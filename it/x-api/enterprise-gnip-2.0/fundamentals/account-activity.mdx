---
title: "Account Activity API: Enterprise"
---

<Note>
  Questo endpoint è stato aggiornato per includere i metadati di modifica dei Post. Scopri di più su questi metadati nella pagina dei fondamenti ["Modifica dei Post"](/it/x-api/enterprise-gnip-2.0/fundamentals/edit-tweets). 

  Questo endpoint è spesso utilizzato con gli endpoint dei Messaggi Diretti. Abbiamo lanciato i nuovi [endpoint v2 dei Messaggi Diretti](/it/x-api/direct-messages/manage/introduction). Nota che le Account Activity API Enterprise e Premium supportano i messaggi one-to-one v2, ma non supportano ancora le conversazioni di gruppo.   
</Note>

Panoramica

`Enterprise`

L’Account Activity API consente di sottoscrivere le attività in tempo reale relative a un account utente tramite webhook. Ciò significa che puoi ricevere in tempo reale Post, Messaggi Diretti e altri eventi dell’account da uno o più dei tuoi account di proprietà o sottoscritti attraverso un’unica connessione.

Riceverai tutte le attività riportate di seguito per ogni sottoscrizione utente associata alla tua registrazione del webhook:

| Tipi di attività |     |
| :--- | :--- |
| \* Post (dell’utente)  <br />    <br />\* Eliminazioni di Post (dell’utente)<br />\* @menzioni (dell’utente)<br />\* Risposte (all’utente o dall’utente)<br />\* Retweet (dell’utente o dell’utente)<br />\* Quote Tweet (dell’utente o dell’utente)<br />\* Retweet di Quote Tweet (dell’utente o dell’utente)<br />\* Mi piace (dell’utente o dell’utente)<br />\* Segui (dell’utente o dell’utente)  <br />    <br />\* Smetti di seguire (dell’utente) | \* Blocchi (dell’utente)<br />\* Sblocchi (dell’utente)<br />\* Silenzi (dell’utente)<br />\* Riattivazioni (dell’utente)<br />\* Messaggi Diretti inviati (dall’utente)<br />\* Messaggi Diretti ricevuti (dall’utente)<br />\* Indicatori di digitazione (verso l’utente)<br />\* Conferme di lettura (verso l’utente)<br />\* Revoche della sottoscrizione (dell’utente) |

**Nota bene** - Non forniamo i dati della home timeline tramite l’Account Activity API. Utilizza [GET statuses/home\_timeline](https://developer.x.com/en/docs/x-api/v1/tweets/timelines/overview) per recuperare questi dati.
 

<div id="video-series">
  #### Serie di video
</div>

Scopri la nostra [serie di quattro video](https://www.youtube.com/watch?v=otPxejFhyy8\&index=0\&list=PLFKjcMIU2WshGG6Yj940XM7Z6BFs1zfBg) sull’Account Activity API per metterti rapidamente al passo!

<iframe src="https://platform.x.com/embed/Tweet.html?dnt=false&embedId=twitter-widget-0&features=eyJ0ZndfdGltZWxpbmVfbGlzdCI6eyJidWNrZXQiOltdLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X2ZvbGxvd2VyX2NvdW50X3N1bnNldCI6eyJidWNrZXQiOnRydWUsInZlcnNpb24iOm51bGx9LCJ0ZndfdHdlZXRfZWRpdF9iYWNrZW5kIjp7ImJ1Y2tldCI6Im9uIiwidmVyc2lvbiI6bnVsbH0sInRmd19yZWZzcmNfc2Vzc2lvbiI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfZm9zbnJfc29mdF9pbnRlcnZlbnRpb25zX2VuYWJsZWQiOnsiYnVja2V0Ijoib24iLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X21peGVkX21lZGlhXzE1ODk3Ijp7ImJ1Y2tldCI6InRydWVfYml0cmF0ZSIsInZlcnNpb24iOm51bGx9LCJ0ZndfZXhwZXJpbWVudHNfY29va2llX2V4cGlyYXRpb24iOnsiYnVja2V0IjoxMjA5NjAwLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X3Nob3dfYmlyZHdhdGNoX3Bpdm90c19lbmFibGVkIjp7ImJ1Y2tldCI6Im9uIiwidmVyc2lvbiI6bnVsbH0sInRmd19kdXBsaWNhdGVfc2NyaWJlc190b19zZXR0aW5ncyI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfdXNlX3Byb2ZpbGVfaW1hZ2Vfc2hhcGVfZW5hYmxlZCI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfdmlkZW9faGxzX2R5bmFtaWNfbWFuaWZlc3RzXzE1MDgyIjp7ImJ1Y2tldCI6InRydWVfYml0cmF0ZSIsInZlcnNpb24iOm51bGx9LCJ0ZndfbGVnYWN5X3RpbWVlX3N1bnNldCI6eyJidWNrZXQiOnRydWUsInZlcnNpb24iOm51bGx9LCJ0ZndfdHdlZXRfZWRpdF9mcm9udGVuZCI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9fQ%3D%3D&frame=false&hideCard=false&hideThread=false&id=996790447048613888&lang=en&origin=https%3A%2F%2Fdeveloper.x.com%2Fen%2Fdocs%2Fx-api%2Fenterprise%2Faccount-activity-api%2Foverview&sessionId=81f4a0339cbd7bd77b669faa00bd3a7224bc4418&theme=light&widgetsVersion=2615f7e52b7e0%3A1702314776716&width=550px" height="400px" />

<div id="feature-summary">
  ### Riepilogo delle funzionalità
</div>

| Tier | Prezzi | Numero di abbonamenti unici | Numero di webhook | Affidabilità e ripristino dell’attività |
| :--- | :--- | :--- | :--- | :--- |
| Enterprise | [Contatta il team vendite](/it/x-api/enterprise-gnip-2.0/enterprise-gnip) | Fino a 500+ | 3+  | [Tentativi di nuovo invio](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#retries) e [Replay](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-replay-api) |

- Hai domande? Riscontri errori?
  - Leggi le nostre [Domande frequenti](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#frequently-asked-questions) o la [Guida alla risoluzione degli errori](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#frequently-asked-questions).

- Esplora il nostro codice di esempio:
  - [Dashboard Enterprise Account Activity API](https://github.com/xdevplatform/account-activity-dashboard-enterprise), un’app web Node che visualizza gli eventi dei webhook usando il tier Enterprise della Account Activity API e include la funzionalità di [Replay](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-replay-api).
  - Il [chatbot SnowBot](https://github.com/xdevplatform/SnowBotDev), un’app web Ruby basata sulle API Enterprise Account Activity e Direct Message.

#### Gestione di un webhook:

L’uso di un webhook consente di sottoscrivere attività in tempo reale relative a un account utente tramite un’unica connessione.

<Tabs>
  <Tab title="Aggiunta di un webhook">
    Iniziamo registrando un nuovo URL di webhook per il contesto applicativo indicato.

    L’URL verrà verificato tramite una richiesta CRC prima del salvataggio. Una volta registrato un webhook, assicurati di annotare l’ID del webhook: ti servirà più avanti.

    Copia la seguente richiesta cURL nel terminale dopo aver aggiornato i seguenti valori:

    - **URL** `<URL>` es. `https://yourdomain.com/webhooks/twitter/`

    - **Consumer key** `<CONSUMER_KEY>` es. `xvz1evFS4wEEPTGEFPHBog`

    - **Access token** `<ACCESS_TOKEN>` es. `370773112-GmHxMAgYyLbNEtIKZeRNFsMKPR9EyMZeS9weJAEb`

      ```
      curl --request POST --url 'https://api.x.com/1.1/account_activity/webhooks.json?url=<URL>' --header 'authorization: OAuth oauth_consumer_key="<CONSUMER_KEY>", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="<ACCESS_TOKEN>", oauth_version="1.0"'
      ```
  </Tab>

  <Tab title="Visualizzazione di un webhook">
    Eseguiremo il seguente comando per ottenere tutti gli URL dei webhook registrati e i relativi stati per la specifica applicazione.

    Copia la seguente richiesta cURL nel terminale dopo aver aggiornato i seguenti valori:

    - **Bearer token** `<BEARER_TOKEN>` es. `AAAAAAAAAAAA0%2EUifi76ZC9Ub0wn...`

      ```curl --request GET --url https://api.x.com/1.1/account_activity/webhooks.json --header 'authorization: Bearer <BEARER_TOKEN>'
      ```
  </Tab>

  <Tab title="Rimozione di un webhook">
    Per rimuovere un webhook dalla configurazione dell’applicazione indicata, copia la seguente richiesta cURL nel terminale dopo aver aggiornato i seguenti valori:

    - **Webhook ID** `<:WEBHOOK_ID>` es. `1234567890`

    - **Consumer key** `<CONSUMER_KEY>` es. `xvz1evFS4wEEPTGEFPHBog`

    - **Access token** `<ACCESS_TOKEN>` es. `370773112-GmHxMAgYyLbNEtIKZeRNFsMKPR9EyMZeS9weJAEb`

      ```curl --request DELETE --url https://api.x.com/1.1/account_activity/webhooks/<:WEBHOOK_ID>.json --header 'authorization: OAuth oauth_consumer_key="<CONSUMER_KEY>", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="<ACCESS_TOKEN>", oauth_version="1.0"'
      ```
  </Tab>
</Tabs>

<div id="managing-a-webhook">
  #### Gestione degli utenti iscritti:
</div>

Una volta registrato un webhook, puoi aggiungere un utente iscritto all’Account Activity API per iniziare a ricevere le attività del suo account.

<Tabs>
  <Tab title="Aggiunta di un'iscrizione">
    Inizieremo iscrivendo un utente così da ricevere tutti i tipi di evento.

    Copia la seguente richiesta cURL nel tuo terminale dopo aver apportato queste modifiche:

    - **ID webhook** `<:WEBHOOK_ID>` ad es. `1234567890`

    - **Nome della consumer key** `<CONSUMER_KEY>` ad es. `xvz1evFS4wEEPTGEFPHBog`

    - **Token di accesso dell’utente da iscrivere** `<SUBSCRIBING_USER'S_ACCESS_TOKEN>` ad es. `370773112-GmHxMAgYyLbNEtIKZeRNFsMKPR9EyMZeS9weJAEb`

      ```
      curl --request POST --url https://api.x.com/1.1/account_activity/webhooks/<:WEBHOOK_ID>/subscriptions/all.json --header 'authorization: OAuth oauth_consumer_key="<CONSUMER_KEY>", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="<SUBSCRIBING_USER'S_ACCESS_TOKEN>", oauth_version="1.0"'
      ```
  </Tab>

  <Tab title="Visualizzazione delle iscrizioni">
    Per visualizzare l’elenco di tutte le iscrizioni ai tipi di attività per un webhook specifico, copia la seguente richiesta cURL nel tuo terminale dopo aver apportato queste modifiche:

    - **ID webhook** `<:WEBHOOK_ID>` ad es. `1234567890`

    - **Bearer token** `<BEARER_TOKEN>` ad es. `AAAAAAAAAAAA0%2EUifi76ZC9Ub0wn...`

      ```
      curl --request GET --url https://api.x.com/1.1/account_activity/webhooks/<:WEBHOOK_ID>/subscriptions/all/list.json --header 'authorization: Bearer <BEARER_TOKEN>'
      ```
  </Tab>

  <Tab title="Rimozione di un'iscrizione">
    Dopo la disattivazione, tutti gli eventi per l’utente richiedente non saranno più inviati all’URL del webhook.

    Per disattivare un’iscrizione nel contesto dell’utente e dell’applicazione indicati, copia la seguente richiesta cURL nel tuo terminale dopo aver apportato queste modifiche:

    - **ID webhook** `<:WEBHOOK_ID>` ad es. `1234567890`

    - **Consumer key** `<CONSUMER_KEY>` ad es. `xvz1evFS4wEEPTGEFPHBog`

    - **Token di accesso dell’utente iscritto** `<SUBSCRIBING_USER'S_ACCESS_TOKEN>` ad es. `370773112-GmHxMAgYyLbNEtIKZeRNFsMKPR9EyMZeS9weJAEb`

      ```
      curl --request DELETE --url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID/subscriptions/all.json --header 'authorization: OAuth oauth_consumer_key="CONSUMER_KEY", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="SUBSCRIBED_USER'S_ACCESS_TOKEN", oauth_version="1.0"'
      ```
  </Tab>
</Tabs>

Ottimo lavoro! Ora dovresti essere in grado di gestire i webhook e gli utenti iscritti.

<div id="managing-subscribed-users">
  #### Articoli di riferimento
</div>

- [Panoramica del Challenge-Response Check (CRC)](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#securing-webhooks)
- \[Account Activity Data Types]\(/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-data-object-structure
- [Gestione di webhook e sottoscrizioni](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#managing-webhooks-and-subscriptions)

## Panoramica video della Account Activity API

In questa panoramica video scoprirai le funzionalità dei livelli Premium ed Enterprise della Account Activity API.

Alla fine di questo video avrai acquisito familiarità con le seguenti funzionalità:

- Registrare un webhook
- Aggiungere una sottoscrizione utente
- Rimuovere una sottoscrizione utente
- Ricevere le attività dell’account
- Riprodurre le attività dell’account

<iframe src="https://platform.x.com/embed/Tweet.html?dnt=false&embedId=twitter-widget-0&features=eyJ0ZndfdGltZWxpbmVfbGlzdCI6eyJidWNrZXQiOltdLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X2ZvbGxvd2VyX2NvdW50X3N1bnNldCI6eyJidWNrZXQiOnRydWUsInZlcnNpb24iOm51bGx9LCJ0ZndfdHdlZXRfZWRpdF9iYWNrZW5kIjp7ImJ1Y2tldCI6Im9uIiwidmVyc2lvbiI6bnVsbH0sInRmd19yZWZzcmNfc2Vzc2lvbiI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfZm9zbnJfc29mdF9pbnRlcnZlbnRpb25zX2VuYWJsZWQiOnsiYnVja2V0Ijoib24iLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X21peGVkX21lZGlhXzE1ODk3Ijp7ImJ1Y2tldCI6InRyZWF0bWVudCIsInZlcnNpb24iOm51bGx9LCJ0ZndfZXhwZXJpbWVudHNfY29va2llX2V4cGlyYXRpb24iOnsiYnVja2V0IjoxMjA5NjAwLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X3Nob3dfYmlyZHdhdGNoX3Bpdm90c19lbmFibGVkIjp7ImJ1Y2tldCI6Im9uIiwidmVyc2lvbiI6bnVsbH0sInRmd19kdXBsaWNhdGVfc2NyaWJlc190b19zZXR0aW5ncyI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfdXNlX3Byb2ZpbGVfaW1hZ2Vfc2hhcGVfZW5hYmxlZCI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfdmlkZW9faGxzX2R5bmFtaWNfbWFuaWZlc3RzXzE1MDgyIjp7ImJ1Y2tldCI6InRydWVfYml0cmF0ZSIsInZlcnNpb24iOm51bGx9LCJ0ZndfbGVnYWN5X3RpbWVsaW5lX3N1bnNldCI6eyJidWNrZXQiOnRydWUsInZlcnNpb24iOm51bGx9LCJ0ZndfdHdlZXRfZWRpdF9mcm9udGVuZCI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9fQ%3D%3D&frame=false&hideCard=false&hideThread=false&id=1204084171334832128&lang=en&origin=https%3A%2F%2Fdeveloper.x.com%2Fen%2Fdocs%2Fx-api%2Fenterprise%2Faccount-activity-api%2Fquick-start%2Fa-visual-walkthrough-of-the-account-activity-api&sessionId=b5b8e259a4c6287be2413de9059093170036fb30&theme=light&widgetsVersion=2615f7e52b7e0%3A1702314776716&width=550px" />

- Hai domande? Riscontri errori?
  - Leggi le nostre [Domande frequenti](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#frequently-asked-questions) o la [guida alla risoluzione degli errori](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#frequently-asked-questions).

- Esplora il nostro codice di esempio:
  - [Dashboard Enterprise per Account Activity API](https://github.com/xdevplatform/account-activity-dashboard-enterprise), una web app Node che mostra gli eventi Webhook utilizzando il livello Enterprise della Account Activity API e include la funzionalità di [Replay](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-replay-api).
  - Il [chatbot SnowBot](https://github.com/xdevplatform/SnowBotDev), una web app Ruby basata sulle API Enterprise Account Activity e Direct Message.

**Enterprise**

<div id="a-video-walkthrough-of-the-account-activity-api">
  ## Per iniziare con i webhook
</div>

L’Account Activity API è un’API basata su webhook che invia eventi dell’account a una web app che sviluppi, distribuisci e ospiti.

Prima di poter iniziare a ricevere eventi webhook nell’applicazione che consuma gli eventi, è necessario occuparsi di alcuni aspetti “infrastrutturali”. Come descritto di seguito, dovrai creare un’app X, ottenere l’accesso all’Account Activity API e sviluppare una web app che elabori gli eventi webhook. 

### 1. Crea un’app X.

- Crea un’[app X](/it/resources/fundamentals/developer-apps) con un account sviluppatore approvato dal [portale per sviluppatori](/it/resources/fundamentals/developer-portal). Se stai creando l’app per conto della tua azienda, è consigliabile usare un account X aziendale. Per richiedere un account sviluppatore, [fai clic qui](/it/resources/fundamentals/developer-apps).
- Abilita “Read, Write and Access direct messages” nella scheda [permissions](/it/resources/fundamentals/developer-apps#oauth-1-0a-app-permissions) della pagina della tua app.
- Nella scheda “Keys and Access Tokens”, annota il Consumer Key (API Key) e il Consumer Token (API Secret) della tua app.
- Nella stessa scheda, genera l’[Access Token e l’Access Token Secret](/it/resources/fundamentals/authentication#obtaining-access-tokens-using-3-legged-oauth-flow) della tua app. Ti serviranno questi access token per registrare l’URL del webhook, dove X invierà gli eventi dell’account.
- Se non conosci il [Login con X](/it/resources/fundamentals/authentication#log-in-with-x) e come funzionano i contesti utente con l’API X, consulta [Obtaining Access Tokens](https://dev.x.com/webhooks/access-tokens). Quando aggiungi account per i quali ricevere eventi, li sottoscriverai utilizzando gli access token di quell’account.
- Prendi nota dell’ID numerico della tua app, come visualizzato nella pagina [“Apps”](/it/resources/fundamentals/developer-apps) del [portale per sviluppatori](/it/resources/fundamentals/developer-portal). Quando richiedi l’accesso all’Account Activity API, ti servirà questo ID app.
   

<div id="1-create-a-x-app">
  ### 2. Ottenere l’accesso all’Account Activity API
</div>

Dopo aver creato un’app X, il passo successivo è richiedere l’accesso all’Account Activity API.

L’Account Activity API è disponibile solo per il piano Enterprise, quindi dovrai inviare una richiesta utilizzando il link seguente.

<Button href="https://developer.x.com/en/enterprise-application.html">
  Richiedi l’accesso Enterprise
</Button>

<div id="2-get-account-activity-api-access">
  ### 3. Sviluppa l’app consumer del webhook
</div>

Una volta ottenuto l’accesso all’Account Activity API, devi sviluppare, distribuire e ospitare un’app web che riceverà gli eventi webhook di X.

- Crea un’app web con un URL da usare come webhook per ricevere gli eventi. Questo è l’endpoint distribuito sul tuo server che ascolta gli eventi webhook di X in arrivo.
  - Il path dell’URI è completamente a tua discrezione. Questo esempio è valido: https://mydomain.com\_/service/listen\_

  - Se ricevi webhook da più fonti, un pattern comune è: https://mydomain.com/webhook/twitter

  - Nota che l’URL specificato non può includere l’indicazione della porta (https://mydomain.com:5000/NoWorkie).

- Come descritto nella nostra guida [Protezione dei webhook](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#securing-webhooks), un primo passo è scrivere codice che riceva una richiesta GET di X Challenge Response Check (CRC) e risponda con un JSON correttamente formattato.

- Registra l’URL del tuo webhook. Invierai una richiesta POST all’endpoint /webhooks.json?url=. Quando effettui questa richiesta, X invierà una richiesta CRC alla tua app web. Quando un webhook viene registrato correttamente, la risposta includerà un id del webhook. Questo id del webhook sarà necessario più avanti per alcune richieste all’Account Activity API.

- X invierà gli eventi webhook dell’account all’URL che hai registrato. Assicurati che la tua app web supporti richieste POST per gli eventi in arrivo. Questi eventi saranno codificati in JSON. Vedi [QUI](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-data-object-structure) esempi di payload JSON dei webhook.

- Una volta che la tua app web è pronta, il passo successivo è aggiungere gli account per i quali ricevere le attività. Quando aggiungi (o elimini) account, effettuerai richieste POST facendo riferimento all’id dell’account. Consulta la nostra [guida sull’aggiunta di sottoscrizioni](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#managing-webhooks-and-subscriptions) per maggiori informazioni.

<div id="3-develop-webhook-consumer-app">
  ### 4. Convalidare la configurazione
</div>

- Per verificare che la tua app e il webhook siano configurati correttamente, metti Mi piace a un Post pubblicato da uno degli account X a cui la tua app è iscritta. Dovresti ricevere un `favorite_events` tramite una richiesta POST all’URL del tuo webhook per ogni Preferito che i tuoi iscritti ricevono.
- Nota che la consegna degli eventi potrebbe iniziare fino a 10 secondi dopo l’aggiunta di un’iscrizione.

**Note importanti**

- Durante la registrazione dell’URL del tuo webhook, la tua web app deve autenticarsi con il proprio consumer token e secret e con il token e secret di accesso utente del proprietario dell’app.

- Tutti i Messaggi Diretti in arrivo saranno recapitati tramite webhook. Tutti i Messaggi Diretti inviati tramite [POST direct\_messages/events/new (message\_create)](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/new-event) saranno anch’essi recapitati tramite webhook. Questo consente alla tua web app di essere a conoscenza dei Messaggi Diretti inviati tramite un client diverso.

- Nota che ogni evento del webhook include un for\_user\_id (ID utente) che indica per quale iscrizione è stato recapitato l’evento.

- Se due utenti utilizzano la tua web app per i Messaggi Diretti nella stessa conversazione, il tuo webhook riceverà due eventi duplicati (uno per ciascun utente). La tua web app dovrebbe tenerne conto.

- Se hai più di una web app che condivide lo stesso URL del webhook e lo stesso utente mappato a ciascuna app, lo stesso evento verrà inviato più volte al tuo webhook (una volta per ogni web app).

- In alcuni casi, il tuo webhook potrebbe ricevere eventi duplicati. La tua app webhook dovrebbe tollerarlo ed eseguire la deduplicazione in base all’ID evento.

- Non aspettarti che una risposta di Quick Reply segua direttamente una richiesta. Un utente può ignorare una richiesta di Quick Reply e rispondere tramite un tradizionale Messaggio Diretto. L’utente può anche fornire una risposta di Quick Reply a una richiesta alla quale non ha risposto in precedenza nel thread del messaggio.

- Vedi codice di esempio:
  - [Enterprise Account Activity API dashboard](https://github.com/xdevplatform/account-activity-dashboard-enterprise), una web app Node che mostra gli eventi del webhook utilizzando il livello enterprise della Account Activity API e include la funzionalità [Replay](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-replay-api).

  - Il [chatbot SnowBot](https://github.com/xdevplatform/SnowBotDev), una web app Ruby basata sulle API Account Activity e Direct Message. Questo codebase include uno [script](https://github.com/xdevplatform/SnowBotDev/wiki/Account-Activity-API-setup-script) per aiutare a configurare i webhook della Account Activity API.

## Proteggere i webhook

Le API di X basate su webhook offrono due metodi per verificare la sicurezza del tuo server webhook:

1. I controlli di challenge-response consentono a X di verificare la proprietà della web app che riceve gli eventi webhook.
2. L’intestazione di firma in ogni richiesta POST ti consente di verificare che X sia l’origine dei webhook in arrivo.
    

### Verifiche Challenge-Response

Per verificare che tu sia il proprietario sia dell'app sia dell'URL del webhook, X eseguirà una Challenge-Response Check (CRC), da non confondere con un controllo di ridondanza ciclica. Quando viene inviato un CRC, X effettuerà una richiesta GET alla tua web app con un parametro _`crc_token`_. Quando tale richiesta viene ricevuta, la tua web app deve creare un `response_token` cifrato basato sul parametro _`crc_token`_ e sul Consumer Secret della tua app (dettagli di seguito). Il `response_token` deve essere codificato in JSON (vedi esempio sotto) e restituito entro tre secondi. In caso di esito positivo, verrà restituito un `id` del webhook.

Un CRC verrà inviato quando registri l’URL del tuo webhook, quindi implementare il codice di risposta al CRC è un primo passo fondamentale. Una volta stabilito il webhook, X attiverà un CRC all’incirca ogni 24 ore dall’ultima volta in cui abbiamo ricevuto una risposta positiva. La tua app può anche attivare un CRC quando necessario effettuando una richiesta PUT con l’`id` del tuo webhook. Attivare un CRC è utile durante lo sviluppo dell’applicazione webhook, dopo il deploy di nuovo codice e il riavvio del servizio.

È previsto che il _`crc_token`_ cambi per ogni richiesta CRC in arrivo e che venga utilizzato come messaggio nel calcolo, dove il tuo Consumer Secret è la chiave.

Nel caso in cui la risposta non venga inviata entro 3 secondi o diventi non valida, gli eventi smetteranno di essere inviati al webhook registrato.

#### La richiesta CRC si verifica:

- Quando si registra un URL webhook.
- All’incirca con cadenza _oraria_ per convalidare l’URL del webhook.
- Puoi attivare manualmente un CRC effettuando una richiesta PUT. Durante lo sviluppo del client del webhook, prevedi di attivare manualmente il CRC mentre definisci la relativa risposta. 
   

<div id="the-crc-request-will-occur">
  #### Requisiti della risposta:
</div>

- Un hash HMAC SHA-256 codificato in base64 generato a partire dal `crc_token` e dal Consumer Secret della tua app.
- `response_token` valido e formato JSON.
- Latenza inferiore a 3 secondi.
- Codice di risposta HTTP 200.
   

<div id="response-requirements">
  #### Librerie HMAC specifiche per lingua:
</div>

- [Java/Scala](https://docs.oracle.com/javase/8/docs/api/index.html?javax/crypto/Mac.html)
- [Ruby](http://ruby-doc.org/stdlib-2.1.0/libdoc/openssl/rdoc/OpenSSL/HMAC.html)
- [Node.js](https://nodejs.org/api/crypto.html#crypto_class_hmac)
- [Python](https://docs.python.org/2/library/hmac.html)

<div id="language-specific-hmac-libraries">
  #### Esempio di generazione del token di risposta in Python:
</div>

Di seguito è definita una route in una webapp Flask per Python 2.7 che risponderà correttamente al controllo di verifica della challenge.

```
import base64
import hashlib
import hmac
import json


\# Defines a route for the GET request
@app.route('/webhooks/twitter', methods=\['GET'\])
def webhook_challenge():

  # crea un hash HMAC SHA-256 dal token in arrivo e dal tuo consumer secret
  sha256\_hash\_digest = hmac.new(TWITTER\_CONSUMER\_SECRET, msg=request.args.get('crc_token'), digestmod=hashlib.sha256).digest()

  # costruisce i dati di risposta con l'hash codificato in base64
  response = {
    'response\_token': 'sha256=' + base64.b64encode(sha256\_hash_digest)
  }

  # restituisce una risposta JSON formattata correttamente
  return json.dumps(response)
```

<div id="example-response-token-generation-in-python">
  #### Esempio di risposta JSON:
</div>

Con la route definita come sopra, la tua web app dovrebbe restituire una risposta simile alla seguente quando visiti https://your-app-domain/webhooks/twitter?crc\_token=foo nel browser.

```
{
  "response_token": "sha256=x0mYd8hz2goCTfcNAaMqENy2BFgJJfJOb4PdvTffpwg="
}
```

<div id="example-json-response">
  #### Altri esempi:
</div>

- [QUI](https://github.com/xdevplatform/account-activity-dashboard/blob/master/helpers/security.js) trovi un esempio di metodo di risposta CRC scritto in Node.js.
- [QUI](https://github.com/xdevplatform/SnowBotDev/blob/master/app/controllers/snow_bot_dev_app.rb) trovi un esempio di metodo di risposta CRC scritto in Ruby (vedi _generate\_crc\_response_ e la route GET che riceve gli eventi CRC).

### Convalida opzionale dell’intestazione della firma

Quando si riceve una richiesta POST da X, si invia una richiesta GET per creare un webhook o si invia una richiesta GET per eseguire un CRC manuale, una firma hash viene passata nelle intestazioni come x-twitter-webhooks-signature. Questa firma può essere utilizzata per verificare che l’origine dei dati sia X. La firma hash del POST inizia con sha256= a indicare l’uso di HMAC SHA-256 per firmare con il tuo X App Consumer Secret il payload. L’hash del GET è calcolato dalla stringa dei parametri di query crc\_token=$token\&nonce=$nonce.

**Passaggi per convalidare una richiesta**

1. Crea un hash utilizzando il tuo consumer secret e il body del payload in arrivo.
2. Confronta l’hash creato con il valore x-twitter-webhooks-signature codificato in base64. Usa un metodo come [compare\_digest](https://docs.python.org/2/library/hmac.html) per ridurre la vulnerabilità ad attacchi di tipo timing.

<div id="optional-signature-header-validation">
  ### Linee guida di sicurezza aggiuntive
</div>

Di seguito sono riportate ulteriori linee guida di sicurezza da considerare per la tua applicazione web. La mancata adozione di queste linee guida non impedirà il funzionamento del webhook, ma sono fortemente consigliate dal team X Information Security. Se non hai familiarità con le raccomandazioni seguenti, consulta l’amministratore del server.

#### Blocchi di rete aggregati di X

Per maggiore sicurezza, potresti aggiungere i seguenti blocchi di rete aggregati a una allowlist:

- 199.59.148.0/22

- 199.16.156.0/22

- 192.133.77.0/26

- 64.63.15.0/24

- 64.63.31.0/24

- 64.63.47.0/24

- 202.160.128.0/24

- 202.160.129.0/24

- 202.160.130.0/24

<div id="x-aggregate-network-blocks">
  #### Configurazioni server consigliate
</div>

- Valutazione “A” nel test di [ssllabs.com](http://ssllabs.com/)
- **Abilita TLS 1.2**
- Abilita la Forward Secrecy
- Disattiva SSLv2
- Disattiva SSLv3 (a causa di POODLE)
- Disattiva TLS 1.0
- Disattiva TLS 1.1
- Disattiva la compressione TLS
- Disattiva i session ticket, a meno che tu non ruoti regolarmente le relative chiavi.
- Imposta l’opzione “ssl\_prefer\_server\_ciphers” o “SSLHonorCipherOrder” nella configurazione SSL su “on”.
- Assicurati che l’elenco dei cifrari sia aggiornato, ad esempio:
  `ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES128-SHA256:AES128-SHA:AES256-GCM-SHA384:AES256-SHA256:AES256-SHA:ECDHE-RSA-DES-CBC3-SHA:DES-CBC3-SHA`

## Gestione di webhook e abbonamenti

### Creazione e modifica dei webhook

Per modificare gli URL dei webhook, devi eliminare il webhook esistente e crearne uno nuovo. Tieni presente che, quando lo fai, ti verrà richiesto di aggiungere nuovamente le iscrizioni degli utenti al nuovo webhook.

#### Endpoint di gestione della configurazione dei webhook:

|     |     |
| :--- | :--- |
| **Metodo** | Enterprise |
| Registra un URL webhook / Genera un webhook\_id | [POST webhooks](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api) |
| Restituisce tutti gli URL webhook e i relativi stati | [GET webhooks](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks) |
| Elimina la configurazione del webhook corrente dell’app | [DELETE webhooks/:webhook\_id](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id) |
| Attiva manualmente una richiesta CRC | [PUT webhooks/:webhook\_id](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id) |

<div id="webhook-configuration-management-endpoints">
  #### Perché non posso semplicemente aggiornare l’URL del webhook?
</div>

Perché le configurazioni dei webhook sono immutabili? X prende molto seriamente la sicurezza. Se l’URL del tuo webhook viene modificato, è possibile che la consumer key e la consumer secret della tua applicazione siano state compromesse. Richiedendoti di creare una nuova configurazione del webhook, ti viene anche imposto di sottoscrivere nuovamente gli eventi dei tuoi utenti. Questo richiede l’uso di token di accesso che è meno probabile che un attore malevolo possegga. Di conseguenza, si riduce la probabilità che un’altra parte riceva informazioni private dei tuoi utenti.
 

### Aggiunta e rimozione delle iscrizioni utente

Il supporto per migliaia di iscrizioni è disponibile con il livello Enterprise. Se disponi già di un account manager, contattalo per qualsiasi domanda. Per richiedere l’accesso alle API Enterprise, [fai clic qui](https://developer.x.com/en/products/x-api/enterprise). 

#### Endpoint per la gestione delle sottoscrizioni

 

|     |     |
| :--- | :--- |
| Metodo | Enterprise |
| Aggiungi una nuova sottoscrizione utente | [POST webhooks/:webhook\_id/subscriptions/all](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all) |
| Recupera una sottoscrizione utente | [GET webhooks/:webhook\_id/subscriptions/all](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all) |
| Restituisce l’elenco di tutte le sottoscrizioni attive | [GET webhooks/:webhook\_id/subscriptions/all/list](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-subscriptions-count) |
| Disattiva una sottoscrizione utente utilizzando l’autenticazione solo app (app-only OAuth) | [DELETE webhooks/:webhook\_id/subscriptions/:user\_id/all.json](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-user-id-all-json) |

Account Activity API: Enterprise

<Note>
  **Nota**: 

  X deve abilitare l’accesso all’Account Activity API per la tua App per sviluppatori prima che tu possa iniziare a usare l’API. A tal fine, assicurati di condividere l’ID dell’App che intendi utilizzare per l’autenticazione con il tuo account manager o con il team di supporto tecnico.
</Note>

L’[Account Activity API](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity) è composta da un insieme di endpoint che consentono di creare e gestire sottoscrizioni utente per ricevere in tempo reale le attività degli account di tutte le sottoscrizioni tramite un’unica connessione. 

Sono disponibili due metodi di autenticazione con l’Account Activity API ([OAuth 1.0a](/it/resources/fundamentals/authentication#oauth-1-0a-2) e [OAuth 2.0 Bearer Token](/it/resources/fundamentals/authentication#bearer-token-also-known-as-app-only)). Il metodo di autenticazione da utilizzare dipende dall’endpoint in uso.

|     |     |     |     |
| :--- | :--- | :--- | :--- |
| **Descrizione** | **Endpoint** | OAuth 1.0a  <br />(contesto utente) | Token Bearer OAuth 2.0 (solo applicazione) |
| Registra un nuovo URL di webhook per il contesto applicativo specificato | [POST account\_activity/webhooks](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks) | ✓   |     |
| Restituisce tutti gli URL e i relativi stati per l’applicazione specificata | [GET account\_activity/webhooks](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks) |     | ✓   |
| Esegue un controllo di verifica della sfida (CRC) per l’URL di un dato webhook | [PUT account\_activity/webhooks/:webhook\_id](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id) | ✓   |     |
| Sottoscrive l’applicazione agli eventi dell’account di un utente | [POST account\_activity/webhooks/:webhook\_id/subscriptions/all](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all) | ✓ \* |     |
| Restituisce il conteggio delle sottoscrizioni attualmente attive | [GET account\_activity/subscriptions/count](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-subscriptions-count) |     | ✓   |
| Verifica se una configurazione di webhook è sottoscritta agli eventi di un utente | [GET account\_activity/webhooks/:webhook\_id/subscriptions/all](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all) | ✓ \* |     |
| Restituisce l’elenco delle sottoscrizioni attualmente attive | [GET account\_activity/webhooks/:webhook\_id/subscriptions/all/list](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all-list) |     | ✓   |
| Elimina un webhook | [DELETE account\_activity/webhooks/:webhook\_id](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id) | ✓   |     |
| \[DEPRECATO] Disattiva una sottoscrizione per il contesto utente e l’applicazione indicati | [DELETE account\_activity/webhooks/:webhook\_id/subscriptions/all](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated) | ✓ \* |     |
| Disattiva una sottoscrizione utilizzando l’autenticazione application-only OAuth | [DELETE /account\_activity/webhooks/:webhook\_id/subscriptions/:user\_id/all.json](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-user-id-all-json) |     | ✓   |
| Riconsegna le attività a un webhook | [POST /1.1/account\_activity/replay/webhooks/:webhook\_id/subscriptions/all.json](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#replay-api) |     | ✓   |

\*\_ L’autenticazione richiede i token di accesso dell’utente che effettua la sottoscrizione. \_

Per gli endpoint che richiedono l’autenticazione con contesto utente OAuth 1.0a, devi fornire le seguenti credenziali per autenticare la richiesta:

- Consumer Keys (API Key e Secret)
- Access Tokens (Access Token e Secret)

Per i tre endpoint seguenti, esegui azioni di scrittura nel contesto della tua applicazione (non sono coinvolti utenti X). Pertanto, gli Access Tokens da fornire sono quelli della tua App per sviluppatori. Puoi generarli direttamente dal [developer portal](https://developer.x.com/en/portal/projects-and-apps), nella scheda “Keys and tokens” della tua App.  

- [POST account\_activity/webhooks](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks): Registra un nuovo URL di webhook per il contesto applicativo indicato
- [PUT account\_activity/webhooks/:webhook\_id](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id): Esegue un controllo CRC (challenge response check) per l'URL di un determinato webhook
- [DELETE account\_activity/webhooks/:webhook\_id](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id): Elimina un webhook

Invece, per i tre endpoint seguenti stai inviando una richiesta che consente alla tua applicazione di accedere a dati protetti per conto di un utente X (ad esempio, Messaggi Diretti). Devi quindi fornire gli Access Token dell’utente sottoscrittore in questione. I token di accesso richiesti possono essere ottenuti utilizzando il flusso OAuth a 3 passaggi (vedi [OAuth 1.0a: come ottenere gli Access Token di un utente](/it/resources/fundamentals/authentication#obtaining-access-tokens-using-3-legged-oauth-flow)). Questi endpoint sono contrassegnati con un asterisco nella tabella sopra (\*).

- [POST account\_activity/webhooks/:webhook\_id/subscriptions/all](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all): Sottoscrive l'applicazione agli eventi dell’account di un utente
- [GET account\_activity/webhooks/:webhook\_id/subscriptions/all](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all): Verifica se una configurazione di webhook è sottoscritta agli eventi di un utente
- [DELETE account\_activity/webhooks/:webhook\_id/subscriptions/all](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated): Disattiva una sottoscrizione per il contesto utente e l’applicazione forniti \[DEPRECATO]

<Note>
  **Nota bene**: 

  Assicurati che la tua App per sviluppatori sia abilitata per "Read, Write, and Direct Messages." Puoi modificare questa impostazione nella [sezione Projects & Apps](https://developer.x.com/en/portal/projects-and-apps) del tuo account sviluppatore, alla voce “App permissions” per l’App selezionata. Dopo aver modificato le impostazioni delle autorizzazioni, dovrai rigenerare le credenziali della tua App.
</Note>

Un elenco di tutti gli endpoint disponibili con l’Account Activity API, incluse le descrizioni e esempi di richieste cURL con esempi di implementazione dell’autenticazione, è disponibile nella [documentazione di riferimento dell’API](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-api-reference-index).

Per ulteriori informazioni, consulta la [web app di esempio e gli script helper](https://github.com/xdevplatform/account-activity-dashboard-enterprise) di XDev per iniziare a usare l’Enterprise Account Activity API.

<Note>
  **Nota bene**: 

  X deve abilitare l’accesso all’Account Activity API per la tua App per sviluppatori prima che tu possa iniziare a usare l’API. A tal fine, assicurati di condividere l’ID dell’App che intendi utilizzare per l’autenticazione con il tuo account manager o il team di supporto tecnico.
</Note>

L’[Account Activity API](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity) è composta da un insieme di endpoint che consentono di creare e gestire sottoscrizioni utente per ricevere, tramite una singola connessione, le attività in tempo reale dell’account per tutti i tuoi account sottoscritti. 

Con l’Account Activity API sono disponibili due metodi di autenticazione ([OAuth 1.0a](/it/resources/fundamentals/authentication#oauth-1-0a-2) e [OAuth 2.0 Bearer Token](/it/resources/fundamentals/authentication#oauth-2-0)). Il metodo di autenticazione da utilizzare dipende dall’endpoint in uso.

|     |     |     |     |
| :--- | :--- | :--- | :--- |
| **Descrizione** | **Endpoint** | OAuth 1.0a  <br />(contesto utente) | Token Bearer OAuth 2.0 (solo applicazione) |
| Registra un nuovo URL di webhook per il contesto applicativo specificato | [POST account\_activity/webhooks](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks) | ✓   |     |
| Restituisce tutti gli URL e i relativi stati per l’applicazione specificata | [GET account\_activity/webhooks](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks) |     | ✓   |
| Esegue un controllo di verifica della sfida (CRC) per l’URL di un dato webhook | [PUT account\_activity/webhooks/:webhook\_id](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id) | ✓   |     |
| Sottoscrive l’applicazione agli eventi dell’account di un utente | [POST account\_activity/webhooks/:webhook\_id/subscriptions/all](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all) | ✓ \* |     |
| Restituisce il conteggio delle sottoscrizioni attualmente attive | [GET account\_activity/subscriptions/count](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-subscriptions-count) |     | ✓   |
| Verifica se una configurazione di webhook è sottoscritta agli eventi di un utente | [GET account\_activity/webhooks/:webhook\_id/subscriptions/all](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all) | ✓ \* |     |
| Restituisce l’elenco delle sottoscrizioni attualmente attive | [GET account\_activity/webhooks/:webhook\_id/subscriptions/all/list](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all-list) |     | ✓   |
| Elimina un webhook | [DELETE account\_activity/webhooks/:webhook\_id](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id) | ✓   |     |
| \[DEPRECATO] Disattiva una sottoscrizione per il contesto utente e l’applicazione indicati | [DELETE account\_activity/webhooks/:webhook\_id/subscriptions/all](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated) | ✓ \* |     |
| Disattiva una sottoscrizione utilizzando l’autenticazione application-only OAuth | [DELETE /account\_activity/webhooks/:webhook\_id/subscriptions/:user\_id/all.json](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-user-id-all-json) |     | ✓   |
| Riconsegna le attività a un webhook | [POST /1.1/account\_activity/replay/webhooks/:webhook\_id/subscriptions/all.json](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#replay-api) |     | ✓   |

\*\_ L’autenticazione richiede i token di accesso dell’utente che effettua la sottoscrizione. \_

Per gli endpoint che richiedono l’autenticazione con contesto utente OAuth 1.0a, devi fornire le seguenti credenziali per autenticare la richiesta:

- Consumer Keys (API Key e Secret)
- Access Tokens (Access Token e Secret)

Per i tre endpoint seguenti, esegui azioni di scrittura nel contesto della tua applicazione (non sono coinvolti utenti X). Pertanto, gli Access Tokens da fornire sono quelli della tua App per sviluppatori. Puoi generarli direttamente dal [developer portal](https://developer.x.com/en/portal/projects-and-apps), nella scheda “Keys and tokens” della tua App.  

- [POST account\_activity/webhooks](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks): Registra un nuovo URL webhook per il contesto applicativo specificato
- [PUT account\_activity/webhooks/:webhook\_id](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id): Avvia un controllo di risposta alla challenge (CRC) per l’URL di un determinato webhook
- [DELETE account\_activity/webhooks/:webhook\_id](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id): Elimina un webhook

D’altra parte, per i tre endpoint seguenti stai effettuando una richiesta che consente alla tua applicazione di accedere a dati protetti per conto di un utente X (ad esempio, i Messaggi Diretti). Devi quindi fornire i token di accesso dell’utente sottoscrittore in questione. I token di accesso richiesti possono essere ottenuti utilizzando il flusso OAuth a 3 passaggi (vedi [OAuth 1.0a: come ottenere i token di accesso di un utente](/it/resources/fundamentals/authentication#obtaining-access-tokens-using-3-legged-oauth-flow)). Questi endpoint sono contrassegnati con un asterisco nella tabella sopra (\*).

- [POST account\_activity/webhooks/:webhook\_id/subscriptions/all](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all): Iscrive l’applicazione agli eventi dell’account di un utente
- [GET account\_activity/webhooks/:webhook\_id/subscriptions/all](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all): Verifica se una configurazione di webhook è iscritta agli eventi di un utente
- [DELETE account\_activity/webhooks/:webhook\_id/subscriptions/all](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated): Disattiva una sottoscrizione per il contesto utente e l’applicazione indicati \[DEPRECATO]

<Note>
  **Nota**: 

  Assicurati che la tua App per sviluppatori sia abilitata per “Lettura, Scrittura e Messaggi Diretti”. Puoi modificare questa impostazione nella [sezione Projects & Apps](https://developer.x.com/en/portal/projects-and-apps) del tuo account sviluppatore, alla voce “App permissions” dell’App selezionata. Dopo aver modificato le autorizzazioni, dovrai rigenerare le credenziali della tua App.
</Note>

Un elenco di tutti gli endpoint disponibili con l’Account Activity API, inclusa la descrizione e gli esempi di richieste cURL con implementazioni di autenticazione, è disponibile nella [documentazione di riferimento dell’API](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-api-reference-index).

Per ulteriori informazioni, consulta la [web app di esempio e gli script di supporto](https://github.com/xdevplatform/account-activity-dashboard-enterprise) di XDev per iniziare a usare l’Enterprise Account Activity API.

## Ritentativi

`Enterprise`

Uno dei vantaggi del livello Enterprise della Account Activity API è un meccanismo di ritentativo per gli eventi webhook. Se non viene ricevuto un codice di risposta HTTP 200 "success", il server di X avvierà un meccanismo di ritentativo, reinviando l'evento webhook fino a tre volte nell’arco di cinque minuti. Questo servizio di ritentativo degli eventi webhook contribuisce a garantire affidabilità e ripristino degli eventi quando si verificano problemi di rete e durante interruzioni del servizio lato client e fasi di deploy.
 

### Che cosa sono i tentativi di reinvio?

L’Account Activity API offre una funzionalità di ritentativo quando l’app web del client non restituisce una risposta 200 “success” per un evento di webhook dell’attività dell’account. Quando il client non conferma la corretta ricezione di un evento, X presume che l’evento non sia stato ricevuto. Se riceviamo una risposta diversa da 200, se non riceviamo alcuna risposta entro tre secondi o se non riceviamo affatto una risposta, ritentiamo la richiesta e la lasciamo aperta per tre secondi. Questo significa che hai circa cinque secondi, su due tentativi, per rispondere e ricevere l’attività che stiamo cercando di inviare al tuo URL di webhook. Nel caso in cui il tuo server non risponda o restituisca un errore temporaneo, eseguiremo ritentativi per cinque minuti. In totale ci saranno tre tentativi di ritentativo per confermare la convalida. Questo garantisce ridondanza e la certezza che tu riceva tutti gli eventi del webhook. Nota che le sottoscrizioni con ritentativi riceveranno eventi ritentati per qualunque/tutte le attività di tutti gli utenti sottoscritti sul proprio webhook.

Se non confermi la convalida entro questi otto tentativi, l’attività non sarà più disponibile tramite l’Account Activity API. 

<div id="what-are-retries">
  ### Sequenza dei tentativi
</div>

L’Account Activity API effettua fino a tre tentativi nell’arco di cinque minuti finché non riceve una risposta 200. Consulta la tabella seguente per maggiori dettagli. Dopo circa cinque minuti, l’attività non può essere reinviata tramite l’Account Activity API. Dovrai utilizzare altri endpoint di X per recuperare i dati mancanti. Ad esempio, le [API di ricerca](/it/x-api/enterprise-gnip-2.0/fundamentals/search-api) possono essere utilizzate per recuperare Post, Retweet, Quote Tweet, Menzioni e Risposte pertinenti. I Messaggi Diretti mancati possono essere recuperati con [questo endpoint](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events).

#### Cronologia dei retry

|     |
| :--- |
| Attività creata, POST all’URL del webhook dall’Account Activity API che va in timeout dopo tre secondi. |
| Attendere tre secondi dopo la fine del timeout precedente, quindi effettuare un POST all’URL del webhook dall’Account Activity API, che va in timeout dopo tre secondi. |
| Attendere 27 secondi dopo la fine del timeout precedente, quindi effettuare un POST all’URL del webhook dall’Account Activity API, che va in timeout dopo tre secondi. |
| Attendere 242 secondi dopo la fine del timeout precedente, quindi effettuare un POST all’URL del webhook dall’Account Activity API, che va in timeout dopo tre secondi. |
| L’Account Activity API interromperà i tentativi di POST dopo questo. Il client deve usare altri endpoint di X per recuperare i dati. |

## Struttura dell’oggetto dati Attività account

| Oggetto | Dettagli |
| :--- | :--- |
| for\_user\_id | Identifica l’abbonamento utente a cui l’evento è correlato. |
| is\_blocked\_by | (condizionale) Mostrato solo quando un altro utente menziona l’utente abbonato. Incluso se true solo per gli eventi di menzione dei Post. |
| source | L’utente che esegue l’attività. Ad esempio, l’utente che segue, blocca o silenzia è l’utente di origine. |
| target | L’utente a cui si applica l’attività. Ad esempio, l’utente che viene seguito, bloccato o silenziato è l’utente di destinazione. |

**Attività disponibili**

| Tipo di messaggio | Dettagli |
| :--- | :--- |
| [tweet\_create\_events](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#tweet-create-events-posts-retweets-replies-quotetweets) | Payload di stato del Post quando una delle seguenti azioni è eseguita dall’utente dell’abbonamento o nei suoi confronti: Post, Retweet, Risposte, @menzioni, QuoteTweet, Retweet di QuoteTweet. |
| [favorite\_events](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#favorite-events) | Evento di Preferito (Mi piace) con l’utente e la destinazione. |
| [follow\_events](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#follow-events) | Evento di Segui con l’utente e la destinazione. |
| [unfollow\_events](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#unfollow-events) | Evento di Smetti di seguire con l’utente e la destinazione. |
| [block\_events](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#block-events) | Evento di Blocco con l’utente e la destinazione. |
| [unblock\_events](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#unblock-events) | Evento di Sblocco con l’utente e la destinazione. |
| [mute\_events](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#mute-events) | Evento di Silenziamento con l’utente e la destinazione. |
| [unmute\_events](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#unmute-events) | Evento di Riattivazione audio con l’utente e la destinazione. |
| [user\_event](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#user-event) | Eventi di revoca inviati quando un utente rimuove l’autorizzazione dell’applicazione e l’abbonamento viene eliminato automaticamente. |
| [direct\_message\_events](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-events) | Stato dei messaggi diretti con l’utente e la destinazione quando un messaggio diretto viene inviato o ricevuto. |
| [direct\_message\_indicate\_typing\_events](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-indicate-typing-events) | Evento di digitazione del messaggio diretto con l’utente e la destinazione. |
| [direct\_message\_mark\_read\_events](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-mark-read-events) | Evento di lettura del messaggio diretto con l’utente e la destinazione. |
| [tweet\_delete\_events](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#tweet-delete-events) | Notifica di Post eliminati per facilitare il rispetto della conformità. |

**Esempi di payload**

Vedi gli esempi di payload sotto per ciascun evento di Attività account descritto nella tabella sopra.

#### tweet\_create\_events (Post, Retweet, Risposte, Quote Tweet) 

```
{
	"for_user_id": "2244994945",
	"tweet_create_events": [
	  {
		<Tweet Object>
	  }
	]
}
```

#### tweet\_create\_events (@menzioni) 

```
{
	"for_user_id": "2244994945",
	"user_has_blocked": "false",
	"tweet_create_events": [
	  {
		<Tweet Object>
	  }
	]
}
```

#### favorite\_events

```
{
	"for_user_id": "2244994945",
	"favorite_events": [{
		"id": "a7ba59eab0bfcba386f7acedac279542",
		"created_at": "Mon Mar 26 16:33:26 +0000 2018",
		"timestamp_ms": 1522082006140,
		"favorited_status": {
			<Tweet Object>
		},
		"user": {
			<User Object>
		}
	}]
}
```

#### follow\_events

```
{
	"for_user_id": "2244994945",
	"follow_events": [{
			"type": "follow",
			"created_timestamp": "1517588749178",
			"target": {
				<Oggetto Utente >
			},
			"source": {
				< Oggetto Utente >
			}
		]
	}
}
```

#### unfollow\_events

```
{
	"for_user_id": "2244994945",
	"follow_events": [{
			"type": "unfollow",
			"created_timestamp": "1517588749178",
			"target": {
				<Oggetto Utente>
			},
			"source": {
				<Oggetto Utente>
			}
		]
	}
}
```

#### block\_events

```
{
	"for_user_id": "2244994945",
	"block_events": [{
		"type": "block",
		"created_timestamp": "1518127020304",
		"source": {
			<User Object>
		},
		"target": {
			<User Object>
		}
	}]
}
```

#### unblock\_events

```
{
	"for_user_id": "2244994945",
	"block_events": [{
		"type": "unblock",
		"created_timestamp": "1518127020304",
		"source": {
			<User Object>
		},
		"target": {
			<User Object>
		}
	}]
}
```

#### eventi\_disattivazione

```
{
	"for_user_id": "2244994945",
	"mute_events": [
		{
			"type": "mute",
		  	"created_timestamp": "1518127020304",
			"source": {
				<User Object>
			},
			"target": {
				<User Object>
			}
		}
	]
}
```

#### unmute\_events

```
{
	"for_user_id": "2244994945",
	"mute_events": [
		{
			"type": "unmute",
		  	"created_timestamp": "1518127020304",
			"source": {
				<User Object>
			},
			"target": {
				<User Object>
			}
		}
	]
}
```

#### user\_event

```
{
	"user_event": {
		"revoke": {
			"date_time": "2018-05-24T09:48:12+00:00",
			"target": {
				"app_id": "13090192"
			},
			"source": {
				"user_id": "63046977"
			}
		}
	}
}
```

#### direct\_message\_events

```
{
  	"for_user_id": "4337869213",
	"direct_message_events": [{
		"type": "message_create",
		"id": "954491830116155396",
		"created_timestamp": "1516403560557",
		"message_create": {
			"target": {
				"recipient_id": "4337869213"
			},
			"sender_id": "3001969357",
			"source_app_id": "13090192",
			"message_data": {
				"text": "Hello World!",
				"entities": {
					"hashtags": [],
					"symbols": [],
					"user_mentions": [],
					"urls": []
				}
			}
		}
	}],
	"apps": {
		"13090192": {
			"id": "13090192",
			"name": "FuriousCamperTestApp1",
			"url": "https://x.com/furiouscamper"
		},
		"users": {},
		"3001969357": {
			"id": "3001969357",
			"created_timestamp": "1422556069340",
			"name": "Jordan Brinks",
			"screen_name": "furiouscamper",
			"location": "Boulder, CO",
			"description": "Alter Ego - X PE opinions-are-my-own",
			"url": "https://t.co/SnxaA15ZuY",
			"protected": false,
			"verified": false,
			"followers_count": 22,
			"friends_count": 45,
			"statuses_count": 494,
			"profile_image_url": "null",
			"profile_image_url_https": "https://pbs.twimg.com/profile_images/851526626785480705/cW4WTi7C_normal.jpg"
		},
		"4337869213": {
			"id": "4337869213",
			"created_timestamp": "1448312972328",
			"name": "Harrison Test",
			"screen_name": "Harris_0ff",
			"location": "Burlington, MA",
			"protected": false,
			"verified": false,
			"followers_count": 8,
			"friends_count": 8,
			"profile_image_url": "null",
			"statuses_count": 240,
			"profile_image_url_https": "https://abs.twimg.com/sticky/default_profile_images/default_profile_normal.png"
		}
	}
}
```

#### direct\_message\_indicate\_typing\_events

```
{
	"for_user_id": "4337869213",
	"direct_message_indicate_typing_events": [{
		"created_timestamp": "1518127183443",
		"sender_id": "3284025577",
		"target": {
			"recipient_id": "3001969357"
		}
	}],
	"users": {
		"3001969357": {
			"id": "3001969357",
			"created_timestamp": "1422556069340",
			"name": "Jordan Brinks",
			"screen_name": "furiouscamper",
			"location": "Boulder, CO",
			"description": "Alter Ego - X PE opinions-are-my-own",
			"url": "https://t.co/SnxaA15ZuY",
			"protected": false,
			"verified": false,
			"followers_count": 23,
			"friends_count": 47,
			"statuses_count": 509,
			"profile_image_url": "null",
			"profile_image_url_https": "https://pbs.twimg.com/profile_images/851526626785480705/cW4WTi7C_normal.jpg"
		},
		"3284025577": {
			"id": "3284025577",
			"created_timestamp": "1437281176085",
			"name": "Bogus Bogart",
			"screen_name": "bogusbogart",
			"protected": true,
			"verified": false,
			"followers_count": 1,
			"friends_count": 4,
			"statuses_count": 35,
			"profile_image_url": "null",
			"profile_image_url_https": "https://pbs.twimg.com/profile_images/763383202857779200/ndvZ96mE_normal.jpg"
		}
	}
}
```

#### direct\_message\_mark\_read\_events

```
{
	"for_user_id": "4337869213",
	"direct_message_mark_read_events": [{
		"created_timestamp": "1518452444662",
		"sender_id": "199566737",
		"target": {
			"recipient_id": "3001969357"
		},
		"last_read_event_id": "963085315333238788"
	}],
	"users": {
		"199566737": {
			"id": "199566737",
			"created_timestamp": "1286429788000",
			"name": "Le Braat",
			"screen_name": "LeBraat",
			"location": "Denver, CO",
			"description": "data di giorno @X, design al crepuscolo",
			"protected": false,
			"verified": false,
			"followers_count": 299,
			"friends_count": 336,
			"statuses_count": 752,
			"profile_image_url": "null",
			"profile_image_url_https": "https://pbs.twimg.com/profile_images/936652894371119105/YHEozVAg_normal.jpg"
		},
		"3001969357": {
			"id": "3001969357",
			"created_timestamp": "1422556069340",
			"name": "Jordan Brinks",
			"screen_name": "furiouscamper",
			"location": "Boulder, CO",
			"description": "Alter ego - X PE opinioni-mie-personali",
			"url": "https://t.co/SnxaA15ZuY",
			"protected": false,
			"verified": false,
			"followers_count": 23,
			"friends_count": 48,
			"statuses_count": 510,
			"profile_image_url": "null",
			"profile_image_url_https": "https://pbs.twimg.com/profile_images/851526626785480705/cW4WTi7C_normal.jpg"
		}
	}
}
```

#### tweet\_delete\_events

```
{
    "for_user_id": "930524282358325248",
    "tweet_delete_events": [
{
        "status": {
            "id": "1045405559317569537",
            "user_id": "930524282358325248"
        },
        "timestamp_ms": "1432228155593"
    }
   ]
}
```

## API di Replay dell’attività dell’account

`Enterprise`

L’Account Activity Replay API è uno strumento di ripristino dei dati che consente di recuperare eventi fino a cinque giorni nel passato. Va utilizzata per ripristinare i dati negli scenari in cui il server [webhook](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api) perde eventi, sia a causa di disconnessioni più lunghe della [finestra di ritentativo](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#retries), sia in scenari di disaster recovery in cui sono necessari alcuni giorni per riportare il sistema alla normalità.

L’Account Activity Replay API è stata sviluppata per qualsiasi scenario in cui non si riesca a ingerire [attività](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity) per un certo periodo di tempo. Recapita le attività allo stesso webhook utilizzato per la consegna in tempo reale originale. Questo prodotto è uno strumento di ripristino e non di backfill, il che significa che gli eventi verranno riprodotti solo se ne è stata tentata in precedenza la consegna. L’Account Activity Replay API non può fornire eventi per un periodo precedente alla data di creazione di una sottoscrizione.

### Utilizzo dell’Account Activity Replay API

Se il tuo account è configurato con la funzionalità Replay, puoi inviare richieste in modo analogo a quelle dell’Account Activity API. È importante notare che la richiesta deve specificare un parametro webhook id per indicare quale webhook desideri riprodurre. In altre parole, una richiesta Replay chiede all’Account Activity Replay API di recuperare gli eventi da una data e ora di inizio a una data e ora di fine in base al webhook id e all’application id.

Tieni presente che è previsto l’uso dell’ora UTC. Queste attività vengono recapitate tramite il webhook registrato associato all’id a una velocità fino a 2.500 eventi al secondo. Ricorda inoltre che può essere in esecuzione un solo job di Replay per webhook alla volta, sebbene tutte le sottoscrizioni attive durante la data/ora specificata per quel webhook vengano riprodotte.

Gli eventi vengono recapitati a partire dal primo (più vecchio) minuto del periodo di tempo specificato, proseguendo in ordine cronologico (per quanto possibile) fino alla consegna dell’ultimo minuto. A quel punto, Replay invierà un [evento di completamento del job](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#job-completed-successfully-message) al webhook. Poiché consegniamo le attività in ordine cronologico, se ci sono pochi o nessun risultato corrispondente vicino all’ora di inizio, è probabile che vi sia un intervallo di tempo prima che vengano recapitati i primi risultati.

<div id="using-account-activity-replay-api">
  ### Limitazioni
</div>

Replay è concepito come uno strumento per recuperare facilmente le attività fino a cinque giorni nel passato, ma non restituirà eventi precedenti al momento di creazione di una sottoscrizione. Ad esempio, se tre giorni fa hai aggiunto una nuova sottoscrizione e hai eseguito un job di Replay con una finestra di cinque giorni antecedenti a oggi, riceveresti dati solo per i tre giorni in cui questa nuova sottoscrizione è stata attiva.

<div id="limitations">
  ### Disponibilità e tipi di dati
</div>

Le attività dell’Account Activity Replay API sono disponibili per cinque giorni dall’avvio della richiesta; i nuovi dati diventano disponibili circa 10 minuti dopo la creazione di una determinata attività. Potrai inviare richieste specificando un intervallo temporale all’interno di questa finestra di cinque giorni utilizzando i parametri from\_date e to\_date nella richiesta. Gli eventi originariamente recapitati prima di ottenere l’accesso a Replay non possono essere riprodotti. Ad esempio, se il tuo account è stato abilitato per l’accesso all’Account Activity Replay API il 1º giugno 2019 alle 15:30 UTC, non potrai utilizzare Replay per recuperare eventi antecedenti a tale data e ora.

Continua alla [Account Activity Replay API reference](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated)

## Introduzione alla migrazione

**Nel 2018 abbiamo dismesso i prodotti Site Streams, User Streams e la versione beta standard dell’Account Activity API – solo DM. Se utilizzavi quei prodotti, assicurati di migrare alla versione premium o enterprise dell’Account Activity API.**

**Abbiamo inoltre dismesso gli endpoint legacy dei Messaggi Diretti. Se utilizzavi quegli endpoint, assicurati di migrare ai nuovi endpoint DM oppure alla versione premium o enterprise dell’Account Activity API.**

**Consulta [questo annuncio](https://devcommunity.x.com/t/details-and-what-to-expect-from-the-api-deprecations-this-week-on-august-16-2018/110746) per saperne di più.**

Ecco gli endpoint interessati da queste modifiche:

- User Streams
- Site Streams
- GET direct\_messages
- GET direct\_messages/sent
- GET direct\_messages/show
- POST direct\_messages/new
- POST direct\_messages/destroy
   

Sono disponibili nuovi endpoint e servizi che offrono un accesso analogo e, per i Messaggi Diretti, anche funzionalità aggiuntive:

- Account Activity API [enterprise](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api) e [premium](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-api-reference-index)
- [GET direct\_messages/events/list](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events)
- [GET direct\_messages/events/show](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/get-event)
- [POST direct\_messages/events/new](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/new-event)
- [POST direct\_messages/events/destroy](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/delete-message-event)

Per aiutarti a effettuare una migrazione senza problemi verso questi nuovi endpoint e servizi, abbiamo due guide alla migrazione:

- [Guida alla migrazione dell’Account Activity API](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#migration-guide-moving-from-user-streams-site-streams-to-account-activity-api) per chi passa da User Streams e Site Streams al nostro nuovo servizio basato su webhook
- [Guida alla migrazione dei Messaggi Diretti](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/guides/direct-message-migration) per chi migra tra gli endpoint REST dei Messaggi Diretti
   

Inoltre, abbiamo una [serie di video](https://www.youtube.com/playlist?list=PLFKjcMIU2WshGG6Yj940XM7Z6BFs1zfBg) sull’Account Activity API e su come iniziare.

Infine, mettiamo a disposizione esempi di codice per approfondire la comprensione e aiutarti a iniziare rapidamente:

- L’[Account Activity Dashboard](https://github.com/xdevplatform/Account-Activity-dashboard) è un’app web di esempio in Node.js con script di supporto per iniziare con l’Account Activity API.
- [SnowBot](https://github.com/xdevplatform/SnowBotDev) è un chatbot di esempio che utilizza l’Account Activity API e gli endpoint REST dei Messaggi Diretti. È scritto in Ruby, usa il framework web Sinatra ed è distribuito su Heroku.

<div id="migration-introduction">
  ## Guida alla migrazione: passaggio da User Streams/Site Streams ad Account Activity API
</div>

**Dal 23 agosto 2018 abbiamo dismesso sia Site Streams sia User Streams. Assicurati di migrare ad Account Activity API.**

**Consulta [questo annuncio](https://devcommunity.x.com/t/details-and-what-to-expect-from-the-api-deprecations-this-week-on-august-16-2018/110746) per ulteriori informazioni.**

Questa guida è pensata per aiutarti a migrare dalle API legacy User Streams e Site Streams alla loro sostituzione, l’Account Activity API. Di seguito troverai un riepilogo delle modifiche, un elenco delle nuove funzionalità, oltre alle principali differenze e considerazioni per agevolare la transizione. Per indicazioni sulla migrazione dagli endpoint DM di base, consulta la [guida alla migrazione dei Direct Message](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/guides/direct-message-migration).

### Riepilogo delle modifiche

L’Account Activity API recapitolerà gli eventi per gli account autenticati e sottoscritti tramite webhook, anziché attraverso una connessione di streaming come con User Streams e Site Streams.

#### API deprecate

GET user

GET site (inclusi i flussi di controllo: GET site/c/:stream\_id, GET site/c/:stream\_id/info.json, GET site/c/:stream\_id/friends/ids.json, POST site/c/:stream\_id/add\_user.json, POST /site/c/:stream\_id/remove\_user.json)

<div id="deprecated-apis">
  #### API sostitutive
</div>

[Enterprise Account Activity API - Tutte le attività](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api)

<div id="new-features">
  ### Differenze e considerazioni per la migrazione
</div>

**Formato API:** La nuova Account Activity API opera in modo diverso rispetto a User Streams e Site Streams. Dovrai modificare la tua web app per ricevere i dati tramite webhook. Puoi trovare ulteriori informazioni sui webhook [qui](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#getting-started-with-webhooks).

**Dati disponibili:** Un’altra differenza importante riguarda i dati forniti. X non invierà più eventi dalle persone che segui su X (ossia la tua home timeline). Si tratta di una modifica intenzionale che non prevediamo di cambiare in futuro.

**Affidabilità:** A differenza dello streaming, i webhook consentono di confermare la consegna e di ritentare le attività inviate tramite POST che non raggiungono l’URL del webhook. Questo offre maggiori garanzie che l’app stia ricevendo tutte le attività pertinenti, anche in caso di brevi disconnessioni o periodi di inattività.

<div id="differences-migration-considerations">
  ### Nuove funzionalità
</div>

L'Account Activity API introduce numerose nuove funzionalità, in particolare la consegna dei dati tramite webhook invece che tramite streaming. I webhook offrono molti vantaggi rispetto allo streaming, tra cui soprattutto velocità e affidabilità. L'API invierà i dati sotto forma di eventi JSON non appena disponibili e non sarà più necessario mantenere una connessione attiva o eseguire il polling dell'endpoint. Questo riduce la necessità di meccanismi di ridondanza e aumenta l'efficienza complessiva. Ulteriori informazioni sui webhook sono disponibili nella [documentazione tecnica](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#getting-started-with-webhooks).

<div id="new-features">
  ### Gestione delle sottoscrizioni utente
</div>

L’Account Activity API consente più sottoscrizioni per un singolo webhook registrato. Questo permette di recapitare le attività di più sottoscrizioni utente nello stesso endpoint, in modo simile all’architettura Site Streams, ma tramite webhook. Ciò significa che puoi monitorare le sottoscrizioni, rispetto ai tuoi limiti di sottoscrizione, indipendentemente dalla connessione del webhook. Questo consente anche di scalare da una o poche sottoscrizioni fino a migliaia per un singolo webhook.

<div id="managing-user-subscriptions">
  ### **Come migrare**
</div>

<div id="how-to-migrate">
  ### **Segui i passaggi seguenti per migrare facilmente dall'API Site Streams all'API Account Activity**
</div>

**Passaggio 1: Scegli un pacchetto**

In base a come stai operando con User Streams o Site Streams, valuta il passaggio alla versione enterprise o premium dell'API Account Activity. Considera il numero di applicazioni o di utenti autorizzati che supporti attualmente e dimensiona in modo adeguato rispetto al volume e all’affidabilità necessari. Quando scegli il pacchetto più adatto alle tue esigenze, prendi in considerazione:

- Numero di webhook necessari
- Numero attuale/stimato di sottoscrizioni/utenti autorizzati gestiti dalla tua applicazione
- Numero attuale di applicazioni client X
- Il livello di supporto che preferisci da X (supporto tramite forum o supporto enterprise gestito 1:1)
- Prezzo di ciascun pacchetto

**Passaggio 2:** **Controlla la configurazione della tua app X nel developer portal**

L’[app X](/it/resources/fundamentals/developer-apps) attualmente usata per User Streams o Site Streams sarà elencata per l’utente proprietario all’interno del [developer portal](/it/resources/fundamentals/developer-portal). Questa app X può essere usata anche con l’API Account Activity per mantenere gli utenti autorizzati su tale applicazione. È anche possibile creare una nuova app e, se desiderato, far ri-autorizzare gli utenti per la nuova app. Se stai creando una nuova app per conto di un’azienda, si consiglia di crearla con un account X @handle aziendale.

- Abilita “Read, Write and Access direct messages” nella scheda [permissions](/it/resources/fundamentals/developer-apps#app-permissions) della pagina della tua app X.
  \*Nota che la modifica di queste impostazioni non è retroattiva: gli utenti già autorizzati manterranno le autorizzazioni concesse al momento dell’autorizzazione. Se un utente non ti ha ancora concesso accesso in lettura, scrittura e ai messaggi diretti, dovrai far ri-autorizzare la tua applicazione a quell’utente.
- Se non hai familiarità con [X Sign-in](/it/resources/fundamentals/authentication#log-in-with-x) e con il funzionamento dei contesti utente con l’API X, consulta [Obtaining Access Tokens](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#getting-started-with-webhooks).
- Genera i token di accesso per il proprietario dell’app X in fondo alla scheda “Keys and Tokens”. Nella stessa scheda annota Consumer Key, Consumer Secret, Access Token e Access Token Secret. Ti serviranno per usare l’API.
- Genera un bearer token usando la tua Consumer Key e Consumer Secret per i metodi API [application-only](/it/resources/fundamentals/authentication#bearer-token-also-known-as-app-only).

**Passaggio 3: Configura i tuoi webhook**

- Crea un’app web con un endpoint da usare come webhook per ricevere eventi (ad es. https://your\_domain.com/webhook/twitter o https://webhooks.your\_domain.com).

- Usa la tua Consumer Key, Consumer Secret, Access Token e Access Token Secret quando crei il webhook. Nota che il tuo endpoint deve restituire una risposta JSON con un response\_token che è un hash HMAC SHA-256 codificato in base64 creato a partire dal crc\_token e dalla Consumer Secret della tua app.

- Consulta la documentazione [Securing Webhooks](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#securing-webhooks) prestando particolare attenzione ai requisiti del Challenge Response Check (CRC).

- Assicurati che il tuo webhook supporti richieste POST per gli eventi in arrivo e richieste GET per il CRC.

- Assicurati che il tuo webhook abbia bassa latenza (meno di 3 secondi per rispondere alle richieste POST)

**Passaggio 4: Convalida la configurazione del tuo webhook**

- Le API dei webhook proteggeranno i tuoi webhook in due modi:

               - Richiedendo challenge response checks per verificare che il proprietario del webhook sia il proprietario dell’app web.

               - Includendo un’intestazione di firma in ogni richiesta POST per consentire alla tua app web di convalidare la fonte.

- Per verificare che tu sia sia il proprietario dell’app web sia dell’URL del webhook, X eseguirà un Challenge Response Check (CRC), da non confondere con un controllo di ridondanza ciclica.
- Una richiesta GET con un parametro denominato crc\_token verrà inviata all’URL del tuo webhook. Il tuo endpoint deve restituire una risposta JSON con un response\_token che è un hash HMAC SHA-256 codificato in base64 creato a partire dal crc\_token e dalla Consumer Secret della tua app.
- Aspettati che il crc\_token cambi a ogni richiesta CRC in arrivo. Il crc\_token deve essere usato come messaggio nel calcolo, dove la tua Consumer Secret è la chiave.
- Se la risposta non è valida, gli eventi smetteranno di essere inviati al webhook registrato.

**Passaggio 5: Crea sottoscrizioni per ciascun utente autorizzato di User Streams o Site Streams**

Conversione all’API Account Activity da User Streams:

- Genera un elenco delle sottoscrizioni utente correnti su User Streams
- Configura le nuove sottoscrizioni all’Account Activity API usando la richiesta:  _POST account\_activity/all/:env\_name/subscriptions_
- Conferma le sottoscrizioni all’Account Activity API usando la richiesta:  \_GET account\_activity/all/:env\_name/subscriptions/list
  \_

Migrazione a Account Activity API da Site Streams: (utilizzando i control streams):

- Genera un elenco delle sottoscrizioni correnti su Site Streams usando la richiesta:  _GET /1.1/site/c/:stream\_id/info.json_
- Configura le nuove sottoscrizioni all’Account Activity API usando la richiesta:  _POST account\_activity/all/:env\_name/subscriptions_
- Conferma le sottoscrizioni all’Account Activity API usando la richiesta:  \_GET account\_activity/all/:env\_name/subscriptions/list
  \_

Registrazione di un webhook e creazione di sottoscrizioni (non in migrazione da Site Streams o User Streams)

- Registra l’URL del webhook con la tua app usando [POST webhooks](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api) e ricevi un webhook\_id.
- Usa il webhook\_id restituito per aggiungere sottoscrizioni utente con [POST webhooks/:webhook\_id/subscriptions/all](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all).

<div id="follow-the-steps-below-to-easily-migrate-from-the-site-streams-api-to-the-account-activity-api">
  ### La dashboard di Account Activity (applicazione di esempio della Account Activity API)
</div>

Abbiamo creato un’app di esempio per rendere il test della Account Activity API un po’ più rapido:   

- Scarica l’applicazione di esempio Account Activity Dashboard [qui](https://github.com/xdevplatform/Account-Activity-dashboard) (usa Node.js)
- Segui le istruzioni nel README per installare e avviare l’app
- Una volta avviata l’applicazione, puoi usare l’interfaccia utente per configurare facilmente il tuo webhook e creare una nuova sottoscrizione

<div id="the-account-activity-dashboard-sample-account-activity-api-application">
  ### Attività disponibili
</div>

| Tipo di messaggio | Dettagli |
| :--- | :--- |
| [tweet\_create\_events](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#tweet-create-events-posts-retweets-replies-quotetweets) | Payload di stato del post quando una delle seguenti azioni viene eseguita dall’utente della sottoscrizione o nei suoi confronti: Post, Retweet, Risposte, @menzioni, QuoteTweet |
| [favorite\_events](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#favorite-events) | Evento di like con l’utente e il destinatario. |
| [follow\_events](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#follow-events) | Evento di follow con l’utente e il destinatario. |
| [block\_events](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#block-events) | Evento di blocco con l’utente e il destinatario. |
| [mute\_events](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#mute-events) | Evento di silenziamento con l’utente e il destinatario. |
| [direct\_message\_events](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-events) | Stato del messaggio diretto con l’utente e il destinatario. |
| [direct\_message\_indicate\_typing\_events](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-indicate-typing-events) | Evento di digitazione nei messaggi diretti con l’utente e il destinatario. |
| [direct\_message\_mark\_read\_events](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-mark-read-events) | Evento di lettura nei messaggi diretti con l’utente e il destinatario. |

### Tipi di messaggi in streaming deprecati 

|     |     |
| :--- | :--- |
| Righe vuote | Le righe vuote non saranno più recapitate nell’Account Activity API poiché erano usate come messaggi di keep-alive in User Streams e Site Streams. |
| Avvisi di limite | Gli avvisi di limite non saranno più inviati a un determinato webhook. In alternativa, gli utenti possono chiamare l’API per ottenere l’utilizzo corrente degli handle disponibili. Questo verrà aggiunto al portale sviluppatori in futuro. |
| Messaggi di disconnessione | Gli avvisi di disconnessione non saranno più necessari poiché i webhook non si basano su una connessione attiva. |
| Avvisi di stallo | Gli avvisi di stallo non saranno più necessari poiché i webhook non dipendono da una connessione attiva in grado di gestire grandi volumi di messaggi in arrivo. |
| Elenco amici | Gli elenchi di amici non saranno più inviati proattivamente. Sarà disponibile un endpoint REST per ottenere queste informazioni. |

<div id="deprecated-streaming-message-types">
  ### Tipi di eventi deprecati
</div>

|     |     |     |     |     |
| :--- | :--- | :--- | :--- | :--- |
| **Descrizione** | **Nome evento** | **Origine** | **Destinazione** | **Oggetto di destinazione** |
| L’utente elimina un Post | delete | Utente corrente | Utente corrente | Post |
| Un utente seguito elimina un Post | delete | Utente seguito | Utente seguito | Post |
| L’utente rimuove il like da un Post | unfavorite | Utente corrente | Autore del Post | Post |
| Un Post dell’utente perde un like | unfavorite | Utente che rimuove il like | Utente corrente | Post |
| L’utente smette di seguire qualcuno | unfollow | Utente corrente | Utente seguito | Null |
| L’utente crea una lista | list\_created | Utente corrente | Utente corrente | Lista |
| L’utente elimina una lista | list\_destroyed | Utente corrente | Utente corrente | Lista |
| L’utente modifica una lista | list\_updated | Utente corrente | Utente corrente | Lista |
| L’utente aggiunge qualcuno a una lista | list\_member\_added | Utente corrente | Utente aggiunto | Lista |
| L’utente viene aggiunto a una lista | list\_member\_added | Utente che aggiunge | Utente corrente | Lista |
| L’utente rimuove qualcuno da una lista | list\_member\_removed | Utente corrente | Utente rimosso | Lista |
| L’utente viene rimosso da una lista | list\_member\_removed | Utente che rimuove | Utente corrente | Lista |
| L’utente si iscrive a una lista | list\_user\_subscribed | Utente corrente | Proprietario della lista | Lista |
| La lista dell’utente riceve una nuova iscrizione | list\_user\_subscribed | Utente che si iscrive | Utente corrente | Lista |
| L’utente annulla l’iscrizione a una lista | list\_user\_unsubscribed | Utente corrente | Proprietario della lista | Lista |
| L’iscrizione alla lista dell’utente viene annullata | list\_user\_unsubscribed | Utente che annulla l’iscrizione | Utente corrente | Lista |
| L’utente aggiorna il proprio profilo | user\_update | Utente corrente | Utente corrente | Null |
| L’utente aggiorna il proprio stato di protezione | user\_update | Utente corrente | Utente corrente | Null |

## Guida alla migrazione dei Messaggi Diretti

**Il 17 settembre 2018 abbiamo ritirato i vecchi endpoint dei Messaggi Diretti.
Se utilizzavi quei endpoint, assicurati di migrare ai nuovi endpoint dei Messaggi Diretti o all’Account Activity API.**

**Consulta [questo annuncio](https://devcommunity.x.com//t/details-and-what-to-expect-from-the-api-deprecations-this-week-on-august-16-2018/110746) per saperne di più.**

Questa guida è pensata per aiutarti a migrare dalle API REST legacy dei Messaggi Diretti alle loro versioni potenziate, uscite dalla fase beta. Di seguito trovi un riepilogo delle modifiche, un elenco delle nuove funzionalità e le principali differenze e considerazioni per facilitare la transizione. I nuovi endpoint dei Messaggi Diretti sono ora disponibili per tutti gli sviluppatori. Per indicazioni sulla migrazione da User Streams o Site Streams, consulta la [guida alla migrazione all’Account Activity API](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#migration-guide-moving-from-user-streams-site-streams-to-account-activity-api).

- [Riepilogo delle modifiche](#summary)
- [Nuove funzionalità](#features)
- [Inviare Messaggi Diretti](#sending)
- [Ricevere Messaggi Diretti](#receiving)
- [Eliminare Messaggi Diretti](#deleting)

### Riepilogo delle modifiche

Se utilizzi ancora i seguenti endpoint dei DM, dovrai eseguire la migrazione ai nuovi endpoint.

| Endpoint deprecato | Nuova alternativa per la migrazione |
| :--- | :--- |
| [POST direct\_messages/new](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/new-event) | [POST direct\_messages/events/new](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/new-event) |
| [GET direct\_messages/show](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/get-event) | [GET direct\_messages/events/show](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/get-event) |
| [GET direct\_messages](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events) | [GET direct\_messages/events/list](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events) |
| [GET direct\_messages/sent](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/get-event) | [GET direct\_messages/events/list](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events) |
| [POST direct\_messages/destroy](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/delete-message-event) | [DELETE direct\_messages/events/destroy](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/delete-message-event "GET direct_messages/events/list") |

<div id="differences-migration-considerations">
  ### Nuove funzionalità
</div>

I nuovi endpoint della API dei Messaggi Diretti introducono diverse capacità e offrono un accesso migliorato ai messaggi diretti precedenti. Le nuove funzionalità includono:

- Supporto per allegati multimediali (immagini, GIF e video).
- Possibilità di proporre agli utenti risposte strutturate con un elenco di opzioni predefinite.
- Accesso ai messaggi diretti passati fino a 30 giorni.

Per l’elenco completo delle nuove funzionalità dei messaggi diretti e dei nuovi endpoint API aggiuntivi, consulta la [documentazione tecnica](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/overview).
 

<div id="new-features">
  ### Differenze e considerazioni per la migrazione
</div>

I nuovi endpoint dell’API si comportano in modo molto diverso rispetto alle versioni precedenti. Limitarsi ad aggiornare gli URL degli endpoint causerà errori nell’applicazione. Tieni presenti le seguenti indicazioni quando aggiorni l’applicazione per la migrazione.

#### Nuovo oggetto Messaggio diretto

La prima cosa che probabilmente noterai è la nuova struttura dell’oggetto dei Messaggi diretti. Questa nuova struttura dell’oggetto Message Create è stata introdotta per supportare funzionalità come [Quick Replies](https://developer.x.com/en/docs/x-api/v1/direct-messages/quick-replies/overview) e [Attachments](https://developer.x.com/en/docs/x-api/v1/direct-messages/message-attachments/overview). Il nuovo oggetto include anche un oggetto utente più piccolo e compatto. L’applicazione dovrà essere aggiornata per tenere conto di questa nuova struttura sia in fase di parsing sia, potenzialmente, nei modelli di dati o nell’archiviazione. Per la descrizione di ciascuna proprietà, consulta la [documentazione completa sul Message Create Object](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/guides/message-create-object).

**Esempio di oggetto message\_create**

```json
{
      "type": "message_create",
      "id": "1234858592",
      "created_timestamp": "1392078023603",
      "initiated_via": {
        "tweet_id": "123456",
        "welcome_message_id": "456789"
      },
      "message_create": {
        "target": {
          "recipient_id": "1234858592"
        },
        "sender_id": "3805104374",
        "source_app_id": "268278",
        "message_data": {
          "text": "Blue Bird",
          "entities": {
            "hashtags": [],
            "symbols": [],
            "urls": [],
            "user_mentions": []
          },
          "quick_reply_response": {
            "type": "options",
            "metadata": "external_id_2"
          },
          "attachment": {
            "type": "media",
            "media": {
             ...
            }
          }
        }
      }
```

<div id="new-direct-message-object">
  #### Riepilogo
</div>

- Struttura completamente nuova dell’oggetto Messaggio Diretto.
- Oggetto utente semplificato.
- Nuove informazioni disponibili (risposte rapide, allegati, ecc.).

### Invio di Messaggi Diretti

[POST direct\_messages/events/new](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/new-event) sostituisce direttamente l’invio dei Messaggi Diretti. La differenza più significativa di questo endpoint è che tutte le informazioni ora vengono inviate come JSON nel corpo della richiesta POST, invece che come singoli parametri POST.

**Esempio di richiesta Twurl**

```bash
twurl -A 'Content-type: application/json' -X POST /1.1/direct\_messages/events/new.json -d '{"event": {"type": "message\_create", "message\_create": {"target": {"recipient\_id": "4534871"}, "message_data": {"text": "Hello World!"}}}}'
```

Nota che nella richiesta sopra il content-type è impostato su application/json anziché su application/x-www-form-urlencoded. Inoltre, se stai costruendo la firma OAuth 1.0a, il corpo JSON non è incluso nella generazione della firma. La maggior parte delle librerie OAuth tiene già conto di questo. Se stai usando [twurl](https://github.com/twitter/twurl), assicurati di utilizzare almeno la versione 0.9.3.

<div id="new-direct-message-object">
  #### Riepilogo
</div>

- Il messaggio è definito nel corpo della richiesta POST in formato JSON
- L’intestazione Content-Type deve essere impostata su application/json
- Il corpo JSON non è incluso nella generazione della firma OAuth.
   

### Recupero dei Messaggi Diretti

Il recupero dei Messaggi Diretti precedenti ora avviene tramite un unico endpoint API: [GET direct\_messages/events/list](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events). La differenza principale di questo nuovo endpoint è che restituisce sia i messaggi inviati sia quelli ricevuti in ordine cronologico inverso, semplificando la ricostruzione di una conversazione. Tuttavia, se ti interessano solo i messaggi inviati o solo quelli ricevuti, dovrai post‑processare la risposta facendo riferimento alla proprietà sender\_id.

La paginazione è ora basata su un valore di cursore anziché sull’ID di un Messaggio Diretto. A ogni risposta viene restituita una proprietà cursor. [GET direct\_messages/events/list](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events) restituisce fino a 30 giorni di messaggi passati, indipendentemente da quanti messaggi siano presenti in quel periodo. Quando non viene restituito alcun cursore, non ci sono ulteriori messaggi disponibili. Il metodo per accedere ai singoli Messaggi Diretti con [GET direct\_messages/events/show](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/get-event) rimane invariato, sebbene l’oggetto Messaggio Diretto restituito abbia una struttura diversa come descritto in precedenza.

Infine, l’accesso in tempo reale ai Messaggi Diretti avverrà tramite webhook con la [Account Activity API](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity). Per indicazioni sulla migrazione da User Streams o Site Streams, consulta la guida alla migrazione alla Account Activity API per maggiori informazioni.

<div id="new-direct-message-object">
  #### Riepilogo
</div>

- I messaggi inviati e ricevuti sono ora disponibili sullo stesso endpoint.
- Fino a 30 giorni di messaggi restituiti.
- Paginazione basata su cursore.
- Accesso in tempo reale ai Messaggi Diretti tramite webhook.

### Eliminazione dei messaggi diretti

I messaggi diretti ora possono essere eliminati con DELETE direct\_messages/events/destroy. L’interfaccia è per lo più invariata e richiede l’ID del messaggio da eliminare. La differenza principale è che l’endpoint ora richiede una richiesta DELETE invece di una POST.

Il modo in cui i messaggi diretti eliminati vengono visualizzati nei client ufficiali di X rimane invariato. I messaggi diretti vengono rimossi solo dall’interfaccia dell’utente nel cui contesto è stata effettuata l’operazione. Gli altri partecipanti alla conversazione possono ancora accedere al messaggio diretto.

<div id="new-direct-message-object">
  #### Riepilogo
</div>

- L’eliminazione di un Messaggio Diretto richiede l’ID.
- Il nuovo endpoint richiede una richiesta DELETE.
- Il modo in cui i Messaggi Diretti eliminati vengono visualizzati nei client ufficiali di X rimane invariato.

**Domande sulla migrazione ai nuovi endpoint dei Messaggi Diretti?**
Pubblica la tua domanda nel forum della community degli sviluppatori su [devcommunity.com](https://devcommunity.x.com/).

## Domande frequenti

### Generale

**Quali sono i vantaggi dell'utilizzo della Account Activity API?**

La Account Activity API utilizza i webhook, il che significa che, a differenza delle API di streaming, non richiediamo di mantenere una connessione aperta per inviarvi informazioni. I webhook sono anche diversi dalle REST API perché non dovete interrogarci centinaia di volte ogni 15 minuti per ottenere i dati che vi interessano. Questo aumenta l’efficienza tra un utente e la vostra app, poiché i dati vengono recapitati non appena si verificano.

La Account Activity API offre numerosi vantaggi:

1. **Velocità**: consegniamo i dati alla velocità di X.
2. **Semplicità**: consegniamo tutti gli eventi di un account tramite un’unica connessione webhook. Le attività recapitate dall’API includono Post, @menzioni, risposte, Retweet, Quote Tweet, Retweet di Quote Tweet, preferiti, Messaggi diretti inviati, Messaggi diretti ricevuti, follow, blocchi, silenziamenti. 
3. **Scalabilità**: ricevete tutte le attività per un account che gestite senza essere limitati da rate limit o tetti agli eventi.

La Account Activity API è disponibile come sandbox premium, premium a pagamento e offerta enterprise, così potete scalarla man mano che vi servono più account per funzionalità di responsabilità o funzionalità aggiuntive.

Per iniziare, scaricate frammenti di codice di esempio da [GitHub](https://github.com/xdevplatform/account-activity-dashboard).
 

**Come faccio a identificare quale livello di prodotto è migliore per me?**

Leggete la nostra pagina [Panoramica della Account Activity API](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity) per saperne di più sulle differenze tra le opzioni Premium e l’opzione Enterprise. 
 

**Qual è la differenza tra un ambiente Premium e un webhook Enterprise?**

Non c’è alcuna differenza. Ogni ambiente Premium avrà il proprio webhook\_id.
 

**Ho bisogno di un ambiente di sviluppo, staging e produzione per la Account Activity API, è possibile?**

Sì! Con i livelli a pagamento della Account Activity API (Premium a pagamento ed Enterprise) è possibile registrare più URL webhook e gestire separatamente le sottoscrizioni per ciascuno tramite i metodi dell’API. Inoltre, più app client possono essere aggiunte a un allowlist per mantenere l’autorizzazione per i vostri utenti attuali.
 

**Avete guide passo-passo su come configurare la Account Activity API?**

In effetti sì!

- Se state iniziando, vi consigliamo di visitare la guida [Guida introduttiva ai webhook](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#getting-started-with-webhooks)

- Seguite i nostri script supportati da X Dev: 
  - [Account Activity API dashboard](https://github.com/xdevplatform/account-activity-dashboard), una web app Node che mostra gli eventi del webhook.
  - Il [chatbot SnowBot](https://github.com/xdevplatform/SnowBotDev), una web app Ruby basata sulle Account Activity e Direct Message API. Questo codebase include uno [script](https://github.com/xdevplatform/SnowBotDev/wiki/Account-Activity-API-setup-script) per aiutare a configurare i webhook della Account Activity API.
     

**Esiste un modo per recuperare i dati se il nostro sistema va offline per un periodo di tempo?**

Con i livelli a pagamento della Account Activity API (Premium a pagamento ed Enterprise), il nostro sistema [ritenterà](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#retries) di inviarvi le attività più volte nell’arco di quattro ore. Se il vostro sistema non risponde entro quel periodo di quattro ore, l’attività andrà persa e dovrete utilizzare altri endpoint REST per recuperare i dati entro 7 giorni.

Suggeriamo di usare i vostri diversi webhook, o ambienti, come strumento di ridondanza, ad esempio la [Account Activity Replay API](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-replay-api), per assicurarvi di non perdere attività se uno dei vostri sistemi va offline.
 

**Quale autenticazione devo usare con la Account Activity API?**

I metodi di autorizzazione richiesti per la Account Activity API sono descritti per metodo nelle [pagine di riferimento dell’API](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-api-reference-index). Se state iniziando con l’autenticazione X, vi consigliamo di leggere [questa sezione](/it/resources/fundamentals/authentication).

**Che cos’è un challenge-response check (CRC)?**

Il controllo della risposta alla challenge dell’Account Activity API è una funzione di sicurezza pensata per garantire che le attività dell’Account Activity API vengano inviate allo sviluppatore corretto. Può anche essere utilizzata dagli sviluppatori per assicurarsi che i dati che stanno ricevendo provengano da X. X invierà automaticamente un CRC all’URL del tuo webhook una volta ogni 24 ore, a partire dall’ultima volta in cui l’URL del webhook è stato convalidato. Il tuo sistema deve rispondere con una risposta valida entro 3 secondi per rimanere convalidato.

Visita la nostra pagina [Proteggere i webhook](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#securing-webhooks) per maggiori dettagli.

**C’è qualcosa che invaliderebbe immediatamente l’URL del mio webhook?**

Se si verifica una delle seguenti condizioni, contrassegneremo immediatamente il tuo webhook come non valido:

- Il server risponde a un CRC con un token errato. In questo caso, il nostro sistema non [ritenterà](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#retries) di inviarti l’attività.
- L’URL del webhook ha un certificato configurato in modo errato. In questo caso, il nostro sistema non [ritenterà](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#retries) di inviarti l’attività.
- Il tuo server restituisce un codice di risposta diverso da 2XX, 4XX o 5XX.
- Dichiari l’uso di gzip senza effettivamente inviarlo.
- Non dichiari l’uso di gzip, ma lo invii comunque nella risposta.

**Riceverò attività duplicate se sono iscritto a utenti che stanno interagendo tra loro?**

Sì. Se la tua app web ha sottoscrizioni attive per l’Utente A e l’Utente B, e l’Utente A menziona l’Utente B in un Post, verranno inviate due attività POST al webhook registrato. Ogni attività avrà un indicatore "for\_user\_id" per mostrare a quale sottoscrizione appartiene.

**Quando effettuo una sottoscrizione al mio webhook, posso sostituire la parte `/all/` del seguente endpoint con altri oggetti di dati dell’Account Activity per limitare le attività che l’API consegna?** `POST https://api.x.com/1.1/account_activity/all/:env_name/subscriptions.json`

No, non è possibile. Allo stato attuale, è disponibile solo il prodotto `/all/`.

**Esiste un modo per utilizzare l’Account Activity API senza richiedere agli utenti le autorizzazioni per i Messaggi Diretti?**

Al momento, le autorizzazioni per i Messaggi Diretti sono necessarie perché non c’è modo di filtrare le attività dei Messaggi Diretti per questa API.

**Esiste una versione gratuita dell’Account Activity API?**

Sì, offriamo la versione sandbox come livello gratuito. La nostra opzione sandbox è limitata a un singolo webhook con un massimo di 15 sottoscrizioni. Puoi leggere di più sull’opzione sandbox nella [nostra documentazione](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity).

**È possibile utilizzare l’Account Activity API per ottenere i Retweet dei Post che menzionano utenti sottoscritti?**

Purtroppo, questo non fa parte delle attività consegnate con questa API. Per questo, suggeriamo di utilizzare la Streaming API.

**Quali sono i possibili tipi di attività rappresentati da un tweet\_create\_event?**

Un payload tweet\_create\_event verrà inviato:

Se l’utente sottoscritto compie una delle seguenti azioni:

- Crea un Post
- Esegue un Retweet
- Risponde a un Post

Se un altro utente:

- @menziona\* l’utente sottoscritto
- Cita un Tweet creato dall’utente sottoscritto

_Nota: l’Account Activity API consegna eventi solo quando l’utente sottoscritto riceverebbe una notifica da X e potrebbe vedere l’evento pubblicamente. Ciò significa che, se l’account menzionato (@userA) segue l’account protetto (@userB), allora UserA riceverà una notifica che UserB lo ha menzionato. Se UserA non segue UserB (ed è stato approvato da UserB), UserA non riceverà una notifica e, pertanto, un tweet\_create\_event non verrebbe inviato tramite AAA se @userA avesse una sottoscrizione._

**Se un utente bloccato menziona il mio utente sottoscritto, come posso identificarlo?**

Vedrai un campo booleano `user_has_blocked` al livello superiore della risposta JSON, impostato su "true" o "false". Questo campo verrà esposto solo per le menzioni ai Post.

Enterprise

**Come posso aggiungere la mia app a una allowlist o verificare se la mia app è già nella allowlist?**

Per gestire le [app X](/it/resources/fundamentals/developer-apps) che hai aggiunto a un allowlist per l’accesso tramite le Enterprise API, contatta il tuo account manager fornendo l’ID della tua app. Puoi trovare l’ID della tua app andando alla pagina ["Apps"](/it/resources/fundamentals/developer-apps) nel [portale per sviluppatori](/it/resources/fundamentals/developer-portal).
 

**Se ho accesso a tre webhook, posso usare tre webhook per ciascuna delle app che ho registrato per uso enterprise?**

Il limite dei webhook è impostato a livello di account, non a livello di app. Se hai accesso a tre webhook e due app registrate per uso enterprise, puoi usare due webhook su un’app e il terzo sull’altra, ma non tre su ciascuna app. 

**Posso specificare quali tipi di eventi verranno riconsegnati usando l’Account Activity Replay API?**

I tipi di eventi da riprodurre non possono essere specificati. Tutti gli eventi recapitati durante l’intervallo di data e ora indicato verranno riprodotti. 

**Sono previsti nuovi tentativi se la mia applicazione non riesce ad acquisire un evento dell’Account Activity Replay API?**

No, non sono previsti nuovi tentativi. Se un’applicazione non riesce ad acquisire un evento inviato dall’Account Activity Replay API, è possibile inviare un altro job di Replay per lo stesso periodo di tempo per tentare la riconsegna di eventuali eventi di Replay non ricevuti. 

**Cosa devo fare quando ricevo un evento di completamento con esito parziale?**

Consigliamo di annotare i timestamp degli eventi ricevuti e di richiedere un altro job di Replay per quelli mancanti. 

**Quanti job dell’Account Activity Replay API posso avere in esecuzione contemporaneamente?**

Può essere in esecuzione un solo job dell’Account Activity Replay API per webhook alla volta. 

**Come posso distinguere gli eventi dell’Account Activity Replay API dagli eventi di produzione in tempo reale mentre vengono recapitati al mio webhook?**

Poiché l’Account Activity Replay API recapita sempre eventi passati, è possibile distinguerli da quelli di produzione in tempo reale in base al timestamp dell’evento. 

**Quanto presto posso iniziare a usare l’Account Activity Replay API per riconsegnare un’attività che la mia applicazione ha perso o non ha elaborato?**

Un’attività diventa disponibile per la riconsegna circa 10 minuti dopo la sua creazione. 

<div id="general">
  ### Guida alla risoluzione degli errori
</div>

#### Codice 32

Questo errore in genere indica che c’è qualcosa di non valido nella richiesta, nelle intestazioni, nell’autorizzazione o nell’URL specificato. Non è un errore dell’Account Activity API: è un errore di autorizzazione e X non sta ricevendo la corretta configurazione OAuth o l’URL.

- **Enterprise** - Assicurati che le consumer key e gli access token che stai utilizzando appartengano a una [app X](/it/resources/fundamentals/developer-apps) registrata per l’uso dei prodotti Enterprise. Se non disponi delle consumer key e degli access token o devi aggiungere la tua app X alla allowlist, contatta il tuo account manager. 

- Se esegui l’autenticazione con contesto utente, assicurati di aver [autorizzato correttamente la richiesta](/it/resources/fundamentals/authentication#authorizing-a-request) includendo `oauth_nonce`, `oauth_signature` e `oauth_timestamp` corretti.

- Assicurati che i tuoi access token abbiano il livello di autorizzazione corretto.
  - Nella scheda “Keys and tokens” della [dashboard dell’app](/it/resources/fundamentals/developer-apps), verifica che i tuoi access token abbiano il [livello di autorizzazione](/it/resources/fundamentals/developer-apps#app-permissions) “Read, write, and direct messages”. 
  - Se il livello di autorizzazione dei token è inferiore, vai alla scheda “Permissions”, imposta l’autorizzazione su “Read, write, and direct messages”, quindi rigenera gli access token e il secret dalla scheda “Keys and tokens”.

- Assicurati che l’URL sia formato correttamente.
  - Tieni presente che `:env_name` distingue tra maiuscole e minuscole.
     

<div id="code-32">
  #### Codice 200 - Accesso negato
</div>

- **Premium** - Assicurati di avere un [account sviluppatore](/it/resources/fundamentals/developer-portal) approvato prima di effettuare una richiesta all'API. Devi inoltre usare il valore corretto di :env\_name nella richiesta, che puoi configurare nella pagina [dev environments](/it/resources/fundamentals/developer-portal).

- **Enterprise** - Verifica che il tuo account manager ti abbia abilitato l'accesso all'Account Activity API.

- Verifica di aver configurato correttamente l'URI. Questo errore può verificarsi se hai inserito un URI errato nella richiesta.
   

<div id="code-200-forbidden">
  #### Codice 214 - L’URL del webhook non soddisfa i requisiti.
</div>

- Assicurati di utilizzare https.
- L’URL del webhook potrebbe essere malformato.
- Per maggiori dettagli sulla configurazione dell’URL del webhook, consulta la sezione [Sviluppare l’app consumer del webhook](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#3-develop-webhook-consumer-app) nella pagina [Introduzione ai webhook](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#getting-started-with-webhooks).
   

<div id="code-214-webhook-url-does-not-meet-the-requirements">
  #### Codice 214 - Latenza elevata nella richiesta CRC GET. Il tuo webhook deve rispondere in meno di 3 secondi.
</div>

- Ciò significa che il tuo server è lento. Assicurati di rispondere al CRC entro 3 secondi.
   

<div id="code-214-high-latency-on-crc-get-request-your-webhook-should-respond-in-less-than-3-seconds">
  #### Codice 214 - Codice di risposta non 200 durante la richiesta CRC GET (ad es. 404, 500, ecc.).
</div>

- Il server è inattivo. Verifica che il server sia in esecuzione correttamente.
   

<div id="code-214-non-200-response-code-during-crc-get-request-ie-404-500-etc">
  #### Codice 214 - Troppe risorse già create.
</div>

- **Enterprise** - Hai già utilizzato tutti i tuoi webhook. Usa l’endpoint [GET webhooks](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks) con ciascuna delle tue app registrate per identificare dove sono distribuiti i tuoi webhook. 

<div id="code-214-too-many-resources-already-created">
  #### Codice 261 - L'applicazione non può eseguire azioni di scrittura.
</div>

- L'app che stai utilizzando con l'API non dispone del [livello di autorizzazione](/it/resources/fundamentals/developer-apps#app-permissions) corretto per il proprio access token e access token secret. Vai alla scheda "Keys and tokens" nella dashboard delle [X apps](/it/resources/fundamentals/developer-apps) e verifica i livelli di autorizzazione assegnati al tuo access token e access token secret. Se è impostato su qualcosa di diverso da "Read, write and Direct Messages", modifica le impostazioni nella scheda "Permission" e rigenera il tuo access token e access token secret per applicare le nuove impostazioni.
- In alternativa, potresti star tentando di registrare un webhook utilizzando l'autenticazione "app-only", che non è supportata. Autenticati invece con contesto utente, come indicato nelle sezioni di riferimento dell'API per la registrazione di un webhook per l'[Enterprise Account Activity API](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks).

## Indice di riferimento dell’Account Activity API

|     |     |
| :--- | :--- |
| **Ambito** | Enterprise |
| Registra un URL di webhook / Genera un webhook\_id | [POST  <br />webhooks](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api) |
| Restituisce tutti gli URL dei webhook e i relativi stati | [GET  <br />webhooks](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks) |
| Avvia manualmente un controllo di risposta alla challenge | [PUT  <br />webhooks/:webhook\_id](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id) |
| Sottoscrive un’applicazione agli eventi di un account | [POST  <br />webhooks/:webhook\_id/subscriptions/all](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all) |
| Restituisce il numero delle sottoscrizioni attive correnti | [GET  <br />subscriptions/count](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-subscriptions-count) |
| Verifica se un webhook è sottoscritto a un account | [GET  <br />webhooks/:webhook\_id/subscriptions/all](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all) |
| Restituisce l’elenco delle sottoscrizioni attive correnti | [GET  <br />webhooks/:webhook\_id/subscriptions/all/list](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-subscriptions-count) |
| Elimina il webhook | [DELETE  <br />webhooks/:webhook\_id](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id) |
| Disattiva una sottoscrizione utilizzando OAuth a 3 passaggi (DEPRECATO) | [DELETE  <br />webhooks/:webhook\_id/subscriptions/all](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated) |
| Disattiva una sottoscrizione utilizzando OAuth solo applicazione | [DELETE  <br />webhooks/:webhook\_id/subscriptions/:user\_id/all.json](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-user-id-all-json) |
| Riconsegna le attività a un webhook | [POST  <br />replay/webhooks/:webhook\_id/subscriptions/all](/it/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated) |

### API Enterprise Account Activity

#### POST account\_activity/webhooks[](#post-account-activity-webhooks "Permalink to this headline")

Registra un nuovo URL webhook per il contesto applicativo specificato. L’URL verrà validato tramite una richiesta CRC prima del salvataggio. Se la validazione non va a buon fine, restituisce al richiedente un messaggio di errore dettagliato.

Il numero di webhook consentiti è determinato dal piano di fatturazione.

### URL della risorsa[](#resource-url "Permalink a questo intestazione")

`https://api.x.com/1.1/account_activity/webhooks.json`

<div id="resource-url">
  ### Informazioni sulla risorsa[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Formato di risposta | JSON |
| Richiede autenticazione | Sì (contesto utente: tutti i token consumer e di accesso) |
| Soggetto a limitazioni di frequenza | Sì |
| Richieste/15 minuti (autenticazione utente) | 15 |
| Supporto per le modifiche ai Tweet | Tutti gli oggetti Tweet includeranno metadati sulle modifiche che descrivono la cronologia delle modifiche del Tweet. Consulta la pagina ["Modifiche ai Tweet"](/it/x-api/enterprise-gnip-2.0/fundamentals/edit-tweets) per ulteriori dettagli. |

<div id="resource-information">
  ### Parametri[](#parameters "Permalink a questo titolo")
</div>

|     |     |
| :--- | :--- |
| url (obbligatorio) | URL codificata per l’endpoint di callback. |

<div id="parameters">
  ### Esempio di richiesta[](#example-request "Permalink a questo titolo")
</div>

$ curl --request POST
\--url 'https://api.x.com/1.1/account\_activity/webhooks.json?url=https%3A%2F%2Fyour\_domain.com%2Fwebhooks%2Ftwitter%2F0'
\--header 'authorization: OAuth oauth\_consumer\_key="CONSUMER\_KEY", oauth\_nonce="GENERATED", oauth\_signature="GENERATED", oauth\_signature\_method="HMAC-SHA1", oauth\_timestamp="GENERATED", oauth\_token="ACCESS\_TOKEN", oauth\_version="1.0"'

<div id="example-request">
  ### Risposte HTTP[](#http-responses "Permalink to this headline")
</div>

| Codice HTTP | Messaggio |
| :--- | :--- |
| 200 | L'URL del webhook è registrato per l'applicazione indicata |
| 403 | Si è verificato un errore nella richiesta. Consultare la sezione dei messaggi di errore di seguito. |

<div id="http-responses">
  ### Esempio di risposta - esito positivo[](#example-response-success "Permalink a questo titolo")
</div>

```json
_HTTP 200_

    {
      "id": "1234567890",
      "url": "https://your_domain.com/webhook/twitter/0",
      "valid": true,
      "created_at": "2016-06-02T23:54:02Z"
    }
```

<div id="example-response-success">
  ### Messaggi di errore[](#error-messages "Permalink to this headline")
</div>

| Codice | Messaggio |
| :--- | :--- |
| 214 | L'URL del webhook non soddisfa i requisiti. |
| 214 | Sono già state create troppe risorse. |
| 214 | L'URL del webhook non soddisfa i requisiti. Token CRC o formato di risposta JSON non valido. |
| 214 | Latenza elevata sulla richiesta GET del CRC. Il webhook deve rispondere in meno di 3 secondi. |
| 214 | Codice di risposta diverso da 200 durante la richiesta GET del CRC (es. 404, 500, ecc.). |

_HTTP 403_

```json
    {
      "errors": [
        {
          "code": 214,
          "message": "Too many resources already created."
        }
      ]
    }
```

#### GET account\_activity/webhooks[](#get-account-activity-webhooks "Permalink a questo titolo")

Restituisce tutti gli URL e i rispettivi stati per l'applicazione indicata.

Contrassegniamo un URL come non valido se non supera il controllo di convalida giornaliero. Per riattivare l’URL, chiama l’endpoint di aggiornamento.

### URL della risorsa[](#resource-url "Permalink a questo intestazione")

`https://api.x.com/1.1/account_activity/webhooks.json`

<div id="resource-url">
  ### Informazioni sulla risorsa[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Formato della risposta | JSON |
| Richiede autenticazione | Sì (solo applicazione - bearer token) |
| Limitazione di frequenza | Sì |
| Richieste per finestra di 15 minuti (autenticazione applicazione) | 15  |

<div id="parameters">
  ### Esempio di richiesta[](#example-request "Permalink a questo titolo")
</div>

```bash
    $ curl --request GET
     --url https://api.x.com/1.1/account_activity/webhooks.json
     --header 'authorization: Bearer TOKEN'
```

<div id="example-request">
  ### Risposta di esempio[](#example-response "Permalink to this headline")
</div>

_HTTP 200 OK_

```json
    [
      {
        "id": "1234567890",
        "url": "https://your_domain.com/webhook/twitter/0",
        "valid": true,
        "created_at": "2016-06-02T23:54:02Z"
      }
      {
        "id": "2468013579",
        "url": "https://your_domain2.com/webhook/twitter/0",
        "valid": true,
        "created_at": "2016-06-04T22:31:29Z"
      }
    ]
```

<div id="example-response-success">
  ### Messaggi di errore[](#error-messages "Permalink to this headline")
</div>

| Codice | Messaggio |
| :--- | :--- |
| 99  | Non disponi dell’accesso a questa risorsa. |

#### PUT account\_activity/webhooks/:webhook\_id[](#put-account-activity-webhooks-webhook-id "Permalink a questo titolo")

Esegue il challenge response check (CRC) per l’URL del webhook specificato. Se il controllo ha esito positivo, restituisce 204 e riabilita il webhook impostandone lo stato su `valid`.

### URL della risorsa[](#resource-url "Permalink a questo titolo")

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id.json`

<div id="resource-url">
  ### Informazioni sulla risorsa[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Formato della risposta | JSON |
| Richiede autenticazione | Sì (contesto utente: tutti i token consumer e di accesso) |
| Soggetto a limitazione di velocità | Sì |
| Richieste per finestra di 15 minuti (autenticazione utente) | 15  |

<div id="resource-information">
  ### Parametri[](#parameters "Permalink a questo titolo")
</div>

|     |     |
| :--- | :--- |
| webhook\_id (obbligatorio) | ID del webhook. Definito nel percorso della risorsa. |

<div id="parameters">
  ### Esempio di richiesta[](#example-request "Permalink a questo titolo")
</div>

```json
    $ curl --request PUT
     --url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID.json
     --header 'authorization: OAuth oauth_consumer_key="CONSUMER_KEY", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="ACCESS_TOKEN", oauth_version="1.0"'
```

<div id="example-request">
  ### Risposta[](#response "Permalink to this headline")
</div>

_HTTP 204 OK_

```
    { }
```

### Messaggi di errore[](#error-messages "Permalink a questo titolo")

| Codice | Messaggio |
| :--- | :--- |
| 34  | Il webhook non esiste o è associato a un’applicazione X diversa. |
| 214 | L’URL del webhook non soddisfa i requisiti. |
| 214 | L’URL del webhook non soddisfa i requisiti. Token CRC non valido o formato della risposta JSON non valido. |
| 214 | Latenza elevata per la richiesta GET del CRC. Il webhook dovrebbe rispondere in meno di 3 secondi. |
| 214 | Codice di risposta diverso da 200 durante la richiesta GET del CRC (ad es. 404, 500, ecc.). |

#### POST account\_activity/webhooks/:webhook\_id/subscriptions/all[](#post-account-activity-webhooks-webhook-id-subscriptions-all "Permalink a questo titolo")

Iscrive l’applicazione indicata a tutti gli eventi nel contesto utente specificato per tutti i tipi di messaggio. Dopo l’attivazione, tutti gli eventi relativi all’utente richiedente saranno inviati al webhook dell’applicazione tramite richiesta POST.

Le iscrizioni sono attualmente limitate in base alla configurazione dell’account. Se hai bisogno di aggiungerne altre, contatta il tuo account manager.

### URL della risorsa[](#resource-url "Permalink to this headline")

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/all.json`

<div id="resource-url">
  ### Informazioni sulla risorsa[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Formato di risposta | JSON |
| Richiede autenticazione | Sì (OAuth a 3 attori - consumer key in whitelist e token di accesso dell’utente sottoscrivente) |
| Soggetta a rate limiting | Sì |
| Richieste / finestra di 15 minuti (autenticazione utente) | 500 |

<div id="resource-information">
  ### Parametri[](#parameters "Permalink a questo titolo")
</div>

|     |     |
| :--- | :--- |
| webhook\_id (obbligatorio) | ID del webhook. Definito nel percorso della risorsa. |

### Esempio di richiesta[](#example-request "Permalink to this headline")

```bash
    $ curl --request POST
     --url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID/subscriptions/all.json
     --header 'authorization: OAuth oauth_consumer_key="WHITELISTED_CONSUMER_KEY", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="SUBSCRIBING_USER'S_ACCESS_TOKEN", oauth_version="1.0"'
```

<div id="example-request">
  ### Esempio di risposta - Successo[](#example-response-success "Permalink a questo titolo")
</div>

_HTTP 204 NESSUN CONTENUTO_

```
    {}
```

<div id="example-response-success">
  ### Messaggi di errore[](#error-messages "Permalink to this headline")
</div>

| Codice | Messaggio |
| :--- | :--- |
| 34  | Il webhook non esiste o è associato a un’applicazione X diversa. |
| 348 | L’applicazione client non è autorizzata ad accedere alle sottoscrizioni webhook di questo utente. |

#### GET account\_activity/subscriptions/count[](#get-account-activity-subscriptions-count "Permalink a questo titolo")

Restituisce il conteggio delle sottoscrizioni attualmente attive sul tuo account. Nota che l’endpoint /count richiede l’autenticazione OAuth in modalità application-only; pertanto, effettua le richieste utilizzando un bearer token invece del contesto utente.

### URL della risorsa[](#resource-url "Permalink a questo titolo")

`https://api.x.com/1.1/account_activity/subscriptions/count.json`

<div id="resource-url">
  ### Informazioni sulla risorsa[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Formato della risposta | Codice di risposta HTTP |
| Richiede autenticazione | Sì (solo applicazione - token bearer) |
| Limitato dalla frequenza | Sì |
| Richieste per finestra di 15 minuti (autenticazione applicativa) | 15  |

<div id="resource-information">
  ### Codici di risposta HTTP[](#http-response-codes "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Codice | Messaggio |
| 200 | Operazione riuscita. Verrà restituito il numero di iscrizioni per il webhook richiesto. |
| 401 | L'applicazione non dispone dell'autorizzazione per visualizzare le iscrizioni per il webhook specificato. |

### Esempio di richiesta[](#example-request "Permalink to this headline")

```bash
    $ curl --request GET
     --url https://api.x.com/1.1/account_activity/subscriptions/count.json
     --header 'authorization: Bearer TOKEN'
```

<div id="example-request">
  ### Esempio di risposta - Esito positivo[](#example-response-success "Permalink to this headline")
</div>

_HTTP 200_

```bash
    {
      "account_name":"my-account",
      "subscriptions_count_all":"1",
      "subscriptions_count_direct_messages":"0",
      "provisioned_count":"50"
    }
```

<div id="example-response-success">
  ### Messaggi di errore[](#error-messages "Permalink to this headline")
</div>

| Codice | Messaggio |
| :--- | :--- |
| 32  | Impossibile eseguire l'autenticazione. |

_HTTP 401_

```abash
    {
      "errors": [
        {
           "code": 32,
          "message": "Impossibile eseguire l'autenticazione."
        }
      ]
    }
```

#### GET account\_activity/webhooks/:webhook\_id/subscriptions/all[](#get-account-activity-webhooks-webhook-id-subscriptions-all "Permalink to this headline")

Consente di verificare se una configurazione di webhook è iscritta agli eventi dell’utente indicato. Se il contesto utente fornito ha un abbonamento attivo con l’applicazione indicata, restituisce 204 OK. Se il codice di risposta non è 204, l’utente non ha un abbonamento attivo. Vedere di seguito i codici di risposta HTTP e i messaggi di errore per maggiori dettagli.

### URL della risorsa[](#resource-url "Permalink to this headline")

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/all.json`

<div id="resource-url">
  ### Informazioni sulla risorsa[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Formato di risposta | JSON |
| Richiede autenticazione | Sì (OAuth a 3 attori - consumer key in whitelist e token di accesso dell’utente sottoscrivente) |
| Soggetta a rate limiting | Sì |
| Richieste / finestra di 15 minuti (autenticazione utente) | 500 |

<div id="resource-information">
  ### Parametri[](#parameters "Permalink a questo titolo")
</div>

|     |     |
| :--- | :--- |
| webhook\_id (obbligatorio) | ID del webhook. Definito nel percorso della risorsa. |

### Esempio di richiesta[](#example-request "Permalink to this headline")

$ curl --request GET
\--url https://api.x.com/1.1/account\_activity/webhooks/:WEBHOOK\_ID/subscriptions/all.json
\--header 'authorization: OAuth oauth\_consumer\_key="WHITELISTED\_CONSUMER\_KEY", oauth\_nonce="GENERATED", oauth\_signature="GENERATED", oauth\_signature\_method="HMAC-SHA1", oauth\_timestamp="GENERATED", oauth\_token="SUBSCRIBING\_USER'S\_ACCESS\_TOKEN", oauth\_version="1.0"'

### Esempio di risposta - Successo[](#example-response-success "Permalink to this headline")

_HTTP 204 Nessun contenuto_

```
    { }
```

#### GET account\_activity/webhooks/:webhook\_id/subscriptions/all/list[](#get-account-activity-webhooks-webhook-id-subscriptions-all-list "Permalink a questo titolo")

Restituisce un elenco delle sottoscrizioni correnti di tipo All Activity per il webhook specificato. Nota: l’endpoint /list richiede l’autenticazione OAuth in modalità applicazione (application-only), quindi le richieste devono essere effettuate utilizzando un bearer token invece del contesto utente.

### URL della risorsa[](#resource-url "Permalink a questo titolo")

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/all/list.json`

<div id="resource-url">
  ### Informazioni sulla risorsa[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Formato della risposta | Codice di risposta HTTP |
| Richiede autenticazione | Sì (solo applicazione - token bearer) |
| Soggetto a limitazione di frequenza | Sì |
| Richieste per finestra di 15 minuti (autenticazione dell’applicazione) | 50  |

<div id="resource-information">
  ### Parametri[](#parameters "Permalink a questo titolo")
</div>

|     |     |
| :--- | :--- |
| webhook\_id (obbligatorio) | ID del webhook. Definito nel percorso della risorsa. |

<div id="resource-information">
  ### Codici di risposta HTTP[](#http-response-codes "Permalink to this headline")
</div>

| Codice | Messaggio |
| :--- | :--- |
| 200 | Operazione riuscita. Verrà restituito un elenco di iscrizioni per il webhook richiesto. |
| 401 | L’applicazione non dispone dell’autorizzazione per visualizzare le iscrizioni per il webhook specificato. |

### Esempio di richiesta[](#example-request "Permalink to this headline")

$ curl --request GET
\--url https://api.x.com/1.1/account\_activity/webhooks/:WEBHOOK\_ID/subscriptions/all/list.json
\--header 'authorization: Bearer TOKEN'

<div id="example-request">
  ### Esempio di risposta - Operazione riuscita[](#example-response-success "Permalink to this headline")
</div>

_HTTP 200_

```bash
    {
      "webhook_id": "1234567890",
      "webhook_url": "https://your_domain.com/webhook/twitter/0",
      "application_id": "11231812",
      "subscriptions": [{
        "user_id": "20212306"
      }]
    }
```

<div id="example-response-success">
  ### Messaggi di errore[](#error-messages "Permalink to this headline")
</div>

| Codice | Messaggio |
| :--- | :--- |
| 32  | Impossibile eseguire l'autenticazione. |

_HTTP 401_

```bash
    {
      "errors": [
        {
           "code": 32,
          "message": "Could not authenticate you."
        }
      ]
    }
```

#### DELETE account\_activity/webhooks/:webhook\_id[](#delete-account-activity-webhooks-webhook-id "Permalink a questo titolo")

Rimuove il webhook dalla configurazione dell'applicazione indicata. L'ID del webhook è reperibile effettuando una chiamata a GET /1.1/account\_activity/webhooks.

### URL della risorsa[](#resource-url "Permalink a questo titolo")

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id.json`

<div id="resource-url">
  ### Informazioni sulla risorsa[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Formato della risposta | JSON |
| Richiede autenticazione | Sì (contesto utente: tutti i token consumer e di accesso) |
| Soggetto a limitazione di velocità | Sì |
| Richieste per finestra di 15 minuti (autenticazione utente) | 15  |

<div id="resource-information">
  ### Parametri[](#parameters "Permalink a questo titolo")
</div>

|     |     |
| :--- | :--- |
| webhook\_id (obbligatorio) | ID del webhook. Definito nel percorso della risorsa. |

### Esempio di richiesta[](#example-request "Permalink to this headline")

```bash
    $ curl --request DELETE
     --url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID.json
     --header 'authorization: OAuth oauth_consumer_key="CONSUMER_KEY", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="ACCESS_TOKEN", oauth_version="1.0"'
```

<div id="example-request">
  ### Risposta[](#response "Permalink to this headline")
</div>

_HTTP 204 OK_

```
    { }
```

#### DELETE account\_activity/webhooks/:webhook\_id/subscriptions/all (DEPRECATO)[](#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated- "Permalink to this headline")

Disattiva le sottoscrizioni per il contesto utente e l’applicazione specificati. Dopo la disattivazione, tutti gli eventi relativi all’utente che effettua la richiesta non verranno più inviati all’URL del webhook.

### URL della risorsa[](#resource-url "Permalink to this headline")

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/all.json`

<div id="resource-url">
  ### Informazioni sulla risorsa[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Formato di risposta | JSON |
| Richiede autenticazione | Sì (OAuth a 3 fasi - consumer key in whitelist e access token dell’utente sottoscritto) |
| Soggetto a limitazione di frequenza | Sì |
| Richieste / finestra di 15 minuti (autenticazione utente) | 500 |

<div id="resource-information">
  ### Parametri[](#parameters "Permalink a questo titolo")
</div>

|     |     |
| :--- | :--- |
| webhook\_id (obbligatorio) | ID del webhook. Definito nel percorso della risorsa. |

### Esempio di richiesta[](#example-request "Permalink to this headline")

```bash
    $ curl --request DELETE
     --url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID/subscriptions/all.json
     --header 'authorization: OAuth oauth_consumer_key="WHITELISTED_CONSUMER_KEY", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="SUBSCRIBED_USER'S_ACCESS_TOKEN", oauth_version="1.0"'
```

Esempio di richiesta

```
    { }
```

#### DELETE /account\_activity/webhooks/:webhook\_id/subscriptions/:user\_id/all.json[](#delete-account-activity-webhooks-webhook-id-subscriptions-user-id-all-json "Permalink a questo titolo")

Disattiva la sottoscrizione per il webhook e l’ID utente specificati. Dopo la disattivazione, tutti gli eventi relativi all’utente che effettua la richiesta non verranno più inviati all’URL del webhook. Nota: questo endpoint richiede l’autenticazione OAuth in modalità application-only; le richieste devono quindi essere eseguite utilizzando un bearer token anziché il contesto utente.

### URL della risorsa[](#resource-url "Permalink a questo titolo")

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/:user_id/all.json`

<div id="resource-url">
  ### Informazioni sulla risorsa[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Formato della risposta | JSON |
| Richiede autenticazione | Sì (solo applicazione - bearer token) |
| Soggetto a limitazioni di frequenza | Sì |
| Richieste per finestra di 15 minuti | 500 |

### Esempio di richiesta[](#example-request "Permalink to this headline")

```bash
    $ curl --request DELETE
     --url https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/:user_id/all.json
     --header 'authorization: Bearer TOKEN'
```

<div id="example-request">
  ### Risposta[](#response "Permalink to this headline")
</div>

_HTTP 204 Nessun contenuto_

<div id="example-response-success">
  ### Messaggi di errore[](#error-messages "Permalink to this headline")
</div>

| Codice | Messaggio |
| :--- | :--- |
| 404 | Spiacenti, questa pagina non esiste. - Questo accade spesso quando l’ID utente specificato non risulta effettivamente iscritto. |

<div id="error-messages">
  ### API di Replay
</div>

**POST /1.1/account\_activity/replay/webhooks/:webhook\_id/subscriptions/all.json [¶](#post-1-1-account-activity-replay-webhooks-webhook-id-subscriptions-all-json- "Permalink a questo titolo")**

Invia una richiesta per recuperare le attività degli ultimi cinque giorni da tutte le sottoscrizioni presenti nelle finestre di data e ora specificate nella richiesta. Se il tuo webhook ha sottoscrizioni utente attive, riceverai in parallelo anche quegli eventi. Nota: eseguiamo un CRC prima di recapitare gli eventi di replay.

|     |     |
| :--- | :--- |
| **Metodo della richiesta** | HTTP POST |
| **URL** | /1.1/account\_activity/replay/webhooks/:webhook\_id/subscriptions/all.json?from\_date=yyyymmddhhmm\&to\_date=yyyymmddhhmm |
| **Formato di risposta** | JSON |
| **Richiede autenticazione** | Sì (solo applicazione - bearer token) |
| **Rate limit** | 5 richieste ogni 15 minuti. Al momento non esiste un limite massimo al numero di job di replay che possono essere richiesti. |
| **from\_date** | Il timestamp UTC più vecchio (iniziale) a partire dal quale verranno forniti gli eventi; deve essere nel formato 'yyyymmddhhmm'. Il timestamp ha granularità al minuto ed è inclusivo (ad es. 12:00 include il minuto 00). Gli orari validi devono rientrare negli ultimi 5 giorni, in ora UTC, e non essere più recenti di 31 minuti rispetto al momento attuale. Si consiglia che from\_date e to\_date siano entro ~2 ore. |
| **to\_date** | Il timestamp UTC più recente (finale) fino al quale verranno forniti gli eventi; deve essere nel formato 'yyyymmddhhmm'. Il timestamp ha granularità al minuto ed è esclusivo (ad es. 12:30 non include il 30º minuto dell’ora). Gli orari validi devono rientrare negli ultimi 5 giorni, in ora UTC, e non essere più recenti di 10 minuti rispetto al momento attuale. |

#### Risposte

Le seguenti risposte possono essere restituite dall’API. La maggior parte dei codici di errore è restituita con una stringa che include dettagli aggiuntivi nel body. Per risposte diverse da 200, è necessario risolvere l’errore e riprovare.

| Stato | Testo | Codice di errore | Descrizione | Messaggio |
| :--- | :--- | :--- | :--- | :--- |
| 202 | Accepted | N/D | La richiesta è andata a buon fine e le attività verranno inviate. | N/D |
| 400 | Bad Request | 214 | Il webhook è stato contrassegnato come non valido. | Il webhook è contrassegnato come non valido e richiede un controllo CRC. |
| 400 | Bad Request | 357 | Manca un parametro di query. | : queryParam è obbligatorio. |
| 400 | Bad Request | 358 | Parametro di route o di query non valido. | Impossibile analizzare il parametro. |
| 400 | Bad Request | 360 | Il parametro di route è negativo. | webhook\_id: \[] non è maggiore o uguale a 0. |
| 400 | Bad Request | 368 | from\_date o to\_date non è nel passato. | : \[\<field\_value>] non è nel passato. |
| 400 | Bad Request | 356 | from\_date deve precedere to\_date. | from\_date deve precedere to\_date. |
| 400 | Bad Request | 356 | from\_date deve rientrare negli ultimi 5 giorni. | from\_date deve rientrare negli ultimi 5 giorni. |
| 401 | Unauthorized | 32  | Autenticazione HTTP non riuscita a causa dell’autenticazione a 3 leg. | Metodo di autenticazione non valido. Utilizzare l’autenticazione application-only. |
| 401 | Unauthorized | 61  | Il client non è autorizzato a richiedere questo metodo. | Il client non è autorizzato a richiedere questo metodo. |
| 403 | Forbidden | 200 | Il client non dispone di un account enterprise con Replay abilitato. | È richiesto un account enterprise dell’Account Activity API con replay. Verificare di avere un account enterprise e che il replay sia abilitato. |
| 404 | Not Found | 34  | webhook\_id inesistente; mancata corrispondenza tra webhook\_id e application\_id. | Il webhook non esiste o è associato a un’applicazione X diversa. |
| 409 | Conflict | 355 | È presente una richiesta in corso che deve terminare l’elaborazione prima di effettuarne un’altra. | Un job di replay è già in corso per questo webhook. |
| 429 | Too Many Requests | 88  | Rate limit superato (raggiunto il limite di richieste per periodo di tempo). | Troppe richieste. Ridurre la frequenza delle richieste API. |
| 500 | Internal Server Error | 0   | Errore interno del server. | Errore interno del server. |
| 503 | Service Unavailable | 67  | Uno o più servizi dipendenti su X non sono disponibili. | Errore del server X. Riprovare utilizzando un backoff esponenziale. |

<div id="responses">
  #### Messaggio "Job completato correttamente"
</div>

Quando il job viene completato correttamente, l’Account Activity Replay API invia il seguente evento di completamento. Una volta ricevuto questo evento, il job ha terminato l’esecuzione e puoi inviarne un altro.

```json
{
  "replay\_job\_status": {
    "webhook_id": "1234577122340233217",
    "job_state": "Complete",
    "job\_state\_description": "Job completed successfully"
    "job_id": "1095098195724558337"
  }
}
```

<div id="job-completed-successfully-message">
  #### Messaggio "Job failed to complete"
</div>

Se il tuo job non viene completato correttamente, restituiremo il seguente messaggio che ti invita a riprovare il job di Replay. Una volta ricevuto questo evento, il job ha terminato l'esecuzione e puoi inviarne un altro.

```json
{
  "replay\_job\_status": {
    "webhook_id": "123451374207332352",
    "job_state": "Incomplete",
    "job\_state\_description": "Job failed to deliver all events, please retry your replay job",
    "job_id": "1093226942650736640"
  }
}
```

<div id="job-failed-to-complete-message">
  #### Esempio di richiesta curl
</div>

```bash
    curl --request POST  --url 'https://api.x.com/1.1/account_activity/replay/webhooks/:webhook_id/subscriptions/all.json?from_date=yyyymmddhhmm&to_date=yyyymmddhhmm'
    --header 'authorization: Bearer TOKEN'
```

<div id="example-curl-request">
  #### Esempio di risposta
</div>

HTTP 202

```bash
{
  "job_id": "1234567890",
  "created_at": "2016-06-02T23:54:02Z"
}
```