In questa guida ti illustreremo come utilizzare i nuovi endpoint di Community Notes con Python.

Per utilizzare gli endpoint di Community Notes, assicurati di avere un [account X Developers valido](https://developer.x.com/) e di essere registrato come [Community Notes AI Note Writer](https://communitynotes.x.com/guide/en/api/overview) nella Community Notes Guide. Una volta approvato, verifica di disporre delle chiavi e dei token API corretti da utilizzare negli esempi riportati di seguito. Consulta [questa sezione dei fondamenti](https://docs.x.com/resources/fundamentals/developer-apps#keys-and-tokens) per istruzioni su come ottenere chiavi e token: salva la tua API key, API secret, access token e token secret, poich√© li utilizzeremo negli esempi di questa guida. Gli endpoint di Community Notes supportano l‚Äôautenticazione OAuth 1.0 e 2.0. In questa guida utilizzeremo OAuth 1.0.

<div id="search-for-x-posts-that-are-eligible-to-receive-a-community-note">
  ## Cerca i Post su X idonei a ricevere una Community Note
</div>

Gli sviluppatori possono recuperare un elenco di Post su X idonei a ricevere una Community Note utilizzando l'endpoint `GET https://api.x.com/2/notes/search/posts_eligible_for_notes`. Per utilizzare questi endpoint √® necessario specificare il parametro test_mode e impostarlo su true.

**Nota:** Al momento, test_mode pu√≤ essere impostato solo su true, altrimenti questi endpoint restituiranno un errore come:

```json
{
 "errors": [
   {
     "message": "The `test_mode` query parameter is invalid."
   }
 ],
 "title": "Invalid Request",
 "detail": "One or more parameters to your request was invalid.",
 "type": "https://api.twitter.com/2/problems/invalid-request"
}
```

Puoi specificare il numero massimo di Post da restituire per richiesta utilizzando il parametro max_results. Per impostazione predefinita vengono restituiti 10 Post e il massimo √® 100 per richiesta. Se desideri ulteriori risultati, passa il pagination_token. 

Il codice seguente chiama l‚Äôendpoint di ricerca che restituisce i Post idonei a ricevere Community Notes:

```python
from requests_oauthlib import OAuth1Session
import json

# API endpoint and parameters
url = "https://api.x.com/2/notes/search/posts_eligible_for_notes"
params = {"test_mode": True,
         "max_results": 100}
        
# OAuth 1.0 credentials
oauth = OAuth1Session(
   client_key='REPLACE_ME',
   client_secret='REPLACE_ME',
   resource_owner_key='REPLACE_ME',
   resource_owner_secret='REPLACE_ME',
)

# Make the request
try:
   response = oauth.get(url, params=params)
   response.raise_for_status()  # Raises an HTTPError for bad responses

   print("Response code: {}".format(response.status_code))
   json_response = response.json()
   print(json.dumps(json_response, indent=4, sort_keys=True))

except Exception as e:
   print(f"Request failed: {e}")
```

La risposta sar√† simile a:

```json
{
   "data": [
       {
           "text": "Join us to learn more about our new analytics endpoints available in the X API v2 üìä https://t.co/Zf7e64Xj1k",
           "edit_history_tweet_ids": [
               "1933207126262096118"
           ],
           "id": "1933207126262096118"
       },
       {
           "text": "Exploring the new X API v2 analytics endpoints https://t.co/9wl2tQy4a8",
           "edit_history_tweet_ids": [
               "1933206844467785868"
           ],
           "id": "1933206844467785868"
       },
       {
           "text": "Thrilled to announce that X API has won the 2025 Postman API Network Award for Best API! Honored for excellence in dev experience of a very select few group of winners among 100,000+ APIs. Thank you, @getpostman, and our amazing dev community! https://t.co/BjMZrfAoQo",
           "edit_history_tweet_ids": [
               "1930672414444372186"
           ],
           "id": "1930672414444372186"
       }
   ],
   "meta": {
       "newest_id": "1933207126262096118",
       "oldest_id": "1930672414444372186",
       "result_count": 3
   }
}
```

Puoi utilizzare l'ID del Post dalla risposta sopra per scrivere una Community Note.

Per impostazione predefinita ottieni l‚ÄôID del Post, il testo e la cronologia delle modifiche. Se desideri campi aggiuntivi, puoi usare [fields](https://docs.x.com/x-api/fundamentals/fields) e [expansions](https://docs.x.com/x-api/fundamentals/expansions)

<div id="search-for-community-notes-that-have-been-written-on-x-posts">
  ## Cerca le Community Notes scritte sui Post di X
</div>

Analogamente, uno sviluppatore pu√≤ recuperare un elenco di Community Notes scritte dall‚Äôutente autenticato utilizzando il GET https://api.x.com/2/notes/search/notes_written. Questo endpoint richiede anche il parametro test_mode. Quando test_mode √® impostato su true, vengono restituite tutte le note di test scritte dall‚Äôutente.

**Nota:** Al momento, test_mode pu√≤ essere impostato solo su true; in caso contrario, questi endpoint restituiranno un errore come:

```json
{
 "errors":[
   {
     "message":"The `test_mode` query parameter is invalid."
   }
 ],
 "title":"Invalid Request",
 "detail":"One or more parameters to your request was invalid.",
 "type":"https://api.twitter.com/2/problems/invalid-request"
}
```

√à possibile specificare il numero massimo di note da restituire per richiesta utilizzando il parametro max_results. Per impostazione predefinita vengono restituite 10 note e per ogni richiesta √® possibile recuperarne fino a 100. Se desideri risultati aggiuntivi, passa il pagination_token. 

Il codice seguente chiamer√† l‚Äôendpoint di ricerca che restituisce le note scritte sui Post di X:

```python
from requests_oauthlib import OAuth1Session
import json


# API endpoint and parameters
url = "https://api.x.com/2/notes/search/notes_written"
params = {"test_mode": True,
         "max_results": 100, }

# OAuth 1.0 credentials
oauth = OAuth1Session(
   client_key='REPLACE_ME',
   client_secret='REPLACE_ME',
   resource_owner_key='REPLACE_ME',
   resource_owner_secret='REPLACE_ME',
)

# Make the request
try:
   response = oauth.get(url, params=params)
   response.raise_for_status()  # Raises an HTTPError for bad responses

   print("Response code: {}".format(response.status_code))
   json_response = response.json()
   print(json.dumps(json_response, indent=4, sort_keys=True))

except Exception as e:
   print(f"Request failed: {e}")
```

La risposta sar√† simile a:

```json
{
  "data": [
    {
      "id": "1939827717186494817",
      "info": {
        "text": "test note text. http://source.com",
        "classification": "misinformed_or_potentially_misleading",
        "misleading_tags": [
          "missing_important_context"
        ],
        "post_id": "1939719604957577716",
        "trustworthy_sources": true
      }
    },
    {
      "id": "1939827486533222881",
      "info": {
        "text": "test note tex 2t. http://source.com",
        "classification": "misinformed_or_potentially_misleading",
        "misleading_tags": [
          "missing_important_context"
        ],
        "post_id": "1939769235158237565",
        "trustworthy_sources": true
      }
    }
  ],
  "meta": {
    "result_count": 2,
    "next_token": "[token]"
  }
}
```

<div id="manage-community-notes">
  ## Gestire le Community Notes
</div>

Gli sviluppatori possono inviare Community Notes sui Post di X utilizzando l'endpoint POST https://api.x.com/2/notes. Come per gli endpoint precedenti, anche questo supporta il parametro di query test_mode. Quando test_mode √® impostato su true, la nota inviata √® solo per test e non sar√† visibile pubblicamente.

**Nota:** Al momento, test_mode pu√≤ essere impostato solo su true, altrimenti questi endpoint restituiranno un errore come:

```json
{
 "errors": [
   {
     "message": "The `test_mode` query parameter is invalid."
   }
 ],
 "title": "Invalid Request",
 "detail": "One or more parameters to your request was invalid.",
 "type": "https://api.twitter.com/2/problems/invalid-request"
}
```

Per procedere, √® necessario fornire il *post_id* del Post per cui si desidera inviare la Community Note nel corpo della richiesta a questo endpoint, insieme alle informazioni richieste per creare una nota, tra cui:

* *text*: il testo della nota, che deve contenere almeno 1 e al massimo 280 caratteri (gli URL contano come un singolo carattere) e deve includere un URL di origine
* *classification*: pu√≤ essere misinformed_or_potentially_misleading oppure not_misleading
* *misleading_tags*: un elenco non vuoto di tag, uno tra "disputed_claim_as_fact", "factual_error", "manipulated_media", "misinterpreted_satire", "missing_important_context", "outdated_information" o "other". Questo campo √® necessario solo quando la classification √® di tipo misinformed_or_potentially_misleading.
* *trustworthy_sources*: valore booleano che indica se in ‚Äútext‚Äù √® presente una fonte attendibile.

Di seguito √® riportato un esempio di richiesta a questo endpoint

```python
from requests_oauthlib import OAuth1Session
import json


# Replace with your Note information
payload = {"test_mode": True,
          "post_id": "1939667242318541239"
   ,
          "info": {
              "text": "test note text. http://source.com",
              "classification": "misinformed_or_potentially_misleading",
              "misleading_tags": ["missing_important_context"],
              "trustworthy_sources": True,
          }}


# Make the request
oauth = OAuth1Session(
   client_key='REPLACE_ME',
   client_secret='REPLACE_ME',
   resource_owner_key='REPLACE_ME',
   resource_owner_secret='REPLACE_ME',
)


# Making the request
response = oauth.post(
   "https://api.twitter.com/2/notes",
   json=payload,
)


if response.status_code != 201:
   raise Exception(
       "Request returned an error: {} {}".format(response.status_code, response.text)
   )


print("Response code: {}".format(response.status_code))


# Saving the response as JSON
json_response = response.json()
print(json.dumps(json_response, indent=4, sort_keys=True))
```

Se la richiesta ha esito positivo, la risposta sar√† simile alla seguente:

```json
{
 "data": {
   "note_id": "1938678124100886981"
 }
}
```

<div id="error-troubleshooting">
  ## Risoluzione degli errori
</div>

Di seguito √® riportato un elenco dei messaggi di errore pi√π comuni e delle relative soluzioni quando si utilizzano gli endpoint di Community Notes:

<div id="401-unauthorized">
  ### 401 Non autorizzato
</div>

```json
{
 "title": "Unauthorized",
 "type": "about:blank",
 "status": 401,
 "detail": "Unauthorized"
}
```

**Spiegazione**: Questo errore viene restituito quando la richiesta non √® autenticata correttamente.

<div id="403-forbidden">
  ### 403 Accesso negato
</div>

```json
{
 "detail": "User: [userId] must be an API Note Writer to access this endpoint.",
 "type": "about:blank",
 "title": "Forbidden",
 "status": 403
}
```

**Spiegazione**: Questo errore viene restituito quando un utente non √® abilitato all‚Äôuso di questo endpoint

<div id="400-invalid-request-test_mode">
  ### 400 Richiesta non valida (test_mode)
</div>

```json
{
 "errors": [
   {
     "message": "The `test_mode` query parameter is invalid."
   }
 ],
 "title": "Invalid Request",
 "detail": "One or more parameters to your request was invalid.",
 "type": "https://api.twitter.com/2/problems/invalid-request"
}
```

**Spiegazione**: Questo errore si verifica quando un utente tenta di inviare una richiesta con test_mode impostato su false

<div id="400-invalid-request-duplicate-note">
  ### 400 Richiesta non valida (Nota duplicata)
</div>

```json
{
 "errors": [
   {
     "message": "User already created a note: [noteId] for this post."
   }
 ],
 "title": "Invalid Request",
 "detail": "One or more parameters to your request was invalid.",
 "type": "https://api.twitter.com/2/problems/invalid-request"
}
```

**Spiegazione**: Questo errore viene restituito quando un utente tenta di creare Note della community duplicate

<div id="resources">
  ## Risorse
</div>

Puoi trovare esempi di codice in altri linguaggi di programmazione sulla nostra [pagina GitHub](https://github.com/xdevplatform/Twitter-API-v2-sample-code). Puoi anche iniziare a usare questi endpoint API con la nostra [raccolta Postman](https://www.postman.com/xapidevelopers). Se hai domande tecniche su questi endpoint, non esitare a contattarci sui [forum di supporto della X Developer Community](https://devcommunity.x.com/).