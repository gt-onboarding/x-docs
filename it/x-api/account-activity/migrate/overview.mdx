<div id="v2-account-activity-api-migration-guide">
  # Guida alla migrazione all’Account Activity API v2
</div>

Questa guida ti aiuta a migrare dalla legacy Enterprise Account Activity API alla Account Activity API v2. La funzionalità principale resta la stessa, ma le strutture degli endpoint e i metodi di autenticazione sono stati aggiornati per coerenza con l’API X v2.

<div id="summary-of-changes">
  ### Riepilogo delle modifiche
</div>

- **Formato API**: Gli endpoint utilizzano il path di base /2/account\_activity/ invece di /1.1/account\_activity/.
- **Gestione dei webhook**: Creazione, elenco, convalida (CRC) ed eliminazione dei webhook sono gestite dalla [V2 Webhooks API](https://github.com/m-rosinsky/XWebhookTest/blob/main/app.py).
- **Autenticazione**: Gli endpoint V2 richiedono uno dei seguenti:
  - **OAuthUser** (OAuth a 3 leg) per azioni specifiche dell’utente (ad es. iscrivere un utente).
  - **OAuth2 App Only** (Bearer Token) per azioni a livello di app (ad es. elencare/eliminare le sottoscrizioni).
  - La V1.1 utilizzava requisiti variabili, spesso OAuth 1.0a.
- **Mappatura degli endpoint**:

| Endpoint V1.1 | Equivalente/azione V2 | Note |
| ----- | ----- | ----- |
| POST /1.1/account\_activity/webhooks.json?url=\<URL> | POST /2/webhooks | [Docs](https://docs.x.com/it/x-api/webhooks/introduction). Richiede OAuth2AppOnly. |
| GET /1.1/account\_activity/webhooks.json | GET /2/webhooks | [Docs](https://docs.x.com/it/x-api/webhooks/introduction). Richiede OAuth2AppOnly. |
| PUT /1.1/account\_activity/webhooks/:webhook\_id.json | PUT /2/webhooks/:webhook\_id | Attiva il CRC. [Docs](https://docs.x.com/it/x-api/webhooks/introduction). Richiede OAuth2AppOnly. |
| DELETE /1.1/account\_activity/webhooks/:webhook\_id.json | DELETE /2/webhooks/:webhook\_id | [Docs](https://docs.x.com/it/x-api/webhooks/introduction). Richiede OAuth2AppOnly. |
| POST /1.1/account\_activity/webhooks/:webhook\_id/subscriptions/all.json | POST /2/account\_activity/webhooks/:webhook\_id/subscriptions/all | Richiede OAuthUser. |
| GET /1.1/account\_activity/subscriptions/count.json | GET /2/account\_activity/subscriptions/count | Richiede OAuth2AppOnly. |
| GET /1.1/account\_activity/webhooks/:webhook\_id/subscriptions/all.json | GET /2/account\_activity/webhooks/:webhook\_id/subscriptions/all | Richiede OAuthUser. |
| GET /1.1/account\_activity/webhooks/:webhook\_id/subscriptions/all/list.json | GET /2/account\_activity/webhooks/:webhook\_id/subscriptions/all/list | Richiede OAuth2AppOnly. |
| DELETE /1.1/account\_activity/webhooks/:webhook\_id/subscriptions/:user\_id/all | DELETE /2/account\_activity/webhooks/:webhook\_id/subscriptions/:user\_id/all | Richiede OAuth2AppOnly. |
| DELETE /1.1/account\_activity/webhooks/:webhook\_id/subscriptions/all | Obsoleto / Nessun equivalente diretto | Utilizzare eliminazioni individuali o rimuovere il webhook tramite DELETE /2/webhooks/:webhook\_id. |

- **Formati di risposta**: Consultare le strutture delle risposte di successo ed errore nella documentazione dell’AAAPI.

Durante la migrazione, aggiornare il codice per utilizzare i nuovi path di base, adeguare i flussi di autenticazione e gestire i webhook utilizzando la [V2 Webhooks API](https://docs.x.com/it/x-api/webhooks/introduction).

<div id="how-to-migrate">
  ### Come eseguire la migrazione
</div>

- **Scegli un pacchetto**:
  - Scegli il pacchetto Enterprise o Pro per l’accesso all’Account Activity API, considerando:
    - Numero di webhook necessari.
    - Abbonamenti o utenti autorizzati attuali/stimati.
    - Numero di applicazioni client X.
    - Livello di supporto desiderato (forum vs supporto enterprise gestito 1:1).
    - Dettagli sui prezzi (contatta il team vendite per Enterprise).
- **Aggiorna l’autenticazione a OAuth 2.0**:
  - Assicurati che la tua App X abbia le autorizzazioni “Lettura, Scrittura e Accesso ai Messaggi Diretti”.
  - Passa a OAuth 2.0 per gli endpoint v2. Ri-autorizza gli utenti se gli scope sono cambiati.
  - Usa il Developer Portal per gestire:
    - Access Token OAuth 2.0.
    - Client ID e Client Secret.
- **Verifica o riconfigura il webhook**:
  - Usa l’URL del webhook esistente o configurane uno nuovo (es. https://your\_domain.com/webhook/twitter).
  - Segui la [documentazione della Webhooks API v2](https://docs.x.com/it/x-api/webhooks/introduction) per registrare e gestire il webhook.
- **App di esempio:**
  - [Semplice server webhook](https://github.com/m-rosinsky/XWebhookTest/blob/main/app.py)
    - Un singolo script Python che mostra come rispondere al controllo CRC e accettare eventi POST.
  - [Dashboard di esempio per Account Activity API](https://github.com/xdevplatform/account-activity-dashboard-enterprise/tree/master)
    - Un’app web sviluppata con [bun.sh](http://bun.sh) che consente di gestire webhook, abbonamenti e ricevere eventi in tempo reale direttamente nell’app.