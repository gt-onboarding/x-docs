---
title: Flux d’autorisation OAuth 2.0 avec code et PKCE
sidebarTitle: Flux d’autorisation OAuth 2.0 avec code et PKCE
---

<div id="oauth-20-authorization-code-flow-with-pkce">
  ### Flux de code d’autorisation OAuth 2.0 avec PKCE
</div>

<div id="introduction">
  #### Introduction
</div>

OAuth 2.0 est un protocole d’autorisation standard du secteur qui offre un meilleur contrôle de la portée d’une application et des parcours d’autorisation sur plusieurs appareils. OAuth 2.0 vous permet de sélectionner des autorisations fines et spécifiques, qui vous confèrent des droits précis au nom d’un utilisateur.

Pour activer OAuth 2.0 dans votre application, vous devez l’activer dans les paramètres d’authentification de l’application, accessibles depuis la section Paramètres de l’application du portail développeur.

#### Pendant combien de temps mes identifiants resteront-ils valides ?  

Par défaut, le jeton d’accès que vous créez via le flux d’autorisation par code avec PKCE ne reste valide que deux heures, sauf si vous avez utilisé le scope `offline.access`.

<div id="refresh-tokens">
  #### Jetons d’actualisation
</div>

Les jetons d’actualisation permettent à une application d’obtenir un nouveau jeton d’accès sans solliciter l’utilisateur, via le flux d’actualisation.

Si la portée `offline.access` est appliquée, un jeton d’actualisation OAuth 2.0 sera émis. Avec ce jeton d’actualisation, vous pouvez obtenir un jeton d’accès. Si cette portée n’est pas fournie, nous ne générerons pas de jeton d’actualisation.

Voici un exemple de requête pour utiliser un jeton d’actualisation afin d’obtenir un nouveau jeton d’accès :

```bash
POST 'https://api.x.com/2/oauth2/token' \
--header 'Content-Type: application/x-www-form-urlencoded' \
--data-urlencode 'refresh_token=bWRWa3gzdnk3WHRGU1o0bmRRcTJ5VUxWX1lZTDdJSUtmaWcxbTVxdEFXcW5tOjE2MjIxNDc3NDM5MTQ6MToxOnJ0OjE' \
--data-urlencode 'grant_type=refresh_token' \
--data-urlencode 'client_id=rG9n6402A3dbUJKzXTNX4oWHJ
```

<div id="app-settings">
  #### Paramètres de l’application
</div>

Vous pouvez configurer l’authentification de votre application en OAuth 1.0a ou OAuth 2.0. Vous pouvez aussi permettre à une application d’utiliser à la fois OAuth 1.0a et OAuth 2.0.

OAuth 2.0 ne peut être utilisé qu’avec l’API X v2. Si vous avez choisi OAuth 2.0, vous verrez un identifiant client dans la section Clés et jetons de votre application. 

<div id="confidential-clients">
  #### Clients confidentiels
</div>

Les [clients confidentiels](https://datatracker.ietf.org/doc/html/rfc6749#section-2.1) peuvent conserver des identifiants de manière sécurisée sans les exposer à des tiers non autorisés et s’authentifier en toute sécurité auprès du serveur d’autorisation, ce qui permet de préserver la confidentialité de votre secret client. Les clients publics, puisqu’ils s’exécutent généralement dans un navigateur ou sur un appareil mobile, ne peuvent pas utiliser vos secrets clients. Si vous sélectionnez un type d’application qui est un client confidentiel, un secret client vous sera fourni.

Si, dans le portail développeur, vous avez sélectionné un type de client de type confidentiel, vous pourrez également voir un secret client. Vos options sont Application native, Application monopage, Application Web, Application automatisée ou bot. Les applications natives et les applications monopage sont des clients publics, tandis que les applications Web, les applications automatisées et les bots sont des clients confidentiels.

Vous n’avez pas besoin d’un identifiant client pour les clients confidentiels si vous utilisez un en-tête Authorization valide. Vous devez toujours inclure l’identifiant client dans le corps des requêtes pour les clients publics. 

<div id="scopes">
  #### Scopes
</div>

Les scopes vous permettent de définir un accès granulaire pour votre application afin qu’elle ne dispose que des autorisations nécessaires. Pour en savoir plus sur la correspondance entre les scopes et les endpoints, consultez notre [guide de correspondance d’authentification](/fr/resources/fundamentals/authentication/guides/v2-authentication-mapping).

|     |     |
| :--- | :--- |
| **Scope** | **Description** |
| tweet.read | Tous les Tweets que vous pouvez voir, y compris ceux provenant de comptes protégés. |
| tweet.write | Tweeter et retweeter en votre nom. |
| tweet.moderate.write | Masquer et réafficher des réponses à vos Tweets. |
| users.email | Adresse e-mail d’un utilisateur authentifié. |
| users.read | Tout compte que vous pouvez voir, y compris les comptes protégés. |
| follows.read | Les personnes qui vous suivent et celles que vous suivez. |
| follows.write | Suivre et ne plus suivre des personnes en votre nom. |
| offline.access | Rester connecté à votre compte jusqu’à ce que vous révoquiez l’accès. |
| space.read | Tous les Spaces que vous pouvez voir. |
| mute.read | Comptes que vous avez mis en sourdine. |
| mute.write | Mettre en sourdine et rétablir le son de comptes en votre nom. |
| like.read | Tweets que vous avez aimés et mentions J’aime visibles. |
| like.write | Aimer et retirer votre J’aime sur des Tweets en votre nom. |
| list.read | Listes, membres et abonnés des listes que vous avez créées ou dont vous êtes membre, y compris les listes privées. |
| list.write | Créer et gérer des listes en votre nom. |
| block.read | Comptes que vous avez bloqués. |
| block.write | Bloquer et débloquer des comptes en votre nom. |
| bookmark.read | Récupérer les Tweets ajoutés aux signets par un utilisateur authentifié. |
| bookmark.write | Ajouter des Tweets aux signets et les retirer. |
| media.write | Importer des médias. |

<div id="rate-limits">
  #### Limites de débit
</div>

Dans l’ensemble, les limites de débit sont identiques à celles en OAuth 1.0a, à l’exception de la consultation des Tweets et des utilisateurs. Nous portons la limite par application de 300 à 900 requêtes par tranches de 15 minutes lorsque vous utilisez OAuth 2.0 pour la consultation des Tweets et des utilisateurs. Pour en savoir plus, consultez notre [documentation sur les limites de débit](/fr/resources/fundamentals/rate-limits).

<div id="grant-types">
  #### Types d’autorisation
</div>

Pour ce lancement initial, nous prenons uniquement en charge le [code d’autorisation](https://oauth.net/2/grant-types/authorization-code/) avec [PKCE](https://oauth.net/2/pkce/) et le [jeton d’actualisation](https://oauth.net/2/grant-types/refresh-token/) comme [types d’autorisation](https://oauth.net/2/grant-types/). D’autres types d’autorisation pourront être proposés à l’avenir.

<div id="oauth-20-flow">
  #### Parcours OAuth 2.0
</div>

OAuth 2.0 suit un parcours similaire à celui que nous utilisons actuellement pour OAuth 1.0a. Vous pouvez consulter un diagramme et une explication détaillée dans notre [documentation à ce sujet](/fr/resources/fundamentals/authentication/oauth-1-0a/obtaining-user-access-tokens). 

<div id="glossary">
  #### Glossaire
</div>

|     |     |
| :--- | :--- |
| **Terme** | **Description** |
| Types d’octroi (grant types) | Le cadre OAuth spécifie plusieurs types d’octroi pour différents cas d’usage et un mécanisme pour en créer de nouveaux. Parmi les exemples : code d’autorisation, identifiants client, code appareil et jeton d’actualisation. |
| Client confidentiel | Les clients sont des applications qui peuvent s’authentifier de façon sécurisée auprès du serveur d’autorisation, par exemple en protégeant leur secret client enregistré. |
| Client public | Les clients ne peuvent pas utiliser de secrets client enregistrés, comme les applications exécutées dans un navigateur ou sur un appareil mobile. |
| Flux de code d’autorisation | Utilisé par les clients confidentiels et publics pour échanger un code d’autorisation contre un jeton d’accès. |
| PKCE | Une extension du flux de code d’autorisation visant à prévenir plusieurs attaques et à permettre d’effectuer l’échange OAuth en toute sécurité depuis des clients publics. |
| Client ID | Se trouve dans la section « Clés et jetons » du portail développeur sous l’en-tête « Client ID ». Si vous ne le voyez pas, veuillez contacter directement notre équipe. Le Client ID est nécessaire pour générer l’URL d’autorisation. |
| Redirect URI | Votre URL de redirection (callback). Vous devrez disposer d’une [validation de correspondance exacte](https://datatracker.ietf.org/doc/html/rfc6749#section-10.6). |
| Code d’autorisation | Permet à une application d’appeler des API au nom des utilisateurs. Appelé auth\_code. L’auth\_code a une durée de validité de 30 secondes dès que le propriétaire de l’application reçoit un auth\_code approuvé de l’utilisateur. Vous devez l’échanger contre un jeton d’accès dans les 30 secondes, faute de quoi l’auth\_code expirera. |
| Jeton d’accès | Les jetons d’accès sont les jetons qu’une application utilise pour effectuer des requêtes API au nom d’un utilisateur. |
| Jeton d’actualisation | Permet à une application d’obtenir un nouveau jeton d’accès sans solliciter l’utilisateur, via le flux de jeton d’actualisation. |
| Client Secret | Si vous avez sélectionné un type d’application de type client confidentiel, un « Client Secret » vous sera fourni sous « Client ID » dans la section « Clés et jetons » de votre application. |

<div id="parameters">
  #### Paramètres
</div>

Pour construire une URL d’autorisation OAuth 2.0, vous devez vous assurer d’inclure les paramètres suivants dans l’URL d’autorisation.

|     |     |
| :--- | :--- |
| **Paramètre** | **Description** |
| response\_type | Indiquez qu’il s’agit d’un code en utilisant le mot « code ». |
| client\_id | Disponible dans le portail développeur sous l’intitulé « Client ID ». |
| redirect\_uri | Votre URL de rappel (callback). Cette valeur doit correspondre à l’une des URL de rappel définies dans les paramètres de votre application. Pour OAuth 2.0, vous devez appliquer une [validation de correspondance exacte](https://datatracker.ietf.org/doc/html/rfc6749#section-10.6) pour votre URL de rappel. |
| state | Une chaîne aléatoire que vous fournissez pour vous protéger contre les [attaques CSRF](https://auth0.com/docs/protocols/state-parameters). La longueur de cette chaîne peut atteindre 500 caractères. |
| code\_challenge | Paramètre [PKCE](https://www.oauth.com/oauth2-servers/pkce/authorization-request/), un secret aléatoire propre à chaque requête. |
| code\_challenge\_method | Précise la méthode utilisée pour la requête (S256 ou plain). |

#### URL d’autorisation 

Avec OAuth 2.0, vous créez une URL d’autorisation que vous pouvez utiliser pour permettre à un utilisateur de s’authentifier via un parcours d’authentification, similaire à « Se connecter avec X ». 

Voici un exemple de l’URL à créer : 

```
https://x.com/i/oauth2/authorize?response_type=code&client_id=M1M5R3BMVy13QmpScXkzTUt5OE46MTpjaQ&redirect_uri=https://www.example.com&scope=tweet.read%20users.read%20account.follows.read%20account.follows.write&state=state&code_challenge=challenge&code_challenge_method=plain
```

Vous devrez appliquer l’encodage approprié pour que cette URL fonctionne. Consultez notre documentation sur l’[encodage pourcent](/fr/resources/fundamentals/authentication/oauth-1-0a/percent-encoding-parameters).