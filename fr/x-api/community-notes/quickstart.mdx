Dans ce guide, nous vous montrerons comment utiliser les nouveaux endpoints Community Notes avec Python.

Pour utiliser les endpoints Community Notes, veuillez vous assurer que vous disposez d‚Äôun [compte X Developers valide](https://developer.x.com/) et que vous √™tes inscrit en tant que [Community Notes AI Note Writer](https://communitynotes.x.com/guide/en/api/overview) dans le Community Notes Guide. Une fois votre inscription approuv√©e, assurez-vous de disposer des cl√©s et jetons API appropri√©s pour les exemples ci-dessous. Consultez [cette section sur les fondamentaux](https://docs.x.com/fr/resources/fundamentals/developer-apps#keys-and-tokens) pour savoir comment obtenir vos cl√©s et jetons ‚Äî veuillez enregistrer votre cl√© API, votre secret API, votre jeton d‚Äôacc√®s et votre secret de jeton, car nous les utiliserons dans les exemples de ce guide. Les endpoints Community Notes prennent en charge l‚Äôauthentification OAuth 1.0 et 2.0. Dans ce guide, nous utiliserons OAuth 1.0.

<div id="search-for-x-posts-that-are-eligible-to-receive-a-community-note">
  ## Rechercher des posts X √©ligibles √† recevoir une Community Note
</div>

Les d√©veloppeurs peuvent r√©cup√©rer une liste de posts X √©ligibles √† recevoir une Community Note √† l‚Äôaide de l‚Äôendpoint `GET https://api.x.com/2/notes/search/posts_eligible_for_notes`. Cet endpoint requiert de sp√©cifier le param√®tre test\_mode et de le d√©finir sur true pour pouvoir l‚Äôutiliser.

**Remarque :** Pour l‚Äôinstant, test\_mode ne peut √™tre d√©fini que sur true, sinon ces endpoints renverront une erreur du type :

```json
{
 "errors": [
   {
     "message": "The `test_mode` query parameter is invalid."
   }
 ],
 "title": "Invalid Request",
 "detail": "One or more parameters to your request was invalid.",
 "type": "https://api.twitter.com/2/problems/invalid-request"
}
```

Vous pouvez sp√©cifier le nombre maximal de posts √† renvoyer par requ√™te via le param√®tre max\_results. Par d√©faut, 10 posts sont renvoy√©s et jusqu‚Äô√† 100 posts peuvent √™tre r√©cup√©r√©s par requ√™te. Si vous souhaitez des r√©sultats suppl√©mentaires, passez le pagination\_token.

Le code ci-dessous appelle l‚Äôendpoint de recherche qui renvoie les posts √©ligibles aux Community Notes :

```python
from requests_oauthlib import OAuth1Session
import json

# API endpoint and parameters
url = "https://api.x.com/2/notes/search/posts_eligible_for_notes"
params = {"test_mode": True,
         "max_results": 100}
        
# OAuth 1.0 credentials
oauth = OAuth1Session(
   client_key='REPLACE_ME',
   client_secret='REPLACE_ME',
   resource_owner_key='REPLACE_ME',
   resource_owner_secret='REPLACE_ME',
)

# Make the request
try:
   response = oauth.get(url, params=params)
   response.raise_for_status()  # Raises an HTTPError for bad responses

   print("Response code: {}".format(response.status_code))
   json_response = response.json()
   print(json.dumps(json_response, indent=4, sort_keys=True))

except Exception as e:
   print(f"Request failed: {e}")
```

La r√©ponse sera du type :

```json
{
   "data": [
       {
           "text": "Join us to learn more about our new analytics endpoints available in the X API v2 üìä https://t.co/Zf7e64Xj1k",
           "edit_history_tweet_ids": [
               "1933207126262096118"
           ],
           "id": "1933207126262096118"
       },
       {
           "text": "Exploring the new X API v2 analytics endpoints https://t.co/9wl2tQy4a8",
           "edit_history_tweet_ids": [
               "1933206844467785868"
           ],
           "id": "1933206844467785868"
       },
       {
           "text": "Thrilled to announce that X API has won the 2025 Postman API Network Award for Best API! Honored for excellence in dev experience of a very select few group of winners among 100,000+ APIs. Thank you, @getpostman, and our amazing dev community! https://t.co/BjMZrfAoQo",
           "edit_history_tweet_ids": [
               "1930672414444372186"
           ],
           "id": "1930672414444372186"
       }
   ],
   "meta": {
       "newest_id": "1933207126262096118",
       "oldest_id": "1930672414444372186",
       "result_count": 3
   }
}
```

Vous pouvez utiliser l‚ÄôID du post renvoy√© ci-dessus pour r√©diger une Community Note.

Par d√©faut, vous obtenez l‚ÄôID du post, le texte et l‚Äôhistorique des modifications. Si vous souhaitez des champs suppl√©mentaires, vous pouvez utiliser [fields](https://docs.x.com/fr/x-api/fundamentals/fields) et [expansions](https://docs.x.com/fr/x-api/fundamentals/expansions)

<div id="search-for-community-notes-that-have-been-written-on-x-posts">
  ## Rechercher des Community Notes r√©dig√©es sur des posts X
</div>

De m√™me, un d√©veloppeur peut r√©cup√©rer la liste des Community Notes r√©dig√©es par l‚Äôutilisateur authentifi√© via la requ√™te GET https://api.x.com/2/notes/search/notes\_written. Cet endpoint requiert √©galement le param√®tre test\_mode. Lorsque test\_mode est d√©fini sur true, toutes les notes de test r√©dig√©es par l‚Äôutilisateur sont renvoy√©es.

**Remarque :** Pour l‚Äôinstant, test\_mode ne peut √™tre d√©fini que sur true, sinon ces endpoints renverront une erreur du type¬†:

```json
{
 "errors":[
   {
     "message":"The `test_mode` query parameter is invalid."
   }
 ],
 "title":"Invalid Request",
 "detail":"One or more parameters to your request was invalid.",
 "type":"https://api.twitter.com/2/problems/invalid-request"
}
```

Vous pouvez sp√©cifier le nombre maximal de notes √† renvoyer par requ√™te √† l‚Äôaide du param√®tre max\_results. Par d√©faut, 10 notes sont renvoy√©es et un maximum de 100 notes peut √™tre r√©cup√©r√© par requ√™te. Si vous souhaitez des r√©sultats suppl√©mentaires, transmettez le pagination\_token.

Le code ci-dessous appelle l‚Äôendpoint de recherche qui renvoie les notes r√©dig√©es sur des posts X¬†:

```python
from requests_oauthlib import OAuth1Session
import json


# API endpoint and parameters
url = "https://api.x.com/2/notes/search/notes_written"
params = {"test_mode": True,
         "max_results": 100, }

# OAuth 1.0 credentials
oauth = OAuth1Session(
   client_key='REPLACE_ME',
   client_secret='REPLACE_ME',
   resource_owner_key='REPLACE_ME',
   resource_owner_secret='REPLACE_ME',
)

# Make the request
try:
   response = oauth.get(url, params=params)
   response.raise_for_status()  # Raises an HTTPError for bad responses

   print("Response code: {}".format(response.status_code))
   json_response = response.json()
   print(json.dumps(json_response, indent=4, sort_keys=True))

except Exception as e:
   print(f"Request failed: {e}")
```

La r√©ponse sera similaire √†¬†:

```json
{
  "data": [
    {
      "id": "1939827717186494817",
      "info": {
        "text": "test note text. http://source.com",
        "classification": "misinformed_or_potentially_misleading",
        "misleading_tags": [
          "missing_important_context"
        ],
        "post_id": "1939719604957577716",
        "trustworthy_sources": true
      }
    },
    {
      "id": "1939827486533222881",
      "info": {
        "text": "test note tex 2t. http://source.com",
        "classification": "misinformed_or_potentially_misleading",
        "misleading_tags": [
          "missing_important_context"
        ],
        "post_id": "1939769235158237565",
        "trustworthy_sources": true
      }
    }
  ],
  "meta": {
    "result_count": 2,
    "next_token": "[token]"
  }
}
```

<div id="manage-community-notes">
  ## G√©rer les Community Notes
</div>

Les d√©veloppeurs peuvent soumettre des Community Notes sur des posts X √† l‚Äôaide de l‚Äôendpoint POST https://api.x.com/2/notes. Comme pour les endpoints pr√©c√©dents, cet endpoint prend √©galement en charge le param√®tre de requ√™te test\_mode. Lorsque test\_mode est d√©fini sur true, la note soumise sert uniquement aux tests et ne sera pas visible publiquement.

**Remarque :** Pour l‚Äôinstant, test\_mode ne peut √™tre d√©fini que sur true ; sinon, ces endpoints renverront une erreur de ce type :

```json
{
 "errors": [
   {
     "message": "The `test_mode` query parameter is invalid."
   }
 ],
 "title": "Invalid Request",
 "detail": "One or more parameters to your request was invalid.",
 "type": "https://api.twitter.com/2/problems/invalid-request"
}
```

Pour ce faire, vous devez fournir le _post\_id_ du post pour lequel vous souhaitez soumettre la Community Note dans le corps de la requ√™te √† cet endpoint, ainsi que les informations requises pour cr√©er une note, notamment :

- _text_ : le texte de la note, qui doit contenir au moins 1 caract√®re et au plus 280 caract√®res (les URL comptent pour un seul caract√®re) et doit inclure une URL source
- _classification_ : peut √™tre soit misinformed\_or\_potentially\_misleading, soit not\_misleading
- _misleading\_tags_ : liste non vide d‚Äô√©tiquettes parmi "disputed\_claim\_as\_fact", "factual\_error", "manipulated\_media", "misinterpreted\_satire", "missing\_important\_context", "outdated\_information" ou "other". Ce champ n‚Äôest n√©cessaire que lorsque la classification est de type misinformed\_or\_potentially\_misleading.
- _trustworthy\_sources_ : valeur bool√©enne indiquant si une source fiable est fournie dans ‚Äútext‚Äù.

Ci-dessous un exemple de requ√™te vers cet endpoint :

```python
from requests_oauthlib import OAuth1Session
import json


# Remplacez par les informations de votre note
payload = {"test_mode": True,
          "post_id": "1939667242318541239"
   ,
          "info": {
              "text": "test note text. http://source.com",
              "classification": "misinformed_or_potentially_misleading",
              "misleading_tags": ["missing_important_context"],
              "trustworthy_sources": True,
          }}


# Effectuer la requ√™te
oauth = OAuth1Session(
   client_key='REPLACE_ME',
   client_secret='REPLACE_ME',
   resource_owner_key='REPLACE_ME',
   resource_owner_secret='REPLACE_ME',
)


# Envoi de la requ√™te
response = oauth.post(
   "https://api.twitter.com/2/notes",
   json=payload,
)


if response.status_code != 201:
   raise Exception(
       "Request returned an error: {} {}".format(response.status_code, response.text)
   )


print("Response code: {}".format(response.status_code))


# Enregistrer la r√©ponse au format JSON
json_response = response.json()
print(json.dumps(json_response, indent=4, sort_keys=True))
```

Si la requ√™te aboutit, la r√©ponse ressemblera √† ceci :

```json
{
 "data": {
   "note_id": "1938678124100886981"
 }
}
```

<div id="error-troubleshooting">
  ## D√©pannage des erreurs
</div>

Vous trouverez ci-dessous une liste de messages d‚Äôerreur courants et leurs solutions lors de l‚Äôutilisation des endpoints Community Notes :

<div id="401-unauthorized">
  ### 401 Non autoris√©
</div>

```json
{
 "title": "Unauthorized",
 "type": "about:blank",
 "status": 401,
 "detail": "Unauthorized"
}
```

**Explication** : Cette erreur est renvoy√©e lorsque la requ√™te n‚Äôest pas correctement authentifi√©e.

<div id="403-forbidden">
  ### 403 Interdit
</div>

```json
{
 "detail": "User: [userId] must be an API Note Writer to access this endpoint.",
 "type": "about:blank",
 "title": "Forbidden",
 "status": 403
}
```

**Explication**: Cette erreur est renvoy√©e lorsqu‚Äôun utilisateur n‚Äôa pas l‚Äôautorisation d‚Äôutiliser cet endpoint.

### 400 Requ√™te invalide (test\_mode)

```json
{
 "errors": [
   {
     "message": "The `test_mode` query parameter is invalid."
   }
 ],
 "title": "Invalid Request",
 "detail": "One or more parameters to your request was invalid.",
 "type": "https://api.twitter.com/2/problems/invalid-request"
}
```

**Explication**: Cet endpoint est renvoy√© lorsqu‚Äôun utilisateur tente d‚Äôeffectuer une requ√™te avec test\_mode d√©fini sur false

<div id="400-invalid-request-duplicate-note">
  ### 400 Requ√™te invalide (Note en double)
</div>

```json
{
 "errors": [
   {
     "message": "User already created a note: [noteId] for this post."
   }
 ],
 "title": "Invalid Request",
 "detail": "One or more parameters to your request was invalid.",
 "type": "https://api.twitter.com/2/problems/invalid-request"
}
```

**Explication**: Cette erreur est renvoy√©e lorsqu‚Äôun utilisateur tente de cr√©er une Community Note en double.

<div id="resources">
  ## Ressources
</div>

Vous trouverez des exemples de code dans d‚Äôautres langages sur notre [page GitHub](https://github.com/xdevplatform/Twitter-API-v2-sample-code). Vous pouvez √©galement commencer √† utiliser ces points de terminaison de l‚ÄôAPI avec notre [collection Postman](https://www.postman.com/xapidevelopers). Si vous avez des questions techniques concernant ces points de terminaison, n‚Äôh√©sitez pas √† nous contacter sur les [forums d‚Äôassistance de la communaut√© des d√©veloppeurs X](https://devcommunity.x.com/).