---
title: Démarrage
sidebarTitle: Démarrage
---

import { Button } from '/snippets/fr/button.mdx';

<div id="getting-started-with-the-manage-direct-message-endpoints">
  ## Prise en main des endpoints de gestion des messages privés
</div>

Ce guide de démarrage rapide vous aidera à effectuer votre première requête vers les endpoints des messages privés à l’aide de Postman, un outil pour gérer et exécuter des requêtes HTTP. Pour en savoir plus sur nos collections Postman, consultez notre guide [Utiliser Postman](/fr/tutorials/postman-getting-started).

Consultez le dépôt GitHub [Exemples de code API X v2](https://github.com/xdevplatform/Twitter-API-v2-sample-code) si vous souhaitez examiner des exemples en Python. De plus, les [kits de développement logiciel (SDK) de la plateforme développeur X](/fr/x-api/tools-and-libraries/sdks) officiels seront mis à jour pour prendre en charge ces endpoints de messages privés.  

<Note>
  **Prérequis**

  Pour suivre ce guide, vous aurez besoin d’un ensemble de [clés et jetons](/fr/resources/fundamentals/authentication) pour authentifier votre requête. Vous pouvez générer ces clés et jetons en suivant ces étapes :

  - [Inscrivez-vous pour obtenir un compte développeur](https://developer.x.com/en/apply-for-access) et obtenez l’approbation.
  - Créez un [Projet](/fr/resources/fundamentals/projects) et une [application développeur](/fr/resources/fundamentals/developer-apps) associés dans le portail développeur.
  - Accédez à la page « Keys and tokens » de votre application pour générer les identifiants requis. Veillez à enregistrer tous les identifiants dans un emplacement sécurisé.
</Note>

<div id="steps-to-building-direct-message-lookup-requests">
  ### Étapes pour créer des requêtes de recherche de Messages directs
</div>

Dans cet exemple, en une seule requête, nous allons créer une nouvelle conversation de groupe et y ajouter notre premier message. Nous ajouterons ensuite un deuxième message à la conversation créée.

<div id="step-one-start-with-a-tool-or-library">
  #### Première étape : commencer avec un outil ou une bibliothèque
</div>

Pour commencer à utiliser les endpoints de gestion des Messages privés, nous allons utiliser l’outil Postman afin de simplifier le processus. Une collection d’exemples de requêtes de l’API X v2, rédigée par XDevelopers, sera utilisée pour explorer six endpoints servant à créer de nouveaux Messages privés et à lister les événements des conversations de Messages privés.

Bien que la majeure partie de la collection soit préremplie, vous devrez fournir quelques informations liées à l’application X créée pour héberger ces requêtes API. Commençons par charger/mettre à jour la collection.

Pour charger la collection Postman de l’API X v2 dans votre environnement, veuillez cliquer sur le bouton suivant :

<Button href="https://app.getpostman.com/run-collection/9956214-784efcda-ed4c-4491-a4c0-a26470a67400">
  Ajouter l’API X v2 à Postman
</Button>

Une fois la collection de l’API X v2 chargée dans Postman, accédez au dossier « Manage Direct Messages ». L’onglet Authorization de ce dossier a été prérempli lorsque c’était possible. Vous devrez mettre à jour quelques paramètres pour renseigner les informations d’authentification de votre application X.

Ce dossier contient également trois endpoints pour créer de nouveaux Messages privés. Notez qu’il existe aussi un dossier « Direct Message lookup » avec trois endpoints disponibles pour récupérer les événements de conversation des Messages privés, y compris l’envoi et la réception de messages, ainsi que les moments où les participants à la conversation rejoignent et quittent.

Étant donné que la création de conversations de groupe est une nouvelle fonctionnalité de l’API X v2, cet exemple s’y concentrera. Nous utiliserons l’exemple « New group DM and conversation ». Cette requête servira à créer une conversation de groupe de Messages privés.

L’étape suivante consiste à vous authentifier auprès de l’endpoint.

<div id="step-two-authenticate-your-request">
  #### Deuxième étape : authentifier votre requête
</div>

Pour effectuer correctement une requête vers l’API X, vous devez vérifier que vous avez l’autorisation de le faire. Pour envoyer une requête réussie à cet endpoint, nous utiliserons l’[OAuth 2.0 Authorization Code Flow with PKCE](fr/resources/fundamentals/authentication#oauth-2-0-authorization-code-flow-with-pkce-2). Vous pouvez générer un jeton d’accès dans Postman. 

Avec Postman, vous pouvez définir la méthode d’authentification au niveau du dossier ou au niveau de la requête. Ici, nous allons configurer les détails d’authentification au niveau du dossier. Accédez au dossier "Manage Direct Messages", sélectionnez l’onglet "Authorization" et confirmez que le Type est défini sur “OAuth 2.0”, et que "Add auth data to" est défini sur "Request Headers." Dans la section "Current Token", assurez-vous que le "Header Prefix" est défini sur Bearer.  

Pour configurer et générer un nouveau jeton :

1. Créez un nom de jeton, par exemple "DM lookup."

2. Confirmez que **Grant Type** est défini sur Authorization Code (with PKCE).

3. Définissez votre **Callback URL**. Vous devrez mettre à jour votre Callback URL pour qu’elle corresponde exactement à la Callback URL associée à votre application dans le [v2 Dev Portal](https://developer.x.com/en/portal/dashboard). Avec l’application X utilisée dans cet exemple, la Callback URL est définie sur - [https://www.example.com.](https://www.example.com/) (Notez que comme cela doit correspondre exactement, [https://example.com](https://example.com) ne fonctionnerait pas.) 

4. Confirmez que **Auth URL** est défini sur [https://x.com/i/oauth2/authorize](https://x.com/i/oauth2/authorize)

5. Confirmez que **Access Token URL** est défini sur [https://api.x.com/2/oauth2/token.](https://api.x.com/2/oauth2/token)**Client ID** - Copiez et collez l’ID client OAuth 2.0 depuis le Developer Portal
   **Client Secret** - Vous n’en aurez besoin que si vous utilisez un type d’application qui est un client confidentiel. Le cas échéant, copiez et collez le secret client OAuth 2.0 depuis le Developer Portal. 

6. Confirmez que **Scope** est défini sur dm.read dm.write tweet.read users.read.

7. Confirmez que **State** est défini sur “state.”

8. Confirmez que **Client Authentication** est défini sur Send as Basic Auth header.

9. Cliquez sur “Get New Access Token”, puis sur "Authorize app" dans le cadre du processus "Sign-in with X".

10. Cliquez sur le bouton "Proceed", puis sur "Use Token" pour générer un jeton. 

11. Cliquez sur le bouton "Save" pour enregistrer ces détails de configuration.

Vous pouvez recevoir un message indiquant que vous n’êtes pas connecté à X. Si vous obtenez cette erreur, vous devrez vous connecter, dans Postman, au compte X au nom duquel vous essayez de publier.

Maintenant que ces détails OAuth 2.0 ont été définis au niveau du dossier, accédez à chacun des exemples et à leur onglet "Authorization" et confirmez que leur Type est défini sur "Inherit auth from parent." 

Notez que ce jeton expirera bientôt, et vous devrez le régénérer en cliquant sur le bouton "Get New Access Token". Cliquer sur ce bouton déclenchera le processus "Sign-in with X" et générera un nouveau jeton pour effectuer des requêtes.

<div id="step-three-retrieve-direct-messages-conversation-events">
  #### Troisième étape : récupérer les événements de conversation des Messages privés
</div>

Lors de la récupération des événements de conversation de Messages privés avec cet endpoint, vous devez spécifier un ID de conversation. L’ID de conversation fait partie du chemin de l’endpoint : https://api.x.com/2/dm\_conversations/:dm\_conversation\_id/dm\_events

Dans Postman, accédez à l’onglet « Params » et saisissez l’ID de la conversation pour laquelle vous souhaitez récupérer des événements dans la section « Path Variables ».

Le paramétrage sera :

|     |     |
| :--- | :--- |
| **Key** | **Value** |
| `dm_conversation_id` | `1228393702244134912` |

Avec cette conversation spécifiée, le chemin résultant devient https://api.x.com/2/dm\_conversations/1582103724607971328/dm\_events

Si vous cliquez sur le bouton « Send », vous recevrez les champs d’objet de Message privé par défaut dans votre réponse : id, text et event\_type. Il y aura également un objet « meta » avec le nombre de résultats, ainsi que des jetons de pagination permettant de récupérer davantage d’événements si disponibles.

```
{
   "data": [
       {
           "event_type": "MessageCreate",
           "id": "1580705921830768647",
           "text": "hello to you two, this is a new group conversation."
       }
   ],
   "meta": {
       "result_count": 1,
       "next_token": "18LAA5FFPEKJA52G0G00ZZZZ",
       "previous_token": "1BLC45FFPEKJA52G0S00ZZZZ"
   }
}
```

Si vous souhaitez recevoir des champs supplémentaires, vous devrez les spécifier dans votre requête avec les paramètres [field](/fr/x-api/fundamentals/fields) et/ou [expansion](/fr/x-api/fundamentals/expansions).

Pour cet exercice, nous demanderons des ensembles supplémentaires de champs de l’objet dm\_event :

1. Les champs d’objet de Message privé par défaut : id, text et event\_type.

2. Des champs d’objet de Message privé supplémentaires : dm\_conversation\_id, created\_at, sender\_id, attachments, participant\_ids, referenced\_tweets

Dans Postman, accédez à l’onglet « Params » et ajoutez la paire clé:valeur suivante au tableau « Query Params » :

|     |     |
| :--- | :--- |
| Key | Value |
| dm\_event.fields | dm\_conversation\_id,created\_at,sender\_id,attachments,participant\_ids,referenced\_tweets |

Vous devriez maintenant voir l’URL suivante à côté du bouton « Send » :

https://api.x.com/2/dm\_conversations/:dm\_conversation\_id/dm\_events?dm\_event.fields=id,text,event\_type,dm\_conversation\_id,created\_at,sender\_id,attachments,participant\_ids,referenced\_tweets

<div id="step-four-make-your-request-and-review-your-response">
  #### Quatrième étape : envoyez votre requête et examinez la réponse
</div>

Une fois tout configuré, cliquez de nouveau sur le bouton « Send » et vous recevrez une réponse similaire à celle ci-dessous. Notez que cette réponse inclut tous les champs dm\_event disponibles.

```
{
   "data": [
       {
           "text": "hello to you two, this is a new group conversation.",
           "id": "1580705921830768647",
           "dm_conversation_id": "1580705921830768643",
           "event_type": "MessageCreate",
           "sender_id": "17200003",
           "created_at": "2022-10-13T23:43:54.000Z"
       }
   ],
   "meta": {
       "result_count": 1,
       "next_token": "18LAA5FFPEKJA52G0G00ZZZZ",
       "previous_token": "1BLC45FFPEKJA52G0S00ZZZZ"
   }
}
```