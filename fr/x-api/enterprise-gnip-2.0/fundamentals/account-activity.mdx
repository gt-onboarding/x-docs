---
title: "Account Activity API: Enterprise"
---

<Note>
  Ce point de terminaison a été mis à jour pour inclure les métadonnées d’édition de posts. Pour en savoir plus, consultez la page des notions de base ["Modifier des posts"](/fr/x-api/enterprise-gnip-2.0/fundamentals/edit-tweets). 

  Ce point de terminaison est souvent utilisé avec les points de terminaison Direct Messages. Nous avons lancé de nouveaux [points de terminaison Direct Messages v2](/fr/x-api/direct-messages/manage/introduction). Notez que les versions Enterprise et Premium de l’Account Activity API prennent en charge les messages v2 en tête‑à‑tête, mais ne prennent pas encore en charge les conversations de groupe.   
</Note>

Présentation

`Enterprise`

L’Account Activity API vous permet de vous abonner, via des webhooks, aux activités en temps réel liées à un compte utilisateur. Vous pouvez ainsi recevoir en temps réel des posts, des Direct Messages et d’autres événements de compte provenant d’un ou plusieurs de vos comptes détenus ou suivis, le tout via une connexion unique.

Vous recevrez toutes les activités ci‑dessous pour chaque abonnement utilisateur lors de l’enregistrement de votre webhook :

| Types d’activité |     |
| :--- | :--- |
| \* Posts (par l’utilisateur)  <br />    <br />\* Suppressions de posts (par l’utilisateur)<br />\* @mentions (de l’utilisateur)<br />\* Réponses (vers ou depuis l’utilisateur)<br />\* Retweets (par l’utilisateur ou concernant l’utilisateur)<br />\* Tweets cités (par l’utilisateur ou concernant l’utilisateur)<br />\* Retweets de tweets cités (par l’utilisateur ou concernant l’utilisateur)<br />\* J’aime (par l’utilisateur ou concernant l’utilisateur)<br />\* Abonnements (par l’utilisateur ou concernant l’utilisateur)  <br />    <br />\* Désabonnements (par l’utilisateur) | \* Blocages (par l’utilisateur)<br />\* Déblocages (par l’utilisateur)<br />\* Masquages (par l’utilisateur)<br />\* Démasquages (par l’utilisateur)<br />\* Direct Messages envoyés (par l’utilisateur)<br />\* Direct Messages reçus (par l’utilisateur)<br />\* Indicateurs de saisie (vers l’utilisateur)<br />\* Accusés de lecture (vers l’utilisateur)<br />\* Révocations d’abonnement (par l’utilisateur) |

**Veuillez noter** - Nous ne délivrons pas les données du fil d’accueil via l’Account Activity API. Veuillez utiliser [GET statuses/home\_timeline](https://developer.x.com/en/docs/x-api/v1/tweets/timelines/overview) pour récupérer ces données.
 

<div id="video-series">
  #### Série vidéo
</div>

Découvrez notre [série vidéo en quatre volets](https://www.youtube.com/watch?v=otPxejFhyy8\&index=0\&list=PLFKjcMIU2WshGG6Yj940XM7Z6BFs1zfBg) sur l’API Account Activity pour être rapidement opérationnel !

<iframe src="https://platform.x.com/embed/Tweet.html?dnt=false&embedId=twitter-widget-0&features=eyJ0ZndfdGltZWxpbmVfbGlzdCI6eyJidWNrZXQiOltdLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X2ZvbGxvd2VyX2NvdW50X3N1bnNldCI6eyJidWNrZXQiOnRydWUsInZlcnNpb24iOm51bGx9LCJ0ZndfdHdlZXRfZWRpdF9iYWNrZW5kIjp7ImJ1Y2tldCI6Im9uIiwidmVyc2lvbiI6bnVsbH0sInRmd19yZWZzcmNfc2Vzc2lvbiI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfZm9zbnJfc29mdF9pbnRlcnZlbnRpb25zX2VuYWJsZWQiOnsiYnVja2V0Ijoib24iLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X21peGVkX21lZGlhXzE1ODk3Ijp7ImJ1Y2tldCI6InRydWF0bWVudCIsInZlcnNpb24iOm51bGx9LCJ0ZndfZXhwZXJpbWVudHNfY29va2llX2V4cGlyYXRpb24iOnsiYnVja2V0IjoxMjA5NjAwLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X3Nob3dfYmlyZHdhdGNoX3Bpdm90c19lbmFibGVkIjp7ImJ1Y2tldCI6Im9uIiwidmVyc2lvbiI6bnVsbH0sInRmd19kdXBsaWNhdGVfc2NyaWJlc190b19zZXR0aW5ncyI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfdXNlX3Byb2ZpbGVfaW1hZ2Vfc2hhcGVfZW5hYmxlZCI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfdmlkZW9faGxzX2R5bmFtaWNfbWFuaWZlc3RzXzE1MDgyIjp7ImJ1Y2tldCI6InRydWVfYml0cmF0ZSIsInZlcnNpb24iOm51bGx9LCJ0ZndfbGVnYWN5X3RpbWVsaW5lX3N1bnNldCI6eyJidWNrZXQiOnRydWUsInZlcnNpb24iOm51bGx9LCJ0ZndfdHdlZXRfZWRpdF9mcm9udGVuZCI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9fQ%3D%3D&frame=false&hideCard=false&hideThread=false&id=996790447048613888&lang=en&origin=https%3A%2F%2Fdeveloper.x.com%2Fen%2Fdocs%2Fx-api%2Fenterprise%2Faccount-activity-api%2Foverview&sessionId=81f4a0339cbd7bd77b669faa00bd3a7224bc4418&theme=light&widgetsVersion=2615f7e52b7e0%3A1702314776716&width=550px" height="400px" />

<div id="feature-summary">
  ### Résumé des fonctionnalités
</div>

| Niveau | Tarification | Nombre d’abonnements uniques | Nombre de webhooks | Fiabilité et reprise d’activité |
| :--- | :--- | :--- | :--- | :--- |
| Enterprise | [Contacter l’équipe commerciale](/fr/x-api/enterprise-gnip-2.0/enterprise-gnip) | Jusqu’à 500+ | 3+  | [Relances](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#retries) et [relecture](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-replay-api) |

- Des questions ? Vous rencontrez des erreurs ?
  - Lisez notre [FAQ](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#frequently-asked-questions) ou notre [guide de dépannage des erreurs](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#frequently-asked-questions).

- Explorez nos exemples de code :
  - [Tableau de bord Enterprise Account Activity API](https://github.com/xdevplatform/account-activity-dashboard-enterprise), une application web Node qui affiche des événements de webhook avec le niveau Enterprise de l’Account Activity API et inclut la fonctionnalité de [relecture](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-replay-api).
  - Le [chatbot SnowBot](https://github.com/xdevplatform/SnowBotDev), une application web Ruby basée sur les API Enterprise Account Activity et Direct Message.

#### Gestion d’un webhook :

L’utilisation d’un webhook vous permet de vous abonner, via une connexion unique, aux activités en temps réel liées à un compte utilisateur.

<Tabs>
  <Tab title="Ajout d’un webhook">
    Commençons par enregistrer une nouvelle URL de webhook pour le contexte d’application donné.

    L’URL sera validée via une requête CRC avant l’enregistrement. Une fois le webhook enregistré, veillez à noter l’ID du webhook, car vous en aurez besoin ultérieurement.

    Copiez la requête cURL suivante dans votre terminal après avoir modifié les éléments suivants :

    - **URL** `<URL>` p. ex. `https://yourdomain.com/webhooks/twitter/`

    - **Consumer key** `<CONSUMER_KEY>` p. ex. `xvz1evFS4wEEPTGEFPHBog`

    - **Access token** `<ACCESS_TOKEN>` p. ex.  `370773112-GmHxMAgYyLbNEtIKZeRNFsMKPR9EyMZeS9weJAEb`

      ```
      curl --request POST --url 'https://api.x.com/1.1/account_activity/webhooks.json?url=<URL>' --header 'authorization: OAuth oauth_consumer_key="<CONSUMER_KEY>", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="<ACCESS_TOKEN>", oauth_version="1.0"'
      ```
  </Tab>

  <Tab title="Affichage d’un webhook">
    Nous allons exécuter la commande suivante pour retourner toutes les URL de webhook enregistrées ainsi que leur statut pour l’application donnée.

    Copiez la requête cURL suivante dans votre terminal après avoir modifié l’élément suivant :

    - **Bearer token** `<BEARER_TOKEN>` p. ex. `AAAAAAAAAAAA0%2EUifi76ZC9Ub0wn...`

      ```curl --request GET --url https://api.x.com/1.1/account_activity/webhooks.json --header 'authorization: Bearer <BEARER_TOKEN>'
      ```
  </Tab>

  <Tab title="Suppression d’un webhook">
    Pour supprimer un webhook de la configuration de l’application indiquée, copiez la requête cURL suivante dans votre terminal après avoir modifié les éléments suivants :

    - **Webhook ID** `<:WEBHOOK_ID>` p. ex. `1234567890`

    - **Consumer key** `<CONSUMER_KEY>` p. ex. `xvz1evFS4wEEPTGEFPHBog`

    - **Access token** `<ACCESS_TOKEN>` p. ex.  `370773112-GmHxMAgYyLbNEtIKZeRNFsMKPR9EyMZeS9weJAEb`

      ```curl --request DELETE --url https://api.x.com/1.1/account_activity/webhooks/<:WEBHOOK_ID>.json --header 'authorization: OAuth oauth_consumer_key="<CONSUMER_KEY>", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="<ACCESS_TOKEN>", oauth_version="1.0"'
      ```
  </Tab>
</Tabs>

<div id="managing-a-webhook">
  #### Gestion des utilisateurs abonnés :
</div>

Une fois que vous avez enregistré un webhook, vous pouvez ajouter un utilisateur abonné à l’Account Activity API pour commencer à recevoir l’activité de son compte.

<Tabs>
  <Tab title="Ajouter un abonnement">
    Nous allons commencer par abonner un utilisateur afin que vous receviez tous les types d’événements.

    Copiez la requête cURL suivante dans votre terminal après avoir remplacé les éléments suivants :

    - **ID du webhook** `<:WEBHOOK_ID>` p. ex. `1234567890`

    - **Nom de la clé consumer** `<CONSUMER_KEY>` p. ex. `xvz1evFS4wEEPTGEFPHBog`

    - **Jeton d’accès de l’utilisateur abonné** `<SUBSCRIBING_USER'S_ACCESS_TOKEN>` p. ex. `370773112-GmHxMAgYyLbNEtIKZeRNFsMKPR9EyMZeS9weJAEb`

      ```
      curl --request POST --url https://api.x.com/1.1/account_activity/webhooks/<:WEBHOOK_ID>/subscriptions/all.json --header 'authorization: OAuth oauth_consumer_key="<CONSUMER_KEY>", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="<SUBSCRIBING_USER'S_ACCESS_TOKEN>", oauth_version="1.0"'
      ```
  </Tab>

  <Tab title="Afficher les abonnements">
    Pour afficher la liste de tous les abonnements par type d’activité pour un webhook donné, copiez la requête cURL suivante dans votre terminal après avoir remplacé les éléments suivants :

    - **ID du webhook** `<:WEBHOOK_ID>` p. ex. `1234567890`

    - **Jeton Bearer** `<BEARER_TOKEN>` p. ex. `AAAAAAAAAAAA0%2EUifi76ZC9Ub0wn...`

      ```
      curl --request GET --url https://api.x.com/1.1/account_activity/webhooks/<:WEBHOOK_ID>/subscriptions/all/list.json --header 'authorization: Bearer <BEARER_TOKEN>'
      ```
  </Tab>

  <Tab title="Supprimer un abonnement">
    Après la désactivation, aucun événement pour l’utilisateur demandeur ne sera plus envoyé à l’URL du webhook.

    Pour désactiver un abonnement dans le contexte utilisateur et l’application fournis, copiez la requête cURL suivante dans votre terminal après avoir remplacé les éléments suivants :

    - **ID du webhook** `<:WEBHOOK_ID>` p. ex. `1234567890`

    - **Clé consumer** `<CONSUMER_KEY>` p. ex. `xvz1evFS4wEEPTGEFPHBog`

    - **Jeton d’accès de l’utilisateur abonné** `<SUBSCRIBING_USER'S_ACCESS_TOKEN>` p. ex. `370773112-GmHxMAgYyLbNEtIKZeRNFsMKPR9EyMZeS9weJAEb`

      ```
      curl --request DELETE --url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID/subscriptions/all.json --header 'authorization: OAuth oauth_consumer_key="CONSUMER_KEY", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="SUBSCRIBED_USER'S_ACCESS_TOKEN", oauth_version="1.0"'
      ```
  </Tab>
</Tabs>

Excellent travail ! Vous devriez maintenant être en mesure de gérer vos webhooks et vos utilisateurs abonnés.

<div id="managing-subscribed-users">
  #### Articles de référence
</div>

- [Présentation du Challenge-Response Check (CRC)](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#securing-webhooks)
- \[Types de données de l’activité de compte]\(/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-data-object-structure
- [Gestion des webhooks et des abonnements](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#managing-webhooks-and-subscriptions)

## Une démonstration vidéo de l’API Account Activity

Dans cette démonstration vidéo, vous découvrirez les fonctionnalités des niveaux Premium et Enterprise de l’API Account Activity.

À la fin de cette vidéo, vous aurez appris ce qui suit :

- Enregistrer un webhook
- Ajouter un abonnement utilisateur
- Supprimer un abonnement utilisateur
- Recevoir les activités de compte
- Rejouer les activités de compte

<iframe src="https://platform.x.com/embed/Tweet.html?dnt=false&embedId=twitter-widget-0&features=eyJ0ZndfdGltZWxpbmVfbGlzdCI6eyJidWNrZXQiOltdLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X2ZvbGxvd2VyX2NvdW50X3N1bnNldCI6eyJidWNrZXQiOnRydWUsInZlcnNpb24iOm51bGx9LCJ0ZndfdHdlZXRfZWRpdF9iYWNrZW5kIjp7ImJ1Y2tldCI6Im9uIiwidmVyc2lvbiI6bnVsbH0sInRmd19yZWZzcmNfc2Vzc2lvbiI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfZm9zbnJfc29mdF9pbnRlcnZlbnRpb25zX2VuYWJsZWQiOnsiYnVja2V0Ijoib24iLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X21peGVkX21lZGlhXzE1ODk3Ijp7ImJ1Y2tldCI6InRydWVfYml0cmF0ZSIsInZlcnNpb24iOm51bGx9LCJ0ZndfZXhwZXJpbWVudHNfY29va2llX2V4cGlyYXRpb24iOnsiYnVja2V0IjoxMjA5NjAwLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X3Nob3dfYmlyZHdhdGNoX3Bpdm90c19lbmFibGVkIjp7ImJ1Y2tldCI6Im9uIiwidmVyc2lvbiI6bnVsbH0sInRmd19kdXBsaWNhdGVfc2NyaWJlc190b19zZXR0aW5ncyI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfdXNlX3Byb2ZpbGVfaW1hZ2Vfc2hhcGVfZW5hYmxlZCI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfdmlkZW9faGxzX2R5bmFtaWNfbWFuaWZlc3RzXzE1MDgyIjp7ImJ1Y2tldCI6InRydWVfYml0cmF0ZSIsInZlcnNpb24iOm51bGx9LCJ0ZndfbGVnYWN5X3RpbWVsaW5lX3N1bnNldCI6eyJidWNrZXQiOnRydWUsInZlcnNpb24iOm51bGx9LCJ0ZndfdHdlZXRfZWRpdF9mcm9udGVuZCI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9fQ%3D%3D&frame=false&hideCard=false&hideThread=false&id=1204084171334832128&lang=en&origin=https%3A%2F%2Fdeveloper.x.com%2Fen%2Fdocs%2Fx-api%2Fenterprise%2Faccount-activity-api%2Fquick-start%2Fa-visual-walkthrough-of-the-account-activity-api&sessionId=b5b8e259a4c6287be2413de9059093170036fb30&theme=light&widgetsVersion=2615f7e52b7e0%3A1702314776716&width=550px" />

- Des questions ? Vous rencontrez des erreurs ?
  - Consultez notre [foire aux questions](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#frequently-asked-questions) ou notre [guide de dépannage des erreurs](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#frequently-asked-questions).

- Parcourez nos exemples de code :
  - [Enterprise Account Activity API dashboard](https://github.com/xdevplatform/account-activity-dashboard-enterprise), une application web Node qui affiche des événements de webhook à l’aide du niveau Enterprise de l’Account Activity API et inclut la fonctionnalité [Replay](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-replay-api).
  - Le [chatbot SnowBot](https://github.com/xdevplatform/SnowBotDev), une application web Ruby basée sur les API Enterprise Account Activity et Direct Message.

**Enterprise**

<div id="a-video-walkthrough-of-the-account-activity-api">
  ## Premiers pas avec les webhooks
</div>

L’API Account Activity est une API à base de webhooks qui envoie des événements de compte à une application web que vous développez, déployez et hébergez.

Plusieurs aspects techniques doivent être traités avant de pouvoir commencer à recevoir des événements de webhook dans votre application consommatrice d’événements. Comme décrit ci-dessous, vous devrez créer une application X, obtenir l’accès à l’API Account Activity et développer une application web qui consomme les événements de webhook. 

### 1. Créez une application X.

- Créez une [application X](/fr/resources/fundamentals/developer-apps) avec un compte développeur approuvé depuis le [portail développeur](/fr/resources/fundamentals/developer-portal). Si vous créez l’application pour votre entreprise, il est recommandé de la créer avec un compte X d’entreprise. Pour demander un compte développeur, [cliquez ici](/fr/resources/fundamentals/developer-apps).
- Activez « Read, Write and Access direct messages » dans l’onglet [Permissions](/fr/resources/fundamentals/developer-apps#oauth-1-0a-app-permissions) de la page de votre application.
- Dans l’onglet « Keys and Access Tokens », notez la Consumer Key (API Key) et le Consumer Token (API Secret) de votre application.
- Dans le même onglet, générez l’[Access Token et l’Access Token Secret](/fr/resources/fundamentals/authentication#obtaining-access-tokens-using-3-legged-oauth-flow) de votre application. Vous aurez besoin de ces Access Tokens pour enregistrer l’URL de votre webhook, à laquelle X enverra les événements de compte.
- Si vous ne connaissez pas [X Sign-in](/fr/resources/fundamentals/authentication#log-in-with-x) ni le fonctionnement des contextes utilisateur avec l’API X, consultez [Obtaining Access Tokens](https://dev.x.com/webhooks/access-tokens). À mesure que vous ajoutez des comptes pour lesquels recevoir des événements, vous les abonnerez en utilisant les Access Tokens de ces comptes.
- Notez l’ID numérique de votre application, tel qu’il apparaît sur la page [« Apps »](/fr/resources/fundamentals/developer-apps) du [portail développeur](/fr/resources/fundamentals/developer-portal). Lorsque vous demanderez l’accès à l’Account Activity API, vous aurez besoin de cet ID d’application.
   

<div id="1-create-a-x-app">
  ### 2. Obtenir l’accès à l’API Account Activity
</div>

Après avoir créé une application X, l’étape suivante consiste à demander l’accès à l’API Account Activity.

L’API Account Activity n’est disponible qu’avec l’offre Enterprise ; vous devrez donc soumettre une demande via le lien ci-dessous.

<Button href="https://developer.x.com/en/enterprise-application.html">
  Demander l’accès Enterprise
</Button>

<div id="2-get-account-activity-api-access">
  ### 3. Développer une application consommatrice de webhooks
</div>

Une fois que vous avez obtenu l’accès à l’Account Activity API, vous devez développer, déployer et héberger une application web qui recevra les événements webhook X.

- Créez une application web avec une URL à utiliser comme webhook pour recevoir des événements. Il s’agit du point de terminaison déployé sur votre serveur qui écoute les événements webhook X entrants.
  - Le chemin d’URI est entièrement à votre discrétion. Cet exemple serait valide : https://mydomain.com\_/service/listen\_

  - Si vous recevez des webhooks provenant de diverses sources, un schéma courant est : https://mydomain.com/webhook/twitter

  - Notez que l’URL spécifiée ne peut pas inclure de numéro de port (https://mydomain.com:5000/NoWorkie).

- Comme décrit dans notre guide [Sécuriser les webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#securing-webhooks), une première étape consiste à écrire du code qui reçoit une requête GET X Challenge Response Check (CRC) et qui répond avec un JSON correctement formaté.

- Enregistrez votre URL de webhook. Vous enverrez une requête POST vers l’endpoint /webhooks.json?url=. Lorsque vous ferez cette requête, X émettra une requête CRC à votre application web. Lorsqu’un webhook est enregistré avec succès, la réponse inclut un identifiant de webhook. Cet identifiant de webhook sera nécessaire ultérieurement pour certaines requêtes vers l’Account Activity API.

- X enverra les événements de webhook de compte à l’URL que vous avez enregistrée. Assurez-vous que votre application web accepte les requêtes POST pour les événements entrants. Ces événements seront encodés en JSON. Voir [ICI](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-data-object-structure) pour des exemples de charges utiles JSON de webhook.

- Une fois votre application web prête, l’étape suivante consiste à ajouter les comptes pour lesquels vous souhaitez recevoir des activités. Lors de l’ajout (ou de la suppression) de comptes, vous effectuerez des requêtes POST en faisant référence à l’identifiant du compte. Consultez notre [guide sur l’ajout d’abonnements](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#managing-webhooks-and-subscriptions) pour plus d’informations.

<div id="3-develop-webhook-consumer-app">
  ### 4. Valider la configuration
</div>

- Pour vérifier que votre application et votre webhook sont correctement configurés, ajoutez un favori à un Post publié par l’un des comptes X auxquels votre application est abonnée. Vous devriez recevoir un `favorite_events` via une requête POST vers l’URL de votre webhook pour chaque favori reçu par vos abonnés.
- Notez que la livraison des événements peut prendre jusqu’à 10 secondes après l’ajout d’un abonnement.

**Notes importantes**

- Lors de l’enregistrement de votre URL de webhook, votre application web doit s’authentifier avec son consumer token et secret _et le user access token et secret du propriétaire de l’application_.

- Tous les Messages privés entrants seront livrés via webhooks. Tous les Messages privés envoyés via [POST direct\_messages/events/new (message\_create)](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/new-event) seront également livrés via webhooks. Cela permet à votre application web d’être informée des Messages privés envoyés via un autre client.

- Notez que chaque événement de webhook inclut un for\_user\_id (ID utilisateur) qui indique pour quel abonnement l’événement a été livré.

- Si deux utilisateurs utilisent votre application web pour des Messages privés dans la même conversation, votre webhook recevra deux événements en double (un pour chaque utilisateur). Votre application web doit en tenir compte.

- Si vous avez plus d’une application web partageant la même URL de webhook et le même utilisateur associé à chaque application, le même événement sera envoyé plusieurs fois à votre webhook (une fois par application web).

- Dans certains cas, votre webhook peut recevoir des événements en double. Votre application webhook doit tolérer ce cas et effectuer une déduplication par ID d’événement.

- N’attendez pas qu’une réponse de Réponse rapide suive directement une demande. Un utilisateur peut ignorer une demande de Réponse rapide et répondre via un Message privé classique. L’utilisateur peut également fournir une réponse de Réponse rapide à une demande à laquelle il n’a pas répondu plus tôt dans le fil de messages.

- Voir du code d’exemple :
  - [Enterprise Account Activity API dashboard](https://github.com/xdevplatform/account-activity-dashboard-enterprise), une application web Node qui affiche les événements de webhook en utilisant le niveau Enterprise de l’Account Activity API et inclut la fonctionnalité [Replay](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-replay-api).

  - Le [chatbot SnowBot](https://github.com/xdevplatform/SnowBotDev), une application web Ruby basée sur les Account Activity et Direct Message APIs. Cette base de code inclut un [script](https://github.com/xdevplatform/SnowBotDev/wiki/Account-Activity-API-setup-script) pour aider à configurer les webhooks de l’Account Activity API.

## Sécurisation des webhooks

Les API de X basées sur des webhooks proposent deux méthodes pour garantir la sécurité de votre serveur de webhook :

1. Les vérifications de type challenge-response permettent à X de confirmer la propriété de l’application web qui reçoit les événements de webhook.
2. L’en-tête de signature dans chaque requête POST vous permet de vérifier que X est bien la source des webhooks entrants.
    

### Vérifications Challenge-Response 

Afin de vérifier que vous êtes à la fois le propriétaire de l’application et de l’URL du webhook, X effectuera une vérification Challenge-Response (CRC), à ne pas confondre avec un contrôle de redondance cyclique. Lorsqu’un CRC est envoyé, X effectuera une requête GET vers votre application web avec un paramètre _`crc_token`_. À la réception de cette requête, votre application web doit construire un `response_token` chiffré à partir du paramètre _`crc_token`_ et du Consumer Secret de votre application (détails ci-dessous). Le `response_token` doit être encodé en JSON (voir l’exemple ci-dessous) et renvoyé sous trois secondes. En cas de succès, un `id` de webhook sera renvoyé. 

Un CRC sera envoyé lorsque vous enregistrez votre URL de webhook, donc implémenter votre code de réponse CRC est une première étape fondamentale. Une fois votre webhook établi, X déclenchera un CRC approximativement toutes les 24 heures à partir du dernier moment où nous avons reçu une réponse réussie. Votre application peut également déclencher un CRC si nécessaire en effectuant une requête PUT avec votre `id` de webhook. Déclencher un CRC est utile pendant le développement de votre application webhook, après le déploiement d’un nouveau code et le redémarrage de votre service. 

Le _`crc_token`_ doit être considéré comme variant à chaque requête CRC entrante et doit être utilisé comme message dans le calcul, votre Consumer Secret servant de clé.

Si la réponse n’est pas renvoyée sous 3 secondes ou devient invalide, les événements cesseront d’être envoyés au webhook enregistré.

#### La requête CRC se produira :

- Lorsqu’une URL de webhook est enregistrée.
- Environ _toutes les heures_ pour valider votre URL de webhook.
- Vous pouvez déclencher manuellement un CRC en effectuant une requête PUT. À mesure que vous développez votre client de webhook, prévoyez de déclencher manuellement le CRC pendant la mise au point de votre réponse CRC. 
   

<div id="the-crc-request-will-occur">
  #### Exigences de la réponse :
</div>

- Un hachage HMAC SHA-256 encodé en base64, créé à partir du `crc_token` et du Consumer Secret de votre application
- Un `response_token` valide et un format JSON.
- Une latence inférieure à 3 secondes.
- Un code de réponse HTTP 200.
   

<div id="response-requirements">
  #### Bibliothèques HMAC spécifiques à une langue :
</div>

- [Java/Scala](https://docs.oracle.com/javase/8/docs/api/index.html?javax/crypto/Mac.html)
- [Ruby](http://ruby-doc.org/stdlib-2.1.0/libdoc/openssl/rdoc/OpenSSL/HMAC.html)
- [Node.js](https://nodejs.org/api/crypto.html#crypto_class_hmac)
- [Python](https://docs.python.org/2/library/hmac.html)

<div id="language-specific-hmac-libraries">
  #### Exemple de génération de jeton de réponse en Python :
</div>

Ce qui suit définit une route dans une application web Flask pour Python 2.7 qui répondra correctement à la vérification par défi-réponse.

```
import base64
import hashlib
import hmac
import json


\# Defines a route for the GET request
@app.route('/webhooks/twitter', methods=\['GET'\])
def webhook_challenge():

  # crée un hachage HMAC SHA-256 à partir du jeton entrant et de votre secret consommateur
  sha256\_hash\_digest = hmac.new(TWITTER\_CONSUMER\_SECRET, msg=request.args.get('crc_token'), digestmod=hashlib.sha256).digest()

  # construit les données de réponse avec le hachage encodé en base64
  response = {
    'response\_token': 'sha256=' + base64.b64encode(sha256\_hash_digest)
  }

  # renvoie une réponse JSON correctement formatée
  return json.dumps(response)
```

<div id="example-response-token-generation-in-python">
  #### Exemple de réponse JSON :
</div>

Avec la route définie comme ci-dessus, votre application web devrait renvoyer une réponse similaire à celle ci-dessous lorsque vous accédez à https://your-app-domain/webhooks/twitter?crc\_token=foo dans votre navigateur.

```
{
  "response_token": "sha256=x0mYd8hz2goCTfcNAaMqENy2BFgJJfJOb4PdvTffpwg="
}
```

<div id="example-json-response">
  #### Autres exemples :
</div>

- [ICI](https://github.com/xdevplatform/account-activity-dashboard/blob/master/helpers/security.js) montre un exemple de méthode de réponse CRC écrite en Node/JS.
- [ICI](https://github.com/xdevplatform/SnowBotDev/blob/master/app/controllers/snow_bot_dev_app.rb) montre un exemple de méthode de réponse CRC écrite en Ruby (voir _generate\_crc\_response_ et la route GET qui reçoit les événements CRC).

### Validation facultative de l’en-tête de signature

Lors de la réception d’une requête POST provenant de X, de l’envoi d’une requête GET pour créer un webhook ou d’une requête GET pour effectuer un CRC manuel, une signature de hachage est transmise dans les en-têtes sous la clé x-twitter-webhooks-signature. Cette signature permet de vérifier que la source des données est bien X. La signature de hachage pour POST commence par sha256=, indiquant l’utilisation de HMAC SHA-256 pour calculer un hachage à partir de votre Consumer Secret de l’application X et de la charge utile. Le hachage pour GET est calculé à partir de la chaîne de paramètres de requête crc\_token=$token\&nonce=$nonce.

**Étapes pour valider une requête**

1. Générez un hachage à l’aide de votre Consumer Secret et du corps de la charge utile reçue.
2. Comparez le hachage généré avec la valeur x-twitter-webhooks-signature encodée en base64. Utilisez une méthode comme [compare\_digest](https://docs.python.org/2/library/hmac.html) pour réduire la vulnérabilité aux attaques par temporisation.

<div id="optional-signature-header-validation">
  ### Recommandations de sécurité supplémentaires
</div>

Voici des recommandations de sécurité supplémentaires à prendre en compte pour votre application web. Leur absence n’empêchera pas votre webhook de fonctionner, mais elles sont vivement recommandées par l’équipe Sécurité de l’information de X. Si vous n’êtes pas familier des recommandations ci-dessous, consultez votre administrateur système.

#### Blocs de réseau agrégés de X

Pour renforcer la sécurité, vous pouvez ajouter les blocs de réseau agrégés suivants à une liste d’autorisation :

- 199.59.148.0/22

- 199.16.156.0/22

- 192.133.77.0/26

- 64.63.15.0/24

- 64.63.31.0/24

- 64.63.47.0/24

- 202.160.128.0/24

- 202.160.129.0/24

- 202.160.130.0/24

<div id="x-aggregate-network-blocks">
  #### Configurations serveur recommandées
</div>

- Note « A » au test [ssllabs.com](http://ssllabs.com/)
- **Activer TLS 1.2**
- Activer la confidentialité persistante (Forward Secrecy)
- Désactiver SSLv2
- Désactiver SSLv3 (en raison de POODLE)
- Désactiver TLS 1.0
- Désactiver TLS 1.1
- Désactiver la compression TLS
- Désactiver les tickets de session, sauf si vous faites une rotation des clés de tickets de session.
- Définir l’option « ssl\_prefer\_server\_ciphers » ou « SSLHonorCipherOrder » sur « on » dans la configuration SSL.
- S’assurer que la liste de chiffrements est moderne, par exemple :
  `ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES128-SHA256:AES128-SHA:AES256-GCM-SHA384:AES256-SHA256:AES256-SHA:ECDHE-RSA-DES-CBC3-SHA:DES-CBC3-SHA`

## Gestion des webhooks et des abonnements

### Création et modification de webhooks

Pour modifier les URL de webhook, vous devez supprimer le webhook existant, puis en créer un nouveau. Notez que, ce faisant, vous devrez réinscrire les utilisateurs au nouveau webhook.

#### Points de terminaison pour la gestion de la configuration des webhooks :

|     |     |
| :--- | :--- |
| **Méthode** | Entreprise |
| Enregistre une URL de webhook / Génère un webhook\_id | [POST webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api) |
| Renvoie toutes les URL de webhook et leurs statuts | [GET webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks) |
| Supprime la configuration de webhook actuelle de l’app | [DELETE webhooks/:webhook\_id](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id) |
| Déclenche manuellement une requête CRC | [PUT webhooks/:webhook\_id](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id) |

<div id="webhook-configuration-management-endpoints">
  #### Pourquoi ne puis-je pas simplement mettre à jour l’URL du webhook ?
</div>

Pourquoi les configurations de webhook sont-elles immuables ? X prend la sécurité très au sérieux. Si l’URL de votre webhook est modifiée, il est possible que la clé et le secret consommateurs de votre application aient été compromis. En vous demandant de créer une nouvelle configuration de webhook, nous vous obligeons également à vous réabonner aux événements de vos utilisateurs. Cela nécessite d’utiliser des jetons d’accès qu’une partie malveillante est moins susceptible de posséder. Ainsi, la probabilité qu’un tiers reçoive des informations privées sur vos utilisateurs est réduite.
 

### Ajout et suppression d’abonnements utilisateur

La prise en charge de milliers d’abonnements est disponible avec l’offre Enterprise. Si vous disposez déjà d’un chargé de compte, contactez-le pour toute question. Pour demander l’accès aux API Enterprise, [cliquez ici](https://developer.x.com/en/products/x-api/enterprise). 

#### Points de terminaison de gestion des abonnements

 

|     |     |
| :--- | :--- |
| Méthode | Enterprise |
| Ajouter un nouvel abonnement utilisateur | [POST webhooks/:webhook\_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all) |
| Récupérer un abonnement utilisateur | [GET webhooks/:webhook\_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all) |
| Renvoie la liste de tous les abonnements actifs | [GET webhooks/:webhook\_id/subscriptions/all/list](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-subscriptions-count) |
| Désactive un abonnement utilisateur à l’aide d’OAuth en mode application uniquement | [DELETE webhooks/:webhook\_id/subscriptions/:user\_id/all.json](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-user-id-all-json) |

Account Activity API: Enterprise

<Note>
  **Veuillez noter** : 

  X doit activer l’accès à l’Account Activity API pour votre application développeur avant que vous ne puissiez commencer à utiliser l’API. À cette fin, veillez à communiquer l’ID de l’application que vous prévoyez d’utiliser pour l’authentification à votre chargé de compte ou à l’équipe d’assistance technique.
</Note>

L’[Account Activity API](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity) se compose d’un ensemble de points de terminaison qui vous permettent de créer et de gérer des abonnements utilisateur afin de recevoir en temps réel les activités de compte pour l’ensemble de vos comptes abonnés via une connexion unique. 

Deux méthodes d’authentification sont disponibles avec l’Account Activity API ([OAuth 1.0a](/fr/resources/fundamentals/authentication#oauth-1-0a-2) et [jeton Bearer OAuth 2.0](/fr/resources/fundamentals/authentication#bearer-token-also-known-as-app-only)). La méthode d’authentification à utiliser dépend du point de terminaison.

|     |     |     |     |
| :--- | :--- | :--- | :--- |
| **Description** | \*\*Endpoint \*\* | OAuth 1.0a  <br />(contexte utilisateur) | Jeton au porteur OAuth 2.0 (application uniquement) |
| Enregistrer une nouvelle URL de webhook pour le contexte d’application donné | [POST account\_activity/webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks) | ✓   |     |
| Renvoyer toutes les URL et leurs statuts pour l’application donnée | [GET account\_activity/webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks) |     | ✓   |
| Déclencher une vérification de réponse au défi (CRC) pour l’URL d’un webhook donné | [PUT account\_activity/webhooks/:webhook\_id](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id) | ✓   |     |
| Abonner l’application aux événements du compte d’un utilisateur | [POST account\_activity/webhooks/:webhook\_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all) | ✓ \* |     |
| Renvoyer le nombre d’abonnements actuellement actifs | [GET account\_activity/subscriptions/count](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-subscriptions-count) |     | ✓   |
| Vérifier si une configuration de webhook est abonnée aux événements d’un utilisateur | [GET account\_activity/webhooks/:webhook\_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all) | ✓ \* |     |
| Renvoyer la liste des abonnements actuellement actifs | [GET account\_activity/webhooks/:webhook\_id/subscriptions/all/list](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all-list) |     | ✓   |
| Supprimer un webhook | [DELETE account\_activity/webhooks/:webhook\_id](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id) | ✓   |     |
| \[OBSOLÈTE] Désactiver un abonnement pour le contexte utilisateur et l’application fournis | [DELETE account\_activity/webhooks/:webhook\_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated) | ✓ \* |     |
| Désactiver un abonnement en utilisant OAuth en mode application uniquement | [DELETE /account\_activity/webhooks/:webhook\_id/subscriptions/:user\_id/all.json](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-user-id-all-json) |     | ✓   |
| Renvoyer de nouveau les activités à un webhook | [POST /1.1/account\_activity/replay/webhooks/:webhook\_id/subscriptions/all.json](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#replay-api) |     | ✓   |

\*\_ L’authentification requiert les jetons d’accès de l’utilisateur abonné. \_

Pour les endpoints nécessitant une authentification OAuth 1.0a en contexte utilisateur, vous devez fournir les identifiants suivants pour authentifier la requête : 

- Clés consommateur (clé API et secret)
- Jetons d’accès (jeton d’accès et secret)

Dans le cas des trois endpoints suivants, vous effectuez des opérations d’écriture dans le contexte de votre application (aucun utilisateur X n’est impliqué). Par conséquent, les jetons d’accès à fournir sont ceux de votre application développeur. Ils peuvent être générés directement depuis le [portail développeur](https://developer.x.com/en/portal/projects-and-apps), sous l’onglet « Keys and tokens » de votre application.  

- [POST account\_activity/webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks): Enregistrer une nouvelle URL de webhook pour le contexte d’application donné
- [PUT account\_activity/webhooks/:webhook\_id](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id): Déclencher une vérification de réponse au défi (CRC) pour l’URL d’un webhook donné
- [DELETE account\_activity/webhooks/:webhook\_id](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id): Supprimer un webhook

D’autre part, pour les trois endpoints suivants, vous effectuez une requête qui permet à votre application d’accéder à des données protégées au nom d’un utilisateur X (par exemple, Messages privés). Vous devez donc fournir les jetons d’accès appartenant à l’utilisateur abonné concerné. Les jetons d’accès requis peuvent être obtenus à l’aide du flux OAuth en 3 étapes (voir [OAuth 1.0a : how to obtain a user’s Access Tokens](/fr/resources/fundamentals/authentication#obtaining-access-tokens-using-3-legged-oauth-flow)). Ces endpoints sont signalés par un astérisque dans le tableau ci-dessus (\*).

- [POST account\_activity/webhooks/:webhook\_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all): Abonner l’application aux événements du compte d’un utilisateur
- [GET account\_activity/webhooks/:webhook\_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all): Vérifier si une configuration de webhook est abonnée aux événements d’un utilisateur
- [DELETE account\_activity/webhooks/:webhook\_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated): Désactiver un abonnement pour le contexte utilisateur et l’application fournis \[OBSOLÈTE]

<Note>
  **Veuillez noter** : 

  Assurez-vous que votre application développeur est activée pour « Read, Write, and Direct Messages ». Vous pouvez modifier ce paramètre dans la [section Projects & Apps](https://developer.x.com/en/portal/projects-and-apps) de votre compte développeur, sous « App permissions » pour l’application développeur sélectionnée. Vous devrez régénérer les identifiants de votre application après avoir modifié les paramètres d’autorisations.
</Note>

Une liste de tous les endpoints disponibles avec l’API Account Activity, incluant la description associée et des exemples de requêtes cURL avec des implémentations d’authentification, est disponible dans [la documentation de référence de l’API](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-api-reference-index).

Pour davantage d’informations, consultez la [web app d’exemple et les scripts utilitaires](https://github.com/xdevplatform/account-activity-dashboard-enterprise) de XDev pour démarrer avec l’API Enterprise Account Activity.

<Note>
  **Veuillez noter** : 

  X doit activer l’accès à l’API Account Activity pour votre application développeur avant que vous puissiez commencer à utiliser l’API. À cette fin, veillez à partager l’App ID que vous comptez utiliser à des fins d’authentification avec votre chargé de compte ou votre équipe d’assistance technique.
</Note>

L’[API Account Activity](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity) se compose d’un ensemble d’endpoints qui vous permettent de créer et de gérer des abonnements utilisateur afin de recevoir en temps réel les activités de compte pour tous vos comptes abonnés via une connexion unique. 

Deux méthodes d’authentification sont disponibles avec l’API Account Activity ([OAuth 1.0a](/fr/resources/fundamentals/authentication#oauth-1-0a-2) et [OAuth 2.0 Bearer Token](/fr/resources/fundamentals/authentication#oauth-2-0)). La méthode d’authentification à utiliser dépend de l’endpoint visé.

|     |     |     |     |
| :--- | :--- | :--- | :--- |
| **Description** | \*\*Endpoint \*\* | OAuth 1.0a  <br />(contexte utilisateur) | Jeton au porteur OAuth 2.0 (application uniquement) |
| Enregistrer une nouvelle URL de webhook pour le contexte d’application donné | [POST account\_activity/webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks) | ✓   |     |
| Renvoyer toutes les URL et leurs statuts pour l’application donnée | [GET account\_activity/webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks) |     | ✓   |
| Déclencher une vérification de réponse au défi (CRC) pour l’URL d’un webhook donné | [PUT account\_activity/webhooks/:webhook\_id](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id) | ✓   |     |
| Abonner l’application aux événements du compte d’un utilisateur | [POST account\_activity/webhooks/:webhook\_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all) | ✓ \* |     |
| Renvoyer le nombre d’abonnements actuellement actifs | [GET account\_activity/subscriptions/count](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-subscriptions-count) |     | ✓   |
| Vérifier si une configuration de webhook est abonnée aux événements d’un utilisateur | [GET account\_activity/webhooks/:webhook\_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all) | ✓ \* |     |
| Renvoyer la liste des abonnements actuellement actifs | [GET account\_activity/webhooks/:webhook\_id/subscriptions/all/list](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all-list) |     | ✓   |
| Supprimer un webhook | [DELETE account\_activity/webhooks/:webhook\_id](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id) | ✓   |     |
| \[OBSOLÈTE] Désactiver un abonnement pour le contexte utilisateur et l’application fournis | [DELETE account\_activity/webhooks/:webhook\_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated) | ✓ \* |     |
| Désactiver un abonnement en utilisant OAuth en mode application uniquement | [DELETE /account\_activity/webhooks/:webhook\_id/subscriptions/:user\_id/all.json](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-user-id-all-json) |     | ✓   |
| Renvoyer de nouveau les activités à un webhook | [POST /1.1/account\_activity/replay/webhooks/:webhook\_id/subscriptions/all.json](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#replay-api) |     | ✓   |

\*\_ L’authentification requiert les jetons d’accès de l’utilisateur abonné. \_

Pour les endpoints nécessitant une authentification OAuth 1.0a en contexte utilisateur, vous devez fournir les identifiants suivants pour authentifier la requête : 

- Clés consommateur (clé API et secret)
- Jetons d’accès (jeton d’accès et secret)

Dans le cas des trois endpoints suivants, vous effectuez des opérations d’écriture dans le contexte de votre application (aucun utilisateur X n’est impliqué). Par conséquent, les jetons d’accès à fournir sont ceux de votre application développeur. Ils peuvent être générés directement depuis le [portail développeur](https://developer.x.com/en/portal/projects-and-apps), sous l’onglet « Keys and tokens » de votre application.  

- [POST account\_activity/webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks) : Enregistrer une nouvelle URL de webhook pour le contexte d’application indiqué
- [PUT account\_activity/webhooks/:webhook\_id](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id) : Déclencher une vérification de réponse au défi (CRC) pour l’URL d’un webhook donné
- [DELETE account\_activity/webhooks/:webhook\_id](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id) : Supprimer un webhook

En revanche, pour les trois endpoints suivants, vous effectuez une requête qui permet à votre application d’accéder à des données protégées pour le compte d’un utilisateur X (par exemple, Messages privés). Vous devez donc fournir les jetons d’accès appartenant à l’utilisateur abonné concerné. Les jetons d’accès requis peuvent être obtenus via le flux OAuth en 3 étapes (voir [OAuth 1.0a : comment obtenir les jetons d’accès d’un utilisateur](/fr/resources/fundamentals/authentication#obtaining-access-tokens-using-3-legged-oauth-flow)). Ces endpoints ont été marqués d’un astérisque dans le tableau ci-dessus (\*).

- [POST account\_activity/webhooks/:webhook\_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all) : Abonner l’application aux événements du compte d’un utilisateur
- [GET account\_activity/webhooks/:webhook\_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all) : Vérifier si une configuration de webhook est abonnée aux événements d’un utilisateur
- [DELETE account\_activity/webhooks/:webhook\_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated) : Désactiver un abonnement pour le contexte utilisateur et l’application fournis \[OBSOLÈTE]

<Note>
  **Veuillez noter** :

  Assurez-vous que votre application développeur est activée pour « Read, Write, and Direct Messages ». Vous pouvez modifier ce paramètre dans la [section Projects & Apps](https://developer.x.com/en/portal/projects-and-apps) de votre compte développeur, sous « App permissions » pour l’application développeur sélectionnée. Vous devrez régénérer les identifiants de votre application après avoir modifié les paramètres d’autorisations.
</Note>

La liste de tous les endpoints disponibles avec l’Account Activity API, incluant la description associée et des exemples de requêtes cURL avec des exemples d’implémentation de l’authentification, est disponible dans [la documentation de référence de l’API](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-api-reference-index).

Pour plus d’informations, consultez [l’application web d’exemple et les scripts utilitaires](https://github.com/xdevplatform/account-activity-dashboard-enterprise) de XDev pour démarrer avec l’Enterprise Account Activity API.

## Nouveaux essais

`Enterprise`

L’un des avantages de l’offre Enterprise de l’Account Activity API est un mécanisme de nouvelle tentative pour les événements webhook. Si un code de réponse HTTP 200 « success » n’est pas reçu, le serveur X déclenche un mécanisme de relance, renvoyant l’événement webhook jusqu’à trois fois sur une période de cinq minutes. Ce service de réémission des événements webhook améliore la fiabilité et la reprise des événements en cas de problèmes réseau ainsi que lors d’interruptions côté client et de déploiements.
 

### Qu’est-ce que les réessais ?

L’API Account Activity propose une fonctionnalité de réessai lorsque l’application web du client ne renvoie pas une réponse 200 « succès » pour un événement de webhook d’activité de compte. Lorsque le client ne confirme pas la bonne réception d’un événement, X suppose que l’événement n’a pas été reçu. Si une réponse non 200 est retournée, si aucune réponse n’est reçue dans un délai de trois secondes, ou si nous ne recevons pas de réponse du tout, nous réémettons la requête et la laissons ouverte pendant trois secondes. Cela signifie que vous disposez d’environ cinq secondes, sur deux tentatives, pour répondre afin de recevoir l’activité que nous essayons d’envoyer vers votre URL de webhook. Dans le cas où votre serveur ne répond pas ou renvoie une erreur transitoire, nous réessaierons pendant cinq minutes. Il y aura au total trois tentatives de réessai pour confirmer la validation. Cela offre de la redondance et garantit que vous recevez tous les événements webhook. Notez que les abonnements avec réessais recevront des événements réémis pour toute activité et pour tous les utilisateurs abonnés sur leur webhook.

Si vous ne confirmez pas la validation au cours de ces huit tentatives, l’activité ne sera plus disponible via l’API Account Activity. 

<div id="what-are-retries">
  ### Délai de nouvelle tentative
</div>

L’API Account Activity effectuera jusqu’à trois tentatives sur une période de cinq minutes, jusqu’à réception d’une réponse 200. Reportez-vous au tableau ci-dessous pour plus de détails. Au-delà d’environ cinq minutes, l’activité ne peut plus être renvoyée via l’API Account Activity. Vous devrez utiliser d’autres endpoints X pour collecter les données manquées. Par exemple, les [API de recherche](/fr/x-api/enterprise-gnip-2.0/fundamentals/search-api) peuvent être utilisées pour récupérer les Posts pertinents, les Retweets, les Tweets cités, les Mentions et les Réponses. Les Messages privés manqués peuvent être récupérés avec [cet endpoint](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events).

#### Chronologie des nouvelles tentatives

|     |
| :--- |
| Activité créée, envoi d’un POST à l’URL du webhook depuis l’Account Activity API, qui expire au bout de trois secondes. |
| Attendre trois secondes après la fin de l’expiration précédente, puis renvoyer un POST à l’URL du webhook depuis l’Account Activity API, qui expire au bout de trois secondes. |
| Attendre 27 secondes après la fin de l’expiration précédente, puis renvoyer un POST à l’URL du webhook depuis l’Account Activity API, qui expire au bout de trois secondes. |
| Attendre 242 secondes après la fin de l’expiration précédente, puis renvoyer un POST à l’URL du webhook depuis l’Account Activity API, qui expire au bout de trois secondes. |
| L’Account Activity API arrêtera ensuite les tentatives de POST. Le client doit utiliser d’autres endpoints X pour récupérer les données. |

## Structure de l’objet de données Account Activity

| Objet | Détails |
| :--- | :--- |
| for\_user\_id | Identifie l’abonnement utilisateur auquel l’événement est lié. |
| is\_blocked\_by | (conditionnel) Affiché uniquement lorsqu’un autre utilisateur mentionne l’utilisateur abonné. Inclus si true pour les événements de mention de post uniquement. |
| source | L’utilisateur qui réalise l’activité. Par exemple, l’utilisateur qui suit, bloque ou met en sourdine est l’utilisateur source. |
| target | L’utilisateur auquel l’activité s’applique. Par exemple, l’utilisateur qui est suivi, bloqué ou mis en sourdine est l’utilisateur cible. |

**Activités disponibles**

| Type de message | Détails |
| :--- | :--- |
| [tweet\_create\_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#tweet-create-events-posts-retweets-replies-quotetweets) | Charge utile d’état de post lorsque l’une des actions suivantes est effectuée par ou à l’égard de l’utilisateur abonné : posts, retweets, réponses, @mentions, QuoteTweets, retweets de QuoteTweets. |
| [favorite\_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#favorite-events) | Événement de favori (like) avec l’utilisateur et la cible. |
| [follow\_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#follow-events) | Événement de suivi avec l’utilisateur et la cible. |
| [unfollow\_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#unfollow-events) | Événement d’arrêt de suivi avec l’utilisateur et la cible. |
| [block\_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#block-events) | Événement de blocage avec l’utilisateur et la cible. |
| [unblock\_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#unblock-events) | Événement de déblocage avec l’utilisateur et la cible. |
| [mute\_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#mute-events) | Événement de mise en sourdine avec l’utilisateur et la cible. |
| [unmute\_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#unmute-events) | Événement d’annulation de mise en sourdine avec l’utilisateur et la cible. |
| [user\_event](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#user-event) | Événements de révocation envoyés lorsqu’un utilisateur retire l’autorisation de l’application et que l’abonnement est automatiquement supprimé. |
| [direct\_message\_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-events) | Événement de message privé avec l’utilisateur et la cible lorsqu’un message privé est envoyé ou reçu. |
| [direct\_message\_indicate\_typing\_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-indicate-typing-events) | Événement d’indication de saisie de message privé avec l’utilisateur et la cible. |
| [direct\_message\_mark\_read\_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-mark-read-events) | Événement de lecture de message privé avec l’utilisateur et la cible. |
| [tweet\_delete\_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#tweet-delete-events) | Notification de posts supprimés afin de faciliter le respect de la conformité. |

**Exemples de charge utile**

Voir ci-dessous les exemples de charge utile pour chaque événement Account Activity décrit dans le tableau ci-dessus.

#### tweet\_create\_events (Posts, Retweets, Réponses, Tweets cités) 

```
{
	"for_user_id": "2244994945",
	"tweet_create_events": [
	  {
		<Tweet Object>
	  }
	]
}
```

#### tweet\_create\_events (@mentions) 

```
{
	"for_user_id": "2244994945",
	"user_has_blocked": "false",
	"tweet_create_events": [
	  {
		<Tweet Object>
	  }
	]
}
```

#### favorite\_events

```
{
	"for_user_id": "2244994945",
	"favorite_events": [{
		"id": "a7ba59eab0bfcba386f7acedac279542",
		"created_at": "Mon Mar 26 16:33:26 +0000 2018",
		"timestamp_ms": 1522082006140,
		"favorited_status": {
			<Tweet Object>
		},
		"user": {
			<User Object>
		}
	}]
}
```

#### follow\_events

```
{
	"for_user_id": "2244994945",
	"follow_events": [{
			"type": "follow",
			"created_timestamp": "1517588749178",
			"target": {
				<Objet User>
			},
			"source": {
				<Objet User>
			}
		]
	}
}
```

#### unfollow\_events

```
{
	"for_user_id": "2244994945",
	"follow_events": [{
			"type": "unfollow",
			"created_timestamp": "1517588749178",
			"target": {
				<Objet utilisateur>
			},
			"source": {
				<Objet utilisateur>
			}
		]
	}
}
```

#### block\_events

```
{
	"for_user_id": "2244994945",
	"block_events": [{
		"type": "block",
		"created_timestamp": "1518127020304",
		"source": {
			<User Object>
		},
		"target": {
			<User Object>
		}
	}]
}
```

#### unblock\_events

```
{
	"for_user_id": "2244994945",
	"block_events": [{
		"type": "unblock",
		"created_timestamp": "1518127020304",
		"source": {
			<User Object>
		},
		"target": {
			<User Object>
		}
	}]
}
```

#### mute\_events

```
{
	"for_user_id": "2244994945",
	"mute_events": [
		{
			"type": "mute",
		  	"created_timestamp": "1518127020304",
			"source": {
				<User Object>
			},
			"target": {
				<User Object>
			}
		}
	]
}
```

#### unmute\_events

```
{
	"for_user_id": "2244994945",
	"mute_events": [
		{
			"type": "unmute",
		  	"created_timestamp": "1518127020304",
			"source": {
				<User Object>
			},
			"target": {
				<User Object>
			}
		}
	]
}
```

#### user\_event

```
{
	"user_event": {
		"revoke": {
			"date_time": "2018-05-24T09:48:12+00:00",
			"target": {
				"app_id": "13090192"
			},
			"source": {
				"user_id": "63046977"
			}
		}
	}
}
```

#### direct\_message\_events

```
{
  	"for_user_id": "4337869213",
	"direct_message_events": [{
		"type": "message_create",
		"id": "954491830116155396",
		"created_timestamp": "1516403560557",
		"message_create": {
			"target": {
				"recipient_id": "4337869213"
			},
			"sender_id": "3001969357",
			"source_app_id": "13090192",
			"message_data": {
				"text": "Hello World!",
				"entities": {
					"hashtags": [],
					"symbols": [],
					"user_mentions": [],
					"urls": []
				}
			}
		}
	}],
	"apps": {
		"13090192": {
			"id": "13090192",
			"name": "FuriousCamperTestApp1",
			"url": "https://x.com/furiouscamper"
		},
		"users": {},
		"3001969357": {
			"id": "3001969357",
			"created_timestamp": "1422556069340",
			"name": "Jordan Brinks",
			"screen_name": "furiouscamper",
			"location": "Boulder, CO",
			"description": "Alter ego – X PE opinions-are-my-own",
			"url": "https://t.co/SnxaA15ZuY",
			"protected": false,
			"verified": false,
			"followers_count": 22,
			"friends_count": 45,
			"statuses_count": 494,
			"profile_image_url": "null",
			"profile_image_url_https": "https://pbs.twimg.com/profile_images/851526626785480705/cW4WTi7C_normal.jpg"
		},
		"4337869213": {
			"id": "4337869213",
			"created_timestamp": "1448312972328",
			"name": "Harrison Test",
			"screen_name": "Harris_0ff",
			"location": "Burlington, MA",
			"protected": false,
			"verified": false,
			"followers_count": 8,
			"friends_count": 8,
			"profile_image_url": "null",
			"statuses_count": 240,
			"profile_image_url_https": "https://abs.twimg.com/sticky/default_profile_images/default_profile_normal.png"
		}
	}
}
```

#### direct\_message\_indicate\_typing\_events

```
{
	"for_user_id": "4337869213",
	"direct_message_indicate_typing_events": [{
		"created_timestamp": "1518127183443",
		"sender_id": "3284025577",
		"target": {
			"recipient_id": "3001969357"
		}
	}],
	"users": {
		"3001969357": {
			"id": "3001969357",
			"created_timestamp": "1422556069340",
			"name": "Jordan Brinks",
			"screen_name": "furiouscamper",
			"location": "Boulder, CO",
			"description": "Alter Ego - X PE opinions-are-my-own",
			"url": "https://t.co/SnxaA15ZuY",
			"protected": false,
			"verified": false,
			"followers_count": 23,
			"friends_count": 47,
			"statuses_count": 509,
			"profile_image_url": "null",
			"profile_image_url_https": "https://pbs.twimg.com/profile_images/851526626785480705/cW4WTi7C_normal.jpg"
		},
		"3284025577": {
			"id": "3284025577",
			"created_timestamp": "1437281176085",
			"name": "Bogus Bogart",
			"screen_name": "bogusbogart",
			"protected": true,
			"verified": false,
			"followers_count": 1,
			"friends_count": 4,
			"statuses_count": 35,
			"profile_image_url": "null",
			"profile_image_url_https": "https://pbs.twimg.com/profile_images/763383202857779200/ndvZ96mE_normal.jpg"
		}
	}
}
```

#### direct\_message\_mark\_read\_events

```
{
	"for_user_id": "4337869213",
	"direct_message_mark_read_events": [{
		"created_timestamp": "1518452444662",
		"sender_id": "199566737",
		"target": {
			"recipient_id": "3001969357"
		},
		"last_read_event_id": "963085315333238788"
	}],
	"users": {
		"199566737": {
			"id": "199566737",
			"created_timestamp": "1286429788000",
			"name": "Le Braat",
			"screen_name": "LeBraat",
			"location": "Denver, CO",
			"description": "data by day @X, design by dusk",
			"protected": false,
			"verified": false,
			"followers_count": 299,
			"friends_count": 336,
			"statuses_count": 752,
			"profile_image_url": "null",
			"profile_image_url_https": "https://pbs.twimg.com/profile_images/936652894371119105/YHEozVAg_normal.jpg"
		},
		"3001969357": {
			"id": "3001969357",
			"created_timestamp": "1422556069340",
			"name": "Jordan Brinks",
			"screen_name": "furiouscamper",
			"location": "Boulder, CO",
			"description": "Alter Ego - X PE opinions-are-my-own",
			"url": "https://t.co/SnxaA15ZuY",
			"protected": false,
			"verified": false,
			"followers_count": 23,
			"friends_count": 48,
			"statuses_count": 510,
			"profile_image_url": "null",
			"profile_image_url_https": "https://pbs.twimg.com/profile_images/851526626785480705/cW4WTi7C_normal.jpg"
		}
	}
}
```

#### tweet\_delete\_events

```
{
    "for_user_id": "930524282358325248",
    "tweet_delete_events": [
{
        "status": {
            "id": "1045405559317569537",
            "user_id": "930524282358325248"
        },
        "timestamp_ms": "1432228155593"
    }
   ]
}
```

## API de relecture de l’activité de compte

`Enterprise`

L’API de relecture de l’activité de compte est un outil de restauration de données qui vous permet de récupérer des événements jusqu’à cinq jours en arrière. Elle doit être utilisée pour restaurer des données lorsque votre serveur de [webhook](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api) a manqué des événements — que ce soit en raison de déconnexions dépassant la [fenêtre de nouvelle tentative](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#retries) ou dans des scénarios de reprise après sinistre où vous avez besoin de quelques jours pour remettre votre système en état nominal.

L’API de relecture de l’activité de compte a été conçue pour tout scénario où vous n’avez pas pu ingérer des [activités](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity) pendant une période donnée. Elle livre les activités au même webhook que celui utilisé pour leur diffusion en temps réel initiale. Ce produit est un outil de restauration et non un outil de rétrodiffusion/remplissage, ce qui signifie que les événements ne seront relus que si une tentative de diffusion antérieure a eu lieu. L’API de relecture de l’activité de compte ne peut pas livrer des événements pour une période antérieure à la date de création d’un abonnement.

### Utilisation de l’API Account Activity Replay

Si votre compte est configuré avec la fonctionnalité Replay, vous pouvez envoyer des requêtes de la même manière que pour l’API Account Activity. Notez que votre requête doit inclure un paramètre webhook id pour indiquer le webhook dont vous souhaitez rejouer les activités. En d’autres termes, une requête Replay demande à l’API Account Activity Replay de récupérer des événements entre une date/heure de début et une date/heure de fin sur la base du webhook id et de l’application id.

Veuillez noter que l’heure UTC est requise. Ces activités sont délivrées via le webhook enregistré associé à l’id, à un débit pouvant atteindre 2 500 événements par seconde. Gardez également à l’esprit qu’une seule tâche Replay par webhook peut être en cours d’exécution à la fois, même si toutes les abonnements qui étaient actifs pendant l’intervalle date/heure spécifié pour ce webhook seront rejoués.

Les événements sont délivrés en commençant par la première minute (la plus ancienne) de la période spécifiée, puis se poursuivent de façon chronologique (autant que possible) jusqu’à la dernière minute. À ce moment-là, Replay enverra un [événement de fin de tâche](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#job-completed-successfully-message) au webhook. Étant donné que nous livrons les activités chronologiquement, s’il y a peu ou pas de correspondances près de l’heure de début, il est probable qu’un délai s’écoule avant la livraison des premiers résultats.

<div id="using-account-activity-replay-api">
  ### Limitations
</div>

Replay est conçu comme un outil permettant de récupérer facilement des activités jusqu’à cinq jours en arrière, mais il ne délivre pas d’événements antérieurs à la date de création d’un abonnement. Par exemple, si vous avez ajouté un nouvel abonnement il y a trois jours et lancé une tâche Replay avec une fenêtre couvrant les cinq jours précédant aujourd’hui, vous ne recevrez que les données des trois jours pendant lesquels ce nouvel abonnement était actif.

<div id="limitations">
  ### Disponibilité et types de données
</div>

Les activités de l’API Account Activity Replay sont disponibles pendant cinq jours à compter du lancement de la requête, avec de nouvelles données généralement accessibles environ 10 minutes après la création d’une activité donnée. Vous pouvez effectuer des requêtes en spécifiant une plage temporelle dans cette fenêtre de cinq jours à l’aide des paramètres from\_date et to\_date dans la requête. Les événements initialement livrés avant que vous n’ayez accès à Replay ne peuvent pas être rejoués. Par exemple, si votre compte a été activé pour l’accès à l’API Account Activity Replay le 1er juin 2019 à 15:30 UTC, vous ne pourrez pas utiliser Replay pour récupérer des événements antérieurs à cette date et cette heure.

Poursuivez vers la [référence de l’API Account Activity Replay](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated)

## Introduction à la migration

**Nous avons retiré les produits Site Streams, User Streams et la version bêta standard de l’Account Activity API - DM Only en 2018. Si vous utilisiez ces produits, veillez à migrer vers la version Premium ou Enterprise de l’Account Activity API.**

**Nous avons également retiré les anciens endpoints de messages privés (Direct Messages). Si vous utilisiez ces endpoints, veillez à migrer soit vers les nouveaux endpoints DM, soit vers la version Premium ou Enterprise de l’Account Activity API.**

**Veuillez consulter [cette annonce](https://devcommunity.x.com/t/details-and-what-to-expect-from-the-api-deprecations-this-week-on-august-16-2018/110746) pour en savoir plus.**

Voici les endpoints qui seront affectés par ces changements :

- User Streams
- Site Streams
- GET direct\_messages
- GET direct\_messages/sent
- GET direct\_messages/show
- POST direct\_messages/new
- POST direct\_messages/destroy
   

Nous proposons de nouveaux endpoints et services offrant un accès similaire et, pour les messages privés, des fonctionnalités supplémentaires :

- Account Activity API [Enterprise](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api) et [Premium](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-api-reference-index)
- [GET direct\_messages/events/list](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events)
- [GET direct\_messages/events/show](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/get-event)
- [POST direct\_messages/events/new](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/new-event)
- [POST direct\_messages/events/destroy](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/delete-message-event)

Pour vous aider à migrer en douceur vers ces nouveaux endpoints et services, nous proposons deux guides de migration :

- [Guide de migration de l’Account Activity API](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#migration-guide-moving-from-user-streams-site-streams-to-account-activity-api), pour ceux qui passent de User Streams et Site Streams à notre nouveau service basé sur des webhooks
- [Guide de migration des messages privés](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/guides/direct-message-migration), pour ceux qui migrent entre les endpoints REST de Direct Message
   

De plus, nous proposons une [série de vidéos](https://www.youtube.com/playlist?list=PLFKjcMIU2WshGG6Yj940XM7Z6BFs1zfBg) sur l’Account Activity API et la mise en route.

Enfin, nous mettons à disposition des exemples de code pour approfondir la compréhension et vous aider à démarrer rapidement :

- Le [Account Activity Dashboard](https://github.com/xdevplatform/Account-Activity-dashboard) est une application web Node.js d’exemple avec des scripts d’assistance pour débuter avec l’Account Activity API.
- [SnowBot](https://github.com/xdevplatform/SnowBotDev) est un chatbot d’exemple utilisant l’Account Activity API et les endpoints REST de Direct Message. Il est écrit en Ruby, utilise le framework web Sinatra et est déployé sur Heroku.

<div id="migration-introduction">
  ## Guide de migration : passage de User Streams/Site Streams à l’Account Activity API
</div>

**Au 23 août 2018, nous avons retiré Site Streams et User Streams. Veillez à migrer vers l’Account Activity API.**

**Veuillez consulter [cette annonce](https://devcommunity.x.com/t/details-and-what-to-expect-from-the-api-deprecations-this-week-on-august-16-2018/110746) pour en savoir plus.**

Ce guide est conçu pour vous aider à migrer des anciennes API User Streams et Site Streams vers leur remplaçante, l’Account Activity API. Vous trouverez ci-dessous un résumé des changements, une liste des nouvelles fonctionnalités, ainsi que les principales différences et considérations pour faciliter la transition. Pour des conseils sur la migration depuis les endpoints DM de base, veuillez consulter le [guide de migration des Messages privés](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/guides/direct-message-migration).

### Résumé des modifications

L’API Account Activity vous enverra des événements pour les comptes authentifiés et abonnés via des webhooks, plutôt que par une connexion de streaming comme avec User Streams et Site Streams.

#### API obsolètes

GET user

GET site (y compris les flux de contrôle : GET site/c/:stream\_id, GET site/c/:stream\_id/info.json, GET site/c/:stream\_id/friends/ids.json, POST site/c/:stream\_id/add\_user.json, POST /site/c/:stream\_id/remove\_user.json)

<div id="deprecated-apis">
  #### API de remplacement
</div>

[Enterprise Account Activity API - Toutes les activités](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api)

<div id="new-features">
  ### Différences et considérations de migration
</div>

**Format de l’API :** La nouvelle API Account Activity fonctionne différemment de User Streams et Site Streams. Vous devrez modifier votre application web pour recevoir les données via des webhooks. Vous trouverez plus d’informations sur les webhooks [ici](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#getting-started-with-webhooks).

**Données disponibles :** Une autre différence clé que vous remarquerez concerne les données livrées. X n’enverra plus d’événements provenant des personnes que vous suivez sur X (autrement dit, votre fil d’accueil). Il s’agit d’un changement intentionnel que nous ne prévoyons pas de modifier à l’avenir.

**Fiabilité :** Contrairement au streaming, les webhooks permettent d’accuser réception de la livraison et de retenter l’envoi des activités POST qui n’atteignent pas l’URL du webhook. Cela garantit davantage que l’application reçoit toutes les activités pertinentes, même en cas de brèves déconnexions ou de périodes d’indisponibilité.

<div id="differences-migration-considerations">
  ### Nouvelles fonctionnalités
</div>

L’API Account Activity introduit de nombreuses nouveautés, notamment la livraison des données via des webhooks plutôt que par streaming. Les webhooks offrent de nombreux avantages par rapport au streaming, les plus importants étant la vitesse et la fiabilité. L’API vous enverra des données sous forme d’événements JSON dès qu’elles seront disponibles, et vous n’aurez plus besoin de maintenir une connexion active ni d’interroger le point de terminaison. Cela réduit le besoin de redondance et améliore l’efficacité globale. Plus d’informations sur les webhooks sont disponibles dans la [documentation technique](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#getting-started-with-webhooks).

<div id="new-features">
  ### Gestion des abonnements utilisateur
</div>

L’API Account Activity autorise plusieurs abonnements pour un même webhook enregistré. Cela permet d’acheminer les activités liées aux abonnements de plusieurs utilisateurs vers un même point de terminaison, à l’image de l’architecture Site Streams, mais via des webhooks. Vous pouvez ainsi suivre les abonnements — au regard de vos limites d’abonnement — indépendamment de la connexion du webhook. Cela facilite également la montée en charge, en passant d’un ou de quelques abonnements à des milliers pour un seul webhook.

<div id="managing-user-subscriptions">
  ### **Procédure de migration**
</div>

<div id="how-to-migrate">
  ### **Suivez les étapes ci-dessous pour migrer facilement de l’API Site Streams vers l’API Account Activity**
</div>

**Étape 1 : Choisir une offre**

Selon la manière dont vous utilisez actuellement User Streams ou Site Streams, vous devriez envisager de passer à la version Entreprise ou Premium de l’API Account Activity. Tenez compte du nombre d’applications ou d’utilisateurs autorisés que vous prenez actuellement en charge et dimensionnez en fonction du volume et du niveau de fiabilité nécessaires. Lors du choix de l’offre la plus adaptée à vos besoins, quelques points à prendre en considération :

- Nombre de webhooks nécessaires
- Abonnements/utilisateurs autorisés actuels/prévus gérés par votre application
- Nombre actuel d’applications clientes X
- Niveau de support souhaité de la part de X (support via forum ou support Entreprise géré en 1:1)
- Prix de chaque offre

**Étape 2 :** **Vérifier la configuration de votre app X dans le portail développeur**

L’[app X](/fr/resources/fundamentals/developer-apps) actuellement utilisée pour User Streams ou Site Streams sera répertoriée pour l’utilisateur propriétaire dans le [portail développeur](/fr/resources/fundamentals/developer-portal). Cette app X peut également être utilisée pour l’API Account Activity afin de conserver les utilisateurs autorisés pour cette application. Une nouvelle app peut aussi être créée, et les utilisateurs peuvent être de nouveau autorisés pour cette nouvelle app si souhaité. Si vous créez une nouvelle app pour le compte d’une entreprise, il est recommandé de la créer avec un compte X @handle d’entreprise.

- Activez « Read, Write and Access direct messages » dans l’onglet [Permissions](/fr/resources/fundamentals/developer-apps#app-permissions) de la page de votre app X. 
  \*Notez que la modification de ces paramètres n’est pas rétroactive : tout utilisateur déjà autorisé conservera les paramètres d’autorisation en vigueur au moment où il a été autorisé. Si un utilisateur ne vous a pas encore accordé les accès lecture, écriture et messages privés, vous devrez lui faire réautoriser votre application.
- Si vous ne connaissez pas [X Sign-in](/fr/resources/fundamentals/authentication#log-in-with-x) et le fonctionnement des contextes utilisateur avec l’API X, consultez [Obtaining Access Tokens](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#getting-started-with-webhooks).
- Générez des jetons d’accès pour le propriétaire de l’app X au bas de l’onglet « Keys and Tokens ». Sur ce même onglet, notez votre Consumer Key, Consumer Secret, Access Token et Access Token Secret. Vous en aurez besoin pour utiliser l’API.
- Générez un bearer token à l’aide de votre Consumer Key et de votre Consumer Secret pour les méthodes d’API [application-only](/fr/resources/fundamentals/authentication#bearer-token-also-known-as-app-only).

**Étape 3 : Configurer vos webhooks**

- Créez une application web avec un endpoint à utiliser comme webhook pour recevoir des événements (p. ex. https://your\_domain.com/webhook/twitter ou https://webhooks.your\_domain.com).

- Utilisez votre Consumer Key, Consumer Secret, Access Token et Access Token Secret lors de la création de votre webhook. Notez que votre endpoint doit renvoyer une réponse JSON avec un response\_token qui est un hachage HMAC SHA-256 encodé en base64, créé à partir du crc\_token et du Consumer Secret de votre app.

- Consultez la documentation [Securing Webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#securing-webhooks) en prêtant une attention particulière aux exigences du Challenge Response Check (CRC).

- Assurez-vous que votre webhook prend en charge les requêtes POST pour les événements entrants et les requêtes GET pour le CRC.

- Assurez-vous que votre webhook présente une faible latence (moins de 3 secondes pour répondre aux requêtes POST).

**Étape 4 : Valider la configuration de votre webhook**

- Les API de webhook sécuriseront vos webhooks de deux manières :

               - Exiger une vérification de réponse au défi pour valider que le propriétaire du webhook est bien le propriétaire de l’app web.

               - Ajouter un en-tête de signature dans chaque requête POST afin que votre app web puisse valider la source.

- Afin de vérifier que vous êtes à la fois le propriétaire de l’app web et de l’URL du webhook, X effectuera un Challenge Response Check (CRC), à ne pas confondre avec un contrôle de redondance cyclique.
- Une requête GET avec un paramètre nommé crc\_token sera envoyée à l’URL de votre webhook. Votre endpoint doit renvoyer une réponse JSON avec un response\_token qui est un hachage HMAC SHA-256 encodé en base64, créé à partir du crc\_token et du Consumer Secret de votre app.
- Le crc\_token est susceptible de changer à chaque requête CRC entrante. Le crc\_token doit être utilisé comme message dans le calcul, où votre Consumer Secret est la clé.
- Si la réponse est invalide, l’envoi des événements au webhook enregistré cessera.

**Étape 5 : Créer des abonnements pour chaque utilisateur autorisé User Streams ou Site Streams**

Conversion vers l’API Account Activity depuis User Streams :

- Générez la liste de vos abonnements utilisateur actuels sur User Streams
- Configurez vos nouveaux abonnements à l’API Account Activity avec la requête : _POST account\_activity/all/:env\_name/subscriptions_
- Confirmez vos abonnements à l’API Account Activity avec la requête : \_GET account\_activity/all/:env\_name/subscriptions/list
  \_

Conversion vers l’API Account Activity depuis Site Streams (à l’aide de flux de contrôle) :

- Générez la liste de vos abonnements actuels sur Site Streams avec la requête : _GET /1.1/site/c/:stream\_id/info.json_
- Configurez vos nouveaux abonnements à l’API Account Activity avec la requête : _POST account\_activity/all/:env\_name/subscriptions_
- Confirmez vos abonnements à l’API Account Activity avec la requête : \_GET account\_activity/all/:env\_name/subscriptions/list
  \_

Enregistrement d’un webhook et création d’abonnements (sans migration depuis Site Streams ou User Streams)

- Enregistrez l’URL de votre webhook auprès de votre application avec [POST webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api) et recevez un webhook\_id.
- Utilisez le webhook\_id renvoyé pour ajouter des abonnements utilisateur avec [POST webhooks/:webhook\_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all).

<div id="follow-the-steps-below-to-easily-migrate-from-the-site-streams-api-to-the-account-activity-api">
  ### Le tableau de bord Account Activity (application d’exemple pour l’API Account Activity)
</div>

Nous avons créé une application d’exemple pour accélérer les tests de l’API Account Activity :   

- Téléchargez l’application d’exemple Account Activity Dashboard [ici](https://github.com/xdevplatform/Account-Activity-dashboard) (elle utilise Node.js)
- Suivez les instructions du README pour installer et lancer l’application
- Une fois l’application lancée, vous pouvez utiliser l’interface pour configurer facilement votre webhook et créer un nouvel abonnement

<div id="the-account-activity-dashboard-sample-account-activity-api-application">
  ### Activités disponibles
</div>

| Type de message | Détails |
| :--- | :--- |
| [tweet\_create\_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#tweet-create-events-posts-retweets-replies-quotetweets) | Charge utile d’état de post lorsque l’une des actions suivantes est effectuée par ou à l’égard de l’utilisateur abonné : posts, retweets, réponses, @mentions, posts cités |
| [favorite\_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#favorite-events) | Événement de mise en favori (like) avec l’utilisateur et la cible. |
| [follow\_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#follow-events) | Événement d’abonnement (follow) avec l’utilisateur et la cible. |
| [block\_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#block-events) | Événement de blocage avec l’utilisateur et la cible. |
| [mute\_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#mute-events) | Événement de mise en sourdine avec l’utilisateur et la cible. |
| [direct\_message\_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-events) | Événement de message direct avec l’utilisateur et la cible. |
| [direct\_message\_indicate\_typing\_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-indicate-typing-events) | Événement d’indication de saisie dans les messages directs avec l’utilisateur et la cible. |
| [direct\_message\_mark\_read\_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-mark-read-events) | Événement de lecture de message direct avec l’utilisateur et la cible. |

### Types de messages de streaming obsolètes 

|     |     |
| :--- | :--- |
| Lignes vides | Les lignes vides ne seront plus envoyées dans l’Account Activity API, car elles étaient utilisées comme messages de keep-alive dans User Streams et Site Streams. |
| Avis de limite | Les avis de limite ne seront plus envoyés à un webhook donné. À la place, les utilisateurs peuvent appeler l’API pour obtenir l’utilisation actuelle des handles disponibles. Cela sera ajouté au portail développeur à l’avenir. |
| Messages de déconnexion | Les avis de déconnexion ne seront plus nécessaires, car les webhooks ne dépendent pas d’une connexion active. |
| Avertissements de blocage | Les avertissements de blocage ne seront plus nécessaires, car les webhooks ne dépendent pas d’une connexion active capable de gérer un grand volume de messages entrants. |
| Liste d’amis | Les listes d’amis ne seront plus envoyées de manière proactive. Un endpoint REST sera désormais disponible pour obtenir ces informations. |

<div id="deprecated-streaming-message-types">
  ### Types d’événements obsolètes
</div>

|     |     |     |     |     |
| :--- | :--- | :--- | :--- | :--- |
| **Description** | **Nom de l’événement** | **Source** | **Cible** | **Objet cible** |
| L’utilisateur supprime un post | delete | Utilisateur actuel | Utilisateur actuel | Post |
| Un utilisateur suivi supprime un post | delete | Utilisateur suivi | Utilisateur suivi | Post |
| L’utilisateur retire un favori d’un post | unfavorite | Utilisateur actuel | Auteur du post | Post |
| Le post de l’utilisateur n’est plus en favori | unfavorite | Utilisateur retirant le favori | Utilisateur actuel | Post |
| L’utilisateur se désabonne de quelqu’un | unfollow | Utilisateur actuel | Utilisateur suivi | Null |
| L’utilisateur crée une liste | list\_created | Utilisateur actuel | Utilisateur actuel | Liste |
| L’utilisateur supprime une liste | list\_destroyed | Utilisateur actuel | Utilisateur actuel | Liste |
| L’utilisateur modifie une liste | list\_updated | Utilisateur actuel | Utilisateur actuel | Liste |
| L’utilisateur ajoute quelqu’un à une liste | list\_member\_added | Utilisateur actuel | Utilisateur ajouté | Liste |
| L’utilisateur est ajouté à une liste | list\_member\_added | Utilisateur ajoutant | Utilisateur actuel | Liste |
| L’utilisateur retire quelqu’un d’une liste | list\_member\_removed | Utilisateur actuel | Utilisateur retiré | Liste |
| L’utilisateur est retiré d’une liste | list\_member\_removed | Utilisateur retirant | Utilisateur actuel | Liste |
| L’utilisateur s’abonne à une liste | list\_user\_subscribed | Utilisateur actuel | Propriétaire de la liste | Liste |
| La liste de l’utilisateur reçoit un abonnement | list\_user\_subscribed | Utilisateur s’abonnant | Utilisateur actuel | Liste |
| L’utilisateur se désabonne d’une liste | list\_user\_unsubscribed | Utilisateur actuel | Propriétaire de la liste | Liste |
| La liste de l’utilisateur reçoit un désabonnement | list\_user\_unsubscribed | Utilisateur se désabonnant | Utilisateur actuel | Liste |
| L’utilisateur met à jour son profil | user\_update | Utilisateur actuel | Utilisateur actuel | Null |
| L’utilisateur met à jour son statut protégé | user\_update | Utilisateur actuel | Utilisateur actuel | Null |

## Guide de migration des messages privés

**Le 17 septembre 2018, nous avons retiré les anciens endpoints de messages privés.
Si vous utilisiez ces endpoints, veillez à migrer vers les nouveaux endpoints de messages privés ou vers l’Account Activity API.**

**Veuillez consulter [cette annonce](https://devcommunity.x.com//t/details-and-what-to-expect-from-the-api-deprecations-this-week-on-august-16-2018/110746) pour en savoir plus.**

Ce guide a pour but de vous aider à migrer des anciennes API REST de messages privés vers leurs remplaçants améliorés, désormais sortis de bêta. Vous trouverez ci-dessous un résumé des changements, une liste des nouvelles fonctionnalités, ainsi que les principales différences et points d’attention pour faciliter la transition. Les nouveaux endpoints de messages privés sont désormais disponibles pour tous les développeurs. Pour des conseils sur la migration depuis User Streams ou Site Streams, consultez le [guide de migration vers l’Account Activity API](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#migration-guide-moving-from-user-streams-site-streams-to-account-activity-api).

- [Résumé des changements](#summary)
- [Nouvelles fonctionnalités](#features)
- [Envoi de messages privés](#sending)
- [Réception de messages privés](#receiving)
- [Suppression de messages privés](#deleting)

### Résumé des modifications

Si vous utilisez encore les endpoints DM suivants, vous devrez migrer vers les endpoints plus récents.

| Endpoint obsolète | Nouvelle alternative de migration |
| :--- | :--- |
| [POST direct\_messages/new](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/new-event) | [POST direct\_messages/events/new](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/new-event) |
| [GET direct\_messages/show](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/get-event) | [GET direct\_messages/events/show](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/get-event) |
| [GET direct\_messages](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events) | [GET direct\_messages/events/list](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events) |
| [GET direct\_messages/sent](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/get-event) | [GET direct\_messages/events/list](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events) |
| [POST direct\_messages/destroy](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/delete-message-event) | [DELETE direct\_messages/events/destroy](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/delete-message-event) |

<div id="differences-migration-considerations">
  ### Nouvelles fonctionnalités
</div>

Les nouveaux endpoints de l’API des Messages privés prennent en charge plusieurs nouvelles fonctionnalités et offrent un meilleur accès aux anciens Messages privés. Parmi les nouveautés :

- Prise en charge des pièces jointes multimédias (images, GIF et vidéos).
- Possibilité d’inviter les utilisateurs à fournir des réponses structurées à partir d’une liste d’options prédéfinies.
- Accès aux anciens Messages privés sur une période allant jusqu’à 30 jours.

Pour la liste complète des nouvelles fonctionnalités des Messages privés et des nouveaux endpoints d’API, consultez la [documentation technique](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/overview).
 

<div id="new-features">
  ### Différences et considérations de migration
</div>

Les nouveaux points de terminaison de l’API se comportent très différemment de leurs versions précédentes. Se contenter de mettre à jour les URL des points de terminaison entraînera des erreurs dans votre application. Tenez compte des éléments suivants lors de la mise à jour de votre application pour la migration.

#### Nouvel objet de message privé

La première chose que vous remarquerez probablement est la nouvelle structure d’objet des messages privés. Cette nouvelle structure d’objet « Message Create » a été introduite pour prendre en charge de nouvelles fonctionnalités comme les [réponses rapides](https://developer.x.com/en/docs/x-api/v1/direct-messages/quick-replies/overview) et les [pièces jointes](https://developer.x.com/en/docs/x-api/v1/direct-messages/message-attachments/overview). Le nouvel objet contient également un objet utilisateur plus compact. Votre application devra être mise à jour pour tenir compte de cette nouvelle structure d’objet lors de l’analyse et, potentiellement, dans les modèles de données ou le stockage. Pour la description de chaque propriété, consultez la [documentation complète sur l’objet Message Create](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/guides/message-create-object).

**Exemple d’objet Message Create**

```json
{
      "type": "message_create",
      "id": "1234858592",
      "created_timestamp": "1392078023603",
      "initiated_via": {
        "tweet_id": "123456",
        "welcome_message_id": "456789"
      },
      "message_create": {
        "target": {
          "recipient_id": "1234858592"
        },
        "sender_id": "3805104374",
        "source_app_id": "268278",
        "message_data": {
          "text": "Blue Bird",
          "entities": {
            "hashtags": [],
            "symbols": [],
            "urls": [],
            "user_mentions": [],
          },
          "quick_reply_response": {
            "type": "options",
            "metadata": "external_id_2"
          },
          "attachment": {
            "type": "media",
            "media": {
             ...
            }
          }
        }
      }
```

<div id="new-direct-message-object">
  #### Résumé
</div>

- Nouvelle structure d’objet pour les Messages privés.
- Objet utilisateur condensé.
- Nouvelles informations disponibles (réponses aux messages rapides, pièces jointes, etc.).

### Envoi de Messages privés

[POST direct\_messages/events/new](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/new-event) remplace directement l’envoi de Messages privés. La principale différence avec ce point de terminaison est que toutes les informations sont désormais envoyées au format JSON dans le corps de la requête POST, plutôt que sous forme de paramètres POST individuels.

**Exemple de requête twurl**

```bash
twurl -A 'Content-type: application/json' -X POST /1.1/direct\_messages/events/new.json -d '{"event": {"type": "message\_create", "message\_create": {"target": {"recipient\_id": "4534871"}, "message_data": {"text": "Hello World!"}}}}'
```

Notez dans la requête ci-dessus que l’en-tête Content-Type est défini sur application/json, et non sur application/x-www-form-urlencoded. De plus, si vous générez la signature OAuth 1.0a, le corps JSON n’est pas inclus dans la génération de la signature. La plupart des bibliothèques OAuth gèrent déjà ce cas. Si vous utilisez [twurl](https://github.com/twitter/twurl), assurez-vous d’utiliser au minimum la version 0.9.3.

<div id="new-direct-message-object">
  #### Résumé
</div>

- Le message est défini dans le corps de la requête POST au format JSON
- L’en-tête Content-Type doit être défini sur application/json
- Le corps JSON n’est pas inclus dans la génération de la signature OAuth.
   

### Récupération des Messages Privés

La récupération des anciens Messages Privés s’effectue désormais via un seul endpoint de l’API : [GET direct\_messages/events/list](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events). La principale différence avec ce nouvel endpoint est qu’il renvoie désormais à la fois les messages envoyés et reçus, par ordre antéchronologique. Cela peut faciliter la reconstitution d’une conversation. Toutefois, si vous ne recherchez que les messages envoyés ou uniquement les messages reçus, vous devrez post-traiter la réponse en vous référant à la propriété sender\_id.

La pagination est désormais basée sur une valeur de curseur plutôt que sur un ID de Message Privé. Une propriété cursor est renvoyée avec chaque réponse. [GET direct\_messages/events/list](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events) renverra jusqu’à 30 jours de messages, quel que soit le nombre de messages existant sur cette période. Lorsqu’aucun curseur n’est renvoyé, il n’y a plus de messages à récupérer. La méthode d’accès à des Messages Privés individuels avec [GET direct\_messages/events/show](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/get-event) reste la même, bien que l’objet Message Privé renvoyé ait une structure différente, comme décrit précédemment.

Enfin, l’accès en temps réel aux Messages Privés se fait désormais via webhook avec l’[Account Activity API](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity). Pour obtenir des conseils de migration depuis User Streams ou Site Streams, consultez le guide de migration vers l’Account Activity API pour plus d’informations.

<div id="new-direct-message-object">
  #### Résumé
</div>

- Les messages envoyés et reçus sont désormais renvoyés par le même endpoint.
- Jusqu’à 30 jours de messages renvoyés.
- Pagination basée sur des curseurs.
- Accès en temps réel aux Messages privés via webhook.

### Suppression des messages privés

Les messages privés peuvent désormais être supprimés avec DELETE direct\_messages/events/destroy. L’interface reste largement identique et nécessite l’ID du message à supprimer. La principale différence est que le point de terminaison requiert désormais une requête DELETE plutôt qu’une requête POST.

La manière dont les messages privés supprimés apparaissent dans les clients officiels de X reste inchangée. Les messages privés ne sont retirés que de l’interface de l’utilisateur du contexte fourni. Les autres participants à la conversation peuvent toujours accéder au message privé.

<div id="new-direct-message-object">
  #### Résumé
</div>

- La suppression d’un message privé nécessite l’ID.
- Le nouveau point de terminaison requiert une requête DELETE.
- La façon dont les messages privés supprimés s’affichent dans les clients officiels X reste inchangée.

\*\*Des questions sur la migration vers les nouveaux points de terminaison de messages privés ?
\*\*Publiez votre question sur le forum de la communauté des développeurs sur [devcommunity.com](https://devcommunity.x.com/).

## Foire aux questions

### Général

**Quels sont les avantages de l’Account Activity API ?**

L’Account Activity API utilise des webhooks, ce qui signifie que, contrairement aux API de streaming, nous n’exigeons pas que vous mainteniez une connexion ouverte pour que nous vous envoyions des informations. Les webhooks diffèrent également des API REST, car vous n’avez pas à nous interroger des centaines de fois toutes les 15 minutes pour obtenir les données qui vous intéressent. Cela améliore l’efficacité entre un utilisateur et votre application, car les données sont livrées en temps réel.

L’Account Activity API présente un certain nombre d’avantages :

1. **Vitesse** : nous livrons les données à la vitesse de X.
2. **Simplicité** : nous livrons tous les événements d’un compte via une seule connexion webhook. Les activités livrées dans l’API incluent les posts, @mentions, réponses, Retweets, Tweets cités, Retweets de Tweets cités, favoris, Messages privés envoyés, Messages privés reçus, suivis, blocages, mises en sourdine.
3. **Évolutivité** : vous recevez toutes les activités d’un compte que vous gérez sans être limité par des plafonds de débit ou des limites d’événements.

L’Account Activity API est disponible en bac à sable Premium, Premium payant et offre Enterprise, ce qui vous permet de monter en charge à mesure que vous avez besoin de plus de comptes pour des fonctionnalités de responsabilisation ou des fonctionnalités supplémentaires.

Pour commencer, téléchargez des extraits de code d’exemple depuis [GitHub](https://github.com/xdevplatform/account-activity-dashboard).
 

**Comment identifier le niveau de produit le mieux adapté à mes besoins ?**

Veuillez consulter notre page [Présentation de l’Account Activity API](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity) pour en savoir plus sur les différences entre les options Premium et l’option Enterprise.
 

**Quelle est la différence entre un environnement Premium et un webhook Enterprise ?**

Il n’y a aucune différence. Chaque environnement Premium aura son propre webhook\_id.
 

**J’ai besoin d’environnements de développement, de préproduction et de production pour l’Account Activity API, est-ce possible ?**

Oui ! Avec les niveaux payants de l’Account Activity API (Premium payant et Enterprise), il est possible d’enregistrer plusieurs URL de webhook et de gérer séparément les abonnements pour chacun via les méthodes de l’API. De plus, plusieurs applications clientes peuvent être ajoutées à une allowlist pour maintenir l’autorisation de vos utilisateurs déjà autorisés.
 

**Avez-vous des guides pas à pas pour configurer l’Account Activity API ?**

En effet !

- Si vous débutez, nous vous recommandons de consulter notre guide [Premiers pas avec les webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#getting-started-with-webhooks)

- Suivez nos scripts pris en charge par X Dev :
  - [Tableau de bord Account Activity API](https://github.com/xdevplatform/account-activity-dashboard), une application web Node qui affiche les événements de webhook.
  - Le [chatbot SnowBot](https://github.com/xdevplatform/SnowBotDev), une application web Ruby bâtie sur les API Account Activity et Direct Message. Cette base de code inclut un [script](https://github.com/xdevplatform/SnowBotDev/wiki/Account-Activity-API-setup-script) pour aider à configurer les webhooks de l’Account Activity API.
     

**Existe-t-il un moyen de récupérer des données si notre système est en panne pendant un certain temps ?**

Avec les niveaux payants de l’Account Activity API (Premium payant et Enterprise), notre système [réessaiera](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#retries) de vous envoyer les activités plusieurs fois sur une période de quatre heures. Si votre système ne répond pas dans ce délai de quatre heures, l’activité sera perdue et vous devrez utiliser d’autres endpoints REST pour récupérer les données sous 7 jours.

Nous vous suggérons d’utiliser vos différents webhooks, ou environnements, comme outil de redondance, par exemple l’[Account Activity Replay API](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-replay-api), afin de vous assurer que vous ne manquez aucune activité si l’un de vos systèmes tombe en panne.
 

**Quelle authentification dois-je utiliser avec l’Account Activity API ?**

Les méthodes d’authentification requises pour l’Account Activity API sont décrites méthode par méthode dans les [pages de référence de l’API](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-api-reference-index). Si vous débutez avec l’authentification X, nous vous recommandons de lire [cette section](/fr/resources/fundamentals/authentication).

**Qu’est-ce qu’un contrôle de challenge–response (CRC) ?**

La vérification de la réponse au challenge de l’API Account Activity est une fonctionnalité de sécurité destinée à garantir que les activités de l’API Account Activity sont envoyées au bon développeur. Elle peut également être utilisée par les développeurs pour s’assurer que les données qu’ils reçoivent proviennent de X. X enverra automatiquement un CRC à votre URL de webhook toutes les 24 heures, à compter de la dernière validation de cette URL. Votre système doit répondre avec une réponse valide en moins de 3 secondes pour rester validé.

Veuillez consulter notre page [Sécuriser les webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#securing-webhooks) pour plus de détails.

**Y a-t-il quelque chose qui invaliderait immédiatement mon URL de webhook ?**

Si l’un des événements suivants se produit, nous marquerons immédiatement votre webhook comme invalide :

- Le serveur répond à un CRC avec un jeton incorrect. Dans ce cas, notre système ne [réessaiera](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#retries) pas de vous envoyer l’activité.
- L’URL du webhook a un certificat incorrectement configuré. Dans ce cas, notre système ne [réessaiera](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#retries) pas de vous envoyer l’activité.
- Votre serveur renvoie un code de réponse autre que 2XX, 4XX ou 5XX.
- Vous indiquez utiliser gzip sans réellement l’envoyer.
- Vous n’indiquez pas utiliser gzip, mais vous l’envoyez quand même dans la réponse.

**Vais-je recevoir des activités en double si je suis abonné à des utilisateurs qui interagissent entre eux ?**

Oui. Si votre application web a des abonnements actifs pour l’Utilisateur A et l’Utilisateur B, et que l’Utilisateur A mentionne l’Utilisateur B dans un Post, deux activités POST seront envoyées au webhook enregistré. Chaque activité comportera un indicateur "for\_user\_id" indiquant à quel abonnement elle se rapporte.

**Lorsque je crée un abonnement à mon webhook, puis-je remplacer la partie `/all/` de l’endpoint suivant par d’autres objets de données d’activité de compte afin de limiter les activités livrées par l’API ?** `POST https://api.x.com/1.1/account_activity/all/:env_name/subscriptions.json`

Non, ce n’est pas possible. À l’heure actuelle, seul le produit `/all/` est disponible.

**Existe-t-il un moyen d’utiliser l’API Account Activity sans demander les autorisations de Messages privés aux utilisateurs ?**

À ce stade, les autorisations de Messages privés sont requises, car il n’existe aucun moyen de « filtrer » les activités de Messages privés pour cette API.

**Existe-t-il une version gratuite de l’API Account Activity ?**

Oui, nous proposons la version sandbox en tant que niveau gratuit. Notre option sandbox est limitée à un seul webhook avec un maximum de 15 abonnements. Vous pouvez en savoir plus sur l’option sandbox dans [notre documentation](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity).

**Est-il possible d’utiliser l’API Account Activity pour obtenir des Retweets de Posts qui mentionnent des utilisateurs abonnés ?**

Malheureusement, cela ne fait pas partie des activités fournies par cette API. Pour cela, nous recommandons plutôt d’utiliser l’API de streaming.

**Quels sont les types d’activité possibles représentés par un tweet\_create\_event ?**

Un payload tweet\_create\_event sera envoyé :

Si l’utilisateur abonné effectue l’une des actions suivantes :

- Crée un Post
- Retweete
- Répond à un Post

Si un autre utilisateur :

- @mentionne\* l’utilisateur abonné
- Cite un Tweet créé par l’utilisateur abonné

_Remarque : l’API Account Activity ne livre des événements que lorsque l’utilisateur abonné recevrait une notification de X et pourrait voir l’événement publiquement. Cela signifie que si le compte mentionné (@userA) suit le compte protégé (@userB), UserA recevra une notification indiquant que UserB l’a mentionné. Si UserA ne suit pas UserB (et n’a pas été approuvé par UserB), UserA ne recevra pas de notification et, par conséquent, un tweet\_create\_event ne serait pas envoyé via AAA si @userA avait un abonnement._

**Si un utilisateur bloqué mentionne mon utilisateur abonné, comment puis-je l’identifier ?**

Vous verrez un champ booléen `user_has_blocked` au niveau supérieur de la réponse JSON, défini sur « true » ou « false ». Ce champ n’apparaîtra que pour les mentions de Post.

Enterprise

**Comment puis-je ajouter mon application à une allowlist ou vérifier si mon application est déjà sur l’allowlist ?**

Pour gérer les [applications X](/fr/resources/fundamentals/developer-apps) que vous avez ajoutées à une allowlist pour l’accès via les API Enterprise, veuillez contacter votre chargé de compte avec l’ID de votre application. Vous pouvez trouver l’ID de votre application en accédant à la page ["Apps"](/fr/resources/fundamentals/developer-apps) dans le [portail développeur](/fr/resources/fundamentals/developer-portal).
 

**Si j’ai accès à trois webhooks, puis-je utiliser trois webhooks pour chacune des applications que j’ai enregistrées pour un usage entreprise ?**

La limite de webhooks est définie au niveau du compte, et non au niveau de l’application. Si vous avez accès à trois webhooks et deux applications enregistrées pour un usage entreprise, vous pouvez utiliser deux webhooks sur une application et le troisième sur l’autre, mais pas trois sur chacune des applications. 

**Puis-je spécifier les types d’événements qui seront rejoués à l’aide de l’Account Activity Replay API ?**

Les types d’événements à rejouer ne peuvent pas être spécifiés. Tous les événements livrés pendant la fenêtre de dates et d’heures indiquée seront rejoués. 

**Y aura-t-il des tentatives de nouvel envoi si mon application ne parvient pas à ingérer un événement de l’Account Activity Replay API ?**

Non, il n’y aura pas de nouvelles tentatives. Si une application ne parvient pas à ingérer un événement envoyé par l’Account Activity Replay API, une autre tâche de Replay peut être soumise pour la même période afin de tenter la nouvelle livraison des événements de Replay manqués. 

**Que dois-je faire lorsque je reçois un événement d’achèvement avec succès partiel ?**

Nous recommandons de noter les horodatages des événements reçus et de soumettre une autre tâche de Replay pour les événements manqués. 

**Combien de tâches d’Account Activity Replay API puis-je exécuter en même temps ?**

Une seule tâche d’Account Activity Replay API par webhook peut être en cours d’exécution à la fois. 

**Comment puis-je différencier les événements de l’Account Activity Replay API des événements de production en temps réel lorsqu’ils sont livrés à mon webhook ?**

Comme l’Account Activity Replay API livre toujours des événements passés, ils peuvent être différenciés des événements de production en temps réel à leur horodatage. 

**Dans quel délai puis-je commencer à utiliser l’Account Activity Replay API pour renvoyer une activité que mon application a manquée ou ignorée ?**

Une activité devient disponible pour une nouvelle livraison environ 10 minutes après sa création. 

<div id="general">
  ### Guide de résolution des erreurs
</div>

#### Code 32

Cette erreur indique généralement qu’un élément est mal formé dans la requête, les en-têtes, l’autorisation ou l’URL que vous spécifiez. Ce n’est pas une erreur de l’Account Activity API, mais une erreur d’autorisation : X ne reçoit pas la configuration OAuth appropriée ou l’URL correcte.

- **Enterprise** - Assurez-vous que les consumer keys et les access tokens que vous utilisez appartiennent à une [application X](/fr/resources/fundamentals/developer-apps) enregistrée pour l’utilisation des produits Enterprise. Si vous n’avez pas vos consumer keys et access tokens, ou si vous devez ajouter votre application X à la liste autorisée (allowlist), veuillez contacter votre account manager. 

- Si vous vous authentifiez avec un contexte utilisateur, assurez-vous d’avoir correctement [autorisé votre requête](/fr/resources/fundamentals/authentication#authorizing-a-request) avec les paramètres `oauth_nonce`, `oauth_signature` et `oauth_timestamp` appropriés.

- Assurez-vous que vos access tokens disposent du niveau d’autorisation approprié.
  - Dans l’onglet « Keys and tokens » du [tableau de bord de l’application](/fr/resources/fundamentals/developer-apps), vérifiez que vos access tokens ont le niveau d’autorisation « Read, write, and direct messages » [permission level](/fr/resources/fundamentals/developer-apps#app-permissions). 
  - Si le niveau d’autorisation des tokens est inférieur, accédez à l’onglet « Permissions », réglez l’autorisation d’accès sur « Read, write, and direct messages », puis régénérez vos access tokens et le secret depuis l’onglet « Keys and tokens ».

- Assurez-vous que votre URL est correctement formée.
  - Notez que `:env_name` est sensible à la casse.
     

<div id="code-32">
  #### Code 200 - Interdit
</div>

- **Premium** - Assurez-vous de disposer d’un [compte développeur](/fr/resources/fundamentals/developer-portal) approuvé avant de tenter d’effectuer une requête vers l’API. Vous devez également utiliser le :env\_name approprié dans la requête, que vous pouvez configurer sur la page [dev environments](/fr/resources/fundamentals/developer-portal).

- **Enterprise** - Assurez-vous que votre gestionnaire de compte vous a accordé l’accès à l’Account Activity API.

- Assurez-vous d’avoir correctement renseigné votre URI. Cette erreur peut se produire si vous avez saisi une URI incorrecte dans votre requête.
   

<div id="code-200-forbidden">
  #### Code 214 - L’URL du webhook ne respecte pas les exigences.
</div>

- Assurez-vous d’utiliser HTTPS.
- L’URL de votre webhook est peut-être mal formée.
- Pour en savoir plus sur la configuration de l’URL de votre webhook, consultez la section [Develop webhook consumer app](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#3-develop-webhook-consumer-app) de la page [Getting started with webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#getting-started-with-webhooks).
   

<div id="code-214-webhook-url-does-not-meet-the-requirements">
  #### Code 214 - Latence élevée sur la requête GET de CRC. Votre webhook doit répondre en moins de 3 secondes.
</div>

- Cela signifie que votre serveur est lent. Assurez-vous de répondre au CRC en moins de 3 secondes.
   

<div id="code-214-high-latency-on-crc-get-request-your-webhook-should-respond-in-less-than-3-seconds">
  #### Code 214 - Code de réponse différent de 200 lors de la requête CRC GET (p. ex. 404, 500, etc.).
</div>

- Votre serveur est hors service. Assurez-vous qu’il fonctionne correctement.
   

<div id="code-214-non-200-response-code-during-crc-get-request-ie-404-500-etc">
  #### Code 214 - Trop de ressources déjà créées.
</div>

- **Enterprise** - Vous avez déjà utilisé tous vos webhooks. Utilisez le point de terminaison [GET webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks) avec chacune de vos applications enregistrées pour identifier où vos webhooks sont déployés. 

<div id="code-214-too-many-resources-already-created">
  #### Code 261 - L’application ne peut pas effectuer d’actions d’écriture.
</div>

- L’application que vous utilisez avec l’API n’a pas le [niveau d’autorisation](/fr/resources/fundamentals/developer-apps#app-permissions) adéquat défini pour son jeton d’accès et son secret de jeton d’accès. Accédez à l’onglet « Keys and tokens » dans le tableau de bord [X apps](/fr/resources/fundamentals/developer-apps) et vérifiez les niveaux d’autorisation attribués à votre jeton d’accès et à votre secret de jeton d’accès. S’il est réglé sur autre chose que « Read, write and Direct Messages », vous devrez ajuster les paramètres dans l’onglet « Permission » et régénérer votre jeton d’accès et votre secret de jeton d’accès pour appliquer les nouveaux paramètres.
- Autre possibilité : vous tentez d’enregistrer un webhook en utilisant une authentification applicative seule, ce qui n’est pas pris en charge. Veuillez plutôt vous authentifier avec un contexte utilisateur, comme indiqué dans les sections de référence de l’API pour l’enregistrement d’un webhook pour l’[Enterprise Account Activity API](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks).

## Index de référence de l’API d’activité de compte

|     |     |
| :--- | :--- |
| **Objectif** | Entreprise |
| Enregistre une URL de webhook / Génère un webhook\_id | [POST  <br />webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api) |
| Renvoie toutes les URL de webhook et leurs statuts | [GET  <br />webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks) |
| Déclenche manuellement une vérification de réponse au défi | [PUT  <br />webhooks/:webhook\_id](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id) |
| Abonne une application aux événements d’un compte | [POST  <br />webhooks/:webhook\_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all) |
| Renvoie le nombre d’abonnements actuellement actifs | [GET  <br />subscriptions/count](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-subscriptions-count) |
| Vérifie si un webhook est abonné à un compte | [GET  <br />webhooks/:webhook\_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all) |
| Renvoie la liste des abonnements actuellement actifs | [GET  <br />webhooks/:webhook\_id/subscriptions/all/list](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-subscriptions-count) |
| Supprime le webhook | [DELETE  <br />webhooks/:webhook\_id](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id) |
| Désactive un abonnement à l’aide d’OAuth à 3 étapes (OBSOLÈTE) | [DELETE  <br />webhooks/:webhook\_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated) |
| Désactive un abonnement à l’aide d’OAuth « application-only » | [DELETE  <br />webhooks/:webhook\_id/subscriptions/:user\_id/all.json](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-user-id-all-json) |
| Réexpédie des activités à un webhook | [POST  <br />replay/webhooks/:webhook\_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated) |

### API d’activité de compte pour entreprises

#### POST account\_activity/webhooks[](#post-account-activity-webhooks "Permalink to this headline")

Enregistre une nouvelle URL de webhook pour le contexte d’application donné. L’URL sera validée via une requête CRC avant l’enregistrement. En cas d’échec de la validation, un message d’erreur détaillé est renvoyé au demandeur.

Le nombre de webhooks autorisés est déterminé par l’offre de facturation.

### URL de la ressource[](#resource-url "Permalink to this headline")

`https://api.x.com/1.1/account_activity/webhooks.json`

<div id="resource-url">
  ### Informations sur la ressource[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Format de réponse | JSON |
| Authentification requise | Oui (contexte utilisateur — tous les jetons consommateur et d’accès) |
| Limitation du débit | Oui |
| Requêtes / fenêtre de 15 min (auth. utilisateur) | 15  |
| Prise en charge des éditions de Tweet | Tous les objets Tweet incluront des métadonnées d’édition décrivant l’historique des modifications du Tweet. Voir la page « Édition de Tweets » [/x-api/enterprise-gnip-2.0/fundamentals/edit-tweets](/fr/x-api/enterprise-gnip-2.0/fundamentals/edit-tweets) pour plus de détails. |

<div id="resource-information">
  ### Paramètres[](#parameters "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| url (obligatoire) | URL encodée du point de terminaison de rappel. |

<div id="parameters">
  ### Exemple de requête[](#example-request "Permalink to this headline")
</div>

$ curl --request POST
\--url 'https://api.x.com/1.1/account\_activity/webhooks.json?url=https%3A%2F%2Fyour\_domain.com%2Fwebhooks%2Ftwitter%2F0'
\--header 'authorization: OAuth oauth\_consumer\_key="CONSUMER\_KEY", oauth\_nonce="GENERATED", oauth\_signature="GENERATED", oauth\_signature\_method="HMAC-SHA1", oauth\_timestamp="GENERATED", oauth\_token="ACCESS\_TOKEN", oauth\_version="1.0"'

<div id="example-request">
  ### Réponses HTTP[](#http-responses "Permalink to this headline")
</div>

| Code HTTP | Message |
| :--- | :--- |
| 200 | L’URL de webhook est enregistrée pour l’application fournie |
| 403 | Votre requête comporte une erreur. Voir la section des messages d’erreur ci-dessous. |

<div id="http-responses">
  ### Exemple de réponse — Succès[](#example-response-success "Permalink to this headline")
</div>

```json
_HTTP 200_

    {
      "id": "1234567890",
      "url": "https://your_domain.com/webhook/twitter/0",
      "valid": true,
      "created_at": "2016-06-02T23:54:02Z"
    }
```

<div id="example-response-success">
  ### Messages d’erreur[](#error-messages "Permalink to this headline")
</div>

| Code | Message |
| :--- | :--- |
| 214 | L’URL du webhook ne satisfait pas aux exigences. |
| 214 | Trop de ressources déjà créées. |
| 214 | L’URL du webhook ne satisfait pas aux exigences. Jeton CRC invalide ou format de réponse JSON invalide. |
| 214 | Latence élevée sur la requête CRC en GET. Votre webhook doit répondre en moins de 3 secondes. |
| 214 | Code de réponse différent de 200 lors de la requête CRC en GET (p. ex. 404, 500, etc.). |

_HTTP 403_

```json
    {
      "errors": [
        {
          "code": 214,
          "message": "Too many resources already created."
        }
      ]
    }
```

#### GET account\_activity/webhooks[](#get-account-activity-webhooks "Permalink to this headline")

Renvoie toutes les URL et leur statut pour l’application donnée.

Une URL est marquée comme invalide si elle échoue au contrôle de validation quotidien. Pour la réactiver, appelez l’endpoint de mise à jour.

### URL de la ressource[](#resource-url "Permalink to this headline")

`https://api.x.com/1.1/account_activity/webhooks.json`

<div id="resource-url">
  ### Informations sur la ressource[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Format de réponse | JSON |
| Authentification requise | Oui (application uniquement — jeton Bearer) |
| Limitation du débit | Oui |
| Requêtes / fenêtre de 15 min (authentification applicative) | 15  |

### Exemple de requête[](#example-request "Permalien vers ce titre")

```bash
    $ curl --request GET
     --url https://api.x.com/1.1/account_activity/webhooks.json
     --header 'authorization: Bearer TOKEN'
```

<div id="example-request">
  ### Exemple de réponse[](#example-response "Lien permanent vers ce titre")
</div>

_HTTP 200 OK_

```json
    [
      {
        "id": "1234567890",
        "url": "https://your_domain.com/webhook/twitter/0",
        "valid": true,
        "created_at": "2016-06-02T23:54:02Z"
      }
      {
        "id": "2468013579",
        "url": "https://your_domain2.com/webhook/twitter/0",
        "valid": true,
        "created_at": "2016-06-04T22:31:29Z"
      }
    ]
```

<div id="example-response-success">
  ### Messages d’erreur[](#error-messages "Permalink to this headline")
</div>

| Code | Message |
| :--- | :--- |
| 99  | Vous n’avez pas accès à cette ressource. |

#### PUT account\_activity/webhooks/:webhook\_id[](#put-account-activity-webhooks-webhook-id "Lien permanent vers ce titre")

Déclenche la vérification par défi-réponse (CRC) pour l’URL du webhook indiqué. Si la vérification réussit, renvoie 204 et réactive le webhook en définissant son statut sur `valid`.

### URL de la ressource[](#resource-url "Permalink to this headline")

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id.json`

<div id="resource-url">
  ### Informations sur la ressource[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Format de réponse | JSON |
| Authentification requise | Oui (contexte utilisateur – tous les jetons consommateur et d’accès) |
| Limitation du débit | Oui |
| Requêtes / fenêtre de 15 min (authentification utilisateur) | 15  |

<div id="resource-information">
  ### Paramètres[](#parameters "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| webhook\_id (obligatoire) | Identifiant du webhook. Défini dans le chemin de la ressource. |

<div id="parameters">
  ### Exemple de requête[](#example-request "Permalink to this headline")
</div>

```json
    $ curl --request PUT
     --url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID.json
     --header 'authorization: OAuth oauth_consumer_key="CONSUMER_KEY", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="ACCESS_TOKEN", oauth_version="1.0"'
```

<div id="example-request">
  ### Réponse[](#response "Lien permanent vers ce titre")
</div>

_HTTP 204 OK_

```
    { }
```

<div id="example-response-success">
  ### Messages d’erreur[](#error-messages "Permalink to this headline")
</div>

| Code | Message |
| :--- | :--- |
| 34  | Le webhook n’existe pas ou est associé à une autre application X. |
| 214 | L’URL du webhook ne respecte pas les exigences. |
| 214 | L’URL du webhook ne respecte pas les exigences. Jeton CRC invalide ou format de réponse JSON invalide. |
| 214 | Latence élevée sur la requête CRC en GET. Votre webhook doit répondre en moins de 3 secondes. |
| 214 | Code de réponse non 200 lors de la requête CRC en GET (p. ex. 404, 500, etc.). |

#### POST account\_activity/webhooks/:webhook\_id/subscriptions/all[](#post-account-activity-webhooks-webhook-id-subscriptions-all "Permalink to this headline")

Abonne l’application indiquée à tous les événements dans le contexte utilisateur fourni, pour tous les types de messages. Après activation, tous les événements concernant l’utilisateur à l’origine de la requête seront envoyés au webhook de l’application via une requête POST.

Les abonnements sont actuellement limités en fonction de la configuration de votre compte. Si vous avez besoin d’ajouter davantage d’abonnements, veuillez contacter votre chargé de compte.

### URL de la ressource[](#resource-url "Permalien vers ce titre")

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/all.json`

<div id="resource-url">
  ### Informations sur la ressource[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Format de réponse | JSON |
| Authentification requise | Oui (OAuth à 3 étapes — clé consommateur autorisée et jeton d’accès de l’utilisateur abonné) |
| Limitation du débit | Oui |
| Requêtes / fenêtre de 15 min (authentification utilisateur) | 500 |

<div id="resource-information">
  ### Paramètres[](#parameters "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| webhook\_id (obligatoire) | Identifiant du webhook. Défini dans le chemin de la ressource. |

<div id="parameters">
  ### Exemple de requête[](#example-request "Permalink to this headline")
</div>

```bash
    $ curl --request POST
     --url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID/subscriptions/all.json
     --header 'authorization: OAuth oauth_consumer_key="WHITELISTED_CONSUMER_KEY", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="SUBSCRIBING_USER'S_ACCESS_TOKEN", oauth_version="1.0"'
```

<div id="example-request">
  ### Exemple de réponse – Réussite[](#example-response-success "Permalink to this headline")
</div>

_HTTP 204 AUCUN CONTENU_

```
    {}
```

<div id="example-response-success">
  ### Messages d’erreur[](#error-messages "Permalink to this headline")
</div>

| Code | Message |
| :--- | :--- |
| 34  | Le webhook n’existe pas ou est associé à une autre application X. |
| 348 | L’application cliente n’est pas autorisée à accéder aux abonnements webhook de cet utilisateur. |

#### GET account\_activity/subscriptions/count[](#get-account-activity-subscriptions-count "Permalien vers ce titre")

Renvoie le nombre d’abonnements actuellement actifs sur votre compte. Notez que le point de terminaison /count requiert OAuth en mode application uniquement ; vous devez donc effectuer les requêtes avec un jeton Bearer plutôt qu’en contexte utilisateur.

### URL de la ressource[](#resource-url "Permalien vers ce titre")

`https://api.x.com/1.1/account_activity/subscriptions/count.json`

<div id="resource-url">
  ### Informations sur la ressource[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Format de la réponse | Code de réponse HTTP |
| Authentification requise | Oui (application uniquement — jeton Bearer) |
| Limitation du débit | Oui |
| Requêtes / fenêtre de 15 minutes (authentification d’application) | 15  |

<div id="resource-information">
  ### Codes de réponse HTTP[](#http-response-codes "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Code | Message |
| 200 | Succès. Un nombre d’abonnements pour le webhook demandé sera renvoyé. |
| 401 | Votre application n’a pas les autorisations nécessaires pour consulter les abonnements du webhook spécifié. |

<div id="parameters">
  ### Exemple de requête[](#example-request "Permalink to this headline")
</div>

```bash
    $ curl --request GET
     --url https://api.x.com/1.1/account_activity/subscriptions/count.json
     --header 'authorization: Bearer TOKEN'
```

<div id="example-request">
  ### Exemple de réponse – réussite[](#example-response-success "Permalink to this headline")
</div>

_HTTP 200_

```bash
    {
      "account_name":"my-account",
      "subscriptions_count_all":"1",
      "subscriptions_count_direct_messages":"0",
      "provisioned_count":"50"
    }
```

<div id="example-response-success">
  ### Messages d’erreur[](#error-messages "Permalink to this headline")
</div>

| Code | Message |
| :--- | :--- |
| 32  | Impossible de vous authentifier. |

_HTTP 401_

```abash
    {
      "errors": [
        {
           "code": 32,
          "message": "Could not authenticate you."
        }
      ]
    }
```

#### GET account\_activity/webhooks/:webhook\_id/subscriptions/all[](#get-account-activity-webhooks-webhook-id-subscriptions-all "Permalien vers ce titre")

Permet de vérifier si une configuration de webhook est abonnée aux événements de l’utilisateur indiqué. Si le contexte utilisateur fourni dispose d’un abonnement actif avec l’application indiquée, renvoie 204 OK. Si le code de réponse n’est pas 204, l’utilisateur n’a pas d’abonnement actif. Voir ci-dessous les codes de réponse HTTP et les messages d’erreur pour plus de détails.

### URL de la ressource[](#resource-url "Permalien vers ce titre")

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/all.json`

<div id="resource-url">
  ### Informations sur la ressource[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Format de réponse | JSON |
| Authentification requise | Oui (OAuth à 3 étapes — clé consommateur autorisée et jeton d’accès de l’utilisateur abonné) |
| Limitation du débit | Oui |
| Requêtes / fenêtre de 15 min (authentification utilisateur) | 500 |

<div id="resource-information">
  ### Paramètres[](#parameters "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| webhook\_id (obligatoire) | Identifiant du webhook. Défini dans le chemin de la ressource. |

### Exemple de requête[](#example-request "Lien permanent vers ce titre")

$ curl --request GET
\--url https://api.x.com/1.1/account\_activity/webhooks/:WEBHOOK\_ID/subscriptions/all.json
\--header 'authorization: OAuth oauth\_consumer\_key="WHITELISTED\_CONSUMER\_KEY", oauth\_nonce="GENERATED", oauth\_signature="GENERATED", oauth\_signature\_method="HMAC-SHA1", oauth\_timestamp="GENERATED", oauth\_token="SUBSCRIBING\_USER'S\_ACCESS\_TOKEN", oauth\_version="1.0"'

<div id="example-request">
  ### Exemple de réponse – Réussite[](#example-response-success "Permalink to this headline")
</div>

_HTTP 204 SANS CONTENU_

```
    { }
```

#### GET account\_activity/webhooks/:webhook\_id/subscriptions/all/list[](#get-account-activity-webhooks-webhook-id-subscriptions-all-list "Permalien vers ce titre")

Renvoie la liste des abonnements actuels de type « All Activity » pour le webhook spécifié. Notez que le point de terminaison /list nécessite l’authentification OAuth en mode application uniquement ; les requêtes doivent donc être effectuées à l’aide d’un jeton Bearer plutôt qu’en contexte utilisateur.

### URL de la ressource[](#resource-url "Permalink to this headline")

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/all/list.json`

<div id="resource-url">
  ### Informations sur la ressource[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Format de réponse | Code de réponse HTTP |
| Authentification requise | Oui (application uniquement — jeton Bearer) |
| Limitation du débit | Oui |
| Requêtes / fenêtre de 15 min (authentification d’application) | 50  |

<div id="resource-information">
  ### Paramètres[](#parameters "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| webhook\_id (obligatoire) | Identifiant du webhook. Défini dans le chemin de la ressource. |

<div id="resource-information">
  ### Codes de réponse HTTP[](#http-response-codes "Permalink to this headline")
</div>

| Code | Message |
| :--- | :--- |
| 200 | Succès. Une liste des abonnements pour le webhook demandé sera renvoyée. |
| 401 | Votre application n’a pas l’autorisation de consulter les abonnements pour le webhook spécifié. |

### Exemple de requête[](#example-request "Lien permanent vers ce titre")

$ curl --request GET
\--url https://api.x.com/1.1/account\_activity/webhooks/:WEBHOOK\_ID/subscriptions/all/list.json
\--header 'authorization: Bearer TOKEN'

<div id="example-request">
  ### Exemple de réponse – Succès[](#example-response-success "Permalink to this headline")
</div>

_HTTP 200_

```bash
    {
      "webhook_id": "1234567890",
      "webhook_url": "https://your_domain.com/webhook/twitter/0",
      "application_id": "11231812",
      "subscriptions": [{
        "user_id": "20212306"
      }]
    }
```

<div id="example-response-success">
  ### Messages d’erreur[](#error-messages "Permalink to this headline")
</div>

| Code | Message |
| :--- | :--- |
| 32  | Impossible de vous authentifier. |

_HTTP 401_

```bash
    {
      "errors": [
        {
           "code": 32,
          "message": "Could not authenticate you."
        }
      ]
    }
```

#### DELETE account\_activity/webhooks/:webhook\_id[](#delete-account-activity-webhooks-webhook-id "Permalink to this headline")

Supprime le webhook de la configuration de l’application spécifiée. L’ID du webhook est accessible en appelant GET /1.1/account\_activity/webhooks.

### URL de la ressource[](#resource-url "Permalink to this headline")

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id.json`

<div id="resource-url">
  ### Informations sur la ressource[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Format de réponse | JSON |
| Authentification requise | Oui (contexte utilisateur – tous les jetons consommateur et d’accès) |
| Limitation du débit | Oui |
| Requêtes / fenêtre de 15 min (authentification utilisateur) | 15  |

<div id="resource-information">
  ### Paramètres[](#parameters "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| webhook\_id (obligatoire) | Identifiant du webhook. Défini dans le chemin de la ressource. |

<div id="parameters">
  ### Exemple de requête[](#example-request "Permalink to this headline")
</div>

```bash
    $ curl --request DELETE
     --url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID.json
     --header 'authorization: OAuth oauth_consumer_key="CONSUMER_KEY", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="ACCESS_TOKEN", oauth_version="1.0"'
```

<div id="example-request">
  ### Réponse[](#response "Lien permanent vers ce titre")
</div>

_HTTP 204 OK_

```
    { }
```

#### DELETE account\_activity/webhooks/:webhook\_id/subscriptions/all (OBSOLÈTE)[](#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated- "Permalink to this headline")

Désactive l’abonnement ou les abonnements pour le contexte utilisateur et l’application fournis. Après la désactivation, aucun événement concernant l’utilisateur demandeur ne sera plus envoyé à l’URL du webhook.

### URL de la ressource[](#resource-url "Permalien vers ce titre")

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/all.json`

<div id="resource-url">
  ### Informations sur la ressource[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Format de réponse | JSON |
| Authentification requise | Oui (OAuth à 3 volets — clé consommateur autorisée et jeton d’accès de l’utilisateur abonné) |
| Limité par le débit | Oui |
| Requêtes / fenêtre de 15 min (auth. utilisateur) | 500 |

<div id="resource-information">
  ### Paramètres[](#parameters "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| webhook\_id (obligatoire) | Identifiant du webhook. Défini dans le chemin de la ressource. |

<div id="parameters">
  ### Exemple de requête[](#example-request "Permalink to this headline")
</div>

```bash
    $ curl --request DELETE
     --url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID/subscriptions/all.json
     --header 'authorization: OAuth oauth_consumer_key="WHITELISTED_CONSUMER_KEY", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="SUBSCRIBED_USER'S_ACCESS_TOKEN", oauth_version="1.0"'
```

Exemple de requête

```
    { }
```

#### DELETE /account\_activity/webhooks/:webhook\_id/subscriptions/:user\_id/all.json[](#delete-account-activity-webhooks-webhook-id-subscriptions-user-id-all-json "Permalink to this headline")

Désactive l’abonnement pour le webhook et l’identifiant utilisateur spécifiés. Après la désactivation, tous les événements concernant l’utilisateur demandeur ne seront plus envoyés à l’URL du webhook. Notez que ce point de terminaison nécessite l’authentification OAuth en mode application uniquement ; les requêtes doivent donc être effectuées à l’aide d’un jeton Bearer plutôt qu’en contexte utilisateur.

### URL de la ressource[](#resource-url "Permalink to this headline")

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/:user_id/all.json`

<div id="resource-url">
  ### Informations sur la ressource[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Format de réponse | JSON |
| Authentification requise | Oui (application uniquement — jeton Bearer) |
| Limitation du débit | Oui |
| Requêtes / fenêtre de 15 min | 500 |

<div id="parameters">
  ### Exemple de requête[](#example-request "Permalink to this headline")
</div>

```bash
    $ curl --request DELETE
     --url https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/:user_id/all.json
     --header 'authorization: Bearer TOKEN'
```

<div id="example-request">
  ### Réponse[](#response "Lien permanent vers ce titre")
</div>

_HTTP 204 AUCUN CONTENU_

<div id="example-response-success">
  ### Messages d’erreur[](#error-messages "Permalink to this headline")
</div>

| Code | Message |
| :--- | :--- |
| 404 | Désolé, cette page n’existe pas. - Cela se produit souvent lorsque l’ID utilisateur spécifié n’est pas réellement abonné. |

<div id="error-messages">
  ### API de relecture
</div>

**POST /1.1/account\_activity/replay/webhooks/:webhook\_id/subscriptions/all.json [¶](#post-1-1-account-activity-replay-webhooks-webhook-id-subscriptions-all-json- "Permalink to this headline")**

Envoie une requête pour récupérer, sur une période maximale de cinq jours, les activités de toutes les abonnements présents pendant les fenêtres de date et d’heure indiquées dans la requête. Si votre webhook a des abonnements utilisateur actifs, vous recevrez ces événements en parallèle. Remarque : un CRC est effectué avant la livraison des événements de relecture.

|     |     |
| :--- | :--- |
| **Méthode de requête** | HTTP POST |
| **URL** | /1.1/account\_activity/replay/webhooks/:webhook\_id/subscriptions/all.json?from\_date=yyyymmddhhmm\&to\_date=yyyymmddhhmm |
| **Format de réponse** | JSON |
| **Nécessite une authentification** | Oui (application uniquement — jeton Bearer) |
| **Limite de débit** | 5 requêtes par 15 minutes. Il n’y a actuellement pas de limite au nombre de tâches de relecture pouvant être demandées. |
| **from\_date** | Horodatage UTC le plus ancien (de début) à partir duquel les événements seront fournis, au format « yyyymmddhhmm ». La granularité est la minute et l’intervalle est inclusif (p. ex. 12:00 inclut la minute 00). Les heures valides doivent se situer dans les 5 derniers jours, en UTC, et ne pas être plus récentes que 31 minutes avant l’instant présent. Il est recommandé que from\_date et to\_date couvrent ~2 heures maximum. |
| **to\_date** | Horodatage UTC le plus récent (de fin) jusqu’auquel les événements seront fournis, au format « yyyymmddhhmm ». La granularité est la minute et l’intervalle est exclusif (p. ex. 12:30 n’inclut pas la 30e minute de l’heure). Les heures valides doivent se situer dans les 5 derniers jours, en UTC, et ne pas être plus récentes que 10 minutes avant l’instant présent. |

#### Réponses

Les réponses suivantes peuvent être renvoyées par l’API. La plupart des codes d’erreur sont renvoyés avec une chaîne contenant des détails supplémentaires dans le corps. Pour les réponses non-200, vous devez corriger l’erreur puis réessayer.

| Statut | Texte | Code d’erreur | Description | Message |
| :--- | :--- | :--- | :--- | :--- |
| 202 | Accepté | N/A | La requête a réussi et les activités seront envoyées. | N/A |
| 400 | Mauvaise requête | 214 | Le webhook a été marqué comme invalide. | Le webhook est marqué comme invalide et nécessite une vérification CRC. |
| 400 | Mauvaise requête | 357 | Le paramètre de requête est manquant. | : queryParam est requis. |
| 400 | Mauvaise requête | 358 | Le paramètre de route ou de requête est mal formé. | Impossible d’analyser le paramètre. |
| 400 | Mauvaise requête | 360 | Le paramètre de route est négatif. | webhook\_id: \[] n’est pas supérieur ou égal à 0. |
| 400 | Mauvaise requête | 368 | from\_date ou to\_date n’est pas dans le passé. | : \[\<field\_value>] n’est pas dans le passé. |
| 400 | Mauvaise requête | 356 | from\_date doit être antérieure à to\_date. | from\_date doit être antérieure à to\_date. |
| 400 | Mauvaise requête | 356 | from\_date doit être dans les 5 derniers jours. | from\_date doit être dans les 5 derniers jours. |
| 401 | Non autorisé | 32  | L’authentification HTTP a échoué en raison d’une authentification à 3 étapes fournie. | Méthode d’authentification invalide. Veuillez utiliser l’authentification application uniquement. |
| 401 | Non autorisé | 61  | Le client n’est pas autorisé à utiliser cette méthode. | Le client n’est pas autorisé à utiliser cette méthode. |
| 403 | Interdit | 200 | Le client n’a pas de compte entreprise avec Replay activé. | Un compte entreprise de l’Account Activity API avec Replay est requis. Veuillez confirmer que vous disposez d’un compte entreprise et que Replay est activé. |
| 404 | Introuvable | 34  | webhook\_id inexistant ; incohérence entre webhook\_id et application\_id. | Le webhook n’existe pas ou est associé à une application X différente. |
| 409 | Conflit | 355 | Une requête est en cours et doit se terminer avant d’en lancer une autre. | Une tâche de Replay est déjà en cours pour ce webhook. |
| 429 | Trop de requêtes | 88  | Limitation de débit (nombre de requêtes par période dépassé) | Trop de requêtes. Veuillez réduire votre fréquence de requêtes à l’API. |
| 500 | Erreur interne du serveur | 0   | Erreur interne du serveur. | Erreur interne du serveur. |
| 503 | Service indisponible | 67  | Un ou plusieurs services dépendants chez X sont indisponibles. | Erreur du serveur X. Réessayez avec une stratégie de backoff exponentiel. |

<div id="responses">
  #### Message « Tâche terminée avec succès »
</div>

Une fois votre tâche terminée avec succès, l’API Account Activity Replay enverra l’événement de fin de tâche suivant. Une fois cet événement reçu, la tâche a terminé son exécution et vous pouvez en soumettre une autre.

```json
{
  "replay\_job\_status": {
    "webhook_id": "1234577122340233217",
    "job_state": "Complete",
    "job\_state\_description": "Job completed successfully"
    "job_id": "1095098195724558337"
  }
}
```

<div id="job-completed-successfully-message">
  #### Message « Job failed to complete »
</div>

Si votre tâche ne s’achève pas correctement, nous renverrons le message suivant pour vous inviter à relancer votre tâche Replay. Une fois que vous recevez cet événement, la tâche a terminé son exécution et vous pouvez en soumettre une autre.

```json
{
  "replay\_job\_status": {
    "webhook_id": "123451374207332352",
    "job_state": "Incomplete",
    "job\_state\_description": "Job failed to deliver all events, please retry your replay job",
    "job_id": "1093226942650736640"
  }
}
```

<div id="job-failed-to-complete-message">
  #### Exemple de requête curl
</div>

```bash
    curl --request POST  --url 'https://api.x.com/1.1/account_activity/replay/webhooks/:webhook_id/subscriptions/all.json?from_date=yyyymmddhhmm&to_date=yyyymmddhhmm'
    --header 'authorization: Bearer TOKEN'
```

<div id="example-curl-request">
  #### Exemple de réponse
</div>

HTTP 202

```bash
{
  "job_id": "1234567890",
  "created_at": "2016-06-02T23:54:02Z"
}
```