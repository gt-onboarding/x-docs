<div id="v2-account-activity-api-migration-guide">
  # Guide de migration de l’API Account Activity v2
</div>

Ce guide vous aide à migrer de l’API Enterprise Account Activity héritée vers l’API Account Activity v2. Les fonctionnalités essentielles restent identiques, mais la structure des endpoints et les méthodes d’authentification ont été mises à jour pour s’aligner sur l’API X v2.

<div id="summary-of-changes">
  ### Résumé des modifications
</div>

- **Format de l’API** : Les endpoints utilisent le chemin de base /2/account\_activity/ au lieu de /1.1/account\_activity/.
- **Gestion des webhooks** : La création, la liste, la validation (CRC) et la suppression des webhooks sont gérées par la [V2 Webhooks API](https://github.com/m-rosinsky/XWebhookTest/blob/main/app.py).
- **Authentification** : Les endpoints V2 requièrent soit :
  - **OAuthUser** (OAuth à 3 volets) pour les actions spécifiques à un utilisateur (p. ex., abonner un utilisateur).
  - **OAuth2 App Only** (jeton Bearer) pour les actions au niveau de l’application (p. ex., lister/supprimer des abonnements).
  - En V1.1, les exigences variaient, souvent avec OAuth 1.0a.
- **Correspondance des endpoints** :

| Endpoint V1.1 | Équivalent / action V2 | Notes |
| ----- | ----- | ----- |
| POST /1.1/account\_activity/webhooks.json?url=\<URL> | POST /2/webhooks | [Docs](https://docs.x.com/fr/x-api/webhooks/introduction). Requiert OAuth2AppOnly. |
| GET /1.1/account\_activity/webhooks.json | GET /2/webhooks | [Docs](https://docs.x.com/fr/x-api/webhooks/introduction). Requiert OAuth2AppOnly. |
| PUT /1.1/account\_activity/webhooks/:webhook\_id.json | PUT /2/webhooks/:webhook\_id | Déclenche un CRC. [Docs](https://docs.x.com/fr/x-api/webhooks/introduction). Requiert OAuth2AppOnly. |
| DELETE /1.1/account\_activity/webhooks/:webhook\_id.json | DELETE /2/webhooks/:webhook\_id | [Docs](https://docs.x.com/fr/x-api/webhooks/introduction). Requiert OAuth2AppOnly. |
| POST /1.1/account\_activity/webhooks/:webhook\_id/subscriptions/all.json | POST /2/account\_activity/webhooks/:webhook\_id/subscriptions/all | Requiert OAuthUser. |
| GET /1.1/account\_activity/subscriptions/count.json | GET /2/account\_activity/subscriptions/count | Requiert OAuth2AppOnly. |
| GET /1.1/account\_activity/webhooks/:webhook\_id/subscriptions/all.json | GET /2/account\_activity/webhooks/:webhook\_id/subscriptions/all | Requiert OAuthUser. |
| GET /1.1/account\_activity/webhooks/:webhook\_id/subscriptions/all/list.json | GET /2/account\_activity/webhooks/:webhook\_id/subscriptions/all/list | Requiert OAuth2AppOnly. |
| DELETE /1.1/account\_activity/webhooks/:webhook\_id/subscriptions/:user\_id/all | DELETE /2/account\_activity/webhooks/:webhook\_id/subscriptions/:user\_id/all | Requiert OAuth2AppOnly. |
| DELETE /1.1/account\_activity/webhooks/:webhook\_id/subscriptions/all | Obsolète / pas d’équivalent direct | Utilisez des suppressions individuelles ou supprimez le webhook via DELETE /2/webhooks/:webhook\_id. |

- **Formats de réponse** : Consultez les structures de réponses de réussite et d’erreur dans la documentation AAAPI.

Lors de la migration, mettez à jour votre code pour utiliser les nouveaux chemins de base, ajustez les parcours d’authentification et gérez les webhooks à l’aide de la [V2 Webhooks API](https://docs.x.com/fr/x-api/webhooks/introduction).

<div id="how-to-migrate">
  ### Comment migrer
</div>

- **Choisir une offre** :
  - Optez pour l’offre Enterprise ou Pro pour accéder à l’Account Activity API, en tenant compte de :
    - Du nombre de webhooks nécessaires.
    - Des abonnements ou utilisateurs autorisés actuels/prévus.
    - Du nombre d’applications clientes X.
    - Du niveau de support souhaité (forum vs. support entreprise géré en 1:1).
    - Des détails de tarification (contacter l’équipe commerciale pour Enterprise).
- **Mettre à jour votre authentification vers OAuth 2.0** :
  - Assurez-vous que votre application X dispose des autorisations « Read, Write, and Access Direct Messages ».
  - Passez à OAuth 2.0 pour les endpoints V2. Réautorisez les utilisateurs si les scopes ont changé.
  - Utilisez le Developer Portal pour gérer :
    - l’Access Token OAuth 2.0 ;
    - le Client ID et le Client Secret.
- **Vérifier ou reconfigurer votre webhook** :
  - Utilisez votre URL de webhook existante ou configurez-en une nouvelle (p. ex. https://your\_domain.com/webhook/twitter).
  - Suivez la [documentation de l’API Webhooks V2](https://docs.x.com/fr/x-api/webhooks/introduction) pour enregistrer et gérer votre webhook.
- **Exemples d’applications :**
  - [Serveur de webhook simple](https://github.com/m-rosinsky/XWebhookTest/blob/main/app.py)
    - Un script Python unique qui montre comment répondre au contrôle CRC et accepter des événements POST.
  - [Exemple de tableau de bord pour l’Account Activity API](https://github.com/xdevplatform/account-activity-dashboard-enterprise/tree/master)
    - Une application web écrite avec [bun.sh](http://bun.sh) qui vous permet de gérer les webhooks, les abonnements et de recevoir des événements en direct directement dans l’application.