---
title: 受众
---

import { Button } from '/snippets/zh/button.mdx';

<div id="custom-audiences">
  ## 自定义受众
</div>

<div id="overview">
  ### 概览
</div>

合作伙伴可以通过多种方式创建[自定义受众](https://business.x.com/en/targeting/tailored-audiences.html)。

- [受众 API（CRM）](#crm)
- [网页](#web)
- [移动端](#mobile)
- [灵活](#flexible)

请注意，无法在定向中排除相似自定义受众。此外，不能在同一广告项目（广告组）中同时定向某个自定义受众及其相似受众。

**受众管理**

可以通过受众合作伙伴和 Ads API 合作伙伴管理受众。我们在 API 中提供了一系列端点，用于访问和维护自定义受众。

针对自定义受众信息，我们提供 2 个端点：

- [GET accounts/:account\_id/custom\_audiences](/zh/x-ads-api/audiences)
- [GET accounts/:account\_id/custom\_audiences/:custom\_audience\_id](/zh/x-ads-api/audiences)

有关如何上传和管理受众的更多信息，请参阅[受众 API 指南](/zh/x-ads-api/audiences)。

**处理时间**

一般情况下，受众更改会以批处理方式处理，约每 6–8 小时运行一次。在处理期间，待更新的现有受众不受影响。我们不建议在该时间窗口内对每个受众进行超过一次的新增更新和一次的移除更新。

**定向**

仅当某个受众在 X 自有及运营的客户端中匹配到过去 90 天内至少 100 名活跃用户时，才能进行定向。[GET accounts/:account\_id/custom\_audiences/:custom\_audience\_id](/zh/x-ads-api/audiences) 会指示某个受众是否因匹配用户过少而无法定向。

**受众 API（CRM）**

<Frame>
  <img src="https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/images/crm_0.png" alt="image2" />
</Frame>

受众或 API 合作伙伴提供一组哈希标识符，X 进行匹配并生成可用于 X 上媒体投放的细分。合作伙伴可以使用[受众 API](/zh/x-ads-api/audiences)创建这些受众。

**工作原理**

<Frame>
  <img src="https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/images/crm_1.png" alt="image3" />
</Frame>

**网页**

在与 MPP 受众合作伙伴协作时，我们提供标准的 Cookie 匹配流程，用于识别可在 X 上进行媒体投放的目标细分。此外，广告主可以设置 [X Web 事件标签](/zh/x-ads-api/measurement/web-conversions#web-event-tags) 来收集网站用户数据并创建相应的自定义受众。

**设置步骤**

<Frame>
  <img src="https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/images/screen_shot_2013-11-26-cookie-usage.png" alt="image0" />
</Frame>

![]()

**工作原理**

<Frame>
  <img src="https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/images/tailored_audience_web.png" alt="image1" />
</Frame>

**移动端**

详情请参阅[来自移动应用的自定义受众博文](https://blog.x.com/2014/introducing-tailored-audiences-from-mobile-apps)。

**灵活**

[灵活受众](/zh/x-ads-api/audiences)使广告主能够基于现有自定义受众或其子集来构建并保存受众组合。可根据互动的新近度与频率，定向自定义受众成员的子集。

**自定义受众的受限用例**

[进一步了解限制](https://developer.x.com/en/developer-terms/more-on-restricted-use-cases "进一步了解限制")

<div id="audiences-faq">
  ### 受众常见问题[](#real-time-tailored-audiences "Permalink to this headline")
</div>

**问：我们推送了大量数据，为什么受众规模显示为 TOO\_SMALL？**

答：当前数据会实时添加进受众，但用于计算受众规模的作业会在一段时间后才运行。正确的受众规模应在数小时后显示在 UI 中。

**问：我们已完成发送受众数据，并等待了 24 小时或更久，但仍无法定向该受众——下一步该怎么办？**

答：请确认以下事项：

- 传递的用户 ID 是否正确且未格式错误。
- 传递的受众名称是否正确，并与先前的成员更新一致。
- 请确认 POST 命令的响应。
- 请确认已正确部署 ID Sync 像素，并且按 ID Sync 流程，已有足够多的用户访问相关站点以完成用户映射。成员更新中未映射的用户不会转化为可定向用户。

如果以上均已确认无误，请联系 X 产品对接人，并尽可能提供详尽信息（首选信息示例参见[合作伙伴来件指南](/zh/x-ads-api/introduction)）。

**问：我们可以调用该端点多少次，应该使用什么算法？**

答：强烈建议仅发送增量变更，切勿重复发送完整的受众成员列表。系统已验证具备足够吞吐量，可处理全球最大网站的增量数据更新。首次上传应谨慎限速，预计需要较长时间完成。

**问：用于定向的受众最小规模是多少？**

- 受众的最小规模为 100 名用户（匹配后）。如果匹配的受众少于 500 名用户，则不会在 X Ads UI 中提供用于定向。

**问：处理受众文件需要多长时间？受众文件多久能在 X 用户界面中准备就绪？**

- 通常处理受众文件需要 4–6 小时，但取决于文件大小。文件处理完成后，受众会在 X Ads UI 中可用。

**问：匹配率如何计算？**

- 匹配率 = 90 天活跃的 X 用户数 / 提供的用户数

**问：如何测试受众文件是否正常工作？**

- 你可以提供一个测试受众文件，并使用“keltonlynn”作为广告主 handle。我们随后可以验证该文件能否被正确摄取并加载到 X UI 中。

**问：什么是合作伙伴用户标识符（`p_user_id`）？**

- 这是你公司用于唯一标识每位客户的标识符。

**问：什么是标准 ID？**

- 可以是电子邮件地址、设备 ID、X @handle 或（用户）ID。

**问：如何获取 HMAC Key？**

- 我们将通过加密邮件提供。请将你的公钥 PGP 发送至[mpp-inquiry%x.com](mailto:mpp-inquiry%x.com)，我们会先发送测试邮件以验证一切正常。验证通过后，将向你发送 HMAC Key。

**问：如何使用给定的 HMAC Key 验证哈希过程是否正确？**

- X 将提供一个测试文件（包含示例电子邮件地址、设备 ID 等）以及对应的哈希结果文件，供你对照验证。

**问：完整数据匹配文件是否有大小限制？**

- 没有，完整数据匹配文件没有大小限制。

**问：处理完整数据匹配文件需要多长时间？**

- 一旦 X 收到该文件，处理大约需要 1 天。

<div id="crm">
  ### CRM
</div>

<Frame>
  <img src="https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/images/crm_0.png" alt="image0" />
</Frame>

本文档介绍了面向自定义受众的 CRM 合作伙伴的集成细节，包括文件格式和数据交换流程。

**摘要**

Company 将代表某客户向 X 提供经过哈希处理的常见用户标识符（如电子邮件地址）或合作伙伴用户 ID，以执行盲匹配并生成用于定向的 X 用户 ID 列表。用于定向的细分受众将提供给在 ads.x.com 广告系列设置中通过文件名指定的该广告主的特定 @handle。

Company 提供的所有文件将通过 X 为 Company 授予的专用账户，以 IronBox（www.golockbox.com）上的安全包形式提交给 X。X 将提供对 IronBox 的访问权限。IronBox API 的文档可在 [https://secure.goironcloud.com/Docs/Help/](https://secure.goironcloud.com/Docs/Help/) 查阅。

<div id="partner-id-matching-requirements">
  #### 合作伙伴 ID 匹配要求
</div>

如果公司使用自有的标准 ID 系统来跟踪用户（即非电子邮件地址、设备 ID、X 用户 ID 等常见用户标识符），建议按以下流程操作。

**1. 全量数据匹配**

首先，公司需提供一份包含所有用户记录的完整列表，在单个文件中提供与 X 匹配所需的唯一常见用户标识符，用于执行全量数据匹配，并生成由 X 存储的合作伙伴 ID（`p_user_id`）到 X ID（`tw_id`）的映射。该流程将每 2–3 个月定期执行一次，以确保数据持续更新。匹配完成后，X 将通过电子邮件向公司分享该文件的基线匹配率。

该文件的格式要求如下：

命名约定：FullDataMatch.\[CompanyName].txt

哈希算法：HMAC\_SHA-256

格式：

第 1 列：常见标识符的 HMAC 哈希值

第 2 列：合作伙伴用户 ID（对每位用户唯一，但在文件中可重复出现）

列分隔符（CSV）：使用逗号分隔哈希后的常见用户标识符与合作伙伴 ID

按行分隔的取值

- 例如：若用户记录 A 的合作伙伴用户 ID 为 1，且常见标识符为 1、2、3：

|     |     |
| :--- | :--- |
| common user identifier 1 | p\_user\_1 |
| common user identifier 2 | p\_user\_1 |
| common user identifier 3 | p\_user\_1 |

\*有关常见用户标识符，请参见下方“哈希指引”部分

**2. 自定义分群列表**

公司将以 `p_user_id` 的形式提供用户列表，以便为客户在 X 上的定向创建自定义受众。

- 按行分隔的取值
- `p_user_id`
- \*（与上述“1. 全量数据匹配”部分中提供的一致。如果全量数据匹配中提供的是哈希值，则公司需在受众文件中提供相同的哈希值；如果提供的是未哈希值，则在受众文件中亦提供未哈希值。）

<div id="standard-matching-requirements">
  #### 标准匹配要求
</div>

如果公司未使用统一的标准 ID 来映射所有客户的用户标识符，建议采用以下流程。

**自定义分段列表**

公司将代表客户，直接向 X 提供经哈希处理的常见用户标识符列表，用于创建自定义受众。

文件格式应为：

- 按行分隔的值
- 经哈希处理的常见用户标识符（例如电子邮件地址）
- 遵循下方列出的文件命名约定
- 按照下方的电子邮件地址哈希说明（见“哈希说明”）执行

<div id="custom-segment-list-file-naming-operations">
  #### 自定义分段列表的文件命名与操作
</div>

文件的具体操作由其文件名决定。可用操作及通用命名规范如下：audiencename\_partnername.handle.operation.filetype

- audiencename：自定义受众的名称。在 ads.x.com 广告系列设置界面选择受众时显示的名称，例如 brand\_loyalty\_card\_holders。
- partnername：代表广告主上传/提供数据的公司名称，例如 company\_name。
- handle：可访问该自定义受众的 X 账号（@handle），例如 @pepsi、@dietpepsi
- operation：new、add、remove、removeall、replace（详见下文）
- \u003ctimestamp\u003e：标准 Unix 纪元时间（秒），用于确保每个上传的受众文件唯一
- filetype：文件需为 \*.txt 格式

<div id="creating-and-updating-audiences">
  #### 创建与更新受众
</div>

使用单个文件创建新受众，例如：loyalty\_card\_holders\_partnername.pepsi.new.txt

Add - 将列表中的匹配用户添加到现有受众，例如：loyalty\_card\_holders\_partnername.pepsi.add..txt

Remove - 从现有受众中移除列表中的匹配用户，例如：loyalty\_card\_holders\_partnername.pepsi.remove..txt

Remove All - 将定期更新的累计列表所产生的匹配用户从该客户的所有受众中移除（即客户的选择退出名单）。例如：partnername.pepsi.removeall.txt

- 可用于维护一份从该广告主选择退出的用户的完整名单。
- X 仅以此文件中提供的最新名单为准，并在所有现有和后续创建的受众中对已匹配用户生效。

在提供并处理此文件时的 X 用户。

Replace - 删除一个现有受众并用新的受众名单替换。例如：loyalty\_card\_holders\_partnername.pepsi.replace..txt

公司整体选择退出 - 公司将提供一份累计的选择退出文件，用于移除依据公司选择退出政策已选择退出的用户。

X 仅以该公司选择退出文件中的最新名单为准，并在提供并处理该文件时，对所有现有和未来受众中已匹配的 X 用户生效。公司选择退出文件的格式如下：例如：partnername.removeall.txt

Delete - 从当前受众列表中删除一个现有受众，例如：loyalty\_card\_holders\_partnername.pepsi.delete.txt

<div id="hashing-directions">
  #### 哈希说明
</div>

X 将通过 PGP 安全地共享一个用于对常见用户标识符（如电子邮件地址）进行哈希的 base64 编码生产密钥。Company 将对该密钥进行 base64 解码，得到一个 32 字节的密钥，用于执行哈希。

示例 base64 编码密钥：

BrQvOg+dACBUmKjRiNxZgJLh6zydjS0ZOv80FelTNzM=

示例 base64 解码密钥：

/:� TшY

规范化：Company 在哈希之前将对常见用户标识符进行基础规范化（设备 ID 除外，参见“设备 ID 规范化”部分）。

<div id="e-mail-normalization">
  #### 电子邮件规范化
</div>

即去除首尾空格，并将电子邮件地址全部转换为小写。

例如：原始电子邮件地址：testemail\_Organisational\_baseball+884`@`It92I6Ev2B`.`Com

规范化后：testemail\_organisational\_baseball+884`@`it92i6ev2b`.`com

哈希值：74d9584eded0ad1e5572a1c1849f3716751d371d6117a6155dad5363f4b4fbec

注意：编码后的 HMAC 和密钥的字符数会因输入和编码方式而异，因此具体字符数并不固定。

<div id="device-id-normalization">
  #### 设备 ID 规范化
</div>

我们对设备 ID 的哈希有一致要求：使用 SHA-256 哈希算法和我们提供给数据合作伙伴的通用盐值。我们会像处理电子邮件地址一样移除空格，但不会对 IDFA/Android ID 进行小写规范化，并且应使用 IDFA/Android ID 的原始精确格式。

以下是 iOS 与 Android 在哈希之前的设备 ID 原始格式示例：

iOS IDFA: DD99CFF7-6186-4602-9DF2-ED3FD0B2D431

Android ID: b5bf2122961b3595

哈希后的 iOS IDFA: 134fb8cd95c7fd42e2793f469a447198ca5f990968db2dbadad70e723ed9750b

哈希后的 Android ID: 130dddff1939f229476f50bc8adab8fcb7e3525b0e9604fe8effc15e68cee4a4

<div id="x-user-id-normalization">
  #### X 用户 ID 规范化
</div>

即便这不属于 PII，X ID 仍将进行哈希处理，因为数据的分组（例如基于 @handle 的客户名单）对广告主而言是私有的。我们对 X ID 的哈希有相同要求：使用 SHA-256 哈希算法以及我们提供给数据合作伙伴的通用盐值。应从 X ID/`@`username 中去除空格，但 User ID 不需要规范化。为进行规范化，@username 应转换为小写，且不应将 @ 符号计入用户名的一部分。

原始 ID 格式为：

- User ID: 27674040
- @username: testusername

哈希后的 User ID：bf6b57d4e861e83bea8bbed2b800b251a64c95468ee6e8cb07c3368c9ed45e85

哈希后的 @username：12201ae78ad1afa907c7112d17f498154ffb0bf9ea523f5390e072a06d7d9812

<div id="id-sync-integration">
  ### ID 同步集成
</div>

通过 `p_id` 发送数据的合作伙伴必须完成 ID 同步流程，以生成广告主或合作伙伴的用户 ID 与 X 用户 ID 之间的映射。这样广告主即可在 X 上直接定向其自有用户分群。合作伙伴在发送成员更新时还必须将参数 `user_identifier_type` 的值设置为 `TALIST_PARTNER_USER_ID` 或 `TAWEB_PARTNER_USER_ID`。

- **仅限 Web**：可通过在广告主站点上部署像素来实现，详见下文。
- **名单**：可使用 [CRM](/zh/x-ads-api/audiences#crm) 页面中描述的任一方法实现。

<div id="pixel-url">
  #### Pixel URL
</div>

|     |
| :--- |
| **基本 URL** |
| [https://analytics.x.com/i/adsct](https://analytics.x.com/i/adsct) |

<div id="pixel-parameters">
  #### Pixel 参数
</div>

|     |     |
| :--- | :--- |
| **参数** | **说明** |
| `p_id` | X 为你分配的合作伙伴 ID |
| `p_user_id` | 合作伙伴系统中该用户的 ID |

<div id="id-sync-pixel">
  #### ID 同步像素：
</div>

以合作伙伴示例 ID 111 和示例 `p_user_id` 为 abc 为例，构造的像素如下：

```json
    <pre class="brush: xml">
    <img height="1" width="1" src="https://analytics.x.com/i/adsct?p_id=111&p_user_id=abc" style="display:none" />
    </pre>
```

**选择退出文件的配置与发送**

合作伙伴应向 X 提供一份据其所知已选择退出定向广告投放的用户列表。文件格式应为：

|     |     |     |     |
| :--- | :--- | :--- | :--- |
| **列号** | **列名** | **列类型** | **说明** |
| 1   | Partner ID | string | “partner id” 是 X 提供给合作伙伴、用于唯一标识每个合作伙伴的 ID。 |
| 2   | 合作伙伴系统中的用户 ID | string | `p_user_id` 是合作伙伴用于标识用户的唯一 ID。包含这些选择退出用户的文件应通过 [TON upload](/zh/x-ads-api/audiences) 端点上传，且上传数据的路径应发送至全局选择退出端点：[PUT accounts/:account\_id/custom\_audiences/global\_opt\_out](/zh/x-ads-api/audiences)。 |

**发送成员更新**

如我们的端点文档所述，通过 [POST custom\_audience\_memberships](/zh/x-ads-api/audiences) 端点传递用户时，应传递客户 ID 以启用基于 cookie 的匹配。使用 `p_id` 发送数据的合作伙伴**必须**将 `user_identifier_type` 设置为 `TALIST_PARTNER_USER_ID` 或 `TAWEB_PARTNER_USER_ID`。

其他步骤与[实时受众 API 集成指南](/zh/x-ads-api/audiences)中所述一致

<div id="custom-audiences-user-data">
  ### 自定义受众用户数据
</div>

本文档概述了\[自定义受众]/x-ads-api/audiences 用户数据的格式。

**数据规范化**

**设备 ID**：

- IDFA - 使用小写并包含短横线；例如：`4b61639e-47cc-4056-a16a-c8217e029462`
- AdID - 需使用设备上的原始格式，不要大写，并包含短横线；例如：`2f5f5391-3e45-4d02-b645-4575a08f86e`
- Android ID - 需使用设备上的原始格式，不要大写，且不包含短横线或空格；例如：`af3802a465767e36`

**电子邮件地址**：

- 全部小写，移除首尾空格；例如：`support@x.com`

**X 用户名**：

- 不含 @，小写并去除首尾空格；例如：`jack`

**X 用户 ID**：

- 标准整数；例如：`143567`

**数据哈希**

每行数据必须使用 `SHA256` 进行哈希，且不使用盐。此外，最终输出的哈希必须为小写。例如，49e0be2aeccfb51a8dee4c945c8a70a9ac500cf6f5cb08112575f74db9b1470d 而不是 49E0BE2AECCFB51A8DEE4C945C8A70A9AC500CF6F5CB08112575F74DB9B1470D

```
# 使用 Python 对 @AdsAPI 用户进行哈希
import hashlib
hashlib.sha256("adsapi".encode()).hexdigest()

# 输出
49e0be2aeccfb51a8dee4c945c8a70a9ac500cf6f5cb08112575f74db9b1470d
```

更多哈希代码示例可在 [github.com/xdevplatform/ads-platform-tools](https://github.com/xdevplatform/ads-platform-tools) 查阅。

<div id="custom-audiences-web">
  ### 自定义受众：Web
</div>

<Frame>
  <img src="https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/images/info.png" alt="info.png" />
</Frame>

**信息**

合作伙伴将代表广告主发送一份用于定向的 ID（`p_user_ids`）列表。这通过 ID 同步流程完成，该流程建立 `p_user_ids` 与 X 用户 ID 之间的映射。随后使用该映射生成可用于定向的 X 用户 ID 列表。这些自定义受众将通过在 ads.x.com 的 Custom Audiences Web 活动设置中由标签指定的、对应广告主的特定 @handle 提供。

X 将提供安全像素，可部署在合作伙伴的标签与站点上，用于将 ID（`p_user_ids`）匹配到 X 用户 ID。完成 ID 同步流程后，合作伙伴将创建定向文件，并通过 HTTPS 端点提供给 X。X 会定期摄取这些定向文件，并在 X 的 UI 中提供。

**X 安全像素**

X 安全像素如下所示：

https://analytics.x.com/i/adsct?p\_user\_id=xyz\&p\_id=123

**`p_user_id`** - xyz 表示由合作伙伴提供的合作伙伴用户 ID

**`p_id`** - 123 表示该合作伙伴的唯一 ID（由 X 提供）

**合作伙伴 HTTPS 端点与定向用户文件**

合作伙伴需要向 X 提供一个 HTTPS 端点和凭据（用户名/密码），以便定期摄取定向文件。示例 HTTPS 端点如下：

```
https://<partnerdomain>/twitter/partner_targeting_%Y-%M-%D.tsv.gz
```

%Y - 年的格式代码（YYYY）

%M - 月的格式代码（MM）

%D - 日的格式代码（DD）

传输的数据将包含以下文件：

1. 合作伙伴定向用户文件
2. 定向转化文件

所有文件均为 TSV 格式，每行各字段以制表符分隔。有效字段值本身不会包含制表符。

**允许的 X IP 范围：**

以下是可放行访问合作伙伴端点的 IP 范围。

- 199.16.156.0/22
- 199.59.148.0/22

**合作伙伴定向用户文件：**

| **列序号** | **列名** | **列类型** | **描述** |
| :--- | :--- | :--- | :--- |
| 1   | partner id | string | “partner id” 是 X 提供给合作伙伴，用于唯一标识每个合作伙伴的 ID。 |
| 2   | advertiser id | string | “advertiser id” 是广告主的 @handle。 |
| 3   | p\_user\_id | string | “p\_user\_id” 是合作伙伴用于标识用户的唯一 ID。 |
| 3   | confidence score | integer | “confidence score”为可选。建议范围为 0–100。若用于再营销，则分数为“100”表示该用户已被直接再营销；0–99 表示相似人群的置信程度。 |
| 4   | segment label | string | “segment label”为可选。合作伙伴可用其指定产品类别等。建议使用该 “segment label”，因为这是 ads.x.com UI 中自定义受众的人类可读名称。 |

**注意事项：**

每次我们收到新的合作伙伴定向文件时，除非另有约定，我们期望这是合作伙伴建议我们定向的完整用户列表，而非增量。我们将与每个合作伙伴就该文件的交付频率达成一致。如果未按预期收到合作伙伴定向文件，我们将沿用上一版本，并设置预定义的过期时间。

<div id="audience-api-integration">
  ## 受众 API 集成
</div>

<div id="overview">
  ### 概览
</div>

Audience API 作为 Ads API 的 [v4](/zh/x-ads-api/introduction) 的一部分发布，同时对旧版 Audiences 端点带来了多项改进。该新端点由全新的 Audience 处理后端提供支持，在稳定性、健壮性和可靠性方面都有显著提升。本指南旨在重点说明 Audience API 与旧版 Audience 上传与管理流程之间的差异。

参考文档见 [Audience API](/zh/x-ads-api/audiences) 参考页面。

**注意**：所有 Audience 用户数据在上传前必须使用 SHA-256 进行哈希处理。更多细节（包括可接受的用户标识符类型与数据规范化）请参见 [user data](/zh/x-ads-api/audiences) 页面。

**Audience 功能变更**

自 v4 起，对自定义受众引入以下变更；一旦 Ads API 的 v3 停用，所有被弃用的端点将不再可用：

- **已弃用** TON 上传：
  - GET accounts/:account\_id/custom\_audience\_changes
  - GET accounts/:account\_id/custom\_audience\_changes/:custom\_audience\_change\_id
  - POST accounts/:account\_id/custom\_audience\_changes
  - PUT accounts/:account\_id/custom\_audiences/global\_opt\_out
- **已弃用** 实时受众：
  - POST custom\_audience\_memberships
- 自定义受众：
  - 将从所有 [Custom Audience](/zh/x-ads-api/audiences) 端点的请求与响应中移除 `list_type` 参数。此前该参数用于标识受众的用户标识符类型（如 email、X User ID 等），但受众现已能够在同一受众中接受多种用户标识符，因此该值已不再必要。
- 通用：
  - 受众回溯窗口更新为匹配过去 90 天内活跃的用户（原为 30 天）
  - 受众可用于定向所需的最低匹配用户数降至 100（原为 500）

<Note>
  **先决条件**

  - Ads API 访问权限
  - 如需访问 Audience 端点，你需要被加入允许列表。请填写此表单；若你最初接受协议的日期早于 2018-08-01，请接受新的 [X Ads Products and Services Agreement](/zh/x-ads-api/introduction)
</Note>

**Audience 上传流程**

下表列出了新版与旧版 Audience 创建流程的主要差异，更多细节见下文：

| 流程步骤 | Audience API |（已弃用）TON 上传 |
| :--- | :--- | :--- |
| 创建空壳 Audience | 可通过 \[POST custom\_audience endpoint]/x-ads-api/audiences 创建 | 可通过 \[POST custom\_audience endpoint]/x-ads-api/audiences 创建 |
| 添加新用户 | 在 [Audience endpoint](/zh/x-ads-api/audiences) 中使用 `operation_type` `Update` | 在 [POST custom\_audience\_changes](/zh/x-ads-api/audiences) 端点使用 `operation` `ADD` |
| 移除用户 | 在 [Audience endpoint](/zh/x-ads-api/audiences) 中使用 `operation_type` `Delete` | 在 [POST custom\_audience\_changes](/zh/x-ads-api/audiences) 端点使用 `operation` `REMOVE` |
| 用户选择退出 | 在 [Audience endpoint](/zh/x-ads-api/audiences) 中使用 `operation_type` `Delete`，并提供该用户所属的相应 `custom_audience_id` | 使用 [Global opt-out endpoint](/zh/x-ads-api/audiences) |

**注意** 通过 TON 上传路径进行更新或选择退出的任何受众，必须先通过 [TON Upload](/zh/x-ads-api/audiences) 端点上传对应列表，并使用 [custom\_audience\_changes](/zh/x-ads-api/audiences) 端点将其关联到某个 Audience。

**速率限制**

Audience API 端点的速率限制为每个账户 1500/1min。单个有效负载内可发送的用户数量不设上限。对有效负载的唯一约束为：

1\. 操作总数：2500 次

2\. 最大有效负载大小：5,000,000 字节

**Audience 用户管理**

要创建一个新的 Audience，需要完成以下步骤

<div id="create-a-new-custom-audience">
  ### 创建新的自定义受众
</div>

使用 \[POST custom\_audience]/x-ads-api/audiences 端点创建一个新的自定义受众“壳”（shell），并获取相应的自定义受众 `id`。如果要从零创建受众，此步骤必不可少；如果要更新现有受众，请跳至下一节。

<div id="add-users-to-an-audience">
  ### 向受众添加用户
</div>

使用包含自定义受众 `id` 的 [POST accounts/:account\_id/custom\_audiences/:custom\_audience\_id/users](/zh/x-ads-api/audiences) 和如下示例负载：

POST https://ads-api.x.com/11/accounts/18ce54d4x5t/custom\_audiences/1nmth/users

```
    # 所有值都必须进行哈希处理，本示例为演示目的而使用未哈希的值
    [
      {
        "operation_type": "Update",
        "params": {
          "effective_at": "2018-05-15T00:00:00Z",
          "expires_at": "2019-01-01T07:00:00Z",
          "users": [
            {
              "email": [
                "abc@x.com"
              ],
              "handle": [
                "x",
                "adsapi"
              ]
            },
            {
              "email": [
                "edf@x.com"
              ],
              "twitter_id": [
                "121291606",
                "17874544"
              ]
            }
          ]
        }
      }
    ]
```

要将用户添加到受众，请使用 `operation_type` 的 `Update`。新的受众接口支持为单个用户传入多个用户键。JSON 对象数组中的每个对象对应一个用户。基于上述示例负载，该请求将向受众添加两位用户，一位包含 `email` 和 `handle`，另一位包含 `email` 和 `twitter_id`。 

<div id="remove-users-from-an-audience">
  #### 从受众中移除用户
</div>

与添加用户的流程类似，可以按如下方式将用户从受众中移除：

POST https://ads-api.x.com/11/accounts/18ce54d4x5t/custom\_audiences/1nmth/users

```
    # 所有值都必须进行哈希处理，本示例为演示目的而使用未哈希的值
    [
      {
        "operation_type": "Delete",
        "params": {
          "effective_at": "2018-05-15T00:00:00Z",
          "expires_at": "2019-01-01T07:00:00Z",
          "users": [
            {
              "email": [
                "abc@x.com"
              ],
              "twitter_id": [
                "783214",
                "1225933934"
              ]
            },
            {
              "email": [
                "edf@x.com"
              ],
              "twitter_id": [
                "121291606",
                "17874544"
              ]
            }
          ]
        }
      }
    ]
```

`operation_type` 必须设置为 `Delete`，并且系统会根据在添加用户到受众时提供的任意键进行匹配。例如，如果某个用户是使用 `email` 和 `twitter_id` 添加到受众中的，那么移除此用户时可使用其中任意一个键，即 `email` 或 `twitter_id`，或两者同时使用。

此外，也可以在同一个请求中同时向受众添加和移除用户。该端点在一次请求中支持多个 `operation_type`。

<div id="opt-out-users">
  #### 选择退出的用户
</div>

随着全局选择退出端点被弃用，合作伙伴需要对选择退出任何受众的用户执行 `Delete` 操作。可以通过以下几种方式实现：

1. 追踪哪些用户属于哪些受众，并从每个受众中分别移除这些用户。
2. 将该用户从与某个 Ads 账号关联的**所有**受众中移除。

**通用最佳实践**

- 我们强烈建议以近实时的批量方式调用此端点，避免出现处理时间更长的峰值队列，从而减少对系统的不必要负载。同时，这也能让用户更快可用于广告活动定向。
- 成功的 API 调用将返回与请求中接收的 `user` 对象数量相对应的 `success_count` 和 `total_count`。
- 此端点具备原子性：要么整个请求成功，要么在发生任何错误时整个请求失败。出现错误响应时，建议 API 使用方修复错误后，携带完整负载重试请求。
- 发生失败时，建议合作伙伴在重试时采用[指数退避](https://en.wikipedia.org/wiki/Exponential_backoff)策略。例如，第一次失败后立即重试；第二次失败后在 1 分钟后重试；第三次连续失败后在 5 分钟后重试，依此类推。

<div id="api-reference">
  ## API 参考
</div>

<div id="keyword-insights">
  ### 关键词洞察
</div>

<Button href="https://app.getpostman.com/run-collection/1d12b9fc623b8e149f87">
  使用 Postman 运行
</Button>

<div id="get-insightskeywordssearch">
  #### GET insights/keywords/search[](#get-insights-keywords-search "Permalink to this headline")
</div>

给定一组关键词，获取其对应的推文量以及30个相关关键词集合。推文量仅针对输入的关键词，不包含相关关键词。

允许的最大时间范围（`end_time` - `start_time`）为 7 天。

请注意，结果限定为单一地理区域（国家）。

**Resource URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/12/insights/keywords/search`

**Parameters[](#parameters "Permalink to this headline")**

| Name | Description |
| :--- | :--- |
| granularity  <br />_required_ | 指定由 `start_time` 和 `end_time` 表示的时间范围内返回数据的粒度。例如，当设置为 `HOUR` 时，将返回从 `start_time` 到 `end_time` 之间每小时的一个数据点。<br /><br />Type: enum<br /><br />Possible values: `DAY`, `HOUR` |
| keywords  <br />_required_ | 以逗号分隔的关键词字符串，用于收窄搜索范围。所有关键词之间为 OR 关系。<br /><br />**Note**: 最多可使用 10 个关键词（`keywords` 与 `negative_keywords` 合计）。<br /><br />Type: string<br /><br />Example: `developers` |
| start\_time  <br />_required_ | 将检索结果限定为在 `start_time` 与 `end_time` 之间时间窗口内收集的数据。采用 [ISO 8601](https://en.wikipedia.org/wiki/ISO_8601) 格式。<br /><br />Type: string<br /><br />Example: `2017-07-10T00:00:00Z` |
| end\_time  <br />_optional_ | 将检索结果限定为在 `start_time` 与 `end_time` 之间时间窗口内收集的数据。采用 [ISO 8601](https://en.wikipedia.org/wiki/ISO_8601) 格式。<br /><br />**Note**: 默认为当前时间。<br /><br />Type: string<br /><br />Example: `2017-07-11T00:00:00Z` |
| location  <br />_optional_ | 可从 [GET targeting\_criteria/locations](/zh/x-ads-api/campaign-management#get-targeting-criteria-locations) 端点获取的定向值，用于根据账号用户所在位置收窄结果。请注意，目前仅支持国家级位置。<br /><br />Type: string<br /><br />Example: `0ce8b9a7b2742f7e` |
| negative\_keywords  <br />_optional_ | 以逗号分隔的排除关键词字符串。所有排除关键词之间为 OR 关系。<br /><br />**Note**: 最多可使用 10 个关键词（`keywords` 与 `negative_keywords` 合计）。<br /><br />Type: string<br /><br />Example: `rain` |

**Example Request[](#example-request "Permalink to this headline")**

```json
GET https://ads-api.x.com/12/insights/keywords/search?end_time=2018-02-02&granularity=DAY&keywords=developers&start_time=2018-02-01
```

**Example Response[](#example-response "Permalink to this headline")**\*

```
    {
      "request": {
        "params": {
          "start_time": "2018-02-01T00:00:00Z",
          "end_time": "2018-02-02T00:00:00Z",
          "granularity": "DAY",
          "keywords": [
            "developers"
          ]
        }
      },
      "data": {
        "related_keywords": [
          "dev",
          "developer",
          "coders",
          "mysql",
          "devs",
          "#technology",
          "#developers",
          "security",
          "programmers",
          "#tech",
          "javascript",
          "#iot",
          "#bigdata",
          "cloud",
          "devops",
          "php",
          "developer",
          "programmer",
          "engineer",
          "big data",
          "agile",
          "app",
          "programming",
          "ios",
          "maker",
          "startups",
          "developer's",
          "java",
          "#devops",
          "startup"
        ],
        "tweet_volume": [
          15707
        ]
      }
    }
```

<div id="tailored-audience-permissions">
  ### 自定义受众权限
</div>

<Button href="https://app.getpostman.com/run-collection/369a02c0adc626ff6a06#?env%5BTwitter%20Ads%20API%5D=W3sia2V5IjoiYWNjb3VudF9pZCIsInZhbHVlIjoieW91cl9hZHNfYWNjb3VudF9pZCIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoidmVyc2lvbiIsInZhbHVlIjoiNSIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoiY29uc3VtZXJfa2V5IiwidmFsdWUiOiJ5b3VyX2NvbnN1bWVyX2tleSIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoiY29uc3VtZXJfc2VjcmV0IiwidmFsdWUiOiJ5b3VyX2NvbnN1bWVyX3NlY3JldCIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoiYWNjZXNzX3Rva2VuIiwidmFsdWUiOiJ5b3VyX2FjY2Vzc190b2tlbiIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoidG9rZW5fc2VjcmV0IiwidmFsdWUiOiJ5b3VyX3Rva2VuX3NlY3JldCIsImVuYWJsZWQiOnRydWV9XQ==">
  在 Postman 中运行
</Button>

#### GET accounts/:account\_id/tailored\_audiences/:tailored\_audience\_id/permissions[](#get-accounts-account-id-tailored-audiences-tailored-audience-id-permissions "Permalink to this headline")

检索指定定向受众关联的部分或全部权限详情。

**Resource URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/5/accounts/:account_id/tailored_audiences/:tailored_audience_id/permissions`

**Parameters[](#parameters "Permalink to this headline")**

| Name | Description |
| :--- | :--- |
| account\_id  <br />_required_ | 已使用账户的标识符。该值出现在资源路径中，通常是除 [GET accounts](/zh/x-ads-api/campaign-management#accounts) 之外所有 Advertiser API 请求的必需参数。指定账户必须与已认证用户关联。<br /><br />Type: string<br /><br />Example: `18ce54d4x5t` |
| tailored\_audience\_id  <br />_required_ | 本次请求中要操作的定向受众的标识。<br /><br />Type: string<br /><br />Example: `1nmth` |
| count  <br />_optional_ | 指定每个请求尝试检索的记录数量。<br /><br />Type: int<br /><br />Default: `200`  <br />Min, Max: `1`, `1000` |
| cursor  <br />_optional_ | 指定用于获取下一页结果的游标。更多信息参见 [Pagination](/zh/x-ads-api/introduction)。<br /><br />Type: string<br /><br />Example: `8x7v00oow` |
| granted\_account\_ids  <br />_optional_ | 通过提供以逗号分隔的标识符列表，将响应限定为目标账户。最多可提供 200 个 ID。<br /><br />Type: string<br /><br />Example: `18ce54aymz3` |
| sort\_by  <br />_optional_ | 按受支持的属性进行升序或降序排序。更多信息参见 [Sorting](/zh/x-ads-api/introduction)。<br /><br />Type: string<br /><br />Example: `created_at-asc` |
| tailored\_audience\_permission\_ids  <br />_optional_ | 通过提供以逗号分隔的标识符列表，将响应限定为目标定向受众权限。最多可提供 200 个 ID。<br /><br />Type: string<br /><br />Example: `ri` |
| with\_total\_count  <br />_optional_ | 是否包含 `total_count` 响应属性。<br /><br />**Note**: 此参数与 `cursor` 互斥。<br /><br />**Note**: 包含 `total_count` 的请求速率限制更低，目前为每 15 分钟 200 次。<br /><br />Type: boolean<br /><br />Default: `false`  <br />Possible values: `true`, `false` |

**Example Request[](#example-request "Permalink to this headline")**

`GET https://ads-api.x.com/5/accounts/18ce54d4x5t/tailored_audiences/1nmth/permissions`

**Example Response[](#example-response "Permalink to this headline")**

```
    {
      "request": {
        "params": {
          "account_id": "18ce54d4x5t",
          "tailored_audience_id": "1nmth"
        }
      },
      "next_cursor": null,
      "data": [
        {
          "tailored_audience_id": "1nmth",
          "permission_level": "READ_ONLY",
          "id": "ri",
          "created_at": "2017-06-08T23:17:59Z",
          "granted_account_id": "18ce54aymz3",
          "updated_at": "2017-06-08T23:17:59Z",
          "deleted": false
        }
      ]
    }

```

#### POST accounts/:account\_id/tailored\_audiences/:tailored\_audience\_id/permissions[](#post-accounts-account-id-tailored-audiences-tailored-audience-id-permissions "Permalink to this headline")

创建一个新的权限对象，允许将指定受众共享给给定账户。

**注意**：为定制受众创建或修改权限，要求该受众由尝试修改权限的账户所有。您可以通过查看相应受众响应中的 `is_owner` 属性来检查定制受众的归属。

**注意**：受众只能在同一企业下的广告账户之间共享；或者当拥有该受众的广告账户具备 `SHARE_AUDIENCE_OUTSIDE_BUSINESS` 账户功能时，才能共享给企业外的账户。

**Resource URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/5/accounts/:account_id/tailored_audiences/:tailored_audience_id/permissions`

**Parameters[](#parameters "Permalink to this headline")**

| Name | Description |
| :--- | :--- |
| account\_id  <br />_required_ | 被使用的账户标识符。出现在资源路径中，通常是除 [GET accounts](/zh/x-ads-api/campaign-management#accounts) 外所有 Advertiser API 请求所需的参数。指定账户必须与已认证用户关联。<br /><br />Type: string<br /><br />Example: `18ce54d4x5t` |
| granted\_account\_id  <br />_required_ | 您希望授予定制受众权限的目标账户。<br /><br />Type: string<br /><br />Example: `18ce54aymz3` |
| permission\_level  <br />_required_ | `granted_account_id` 对该定制受众应具有的访问级别。<br /><br />Type: enum<br /><br />Possible values: `READ_ONLY`, `READ_WRITE` |
| tailored\_audience\_id  <br />_required_ | 您在此请求中操作的定制受众的引用。<br /><br />Type: string<br /><br />Example: `2906h` |

**Example Request[](#example-request "Permalink to this headline")**

`POST https://ads-api.x.com/5/accounts/18ce54d4x5t/tailored_audiences/2906h/permissions?granted_account_id=18ce54aymz3&permission_level=READ_ONLY`

**Example Response[](#example-response "Permalink to this headline")**

```
    {
      "request": {
        "params": {
          "account_id": "18ce54d4x5t",
          "granted_account_id": "18ce54aymz3",
          "permission_level": "READ_ONLY",
          "tailored_audience_id": "2906h"
        }
      },
      "data": {
        "tailored_audience_id": "2906h",
        "permission_level": "READ_ONLY",
        "id": "14m",
        "created_at": "2017-09-12T23:49:34Z",
        "granted_account_id": "18ce54aymz3",
        "updated_at": "2017-09-12T23:49:34Z",
        "deleted": false
      }
    }
```

#### DELETE accounts/:account\_id/tailored\_audiences/:tailored\_audience\_id/permissions/:tailored\_audience\_permission\_id[](#delete-accounts-account-id-tailored-audiences-tailored-audience-id-permissions-tailored-audience-permission-id "Permalink to this headline")

撤销指定的 Tailored Audience 共享权限。

**注意**：创建或修改某个 Tailored Audience 的权限，要求该受众由尝试修改权限的账户所拥有。您可以通过查看给定受众响应中的 `is_owner` 属性来检查 Tailored Audience 的所有权。

撤销后，我们保证被授予的账户（`granted_account_id`）将无法在后续广告系列中定向该受众。现有广告系列仍会继续使用已共享的受众运行；广告系列不会停止，且该受众不会从广告系列中移除。在撤销受众共享权限后，无法复制该广告系列。

**资源 URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/5/accounts/:account_id/tailored_audiences/:tailored_audience_id/permissions/:tailored_audience_permission_id`

**参数[](#parameters "Permalink to this headline")**

| 名称 | 描述 |
| :--- | :--- |
| account\_id  <br />_必填_ | 目标账户的标识符。该值出现在资源路径中，并且通常是除 [GET accounts](/zh/x-ads-api/campaign-management#accounts) 外所有 Advertiser API 请求所需的参数。指定的账户必须与已通过身份验证的用户关联。<br /><br />类型：string<br /><br />示例：`18ce54d4x5t` |
| tailored\_audience\_id  <br />_必填_ | 您在请求中操作的 Tailored Audience 的标识。<br /><br />类型：string<br /><br />示例：`1nmth` |
| tailored\_audience\_permission\_id  <br />_必填_ | 您在请求中操作的 Tailored Audience 权限的标识。<br /><br />类型：string<br /><br />示例：`ri` |

**示例请求[](#example-request "Permalink to this headline")**

`DELETE https://ads-api.x.com/5/accounts/18ce54d4x5t/tailored_audiences/1nmth/permissions/ri`

**示例响应[](#example-response "Permalink to this headline")**

```
    {
      "request": {
        "params": {
          "account_id": "18ce54d4x5t",
          "tailored_audience_permission_id": "ri",
          "tailored_audience_id": "1nmth"
        }
      },
      "data": {
        "tailored_audience_id": "1nmth",
        "permission_level": "READ_ONLY",
        "id": "ri",
        "created_at": "2017-06-08T23:17:59Z",
        "granted_account_id": "18ce54aymz3",
        "updated_at": "2017-08-30T18:29:35Z",
        "deleted": true
      }
    }
```

<div id="targeted-audiences">
  ### 目标受众
</div>

<Button href="https://app.getpostman.com/run-collection/1d12b9fc623b8e149f87">
  在 Postman 中运行
</Button>

#### GET accounts/:account\_id/custom\_audiences/:custom\_audience\_id/targeted[](#get-accounts-account-id-custom-audiences-custom-audience-id-targeted "此标题的永久链接")

获取针对指定 `custom_audience_id` 的活跃或全部广告组与广告系列的列表

| 名称 | 说明 |
| :--- | :--- |
| account\_id  <br />_必填_ | 被使用账户的标识符。出现在资源路径中，通常是除 [GET accounts](/zh/x-ads-api/campaign-management#accounts) 外所有广告主 API 请求所需的参数。指定的账户必须与已认证用户关联。<br /><br />类型：string<br /><br />示例：`18ce54d4x5t` |
| custom\_audience\_id  <br />_必填_ | 你在该请求中所使用的自定义受众的引用。<br /><br />类型：string<br /><br />示例：`2906h` |
| with\_active  <br />_可选_ | 当为 `false` 时，包含状态为 `servable=false` 的广告组。<br /><br />类型：boolean<br /><br />默认值：`true`  <br />可能的取值：`true`、`false` |
| cursor  <br />_可选_ | 指定用于获取下一页结果的游标。更多信息参见[分页](/zh/x-ads-api/introduction)。  <br />  <br />类型：string  <br />  <br />示例：`8x7v00oow` |

**示例请求[](#example-request "此标题的永久链接")**

`GET https://ads-api.x.com/12/accounts/18ce54d4x5t/custom_audiences/2906h/targeted`

**示例响应[](#example-response "此标题的永久链接")**

```
    {
      "request": {
        "params": {
          "account_id": "18ce54d4x5t",
          "custom_audience_id": "2906h",
        }
      },
      "next_cursor": null,
      "data": [
        {
          "campaign_id": "59hod",
          "campaign_name": "test-campaign",
          "line_items": [
            {
              "id": "5gzog",
              "name": "test-line-item",
              "servable": true
            }
          ]
        },
        {
          "campaign_id": "arja7",
          "campaign_name": "Untitled campaign",
          "line_items": [
            {
              "id": "bjw1q",
              "name": null,
              "servable": true
            }
          ]
        }
      ]
    }
```

<div id="custom-audiences-users">
  ### 自定义受众用户
</div>

<Button href="https://app.getpostman.com/run-collection/1d12b9fc623b8e149f87">
  在 Postman 中运行
</Button>

#### POST accounts/:account\_id/custom\_audiences/:custom\_audience\_id/users[](#post-accounts-account-id-custom-audiences-custom-audience-id-users "Permalink to this headline")

此端点允许合作伙伴向指定的 `custom_audience_id` 添加、更新或移除用户。该端点也支持为每个用户提供多种类型的用户标识符。

请求中 `users` 字段所提供的所有数据，**除** `partner_user_id` 外，必须使用 `SHA256` 进行哈希并先行[规范化](/zh/x-ads-api/audiences#twitter-user-id-normalization)。

**批量请求**

- 当前最大批次大小为 `2500`，**仅适用于此端点**。批次大小由每个请求中的操作数（`Update`/`Delete`）决定。例如，在一个数组中包含超过 2500 个操作对象（`{"operation_type": "Update/Delete", [..] }`）会导致错误。
- 此端点可接受的 POST 请求正文的最大大小为 `5,000,000` 字节。
- 此端点的速率限制为每 1 分钟窗口内 1500 次。
- 所有参数都通过请求正文发送，且 `Content-Type` 必须为 `application/json`。
- 批量请求作为整体成败一致；无论成功还是出错，API 响应都会保留与初始请求一致的项目顺序。

**批量响应**

Ads API 返回的响应包含两个字段：`success_count` 和 `total_count`。这两个值必须始终相等，表示后端已处理的请求记录数。当请求正文中发送的记录数与 `success_count` 和 `total_count` **不**相等时，应视为错误，需要重试。

**批量错误**

- 请求级错误（例如，超过最大批次大小）会在响应的 `errors` 对象中返回。
- 项目级错误（例如，缺少必填参数）会在响应的 `operation_errors` 对象中返回。
- `operation_errors` 中错误的索引对应输入项的索引，并附带相应的错误消息。

<div id="resource-url">
  #### 资源 URL[](#resource-url "Permalink to this headline")
</div>

`https://ads-api.x.com/12/accounts/:account_id/custom_audiences/:custom_audience_id/users`

<div id="parameters">
  #### 参数[](#parameters "Permalink to this headline")
</div>

| 名称 | 说明 |
| :--- | :--- |
| operation\_type  <br />_必填_ | 针对 `users` 组正在执行的操作类型。<br /><br />类型：enum<br /><br />可选值：`Update`、`Delete` |
| params  <br />_必填_ | 一个 JSON 对象，包含 `users` 数组、`effective_at` 和 `expires_at` 时间戳。<br /><br />类型：JSON |
| users  <br />_必填_ | 一个由 JSON 对象组成的数组，包含单个用户的所有参数。<br /><br />类型：JSON |
| effective\_at  <br />_可选_ | 自定义受众关联生效的 UTC 时间。采用 [ISO 8601](https://en.wikipedia.org/wiki/ISO_8601) 表示。默认为当前日期和时间。<br /><br />类型：string<br /><br />示例：`2017-07-05T07:00:00Z` |
| expires\_at  <br />_可选_ | 自定义受众关联失效的 UTC 时间。指定时间必须晚于 `effective_at` 的值。采用 [ISO 8601](https://en.wikipedia.org/wiki/ISO_8601) 表示。默认为自请求时间戳起 13 个月后。<br /><br />类型：string<br /><br />示例：`2017-07-05T07:00:00Z` |

鉴于 `users` 对象采用多键方式，下面对该对象的每个元素进行说明：

| 名称 | 说明 |
| :--- | :--- |
| email  <br />_可选_ | 用户的电子邮件地址。<br /><br />类型：Array\[String] |
| device\_id  <br />_可选_ | IDFA/AdID/Android ID<br /><br />类型：Array\[String] |
| handle  <br />_可选_ | 用户所属的 @handle。<br /><br />类型：Array\[String] |
| twitter\_id  <br />_可选_ | 用户所属的 X ID。<br /><br />类型：Array\[String] |
| phone\_number  <br />_可选_ | 用户的电话号码。<br /><br />类型：Array\[String] |
| partner\_user\_id  <br />_可选_ | 合作伙伴系统中该用户的 ID。<br /><br />类型：Array\[String] |

<div id="example-request">
  #### 示例请求[](#example-request "此标题的永久链接")
</div>

`POST https://ads-api.x.com/12/accounts/18ce54d4x5t/custom_audiences/1nmth/users`

```
    [
      {
        "operation_type": "Update",
        "params": {
          "effective_at": "2018-05-15T00:00:00Z",
          "expires_at": "2019-01-01T07:00:00Z",
          "users": [
            {
              "email": [
                "4798b8bbdcf6f2a52e527f46a3d7a7c9aefb541afda03af79c74809ecc6376f3"
              ],
              "handle": [
                "7352f353c460e74c7ae226952d04f8aa307b12329c5512ec8cb6f1a0f8f9b2cb",
                "49e0be2aeccfb51a8dee4c945c8a70a9ac500cf6f5cb08112575f74db9b1470d"
              ]
            },
            {
              "email": [
                "5bf13d5ad4200407c5bc8b9bb578e425d05ef936fd488e3799a9d0806669223c"
              ],
              "twitter_id": [
                "34d56c7159a7eea941f359653029410f813f65a1d2d13ecc5ccbdd5a8cb755cf",
                "00e7b76c9739dec57f4c4a20ec021a20ffcf26bd00f519b17ea00f0ed6048f85"
              ]
            }
          ]
        }
      },
      {
        "operation_type": "Delete",
        "params": {
          "effective_at": "2018-05-15T00:00:00Z",
          "expires_at": "2019-01-01T07:00:00Z",
          "users": [
            {
              "device_id": [
                "8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92"
              ],
              "email": [
                "4798b8bbdcf6f2a52e527f46a3d7a7c9aefb541afda03af79c74809ecc6376f3"
              ],
              "handle": [
                "461222f5dd690a20651c3d19848015cb0369db3f8e937571ffb775de70750847"
              ],
              "twitter_id": [
                "c623c7e163984493b46c547088542e95d0aaa529bc52bbecce3ff91eb6b7843b"
              ]
            },
            {
              "email": [
                "5bf13d5ad4200407c5bc8b9bb578e425d05ef936fd488e3799a9d0806669223c"
              ],
              "twitter_id": [
                "858cdc7f313f84a3f3c48e9a6323307c1ef1bb7439b8e3623e140454b0fd8fa5",
                "bb074e154657b91d99bd1bb3757409149670e8ae7a0fe9136fae29a26a7881c8"
              ]
            }
          ]
        }
      }
    ]
```

<div id="example-response">
  #### 示例响应[](#example-response "Permalink to this headline")
</div>

```
    {
      "request": {
        "params": {
          "account_id": "18ce54d4x5t",
          "custom_audience_id": "1nmth"
        }
      },
      "data": {
        "success_count": 4,
        "total_count": 4
      }
    }
```

<div id="tailored-audience-permissions">
  ### 自定义受众权限
</div>

<Button href="https://app.getpostman.com/run-collection/369a02c0adc626ff6a06#?env%5BTwitter%20Ads%20API%5D=W3sia2V5IjoiYWNjb3VudF9pZCIsInZhbHVlIjoieW91cl9hZHNfYWNjb3VudF9pZCIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoidmVyc2lvbiIsInZhbHVlIjoiNSIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoiY29uc3VtZXJfa2V5IiwidmFsdWUiOiJ5b3VyX2NvbnN1bWVyX2tleSIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoiY29uc3VtZXJfc2VjcmV0IiwidmFsdWUiOiJ5b3VyX2NvbnN1bWVyX3NlY3JldCIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoiYWNjZXNzX3Rva2VuIiwidmFsdWUiOiJ5b3VyX2FjY2Vzc190b2tlbiIsImVuYWJsZWQiOnRydWV9LHsia2V5IjoidG9rZW5fc2VjcmV0IiwidmFsdWUiOiJ5b3VyX3Rva2VuX3NlY3JldCIsImVuYWJsZWQiOnRydWV9XQ==">
  在 Postman 中运行
</Button>

#### GET accounts/:account\_id/custom\_audiences/:custom\_audience\_id/permissions[](#get-accounts-account-id-custom-audiences-custom-audience-id-permissions "Permalink to this headline")

检索与指定自定义受众关联的部分或全部权限的详细信息。

**Resource URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/12/accounts/:account_id/custom_audiences/:custom_audience_id/permissions`

**Parameters[](#parameters "Permalink to this headline")**

| Name | Description |
| :--- | :--- |
| account\_id  <br />_required_ | 被使用的账户标识符。出现在资源路径中，且通常是除 [GET accounts](/zh/x-ads-api/campaign-management#accounts) 之外所有 Advertiser API 请求的必需参数。指定的账户必须与已认证用户关联。<br /><br />Type: string<br /><br />Example: `18ce54d4x5t` |
| custom\_audience\_id  <br />_required_ | 本次请求中所操作的自定义受众的引用。<br /><br />Type: string<br /><br />Example: `1nmth` |
| count  <br />_optional_ | 指定每个请求尝试检索的记录数量。<br /><br />Type: int<br /><br />Default: `200`  <br />Min, Max: `1`, `1000` |
| cursor  <br />_optional_ | 指定用于获取下一页结果的游标。参见 [Pagination](/zh/x-ads-api/introduction) 了解更多信息。<br /><br />Type: string<br /><br />Example: `8x7v00oow` |
| granted\_account\_ids  <br />_optional_ | 通过提供以逗号分隔的标识符列表，将响应限定为所需的账户。最多可提供 200 个 ID。<br /><br />Type: string<br /><br />Example: `18ce54aymz3` |
| sort\_by  <br />_optional_ | 按受支持的属性以升序或降序排序。参见 [Sorting](/zh/x-ads-api/fundamentals/sorting) 了解更多信息。<br /><br />Type: string<br /><br />Example: `created_at-asc` |
| custom\_audience\_permission\_ids  <br />_optional_ | 通过提供以逗号分隔的标识符列表，将响应限定为所需的自定义受众权限。最多可提供 200 个 ID。<br /><br />Type: string<br /><br />Example: `ri` |
| with\_total\_count  <br />_optional_ | 是否包含 `total_count` 响应属性。<br /><br />**Note**: 此参数与 `cursor` 互斥。<br /><br />**Note**: 包含 `total_count` 的请求将具有更低的速率上限，目前为每 15 分钟 200 次。<br /><br />Type: boolean<br /><br />Default: `false`  <br />Possible values: `true`, `false` |

**Example Request[](#example-request "Permalink to this headline")**

`GET https://ads-api.x.com/12/accounts/18ce54d4x5t/custom_audiences/1nmth/permissions`

**Example Response[](#example-response "Permalink to this headline")**

```
    {
      "request": {
        "params": {
          "account_id": "18ce54d4x5t",
          "custom_audience_id": "1nmth"
        }
      },
      "next_cursor": null,
      "data": [
        {
          "custom_audience_id": "1nmth",
          "permission_level": "READ_ONLY",
          "id": "ri",
          "created_at": "2017-06-08T23:17:59Z",
          "granted_account_id": "18ce54aymz3",
          "updated_at": "2017-06-08T23:17:59Z",
          "deleted": false
        }
      ]
    }
```

#### POST accounts/:account\_id/custom\_audiences/:custom\_audience\_id/permissions[](#post-accounts-account-id-custom-audiences-custom-audience-id-permissions "Permalink to this headline")

创建一个新的权限对象，允许将指定受众与给定账户共享。

**注意**：为自定义受众创建或修改权限，要求该受众由尝试修改权限的账户所有。您可以在该受众的响应中查看 `is_owner` 属性以验证所有权。

**注意**：受众只能在同一企业下的广告账户之间共享；或当拥有该受众的广告账户启用了 `SHARE_AUDIENCE_OUTSIDE_BUSINESS` 账户功能时，才能共享到企业外的广告账户。

**Resource URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/12/accounts/:account_id/custom_audiences/:custom_audience_id/permissions`

**Parameters[](#parameters "Permalink to this headline")**

| Name | Description |
| :--- | :--- |
| account\_id  <br />_required_ | 被使用的账户标识符。出现在资源路径中，且通常是除 [GET accounts](/zh/x-ads-api/campaign-management#accounts) 之外所有 Advertiser API 请求所需的参数。指定的账户必须与已认证用户关联。<br /><br />Type: string<br /><br />Example: `18ce54d4x5t` |
| granted\_account\_id  <br />_required_ | 你希望授予自定义受众权限的账户。<br /><br />Type: string<br /><br />Example: `18ce54aymz3` |
| permission\_level  <br />_required_ | `granted_account_id` 应获得的针对该自定义受众的访问级别。<br /><br />Type: enum<br /><br />Possible values: `READ_ONLY`, `READ_WRITE` |
| custom\_audience\_id  <br />_required_ | 你在该请求中所操作的自定义受众的标识。<br /><br />Type: string<br /><br />Example: `2906h` |

**Example Request[](#example-request "Permalink to this headline")**

```
POST https://ads-api.x.com/12/accounts/18ce54d4x5t/custom_audiences/2906h/permissions?granted_account_id=18ce54aymz3&permission_level=READ_ONLY
```

**Example Response[](#example-response "Permalink to this headline")**

```
    {
      "request": {
        "params": {
          "account_id": "18ce54d4x5t",
          "granted_account_id": "18ce54aymz3",
          "permission_level": "READ_ONLY",
          "custom_audience_id": "2906h"
        }
      },
      "data": {
        "custom_audience_id": "2906h",
        "permission_level": "READ_ONLY",
        "id": "14m",
        "created_at": "2017-09-12T23:49:34Z",
        "granted_account_id": "18ce54aymz3",
        "updated_at": "2017-09-12T23:49:34Z",
        "deleted": false
      }
    }
```

#### DELETE accounts/:account\_id/custom\_audiences/:custom\_audience\_id/permissions/:custom\_audience\_permission\_id[](#delete-accounts-account-id-custom-audiences-custom-audience-id-permissions-custom-audience-permission-id "Permalink to this headline")

撤销指定的自定义受众共享权限。

**注意**：创建或修改自定义受众的权限要求该受众归尝试修改权限的账户所有。您可以通过查看某个受众返回结果中的 `is_owner` 响应属性来检查该自定义受众的所有权。

撤销后，我们保证被授予的账户（`granted_account_id`）将无法在后续广告系列中定向该受众。现有广告系列将继续使用已共享的受众；广告系列不会停止，且不会从广告系列中移除该受众。在撤销受众共享权限后，将无法复制此广告系列。

**资源 URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/12/accounts/:account_id/custom_audiences/:custom_audience_id/permissions/:custom_audience_permission_id`

**参数[](#parameters "Permalink to this headline")**

| 名称 | 描述 |
| :--- | :--- |
| account\_id  <br />_必填_ | 要使用的账户标识符。出现在资源路径中，并且通常是所有广告主 API 请求（不包括 [GET accounts](/zh/x-ads-api/campaign-management#accounts)）的必填参数。指定的账户必须与已认证用户关联。<br /><br />类型：string<br /><br />示例：`18ce54d4x5t` |
| custom\_audience\_id  <br />_必填_ | 您在请求中操作的自定义受众的引用。<br /><br />类型：string<br /><br />示例：`1nmth` |
| custom\_audience\_permission\_id  <br />_必填_ | 您在请求中操作的自定义受众权限的引用。<br /><br />类型：string<br /><br />示例：`ri` |

**示例请求[](#example-request "Permalink to this headline")**

`DELETE https://ads-api.x.com/12/accounts/18ce54d4x5t/custom_audiences/1nmth/permissions/ri`

**示例响应[](#example-response "Permalink to this headline")**

```
    {
      "request": {
        "params": {
          "account_id": "18ce54d4x5t",
          "custom_audience_permission_id": "ri",
          "custom_audience_id": "1nmth"
        }
      },
      "data": {
        "custom_audience_id": "1nmth",
        "permission_level": "READ_ONLY",
        "id": "ri",
        "created_at": "2017-06-08T23:17:59Z",
        "granted_account_id": "18ce54aymz3",
        "updated_at": "2017-08-30T18:29:35Z",
        "deleted": true
      }
    }
```

<div id="custom-audiences">
  ### 自定义受众
</div>

<Button href="https://app.getpostman.com/run-collection/1d12b9fc623b8e149f87">
  使用 Postman 运行
</Button>

#### GET accounts/:account\_id/custom\_audiences[](#get-accounts-account-id-custom-audiences "Permalink to this headline")

检索与当前账户关联的部分或全部自定义受众的详细信息。

**Resource URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/12/accounts/:account_id/custom_audiences`

**Parameters[](#parameters "Permalink to this headline")**

| Name | Description |
| :--- | :--- |
| account\_id  <br />_required_ | 被使用账户的标识符。出现在资源路径中，且通常是除 [GET accounts](/zh/x-ads-api/campaign-management#accounts) 外所有广告主 API 请求所必需的参数。指定的账户必须与已认证用户关联。<br /><br />Type: string<br /><br />Example: `18ce54d4x5t` |
| count  <br />_optional_ | 指定每个请求尝试检索的记录数。<br /><br />Type: int<br /><br />Default: `200`  <br />Min, Max: `1`, `1000` |
| cursor  <br />_optional_ | 指定用于获取下一页结果的游标。更多信息参见 [Pagination](/zh/x-ads-api/introduction)。<br /><br />Type: string<br /><br />Example: `8x7v00oow` |
| permission\_scope  <br />_optional_ | 将响应过滤为你拥有的列表或与您共享的列表。默认情况下，如果未指定此参数，你只会看到你拥有的受众。<br /><br />Type: enum<br /><br />Default: `OWNER`  <br />Possible values: `OWNER`, `SHARED` |
| q  <br />_optional_ | 按 `name` 限定资源的可选查询。<br /><br />**Note**: 执行不区分大小写的前缀匹配。<br /><br />Type: string<br /><br />Min, Max length: `1`, `255` |
| sort\_by  <br />_optional_ | 按受支持的属性进行升序或降序排序。更多信息参见 [Sorting](/zh/x-ads-api/fundamentals/sorting)。<br /><br />Type: string<br /><br />Example: `created_at-asc` |
| custom\_audience\_ids  <br />_optional_ | 通过指定逗号分隔的标识符列表，将响应限定为所需的自定义受众。最多可提供 200 个 ID。<br /><br />Type: string<br /><br />Example: `1nmth` |
| with\_deleted  <br />_optional_ | 在请求中包含已删除的结果。<br /><br />Type: boolean<br /><br />Default: `false`  <br />Possible values: `true`, `false` |
| with\_total\_count  <br />_optional_ | 包含 `total_count` 响应属性。<br /><br />**Note**: 此参数与 `cursor` 互斥。<br /><br />**Note**: 包含 `total_count` 的请求将具有更低的速率限制，目前为每 15 分钟 200 次。<br /><br />Type: boolean<br /><br />Default: `false`  <br />Possible values: `true`, `false` |

**Example Request[](#example-request "Permalink to this headline")**

`GET https://ads-api.x.com/12/accounts/18ce54d4x5t/custom_audiences?custom_audience_ids=1nmth`

**Example Response[](#example-response "Permalink to this headline")**

```
    {
      "request": {
        "params": {
          "custom_audience_ids": [
            "1nmth"
          ],
          "account_id": "18ce54d4x5t"
        }
      },
      "next_cursor": null,
      "data": [
        {
          "targetable": true,
          "name": "twurl-using-subshell-for-file",
          "targetable_types": [
            "CRM",
            "EXCLUDED_CRM"
          ],
          "audience_type": "CRM",
          "description": null,
          "permission_level": "READ_WRITE",
          "owner_account_id": "18ce54d4x5t",
          "id": "1nmth",
          "reasons_not_targetable": [],
          "created_at": "2017-01-08T08:19:58Z",
          "updated_at": "2017-01-08T16:21:13Z",
          "partner_source": "OTHER",
          "deleted": false,
          "audience_size": 1470
        }
      ]
    }
```

#### GET accounts/:account\_id/custom\_audiences/:custom\_audience\_id[](#get-accounts-account-id-custom-audiences-custom-audience-id "Permalink to this headline")

检索与当前账户关联的指定自定义受众。

**Resource URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/12/accounts/:account_id/custom_audiences/:custom_audience_id`

**Parameters[](#parameters "Permalink to this headline")**

| Name | Description |
| :--- | :--- |
| account\_id  <br />_required_ | 被操作账户的标识符。该值出现在资源路径中，且通常是除 [GET accounts](/zh/x-ads-api/campaign-management#accounts) 外所有 Advertiser API 请求所必需的参数。指定的账户必须与已认证用户关联。<br /><br />Type: string<br /><br />Example: `18ce54d4x5t` |
| custom\_audience\_id  <br />_required_ | 本次请求中所操作的自定义受众的标识符。<br /><br />Type: string<br /><br />Example: `2906h` |
| with\_deleted  <br />_optional_ | 是否在结果中包含已删除项。<br /><br />Type: boolean<br /><br />Default: `false`  <br />Possible values: `true`, `false` |

**Example Request[](#example-request "Permalink to this headline")**

`GET https://ads-api.x.com/12/accounts/18ce54d4x5t/custom_audiences/2906h`

**Example Response[](#example-response "Permalink to this headline")**

```
    {
      "request": {
        "params": {
          "custom_audience_id": "2906h",
          "account_id": "18ce54d4x5t"
        }
      },
      "data": {
        "targetable": false,
        "name": "developers",
        "targetable_types": [
          "CRM",
          "EXCLUDED_CRM"
        ],
        "audience_type": "CRM",
        "description": null,
        "permission_level": "READ_WRITE",
        "owner_account_id": "18ce54d4x5t",
        "id": "2906h",
        "reasons_not_targetable": [],
        "created_at": "2017-08-22T23:34:26Z",
        "updated_at": "2017-08-22T23:34:26Z",
        "partner_source": "OTHER",
        "deleted": false,
        "audience_size": 140321
      }
    }
```

#### POST accounts/:account\_id/custom\_audiences[](#post-accounts-account-id-custom-audiences "此标题的永久链接")

为当前账户创建一个新的占位用 自定义受众。

**资源 URL[](#resource-url "此标题的永久链接")**

`https://ads-api.x.com/12/accounts/:account_id/custom_audiences`

**参数[](#parameters "此标题的永久链接")**

| 名称 | 描述 |
| :--- | :--- |
| account\_id  <br />_必填_ | 目标账户的标识符。出现在资源路径中，且通常是除 [GET accounts](/zh/x-ads-api/campaign-management#accounts) 之外所有广告主 API 请求的必填参数。指定的账户必须与已认证用户关联。<br /><br />类型：string<br /><br />示例：`18ce54d4x5t` |
| name  <br />_必填_ | 此受众的显示名称。必须使用唯一名称，否则会返回错误。<br /><br />类型：string<br /><br />示例：`ads api users` |
| description  <br />_可选_ | 此受众的描述。<br /><br />类型：string<br /><br />示例：`Collection of all users of the Ads API` |

**示例请求[](#example-request "此标题的永久链接")**

`POST https://ads-api.x.com/12/accounts/18ce54d4x5t/custom_audiences?name=developers`

**示例响应[](#example-response "此标题的永久链接")**

```
    {
      "data": {
        "targetable": false,
        "name": "developers",
        "targetable_types": [
          "CRM",
          "EXCLUDED_CRM"
        ],
        "audience_type": "CRM",
        "description": null,
        "permission_level": "READ_WRITE",
        "owner_account_id": "18ce54d4x5t",
        "id": "2906h",
        "reasons_not_targetable": [
          "PROCESSING",
          "TOO_SMALL"
        ],
        "created_at": "2017-08-22T23:34:26Z",
        "updated_at": "2017-08-22T23:34:26Z",
        "partner_source": "OTHER",
        "deleted": false,
        "audience_size": null
      },
      "request": {
        "params": {
          "account_id": "18ce54d4x5t",
          "name": "developers"
        }
      }
    }
```

#### PUT accounts/:account\_id/custom\_audiences/:custom\_audience\_id[](#put-accounts-account-id-custom-audiences-custom-audience-id "Permalink to this headline")

更新当前账户关联的特定自定义受众。

**Resource URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/12/accounts/:account_id/custom_audiences/:custom_audience_id`

**Parameters[](#parameters "Permalink to this headline")**

| Name | Description |
| :--- | :--- |
| account\_id  <br />_required_ | 被使用的账户标识符。出现在资源路径中，且通常是除 [GET accounts](/zh/x-ads-api/campaign-management#accounts) 以外所有 Advertiser API 请求所必需的参数。指定的账户必须与已认证用户关联。<br /><br />Type: string<br /><br />Example: `18ce54d4x5t` |
| custom\_audience\_id  <br />_required_ | 本次请求中要操作的自定义受众的标识。<br /><br />Type: string<br /><br />Example: `2906h` |
| name  <br />_optional_ | 此受众的显示名称。必须使用唯一的名称值，否则将返回错误。<br /><br />Type: string<br /><br />Example: `ads api users` |
| description  <br />_optional_ | 此受众的描述。<br /><br />Type: string<br /><br />Example: `Collection of all users of the Ads API` |

**Example Request[](#example-request "Permalink to this headline")**

`PUT https://ads-api.x.com/12/accounts/18ce54d4x5t/custom_audiences/2906h?name=developers_changed`

**Example Response[](#example-response "Permalink to this headline")**

```
    {
      "data": {
        "targetable": false,
        "name": "developers_changed",
        "targetable_types": [
          "CRM",
          "EXCLUDED_CRM"
        ],
        "audience_type": "CRM",
        "description": null,
        "permission_level": "READ_WRITE",
        "is_owner": true,
        "id": "2906h",
        "reasons_not_targetable": [
          "PROCESSING",
          "TOO_SMALL"
        ],
        "created_at": "2017-08-22T23:34:26Z",
        "updated_at": "2017-08-22T23:34:26Z",
        "partner_source": "OTHER",
        "deleted": false,
        "audience_size": null
      },
      "request": {
        "params": {
          "account_id": "18ce54d4x5t",
          "name": "developers_changed"
        }
      }
    }
```

#### POST batch/accounts/:account\_id/custom\_audiences[](#post-batch-accounts-account-id-custom-audiences "Permalink to this headline")

允许批量创建自定义受众。有关受众的更多信息，请参阅[自定义受众概览](/zh/x-ads-api/audiences)页面。

**注意：** 此批量端点目前处于**封闭测试**阶段，仅向部分广告主开放。在此测试期间，仅支持基于移动端自定义受众创建灵活受众。

**批量请求**

- 当前最大批量大小为 10。
- 所有参数通过请求正文发送，且必须使用 `application/json` 的 `Content-Type`。
- 批量请求作为整体共同成功或失败；无论成功还是出错，所有 API 响应都会保留与初始请求相同的项目顺序。

**批量响应**

批量 API 响应会返回按顺序排列的项目集合。除此之外，它们在结构上与相应的单项目端点一致。

**批量错误**

- 请求级错误（例如超出最大批量大小）会在响应中的 `errors` 对象下显示。
- 项目级错误（例如缺少必填参数）会在响应中的 `operation_errors` 对象下显示。

**灵活受众**

<Button href="https://app.getpostman.com/run-collection/1d12b9fc623b8e149f87">
  在 Postman 中运行
</Button>

- 灵活受众一经创建便不可更改。
- 通过包含布尔逻辑组合的树形结构传递自定义受众，以创建灵活受众。
- 创建一个灵活受众最多可使用 10 个自定义受众叶节点。

**资源 URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/12/batch/accounts/:account_id/custom_audiences`

**参数[](#parameters "Permalink to this headline")**

| 名称 | 说明 |
| :--- | :--- |
| account\_id  <br />_必填_ | 被使用的账户标识符。出现在资源路径中，通常是除 [GET accounts](/zh/x-ads-api/campaign-management#accounts) 之外所有广告主 API 请求所需的参数。指定的账户必须与已认证用户关联。<br /><br />类型：string<br /><br />示例：`18ce54d4x5t` |
| audience\_type  <br />_必填_ | 要创建的受众类型。<br /><br />类型：enum<br /><br />可能的取值：`FLEXIBLE`, `MOBILE_AUDIENCE` |
| child\_segments  <br />_必填_ | 一个数组，包含用于定义你希望定向的自定义受众成员子集的对象。每个对象应包含 `custom_audience_id`、`frequency`、`frequency_comparator`、`lookback_window`、`negate`，以及在某些情况下额外的 `child_segments`。<br /><br />类型：array |
| name  <br />_必填_ | 受众的显示名称。必须使用唯一的名称值，否则会导致错误。<br /><br />类型：string<br /><br />示例：`my_flexible_audience_name` |
| operation\_type  <br />_必填_ | 对每个条目执行的操作类型。<br /><br />类型：enum<br /><br />可能的取值：`Create`, `Update`, `Delete` |
| boolean\_operator  <br />_有时必填_ | 在其父（包含）对象中子分段之间的逻辑关系。如果父对象的 child\_segments 非空，则为必填。<br /><br />类型：enum<br /><br />可能的取值：`AND`, `OR` |
| lookback\_window  <br />_有时必填_ | 一个整数值，指定用户在多少天范围内采取了特定动作并满足给定自定义受众的条件。<br /><br />类型：int<br /><br />可能的取值：`1`, `7`, `14`, `30` |
| segments  <br />_有时必填_ | 一个对象，包含 `boolean_operator` 和 `child_segments`，用于定义你希望定向的自定义受众成员子集。<br /><br />类型：object |
| custom\_audience\_id  <br />_有时必填_ | 作为子分段使用的自定义受众 ID。<br /><br />类型：string<br /><br />示例：`tyfo` |
| frequency  <br />_可选_ | 一个整数值，指定在回溯窗口内用户采取特定动作并满足给定自定义受众条件的次数。<br /><br />类型：int<br /><br />默认值：`1` |
| frequency\_comparator  <br />_可选_ | 与请求中传入的 `frequency` 进行比较的比较符。<br /><br />注意：下列取值中，`GTE` 表示大于等于，`LT` 表示小于，依此类推。<br /><br />类型：string<br /><br />可能的取值：`NUM_GTE`, `NUM_GT`, `NUM_EQ`, `NUM_LTE`, `NUM_LT` 默认值：`NUM_GTE` |
| negate  <br />_可选_ | 将该分段取反，从而在组合中被排除。<br /><br />类型：boolean<br /><br />默认值：`true`  <br />可能的取值：`true`, `false` |

**示例请求[](#example-request "Permalink to this headline")**

`POST https://ads-api.x.com/12/batch/accounts/18ce54d4x5t/custom_audiences`

```
    [
      {
        "operation_type":"Create",
        "params":{
          "name":"my_flexible_audience_name",
          "audience_type":"FLEXIBLE",
          "segments":{
            "boolean_operator":"AND",
            "child_segments":[
              {
                "custom_audience_id":"TYIF",
                "frequency":1,
                "frequency_comparator":"NUM_GT",
                "lookback_window":30,
                "negate":true,
                "child_segments":[

                ]
              },
              {
                "boolean_operator":"OR",
                "child_segments":[
                  {
                    "custom_audience_id":"TXR1",
                    "lookback_window":30,
                    "child_segments":[

                    ]
                  },
                  {
                    "custom_audience_id":"TYFO",
                    "frequency":1,
                    "frequency_comparator":"NUM_GT",
                    "lookback_window":30,
                    "negate":true,
                    "child_segments":[

                    ]
                  }
                ]
              }
            ]
          }
        }
      }
    ]
```

**示例响应[](#example-response "Permalink to this headline")**

```
    {
      "data": {
        "targetable": false,
        "name": "my_flexible_audience_name",
        "targetable_types": [
          "FLEXIBLE",
          "EXCLUDED_FLEXIBLE"
        ],
        "audience_type": "FLEXIBLE",
        "id": "13ld7",
        "reasons_not_targetable": [
          "PROCESSING",
          "TOO_SMALL"
        ],
        "metadata": [
          {
            "custom_audience_id": "13ld7",
            "account_id": "qsx3w2",
            "name": "my_flexible_audience_name",
            "audience_source": "FLEXIBLE_AUDIENCE",
            "upload_status": "UPLOADED",
            "segments": {
              "boolean_operator": "AND",
              "frequency": 1,
              "frequency_comparator": "NUM_GTE",
              "negate": false,
              "child_segments": [
                {
                  "custom_audience_id": "tyif",
                  "lookback_window": 30,
                  "frequency": 1,
                  "frequency_comparator": "NUM_GT",
                  "negate": true,
                  "child_segments": [

                  ]
                },
                {
                  "boolean_operator": "OR",
                  "frequency": 1,
                  "frequency_comparator": "NUM_GTE",
                  "negate": false,
                  "child_segments": [
                    {
                      "custom_audience_id": "txr1",
                      "lookback_window": 30,
                      "frequency": 1,
                      "frequency_comparator": "NUM_GTE",
                      "negate": false,
                      "child_segments": [

                      ]
                    },
                    {
                      "custom_audience_id": "tyfo",
                      "lookback_window": 30,
                      "frequency": 1,
                      "frequency_comparator": "NUM_GT",
                      "negate": true,
                      "child_segments": [

                      ]
                    }
                  ]
                }
              ]
            }
          }
        ],
        "created_at": "2015-11-10T21:26:43Z",
        "updated_at": "2015-11-11T01:11:47Z",
        "partner_source": "OTHER",
        "deleted": false,
        "audience_size": null
      },
      "request": [
        {
          "params": {
            "name": "my_flexible_audience_name",
            "audience_type": "FLEXIBLE",
            "segments": {
              "boolean_operator": "AND",
              "child_segments": [
                {
                  "custom_audience_id": "TYIF",
                  "lookback_window": 30,
                  "frequency": 1,
                  "frequency_comparator": "NUM_GT",
                  "negate": true,
                  "child_segments": -

                  ]
                },
                {
                  "boolean_operator": "OR",
                  "child_segments": [
                    {
                      "custom_audience_id": "TXR1",
                      "lookback_window": 30,
                      "child_segments": [

                      ]
                    },
                    {
                      "custom_audience_id": "TYFO",
                      "lookback_window": 30,
                      "frequency": 1,
                      "frequency_comparator": "NUM_GT",
                      "negate": true,
                      "child_segments": [

                      ]
                    }
                  ]
                }
              ]
            },
            "account_id": "qsx3w2"
          },
          "operation_type": "Create"
        }
      ]
    }
```

#### DELETE accounts/:account\_id/custom\_audiences/:custom\_audience\_id[](#delete-accounts-account-id-custom-audiences-custom-audience-id "Permalink to this headline")

删除当前账户下的指定自定义受众。

**资源 URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/12/accounts/:account_id/custom_audiences/:custom_audience_id`

**参数[](#parameters "Permalink to this headline")**

| 名称 | 说明 |
| :--- | :--- |
| account\_id  <br />_必填_ | 目标账户的标识符。该参数出现在资源路径中，通常是所有广告主 API 请求（[GET accounts](/zh/x-ads-api/campaign-management#accounts) 除外）的必填项。指定的账户必须与已认证用户关联。<br /><br />类型：string<br /><br />示例：`18ce54d4x5t` |
| custom\_audience\_id  <br />_必填_ | 本次请求所操作的自定义受众的标识。<br /><br />类型：string<br /><br />示例：`2906h` |

**示例请求[](#example-request "Permalink to this headline")**

`DELETE https://ads-api.x.com/12/accounts/18ce54d4x5t/custom_audiences/2906h`

**示例响应[](#example-response "Permalink to this headline")**

```
    {
      "data": {
        "targetable": false,
        "name": "developers",
        "targetable_types": [
          "CRM",
          "EXCLUDED_CRM"
        ],
        "audience_type": "CRM",
        "description": null,
        "permission_level": "READ_WRITE",
        "owner_account_id": "18ce54d4x5t",
        "id": "2906h",
        "reasons_not_targetable": [
          "TOO_SMALL"
        ],
        "created_at": "2017-08-22T23:34:26Z",
        "updated_at": "2017-08-30T18:09:00Z",
        "partner_source": "OTHER",
        "deleted": true,
        "audience_size": null
      },
      "request": {
        "params": {
          "custom_audience_id": "2906h",
          "account_id": "18ce54d4x5t"
        }
      }
    }
```

<div id="do-not-reach-lists">
  ### 不触达名单（DNRL）
</div>

<Button href="https://app.getpostman.com/run-collection/1d12b9fc623b8e149f87">
  在 Postman 中运行
</Button>

#### GET accounts/:account\_id/do\_not\_reach\_lists[](#get-accounts-account-id-do-not-reach-lists "Permalink to this headline")

检索与当前账户关联的全部或部分不触达名单的详细信息。

**注意**：一个 `account_id` 最多只能有一个不触达名单

**资源 URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/12/accounts/:account_id/do_not_reach_lists`

**参数[](#parameters "Permalink to this headline")**

| 名称 | 说明 |
| :--- | :--- |
| account\_id  <br />_必填_ | 目标账户的标识符。出现在资源路径中，通常是除 [GET accounts](/zh/x-ads-api/campaign-management#accounts) 之外所有 Advertiser API 请求的必需参数。指定账户必须与已认证用户关联。<br /><br />类型：string<br /><br />示例：`18ce54d4x5t` |
| with\_deleted  <br />_可选_ | 在请求中包含已删除的结果。<br /><br />类型：boolean<br /><br />默认值：`false`  <br />可选值：`true`、`false` |

**示例请求[](#example-request "Permalink to this headline")**

`GET https://ads-api.x.com/12/accounts/18ce54bgxky/do_not_reach_lists`

**示例响应[](#example-response "Permalink to this headline")**

```
    {
      "request": {
        "params": {
          "account_id": "18ce54bgxky"
        }
      },
      "next_cursor": null,
      "data": [
        {
          "targetable": false,
          "name": "Do Not Reach List",
          "description": "test DNRL",
          "id": "4kzrq",
          "reasons_not_targetable": [
            "TOO_SMALL"
          ],
          "created_at": "2021-10-28T22:09:29Z",
          "list_size": null,
          "updated_at": "2021-11-04T03:33:06Z",
          "deleted": false
        }
      ]
    }
```

#### POST accounts/:account\_id/do\_not\_reach\_lists[](#post-accounts-account-id-do-not-reach-lists "Permalink to this headline")

创建一个与当前账户关联的不触达名单（Do Not Reach List）。

**注意**：每个 `account_id` 最多只能有一个不触达名单

**Resource URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/12/accounts/:account_id/do_not_reach_lists`

**Parameters[](#parameters "Permalink to this headline")**

| Name | Description |
| :--- | :--- |
| account\_id  <br />_required_ | 目标账户的标识符。出现在资源路径中，且通常是除 [GET accounts](/zh/x-ads-api/campaign-management#accounts) 外所有 Advertiser API 请求的必需参数。指定的账户必须与已认证的用户关联。<br /><br />Type: string<br /><br />Example: `18ce54d4x5t` |
| description  <br />_optional_ | 此受众的描述。<br /><br />Type: string<br /><br />Example: `A list of users to exclude` |

**Example Request[](#example-request "Permalink to this headline")**

`POST https://ads-api.x.com/12/accounts/18ce54bgxky/do_not_reach_lists?description=A list of users to exclude`

**Example Response[](#example-response "Permalink to this headline")**

```
    {
      "request": {
        "params": {
          "description": "A list of users to exclude",
          "account_id": "18ce54bgxky"
        }
      },
      "data": {
        "targetable": false,
        "name": "Do Not Reach List",
        "description": "A list of users to exclude",
        "id": "4ofrq",
        "reasons_not_targetable": [
          "PROCESSING",
          "TOO_SMALL"
        ],
        "created_at": "2022-02-08T23:02:48Z",
        "list_size": null,
        "updated_at": "2022-02-08T23:02:48Z",
        "deleted": false
      }
    }
```

#### POST batch/accounts/:account\_id/do\_not\_reach\_lists/:do\_not\_reach\_list\_id/users[](#post-batch-accounts-account-id-do-not-reach-lists-do-not-reach-list-id-users "Permalink to this headline")

此端点允许向给定的 `do_not_reach_list_id` 添加、更新或移除用户。此端点仅接受电子邮件作为有效的用户标识符类型。

请求中 `emails` 字段提供的所有数据必须使用 `SHA256` 进行哈希并先行[规范化](/zh/x-ads-api/audiences#e-mail-normalization)。

**注意**

- 一个 `account_id` 至多只能拥有一个不触达名单（Do Not Reach List）
- 添加到此名单的用户**必须**设置 `expires_at` 时间戳，且该时间戳需早于从当前时间起算的 13 个月
- 不触达名单 API 不接受 `effective_at` 时间戳，并默认使用当前时间戳
- 不触达名单不会将用户从账户中的任何或全部自定义受众中移除，但会对该账户的所有广告活动充当排除定向

**批量请求**

- 当前最大批处理大小为 `2500`，**仅适用于该端点**。批处理大小由每个请求中的操作数（`Update`/`Delete`）决定。例如，在一个数组中包含超过 2500 个操作对象（`{"operation_type": "Update/Delete", [..] }`）会导致错误。
- 此端点可接受的最大请求 POST 正文大小为 `5,000,000` 字节。
- 此端点的速率限制为每 1 分钟窗口 1500 次
- 所有参数通过请求正文发送，并且需要 `application/json` 的 `Content-Type`。
- 批量请求作为一个整体同时失败或成功，且无论错误还是成功，所有 API 响应都会保留与初始请求相同的条目顺序。

**批量响应**

Ads API 返回的响应包含两个字段：`success_count` 和 `total_count`。这两个值必须始终相等，表示后端已处理的请求记录数。当请求正文中发送的记录数与 `success_count` 和 `total_count` 的数量**不**相等时，应视为错误情况，需要重试。

**批量错误**

- 请求级错误（例如超出最大批处理大小）会在响应的 `errors` 对象下显示。
- 条目级错误（例如缺少必需参数）会在响应的 `operation_errors` 对象下显示。
- `operation_errors` 中错误的索引对应输入条目的索引，并附有相应的错误消息

**资源 URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/12/batch/accounts/:account_id/do_not_reach_lists/:do_not_reach_list_id/users`

**参数[](#parameters "Permalink to this headline")**

| Name | Description |
| :--- | :--- |
| account\_id  <br />_required_ | 被使用账户的标识符。出现在资源路径中，并且通常是除 [GET accounts](/zh/x-ads-api/campaign-management#accounts) 之外所有 Advertiser API 请求的必需参数。指定的账户必须与已认证用户关联。<br /><br />Type: string<br /><br />Example: `18ce54d4x5t` |
| do\_not\_reach\_list\_id  <br />_required_ | 你在请求中操作的不触达名单的引用<br /><br />Type: string<br /><br />Example: `2906h` |
| operation\_type  <br />_required_ | 针对每个 `users` 分组执行的操作类型。<br /><br />Type: enum<br /><br />Possible values: `Update`, `Delete` |
| params  <br />_required_ | 包含 `emails` 数组和 `expires_at` 时间戳的 JSON 对象。<br /><br />Type: JSON |
| users  <br />_required_ | 包含单个用户全部参数的 JSON 对象数组。<br /><br />Type: JSON |
| expires\_at  <br />_optional_ | 用户关联应过期的 UTC 时间。指定时间必须晚于当前时间戳。采用 [ISO 8601](https://en.wikipedia.org/wiki/ISO_8601) 格式。默认值为自当前时间戳起 13 个月。<br /><br />Type: string<br /><br />Example: `2017-07-05T07:00:00Z` |

鉴于 `users` 对象的多键设计，下面对该对象的每个元素进行说明：

| 名称 | 描述 |
| :--- | :--- |
| email  <br />_可选_ | 用户的电子邮箱地址（可为多个）。<br /><br />类型：Array\[String] |
| phone\_number  <br />_可选_ | 用户的电话号码（可为多个）。<br /><br />类型：Array\[String] |

**示例请求[](#example-request "Permalink to this headline")**

```
`POST https://ads-api.x.com/12/batch/accounts/18ce54bgxky/do_not_reach_lists/4kzro/users`

    [
      {
        "operation_type": "Update",
        "params": {
          "expires_at": "2023-01-22T00:00:00Z",
          "users": [
            {
              "email": [
                "FEAD76F6ADF99FFFB997AA4E3C8AD38FF531BC4C956DBD03CD0163F744D8AABC"
              ],
              "phone_number": [
                "CCABF1B62A202E0FE28BC6C014983C89A65451DD4482BD66A0ADB65366F38A9A"
              ]
            },
            {
              "email": [
                "FEAD76F6ADF99FFFB997AA4E3C8AD38FF531BC4C956DBD03CD0163F744D8AABA"
              ],
              "phone_number": [
                "CCABF1B62A202E0FE28BC6C014983C89A65451DD4482BD66A0ADB65366F38A9E"
              ]
            }
          ]
        }
      }
    ]
```

**示例响应[](#example-response "Permalink to this headline")**

```
    {
      "data": [
        {
          "success_count": 2,
          "total_count": 2
        }
      ],
      "request": [
        {
          "params": {
            "do_not_reach_list_id": "4ofrq",
            "expires_at": "2023-01-22T00:00:00Z",
            "account_id": "18ce54bgxky"
          },
          "operation_type": "Update"
        }
      ]
    }
```

#### DELETE accounts/:account\_id/do\_not\_reach\_lists/:do\_not\_reach\_list\_id[](#delete-accounts-account-id-do-not-reach-lists-do-not-reach-list-id "Permalink to this headline")

删除当前账户的指定不触达名单（DNRL）。

**Resource URL[](#resource-url "Permalink to this headline")**

`https://ads-api.x.com/12/accounts/:account_id/do_not_reach_lists/:do_not_reach_list_id`

**Parameters[](#parameters "Permalink to this headline")**

无

**Example Request[](#example-request "Permalink to this headline")**

`DELETE https://ads-api.x.com/12/accounts/18ce54bgxky/do_not_reach_lists/4ofrp`

**Example Response[](#example-response "Permalink to this headline")**

```
    {
      "request": {
        "params": {
          "do_not_reach_list_id": "4ofrp",
          "account_id": "18ce54bgxky"
        }
      },
      "data": {
        "targetable": false,
        "name": "Do Not Reach List",
        "description": null,
        "id": "4ofrp",
        "reasons_not_targetable": [
          "PROCESSING",
          "TOO_SMALL"
        ],
        "created_at": "2022-02-08T23:02:07Z",
        "list_size": null,
        "updated_at": "2022-02-08T23:02:21Z",
        "deleted": true
      }
    }
```