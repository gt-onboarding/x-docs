---
title: 全档案搜索
sidebarTitle: 全档案搜索
---

import { Button } from '/snippets/zh/button.mdx';

<div id="getting-started-with-the-full-archive-search-endpoint">
  ## 全档案搜索端点入门
</div>

本快速入门指南将帮助你使用 Postman，向全档案搜索端点发送第一个请求，并指定一组字段。

如果你希望查看不同语言的示例代码，请访问我们的 [X API v2 示例代码](https://github.com/xdevplatform/Twitter-API-v2-sample-code) GitHub 代码库。

<Note>
  ### 先决条件

  全档案搜索端点目前仅对 Pro 和 Enterprise 访问开放。要使用此端点，你必须升级至 Pro 访问，或 [申请 Enterprise 访问级别](https://docs.google.com/forms/d/e/1FAIpQLScO3bczKWO2jFHyVZJUSEGfdyfFaqt2MvmOfl_aJp0KxMqtDA/viewform)。

  除获得访问批准外，你还需要一组用于对请求进行身份验证的 [密钥和令牌](/zh/resources/fundamentals/authentication)。你可以按照以下步骤生成这些密钥和令牌：

  - 在开发者门户中，进入具有 Enterprise 或 Pro 访问的 [项目](/zh/resources/fundamentals/projects)，并确保该项目下关联了一个 [开发者应用](/zh/resources/fundamentals/developer-apps)。

  - 前往应用的“Keys and tokens”页面以生成所需的凭据。请确保将所有凭据保存在安全位置。
</Note>

<div id="steps-to-build-a-full-archive-search-request">
  ### 构建全档案搜索请求的步骤
</div>

**步骤一：选择工具或库**

你可以使用多种工具、代码示例和库来向此端点发起请求。为简化流程，此处我们使用 Postman。

要将 X API v2 的 Postman 集合加载到你的环境中，请点击以下按钮：

<Button href="https://app.getpostman.com/run-collection/9956214-784efcda-ed4c-4491-a4c0-a26470a67400">
  将 X API v2 添加到 Postman
</Button>

在 Postman 中加载 X API v2 集合后，前往 Search Posts > Full-archive search request。

**步骤二：为请求进行身份验证**

要正确调用 X API，你需要确认自己具备相应权限。对于此端点，必须使用 [OAuth 2.0 App-Only](/zh/resources/fundamentals/authentication#app-only-authentication-and-oauth-2-0-bearer-token) 方式为请求进行认证。

你需要在 Postman 中添加密钥和令牌，尤其是 [App Access Token](/zh/resources/fundamentals/authentication#using-and-generating-an-app-only-bearer-token)（亦称 App-only Bearer Token）。在 Postman 右上角选择名为“X API v2”的环境，并将密钥与令牌分别填写到“initial value”和“current value”字段（点击环境下拉菜单旁的眼睛图标）。

如果配置正确，该变量会自动注入到请求的 Authorization 选项卡中。
 

**步骤三：创建搜索查询**

每个全档案搜索请求需要包含一个搜索查询。此示例中，我们使用匹配 @XDevelopers 账号发布的帖子（Posts）的查询。该查询使用 from 运算符并设置为 XDevelopers（不区分大小写）：

`from:XDevelopers`

在 Postman 中，前往 “Params” 选项卡，将此 ID，或用逗号分隔的一串帖子 ID，输入到 `ids` 参数的 “Value” 列中。
 

| Key | Value | Description |
| :--- | :--- | :--- |
| `query` | `from:XDevelopers` | 提交给全档案搜索端点的搜索查询 |

步骤四：确定并指定要检索的字段

若在步骤三后点击 “Send” 按钮，你将在响应中收到默认的 [Post object](/zh/x-api/fundamentals/data-dictionary#tweet) 字段：`id`、`text` 和 `edit_history_tweet_ids`。请注意，如果返回的是编辑功能推出前的帖子，则不会提供 `edit_history_tweet_ids` 字段；该字段未进行历史回填。 

如需默认字段之外的其他字段，需在请求中通过 [field](/zh/x-api/fundamentals/fields) 和/或 [expansion](/zh/x-api/fundamentals/expansions) 参数进行指定。

在本练习中，我们将从不同对象请求四组字段：

1. 默认的 Post 对象字段
2. 主体帖子对象中的附加字段 tweet.created\_at
3. 返回帖子所关联作者的 [user 对象](/zh/x-api/fundamentals/data-dictionary#user) 默认字段
4. 关联用户对象中的附加字段 user.description
    

在 Postman 中，前往 “Params” 选项卡，并将以下键值对添加到 “Query Params” 表格中：

| Key | Value | Returned fields |
| :--- | :--- | :--- |
| `tweet.fields` | `created_at` | `tweets.created_at` |
| `expansions` | `author_id` | includes.users.id, includes.users.name, includes.users.username |
| user.fields | description | includes.users.description |

你现在应当能在 “Send” 按钮旁看到以下 URL：

`https://api.x.com/2/tweets/search/all?query=from:XDevelopers&tweet.fields=created_at&expansions=author_id&user.fields=created_at`

<Note>
  **请注意**

  默认情况下，只返回最新的 10 条帖子。若希望每次请求返回超过 10 条，可使用 max\_results 参数，最多可设置为 500 条。同样，默认只返回过去 30 天内的帖子。若需获取早于 30 天的帖子，请在 API 调用中使用 start\_time 和 end\_time 参数。
</Note>

**步骤五：发起请求并查看响应**

完成所有设置后，点击“Send”按钮，您将收到类似如下的响应：

```
{
   "data": [
       {
           "author_id": "2244994945",
           "created_at": "2020-06-11T16:05:06.000Z",
           "id": "1271111223220809728",
           "text": "Tune in tonight and watch as @jessicagarson takes us through running your favorite Python package in R. 🍿\n\nLearn how to use two powerful programming languages for data science together, and see a live example that uses the recent search endpoint from Twitter’s Developer Labs. https://t.co/v178oUZNuj"
       },
       {
           "author_id": "2244994945",
           "created_at": "2020-06-10T19:25:24.000Z",
           "id": "1270799243071062016",
           "text": "As we work towards building the new Twitter API, we’ve extended the deprecation timeline for several Labs v1 endpoints. Learn more 📖 https://t.co/rRWaJYJgKk"
       },
       {
           "author_id": "2244994945",
           "created_at": "2020-06-09T18:08:47.000Z",
           "id": "1270417572001976322",
           "text": "Annotations help you learn more about a Tweet — they can even help you find topics of interest. 🔬\n\nIn this tutorial, @suhemparack shows us how find Tweets related to COVID-19 using annotations + the filtered stream endpoint.\n\nLearn how you can, too. ⤵️\nhttps://t.co/qwVOgw0zSV"
       }
   ],
   "includes": {
       "users": [
           {
               "description": "The voice of Twitter's #DevRel team, and your official source for updates, news, & events about Twitter's API. \n\n#BlackLivesMatter",
               "id": "2244994945",
               "name": "Twitter Dev",
               "username": "TwitterDev"
           }
       ]
   },
   "meta": {
       "newest_id": "1271111223220809728",
       "oldest_id": "1270417572001976322",
       "result_count": 3
   }
}
```

在此示例中，我们使用了一个非常简单的查询。若您需要更详细的指南，请访问下方列出的资源。

**后续步骤**

[使用 API 参考自定义您的请求](/zh/x-api/posts/full-archive-search)

[查看查询运算符的完整列表](/zh/x-api/posts/search/integrate/build-a-query "查看查询运算符的完整列表")

[使用这些端点的示例代码](https://github.com/xdevplatform/Twitter-API-v2-sample-code "使用这些端点的示例代码")