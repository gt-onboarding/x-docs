---
title: 恢复与冗余
sidebarTitle: 恢复与冗余
---

<div id="introduction">
  #### 介绍
</div>

在消费流式数据时，尽可能延长连接时间并接收所有匹配数据是基本目标。这意味着需要利用冗余连接、自动检测断线、快速重连，并制定丢失数据的补救方案。

在本集成指南中，我们将讨论不同的冗余与恢复功能：冗余连接、回填和恢复。
 

**冗余连接**

冗余连接允许你同时与过滤流建立多个连接。通过让两个独立的消费者连接到同一条流，并通过两条连接接收相同的数据，从而实现冗余。这样，你的应用在多种情况下即可实现热备切换，例如当其中一条流断开，或应用的主服务器发生故障时。

Filtered stream 目前仅允许具有 Enterprise 访问权限的项目最多建立两个冗余连接。要使用冗余流，只需连接与你的主连接相同的 URL。你的流数据将通过两条连接同时发送。

<div id="recovering-missed-data-after-a-disconnection-backfill">
  #### 断线后恢复遗漏数据：回填
</div>

在检测到断线后，你的系统应能够智能地重新连接到流。如果可能，你的系统应记录断线持续时间，以便使用合适的恢复功能来回填数据。

如果你使用具有 Enterprise 访问权限的项目，并确认断线持续了五分钟或更短，可以使用回填参数 backfill\_minutes。将此参数与 [GET /tweets/search/stream](/zh/x-api/posts/filtered-stream#get-2-tweets-search-stream) 请求一起传递时，你将收到过去一到五分钟内匹配你规则的帖子。我们通常会在任何新匹配的帖子之前先传递这些较早的帖子，且不会对帖子进行去重。这意味着如果你断线了 90 秒，但请求了两分钟的回填数据，你将收到 30 秒的重复帖子，你的系统应能够容忍这种情况。以下是带有回填参数的请求示例：

`curl 'https://api.x.com/2/tweets/search/stream?backfill_minutes=5' -H "Authorization: Bearer $ACCESS_TOKEN"`

如果你没有 Enterprise 访问权限，或者确认断线时间超过五分钟，你可以使用 [recent search endpoint](/zh/x-api/posts/search/introduction) 或恢复功能来请求遗漏的数据。但请注意，搜索帖子端点不包含 sample:、bio:、bio\_name: 或 bio\_location: 运算符，并且在使用包含重音和变音符号的 keyword 和 #hashtag 运算符时，其匹配行为存在一些差异。这些差异可能导致你无法完全恢复通过过滤流端点本应接收到的所有帖子。

**断线后恢复遗漏数据：恢复**

如果你使用具有 Enterprise 访问权限的项目，当你无法在 5 分钟回填窗口内重新连接时，可以使用恢复功能来找回过去 24 小时内遗漏的数据。

流式恢复功能允许你将回填窗口扩展至 24 小时。恢复使你能够“重放”遗漏数据的时间段。当你使用 start\_time 和 end\_time 请求参数发起连接请求时，将启动一次恢复流。连接后，恢复将重新流式传输所指定的时间段，然后断开连接。

你可以同时向恢复发起 2 个并发请求，即“两项恢复作业”。恢复在技术上与回填工作方式相同，只是额外定义了开始和结束时间。一次恢复仅针对单个时间范围。

|     |     |     |
| :--- | :--- | :--- |
| **名称** | **类型** | **描述** |
| start\_time | date (ISO 8601) | YYYY-MM-DDTHH:mm:ssZ（ISO 8601/RFC 3339）。<br /><br />UTC 时间，表示恢复的开始时间。 |
| end\_time | date (ISO 8601) | YYYY-MM-DDTHH:mm:ssZ（ISO 8601/RFC 3339）。<br /><br />UTC 时间，表示恢复的结束时间。 |

示例请求 URL： [https://api.x.com/2/tweets/search/stream?start\_time=2022-07-12T15:10:00Z\&end\_time=2022-07-12T15:20:00Z](https://api.x.com/2/tweets/search/stream?start_time=1985-04-12T23:20:50.52Z\&end_time=1985-04-13T00:20:50.52Z)