---
title: v1 迁移至 v2
sidebarTitle: v1 迁移至 v2
---

<div id="standard-v11-compared-to-x-api-v2">
  ### 标准版 v1.1 与 X API v2 的比较
</div>

如果您一直在使用 v1.1 的 [statuses/filter](https://developer.x.com/en/docs/x-api/v1/tweets/filter-realtime/api-reference/post-statuses-filter) 端点，本指南将帮助您了解标准版与 X API v2 过滤流端点之间的相似点与差异。

- **相似点**
  - 请求参数与运算符
  - 对帖子编辑历史与元数据的支持
- **差异**
  - 端点 URL
  - 应用与项目要求
  - 身份验证方式
  - 规则数量与持久化流
  - 响应数据格式
  - 请求参数
  - 恢复与冗余功能的可用性
  - 查询运算符

<div id="similarities">
  #### 相似之处
</div>

**请求参数与运算符**

标准 v1.1 的 statuses/filter 端点提供了一些可随请求传递的参数，用于过滤流。在 v2 过滤流中，则改为使用一组可通过布尔逻辑组合的[运算符](/zh/x-api/posts/filtered-stream#building-rules-for-filtered-stream)来筛选所需的帖子。可用的运算符中有一些是对现有标准 v1.1 参数的直接替代。 

以下标准 v1.1 请求参数在 X API v2 中有等效运算符：
 

| **Standard** | **X API v2** |
| :--- | :--- |
| follow - 以逗号分隔的用户 ID 列表，表示应在流中投递其帖子的用户。 | 多种运算符可帮助你查找与特定用户相关的帖子：<br /><br />\* @<br />\* from:<br />\* to:<br />\* 等 |
| track - 以逗号分隔的短语列表，用于确定哪些帖子将被投递到流中。 | 多种运算符可帮助你查找与特定关键词相关的帖子：<br /><br />\* keyword<br />\* "exact phrase match"<br />\* #<br />\* 等 |

**对帖子编辑历史和元数据的支持**

两个版本都提供描述编辑历史的元数据。请参阅[过滤流 API 参考](/zh/x-api/posts/filtered-stream#api-reference-index)和[帖子编辑基础](/zh/x-api/fundamentals/edit-posts)了解更多信息。 

<div id="differences">
  #### 差异
</div>

**端点 URL**

- 标准 v1.1 端点：
  - https://stream.x.com/1.1/statuses/filter.json
- X API v2 端点：
  - https://api.x.com/2/tweets/search/stream
  - https://api.x.com/2/tweets/search/stream/rule

**应用与项目要求**

使用 X API v2 端点时，必须在请求认证时使用与某个[开发者应用](/zh/resources/fundamentals/developer-apps)及其所属[项目](/zh/resources/fundamentals/projects)关联的凭据。所有 X API v1.1 端点均可使用独立应用或与项目关联的应用的凭据。

**身份验证方式**

标准端点支持[OAuth 1.0a 用户上下文](/zh/resources/fundamentals/authentication)，而 X API v2 过滤流端点支持[OAuth 2.0 仅应用](/zh/resources/fundamentals/authentication#oauth-2-0)（亦称为仅应用身份验证）。要向 X API v2 发起请求，必须使用应用访问令牌对请求进行认证。

如果你不再持有在开发者门户中创建项目与应用时提供的应用访问令牌，可以前往开发者门户中应用的“Keys and tokens”页面生成新的令牌。若希望以编程方式生成应用访问令牌，请参阅此[OAuth 2.0 仅应用指南](/zh/resources/fundamentals/authentication#app-only-authentication-and-oauth-2-0-bearer-token)。

**规则数量与持久化流**

标准 v1.1 端点仅支持使用单条规则过滤流式连接。要更改规则，必须断开流，并提交包含修订后过滤规则（作为参数传递）的新请求。

X API v2 过滤流端点允许对单个流应用多条规则，并可在保持流连接的同时向流添加或移除规则。

**响应数据格式**

标准 v1.1 与 X API v2 端点之间最大的差异之一在于如何选择在负载中返回哪些字段。

对于标准端点，许多响应字段会默认返回，你也可以通过参数指定应在负载中返回的字段或字段集合。

X API v2 默认仅返回帖子 id 和文本字段。要请求其他任何字段或对象，需要使用[fields](/zh/x-api/fundamentals/fields)和[expansions](/zh/x-api/fundamentals/expansions)参数。从这些端点请求的任何帖子字段将返回在主帖子对象中。任何扩展的用户、媒体、投票或地点对象及其字段将返回在响应中的 includes 对象内。随后可以通过匹配帖子与扩展对象中的 ID，将扩展对象关联回帖子对象。

建议查阅各自的指南，或阅读我们的[如何使用 fields 与 expansions](/zh/x-api/fundamentals/data-dictionary#how-to-use-fields-and-expansions)指南以了解更多信息。

我们还提供了[数据格式迁移指南](/zh/x-api/migrate/data-format-migration#migrating-from-standard-v1-1s-data-format-to-v2)，帮助你将标准 v1.1 字段映射到较新的 v2 字段。该指南还会提供在 v2 请求中为返回特定字段所需传递的具体 expansion 与 field 参数。
 

除请求字段方式的变化外，X API v2 还为 API 返回的对象引入了新的 JSON 设计，包括帖子和[用户](/zh/x-api/fundamentals/data-dictionary#user)对象。

- 在 JSON 根级别，标准端点将帖子对象返回在 statuses 数组中，而 X API v2 返回在 data 数组中。
- X API v2 的 JSON 不再将转发与引用称为“statuses”，而是称为转发与引用的 Tweets。许多遗留与已弃用字段（例如 contributors 和 user.translator\_type）正在被移除。
- X API v2 不再同时使用 favorites（帖子对象中）与 favourites（用户对象中），而统一使用术语 like。
- X 采用约定：无值（例如 null）的 JSON 字段不会写入负载。仅当帖子与用户属性具有非空值时才会被包含。
   

我们还为[帖子对象](/zh/x-api/fundamentals/data-dictionary#tweet)引入了一组新字段，包括以下内容：

- 一个 [conversation\_id](/zh/x-api/fundamentals/conversation-id) 字段
- 两个新的 [annotations](/zh/x-api/fundamentals/post-annotations) 字段，包括 context 和 entities
- 若干新的 [metrics](/zh/x-api/fundamentals/metrics) 字段
- 一个新的 reply\_setting 字段，用于显示谁可以回复某条帖子

**请求参数**

还有一组标准的过滤流请求参数在 X API v2 中**不**受支持：

| 标准 v1.1 参数 | 详情 |
| :--- | :--- |
| locations - 以逗号分隔的经度、纬度对列表，指定一组边界框用于按位置筛选帖子。 | 我们尚未在 X API v2 中发布基于位置的运算符。 |
| Delimited | 在 v1.1 端点中，将其设置为字符串长度表示应在流中对状态进行分隔，使客户端在状态消息结束前知道需要读取的字节数。<br /><br />此功能在 X API v2 中不可用。 |
| Stall\_warnings | 在 v1.1 端点中，将此参数设置为 true 会在客户端存在断开风险时定期发送提示消息。<br /><br />在 X API v2 中，默认会发送停滞警告，并会定期发送新行。 |

**恢复与冗余功能的可用性**

X API v2 的过滤流引入了恢复与冗余功能，帮助你最大化流式连接的正常运行时间，并在断开时间不超过五分钟的情况下，恢复可能错过的帖子。

冗余连接允许你对同一流最多建立两路连接，这有助于确保即使其中一路连接失败，你也能始终保持与流的连接。

backfill\_minutes 参数可用于恢复最多五分钟的遗漏数据。

这两项功能仅通过[学术研究访问](/zh/x-api/getting-started/about-x-api)提供。你可以在我们的[恢复与冗余功能](/zh/x-api/posts/filtered-stream#filtered-stream-recovery-and-redundancy-features)集成指南中了解更多信息。

**新的查询运算符**

X API v2 引入了新的运算符，以支持两项新功能：

- **[Conversation IDs](/zh/x-api/fundamentals/conversation-id)** - 随着对话在 X 上展开，将提供一个对话 ID 来标记属于该对话的帖子。对话中的所有帖子其 conversation\_id 都将被设置为发起该对话的帖子的 ID。
  - conversation\_id:
- **[X Annotations](/zh/x-api/fundamentals/post-annotations)** 为帖子提供上下文信息，包括实体和上下文注解。实体由人物、地点、产品和组织构成。上下文是域或主题，已浮现的实体隶属于这些域或主题。例如，帖子中提到的人可能具有一个上下文，指示其是否是运动员、演员或政治人物。
  - context: - 匹配带有目标上下文注解的帖子。
  - entity: - 匹配带有目标实体注解的帖子。 