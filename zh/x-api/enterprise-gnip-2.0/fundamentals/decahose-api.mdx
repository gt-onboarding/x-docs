---
title: Decahose API
---

<Note>
  此端点已更新，现包含帖子编辑元数据。有关这些元数据的更多信息，请参阅["编辑帖子"基础知识页面](/zh/x-api/enterprise-gnip-2.0/fundamentals/edit-tweets)。
</Note>

<div id="decahose-stream">
  ### Decahose 流
</div>

[企业版](https://developer.x.com/en/products/x-api/enterprise)

_这是仅在我们的托管访问级别中提供的企业 API。要使用此 API，您必须先与我们的企业销售团队开通账户。[了解更多](https://developer.x.com/en/products/x-api/enterprise)_

Decahose 通过流式连接提供 X 实时 Firehose 的 10% 随机样本。这通过实时抽样算法实现，该算法随机选择数据，同时在 X 通过 Firehose 发送数据时仍可按预期实现低延迟传输。

以下是 Decahose 可用的一些特性：

- **扩展与增强的 URL：** - 完整解展开缩短的 URL，并提供额外的元数据（页面标题与描述）
- **流分区** - 2 个分区，每个分区包含 Decahose 流量的 50%
- **更高的可靠性** - 后端系统的地域多样化

注意：此数据以批量形式交付，不支持额外过滤（例如按关键词）。

`ENTERPRISE`

<div id="streaming-likes">
  ### 点赞流式传输
</div>

_这是仅在我们的托管访问级别内提供的企业级 API。要使用此 API，您必须先与我们的企业销售团队开通账户。[了解更多](https://developer.x.com/en/products/x-api/enterprise)_

点赞可用于洞察哪些用户为帖子点赞，并提供准确的点赞计数。Gnip 的 Firehose 和 Decahose 可传递与通过 Gnip 分发的帖子相关的公开点赞数据。这为与某条帖子相关的实时公开互动与受众指标提供支持。
 

**开始使用点赞**

在准备消费点赞数据时，您需要了解：

- 点赞通过独立的、单独的流传递
- 点赞历史上被称为“Favorites”。增强的原生格式载荷保留了这一命名法
- 流仅包含公开的点赞
  - “公开”指点赞用户、帖子创建者以及帖子在平台上均为公开
- 点赞与转发非常相似，代表一种公开的互动信号
- 载荷元素包括：
  - 原始帖子对象
  - 创建原始帖子的参与者（Actor）对象
  - 执行点赞操作的参与者（Actor）对象
- 只有原创内容可以被点赞
  - 转发无法被点赞。对转发的点赞会计入原始帖子
  - 引用推文\_可以\_被点赞
- 点赞活动包含适用的 Gnip Enrichments（如已购买/应用）
- 支持的产品/功能
  - 点赞流支持回填（如已购买/应用）
  - 点赞流不支持回放
  - 点赞不支持搜索或历史数据
  - 目前没有将点赞支持添加到 PowerTrack 的计划

**Decahose**

- 对于 Decahose 中提供的 10% 样本帖子，流包含 100% 的适用公开点赞
- **分区：** 2
- **URL 结构**
  - https://gnip-stream.x.com/stream/sample10-likes/accounts/\<accountName>/publishers/twitter/\<streamLabel>.json?partition=1

**原生增强格式载荷**

```json
{
   "id":"43560406e0ad9f68374445f5f30c33fc",
   "created_at":"Thu Dec 01 22:27:39 +0000 2016",
   "timestamp_ms":1480631259353,
   "favorited_status":{
      "created_at":"Thu Dec 01 22:27:16 +0000 2016",
      "id":804451830033948672,
      "id_str":"804451830033948672",
      "text":"@kafammheppduman",
      "source":"\u003ca href=\"http:\/\/x.com\/download\/android\" rel=\"nofollow\"\u003eX 安卓版\u003c\/a\u003e",
      "truncated":false,
      "in_reply_to_status_id":803694205163814912,
      "in_reply_to_status_id_str":"803694205163814912",
      "in_reply_to_user_id":2855759795,
      "in_reply_to_user_id_str":"2855759795",
      "in_reply_to_screen_name":"kafammheppduman",
      "user":{
         "id":2855759795,
         "id_str":"2855759795",
         "name":"delirdim kanka",
         "screen_name":"kafammheppduman",
         "location":"sanane",
         "url":"http:\/\/instagram.com\/kafammheppduman",
         "description":"Manit @GalatasaraySk \ud83d\udc9e",
         "translator_type":"none",
         "protected":false,
         "verified":false,
         "followers_count":3702,
         "friends_count":607,
         "listed_count":1,
         "favourites_count":113338,
         "statuses_count":389,
         "created_at":"Sat Nov 01 22:38:25 +0000 2014",
         "utc_offset":null,
         "time_zone":null,
         "geo_enabled":true,
         "lang":"tr",
         "contributors_enabled":false,
         "is_translator":false,
         "profile_background_color":"C0DEED",
         "profile_background_image_url":"",
         "profile_background_image_url_https":"",
         "profile_background_tile":false,
         "profile_link_color":"1DA1F2",
         "profile_sidebar_border_color":"C0DEED",
         "profile_sidebar_fill_color":"DDEEF6",
         "profile_text_color":"333333",
         "profile_use_background_image":true,
       "Profile_image_url": "http:\/\/pbs.twimg.com\/profile_images\/804421763945861121\/v3bp9pnq_normal.jpg",
         "Profile_image_url_https": "https:\/\/pbs.twimg.com\/profile_images\/804421763945861121\/v3bp9pnq_normal.jpg",
         "profile_banner_url":"https:\/\/pbs.twimg.com\/profile_banners\/2855759795\/1480630085"
         "default_profile":true,
         "default_profile_image":false,
         "following":null,
         "follow_request_sent":null,
         "notifications":null
      },
      "geo":null,
      "coordinates":null,
      "place":null,
      "contributors":null,
      "is_quote_status":false,
      "retweet_count":0,
      "favorite_count":0,
      "entities":{
         "hashtags":[],
         "urls":[],
         "user_mentions":[
            {
               "screen_name":"kafammheppduman",
               "name":"delirdim kanka",
               "id":2855759795,
               "id_str":"2855759795",
               "indices":[
                  0,
                  16
               ]
            }
         ],
         "symbols":[]
      },
      "favorited":false,
      "retweeted":false,
      "filter_level":"low",
      "lang":"und"
   },
   "user":{
      "id":774146932365070336,
      "id_str":"774146932365070336",
      "name":"Uyuyan Adam",
      "screen_name":"saykoMenn",
      "location":"Tarsus, T\u00fcrkiye",
      "url":"http:\/\/connected2.me\/pmc1i",
      "description":null,
      "translator_type":"none",
      "protected":false,
      "verified":false,
      "followers_count":414,
      "friends_count":393,
      "listed_count":0,
      "favourites_count":9868,
      "statuses_count":370,
      "created_at":"Fri Sep 09 07:26:26 +0000 2016",
      "utc_offset":null,
      "time_zone":null,
      "geo_enabled":false,
      "lang":"tr",
      "contributors_enabled": false,
      "is_translator": false,
      "profile_background_color": "F5F8FA",
      "profile_background_image_url": "",
      "profile_background_image_url_https": "",
      "profile_background_tile": false,
      "profile_link_color": "1DA1F2",
      "profile_sidebar_border_color": "C0DEED",
      "profile_sidebar_fill_color": "DDEEF6",
      "profile_text_color": "333333",
      "profile_use_background_image": true,
      "profile_image_url": "http:\/\/pbs.twimg.com\/profile_images\/802992813424201728\/VMzcTL3x_normal.jpg",
      "profile_image_url_https": "https:\/\/pbs.twimg.com\/profile_images\/802992813424201728\/VMzcTL3x_normal.jpg",
      "profile_banner_url": "https:\/\/pbs.twimg.com\/profile_banners\/774146932365070336\/1480283382",
      "default_profile": true,
      "default_profile_image": false,
      "following": null,
      "follow_request_sent": null,
      "notifications": null
   }
}
```

**点赞删除 / “取消点赞” 载荷**

```json
{
   "delete":{
      "favorite":{
         "tweet_id":696615514970279937,
         "tweet_id_str":"696615514970279937",
         "user_id":2510287578,
         "user_id_str":"2510287578"
      },
      "timestamp_ms":"1480437031205"
   }
}
```

<div id="guides">
  ## 指南
</div>

<div id="recovery-and-redundency">
  ### 恢复与冗余
</div>

**简介** 

在以流式方式处理大量实时帖子时，有一套最佳实践可同时提升数据的可靠性与完整保真度。在消费实时数据时，最大化连接时长是一个基本目标。一旦发生断连，应当自动检测并重连。重连后，需要评估是否存在需要回填的数据时间段。负责管理这些细节并消费实时帖子的组件，只是一个同时涉及网络、数据存储、服务器和存储等问题的系统的一部分。鉴于这些系统的复杂性，另一项最佳实践是搭建不同的流式环境，至少将开发/测试与生产环境的流分离。

Decahose 提供了一组有助于实现上述目标的功能。

1. 为支持多个环境，我们可以为你的账户部署[附加流](#AdditionalStreams)。这些流彼此独立，并具有不同的 stream\_label 以便区分。
2. 为帮助维持连接，每个 Decahose 流都支持[冗余连接](/zh/x-api/enterprise-gnip-2.0/fundamentals/decahose-api#additional-streams)。最常见的架构是一个流拥有两个连接，而在客户端有两个彼此独立的消费进程——理想情况下位于不同网络。通过这种设计，可在客户端侧的网络、服务器和数据存储路径上实现冗余。请注意，每个连接都会提供完整副本的数据，客户端必须能够容忍并处理重复数据。
3. 每 10 秒会发送一次“心跳”；然而，在 Decahose 流中，数据量足够大，以至于即使是很短的时间（例如几秒）没有帖子也可能表明连接问题。因此，“数据静默”和缺少心跳都可用于检测断连。

鉴于断连不可避免，Decahose 流提供专用的[恢复](/zh/x-api/enterprise-gnip-2.0/fundamentals/decahose-api#overview)与[回填](/zh/x-api/enterprise-gnip-2.0/fundamentals/decahose-api#backfill)功能，帮助找回因断连及其他运维问题而遗漏的数据。

<div id="additional-streams">
  #### 额外的流
</div>

提供额外的 Decahose 流是为您的解决方案提升可靠性的另一种方式。任何额外的流彼此完全独立，并拥有其唯一的端点。每个流都会分配一个独立的 stream\_label；该标签与您的账户名称一起构成该流 URL 的一部分。请参见下面的示例：

https://gnip-stream.x.com/stream/sample10/accounts/:account\_name/publishers/twitter/:stream\_label.json

最常见的做法是：为生产系统专用一个实时流，并另配一个用于开发与测试的流。测试/开发流使 Decahose 客户能够在不影响生产的情况下验证客户端消费者更新。虽然任何（唯一的）标签都可用于流，但常见约定是生产流使用“prod”，而开发流使用“dev”或“sandbox”。

流的数量及其唯一标签可由您的客户代表进行配置。

**冗余连接**

冗余连接是指允许您同时建立多个到同一数据流的连接。这样，您可使用两个独立的消费者连接到同一流，并通过两条连接接收相同数据，从而实现冗余。由此，您的应用具备热备自动切换能力，以应对诸如某条流断开或应用主服务器故障等情况。

任一流允许的连接数可由您的客户代表进行配置。要使用冗余连接，只需连接到与主连接相同的 URL。您的流数据会通过两条连接同时发送，两条流连接也会显示在流仪表板上。

请注意，就计费而言，我们会对您通过多个连接接收到的活动计数进行去重，因此每个唯一活动只计费一次。鉴于 Decahose 具有两个分区，以下示例说明连接计数的工作方式：

Connect to decahose partition=1
Connect to decahose partition=1
Connect to decahose partition=2

上述情况共计三个连接——两个连接到 partition=1，一个连接到 partition=2。通常，您会希望各分区的连接数相同，因此该示例突出了这样一种情况：到 partition=2 的冗余连接已掉线，您需要进一步排查。

**恢复**

#### 概览 

Recovery 是一款数据恢复工具（不用于主要数据采集），可提供对最近 X 历史数据滚动 5 天窗口的流式访问。它应在以下场景中用于数据补采：当你的消费端应用因短时断连，或出于任何其他原因在一段时间内未能摄取实时数据而错过实时流数据时。

#### 使用 Recovery 

使用 Recovery 流时，应用可以以与实时流相同的方式向其发起请求。但必须在 URL 中指定参数来标明请求的时间窗口。换言之，Recovery 请求会向 API 请求“从时间 A 到时间 B 的帖子”。这些帖子随后会通过你的流式连接传送，传送方式与实时流相仿，但速率会略慢于实时。示例如下：

"https://stream-data-api.x.com/stream/powertrack/accounts/someAccountName/publishers/twitter/powertrack.json?startTime=2023-07-05T17:09:12.070Z"

帖子将从指定时间段的第一个（最早的）分钟开始传送，按时间顺序持续，直到最后一分钟传送完毕。此时，会通过连接发送“Recovery Request Completed”消息，然后服务器关闭该连接。如果请求开始于匹配结果很少或没有的时段，在首次结果传送之前可能会有一段等待——当 Recovery 在当前处理的归档片段中遇到匹配时，才会开始传送数据。当没有可传送的结果时，流会通过连接持续发送回车（即“心跳”）以防止超时。

Recovery 的定位是帮助在短时断连情况下便捷地补回遗漏数据，而并非用于非常长的时间段（例如整天）。如需恢复较长时间段的数据，建议将长请求拆分为较短的时间窗口（例如两小时），以降低因网络波动或其他原因导致中途断开的可能性，并提升对长请求进度的可观测性。

<div id="data-availability">
  #### 数据可用性
</div>

如果无法在 5 分钟回填窗口内重新连接，可使用恢复功能在过去 24 小时内找回遗漏的数据。

流式恢复功能将回填窗口扩展至 24 小时。恢复允许您“补回”遗漏数据所处的时间段。当您使用 'start\_time' 和 'end\_time' 请求参数发起连接请求时，将启动一个恢复流。连接成功后，恢复会重新传输所指定的时间段，然后断开连接。  

您可以同时发起 2 个并发的恢复请求，即“两项恢复作业”。从技术角度看，恢复与回填的工作方式相同，不同之处在于需要定义开始和结束时间。一次恢复周期仅对应单一的时间范围。

<div id="backfill">
  #### 回填
</div>

要请求回填，你需要在连接请求中添加参数 backfillMinutes=N，其中 N 表示在建立连接时要回填的分钟数（1–5，仅限整数）。例如，如果你断开了 90 秒，你应在连接请求中添加 backfillMinutes=2。由于该请求将提供 2 分钟的回填（包括断开前的 30 秒时段），你的\_消费端应用必须能容忍重复数据\_。

一个向分区 1 请求 5 分钟回填的 Decahose 连接请求 URL 示例：

https://gnip-stream.x.com/stream/sample10/accounts/:account\_name/publishers/twitter/:stream\_label.json?partition=1\&backfillMinutes=5

**注意：**

- 你可以选择在连接时始终使用 backfillMinutes=5，然后在客户端去重处理任何重复数据。

- 如果断连超过 5 分钟，你可以使用 Recovery 来恢复数据。

**从断连中恢复**

重启并从断连中恢复涉及以下步骤：

- 确定断连时长。
  - 5 分钟以内？
    - 如果为流启用了回填，请准备带有合适 backfillMinutes 参数的连接请求。
  - 超过 5 分钟？
    - 如果你有 Recovery 流，请针对断连时段发起 Recovery 请求（理想情况下使用你当前的实时规则集，必要时通过 Rules API 更新）。
- 发起新的连接请求。

当你遇到断连或停机时，以下策略可用于缓解与恢复：

1. **实施回填**
   回填允许你从断开连接之前的时间点重新连接，覆盖最长 5 分钟的断连。通过在连接请求中添加参数实现。

2. **从其他位置消费冗余流**
   如果冗余流能导入同一在线环境并进行去重，则除非主流与冗余流同时出现停机或断连，否则无需恢复。如果冗余流无法实时导入生产环境，可将其写入单独的“应急”数据存储。这样，当主流连接出现断连或停机时，你的系统可用这些数据补全主数据库在缺失时段的空白。

3. **实施 Recovery**
   当断连或停机同时影响主流与冗余流时，使用 Decahose Recovery 恢复遗漏的数据。该 API 提供覆盖 5 天档案的滚动窗口，最佳做法是每次请求不超过 1 小时的窗口，并以流式方式导入。此过程与实时流并行进行。请注意，我们无法恢复超出 Recovery 提供的 5 天窗口之外的 Decahose 数据，因此在你方可能出现较长停机的情况下，使用冗余流以确保你方保有完整数据副本非常重要。

当你检测到存储数据量异常时—
在未发生断连或停机的情况下，检测数据缺失的可能方式包括：

1. 统计入站帖子
   你的系统应在摄取应用的最前端统计接收的原始帖子数量，并提供将该数量与最终数据存储中的帖子数量进行比对的机制。可监控任何差异，并在接收后发生丢数问题时告警。

2. 分析异常的存储量
   你也可以分析最终数据库中的存储数据量以查找异常下滑。这也可指示问题，尽管在某些情况下量的下降是正常的（例如 X 平台不可用，导致一段时间内无法创建帖子）。

<div id="api-reference">
  ## API 参考
</div>

<div id="decahose-stream">
  ### Decahose 流
</div>

跳转到本页

[方法](/zh/x-api/enterprise-gnip-2.0/fundamentals/decahose-api#methods)

[身份验证](/zh/x-api/enterprise-gnip-2.0/fundamentals/decahose-api#authentication)

[GET /\{stream-type}/:stream](/zh/x-api/enterprise-gnip-2.0/fundamentals/decahose-api#get-stream-type-stream)

[回放 API](/zh/x-api/enterprise-gnip-2.0/fundamentals/decahose-api#replay-api)

<div id="methods">
  #### 方法
</div>

| 方法 | 说明 |
| :--- | :--- |
| [GET /\{stream-type}/:stream](#Stream) | 连接数据流 |

<div id="authentication">
  #### 身份验证[](#authentication- "Permalink to this headline")
</div>

对 Volume Stream API 的所有请求都必须使用 HTTP 基本身份验证，该身份验证使用在 console.gnip.com 登录您账户的有效电子邮件地址与密码组合构成。凭据必须作为每个请求的 Authorization 请求头传递。请确认您的客户端为所有 API 请求添加了“Authorization: Basic”HTTP 头（通过 HTTPS 传输经编码的凭据）。

#### GET \{stream-type}:stream

建立到 Firehose 流的持久连接，通过该连接传输实时数据。

<div id="request-specifications">
  #### 请求规范
</div>

|     |     |
| :--- | :--- |
| **请求方法** | HTTP GET |
| **连接类型** | Keep-Alive  <br />  <br />应在请求头中指定。 |
| **URL** | 可在控制台的流 API 帮助页面找到，结构如下：  <br />  <br />Decahose：<br /><br />[https://gnip-stream.x.com/stream/sample10/accounts/:account\_name/publishers/twitter/:stream\_label.json?partition=1](https://gnip-stream.x.com/stream/sample10/accounts/:account_name/publishers/twitter/:stream_label.json?partition=1) |
| **分区（必填）** | `partition=\{#}` - 现在必须使用分区才能消费完整流。连接到流时需要指定分区参数。以下为各流的分区数量：<br /><br />\* Decahose：2 个分区 |
| **压缩** | Gzip。要以 Gzip 压缩方式连接到流，只需在连接请求中添加 Accept-Encoding 头。该请求头应如下所示：  <br />  <br />Accept-Encoding: gzip |
| **字符编码** | UTF-8 |
| **响应格式** | JSON。应在请求头中指定响应为 JSON 格式。 |
| **速率限制** | 每 60 秒 10 次请求。 |
| **回填参数** | 如果您购买了启用回填的流，需要在 GET 请求中添加“backfillMinutes”参数以启用。 |
| **读取超时** | 在客户端设置读取超时，并确保其值大于 30 秒。 |
| **推文编辑支持** | 所有 Tweet 对象均包含描述推文编辑历史的编辑元数据。详情参见["Edit Tweets"基础知识页面](/zh/x-api/enterprise-gnip-2.0/fundamentals/edit-tweets)。 |

<div id="responses">
  #### 响应
</div>

对于这些请求，API 可能返回以下响应。多数错误代码的响应正文会包含字符串以提供更多详细信息。对于非 200 响应，客户端应尝试重新连接。

| 状态 | 文本 | 说明 |
| :--- | :--- | :--- |
| 200 | 成功 | 连接已成功建立，新的活动将在抵达时持续推送。 |
| 401 | 未授权 | 由于凭据无效导致 HTTP 认证失败。请使用你的凭据登录 console.gnip.com，确认在请求中正确使用。 |
| 406 | 不可接受 | 通常发生在客户端未正确包含用于接受流中 gzip 编码的请求头，但也可能在其他情况下出现。  <br />  <br />将包含类似于 “This connection requires compression. To enable compression, send an ‘Accept-Encoding: gzip’ header in your request and be ready to uncompress the stream as it is read on the client end.” 的 JSON 消息。 |
| 429 | 频率受限 | 你的应用已超出连接请求的限制。 |
| 503 | 服务不可用 | Twitter 服务器故障。请使用指数退避模式重新连接。若 [X API 状态页](https://api.twitterstat.us/) 未发布相关公告，且在 10 分钟后仍无法连接，请联系支持或紧急渠道。 |

<div id="example-curl-request">
  #### curl 请求示例
</div>

以下示例请求使用命令行中的 cURL 发起。请注意，这些请求也可以使用你所选的编程语言发送：

```
curl --compressed -v -uexample@customer.com "https://gnip-stream.x.com/stream/firehose/accounts/:account\_name/publishers/twitter/:stream\_label.json?partition={#}"
```

<div id="replay-api">
  #### 回放 API
</div>

回放 API 是实时 Volume 流的重要补充。回放是一种数据恢复工具，可通过流式方式访问 X 近期历史数据的滚动时间窗口。