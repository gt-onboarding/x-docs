---
title: 最佳实践
sidebarTitle: 最佳实践
---

在使用 [`POST /2/media/upload`](/zh/x-api/media/media-upload) 端点时，有几个重要概念需要了解。通过 OAuth 上传媒体可能有些复杂，因此我们在此列出了一些注意事项，并提供了一个可运行的示例，展示如何使用该端点。

<div id="keep-in-mind">
  ## 请注意
</div>

- 在一条帖子中，最多可附加 4 张照片、1 个动画 GIF 或 1 个视频。
- 传入的图像应为原始二进制数据或 base64 二进制编码；只要正确设置了 Content-Type（不确定时可使用：`application/octet-stream`），无需额外对内容进行编码或转义。
- 提交 base64 编码图像时，请务必在消息的图像部分设置 “Content-Transfer-Encoding: base64”。
- 多部分消息的边界必须单独占一行，并以 CRLF 结尾。
- 如需使用此端点进行 POST 的示例，建议使用 [xurl](https://github.com/xdevplatform/xurl) 进行测试。另请参阅可用的 [X Libraries](/zh/resources/tools-and-libraries)。
- 对于 JavaScript 以及其他无法精确表示长整数的语言，请使用 API 响应中提供的 `media_id_string`。

<div id="media-categories">
  ## 媒体类别
</div>

媒体类别参数用于定义待上传媒体文件的使用场景，并可能影响媒体上传时所施加的文件大小上限或其他约束。上传媒体时务必选择正确的媒体类别，以避免后续使用该媒体时出现问题。该参数为可选项，在上传流程中作为 INIT 请求的一部分传递。若未指定媒体类别，则会依据内容类型将上传的媒体视为帖子用媒体（`tweet_image`、`tweet_video` 或 `tweet_gif`）。

常见的媒体类别包括：

- `tweet_image`
- `tweet_video`
- `tweet_gif`
- `dm_image`
- `dm_video`
- `dm_gif`
- `subtitles`

如果你是 X 广告 API 合作伙伴，请参阅[此文档](/zh/x-ads-api/creatives#promoted-video)，了解关于推广视频推荐媒体类别的更多信息。

<div id="image-specifications-and-recommendations">
  ## 图片规范与建议
</div>

图片文件必须同时满足以下条件：

- 支持的图片媒体类型：`JPG`、`PNG`、`GIF`、`WEBP`
- 图片大小：`<= 5 MB`
- 动态 GIF 大小：`<= 15 MB`

上述文件大小上限由媒体上传端点强制执行。此外，在调用包含 `media_id` 的帖子创建（或类似）端点时，还会应用一个与特定产品实体相关的单独文件大小上限。具体的文件大小上限及其他约束可能会因 `media_category` 参数而有所不同。

<div id="animated-gif-recommendations">
  ## 动态 GIF 建议
</div>

即使文件大小符合限制，GIF 在创建帖子时仍可能失败。请遵循以下约束以提高成功率。

- **分辨率**：`<= 1280x1080`（`width` × `height`）
- **帧数**：`<= 350`
- **像素总数**：`<= 3 亿`（`width` \* `height` \* `num_frames`）
- **文件大小**：`<= 15 MB`

如需处理更大的 GIF，请使用带有 `media_category` 参数的[分块上传](/zh/x-api/media/quickstart/media-upload-chunked)端点。这样服务器即可异步处理 GIF 文件，这是处理较大文件的必要条件。传入 `media_category=tweet_gif`，即可为包含动态 GIF 的帖子启用异步上传。

<div id="video-specifications-and-recommendations">
  ## 视频规格与建议
</div>

请使用异步方式进行媒体上传。

<div id="recommended">
  ### 推荐
</div>

- **视频编码**: `H264 High Profile`
- **帧率**: `30 FPS`、`60 FPS`
- **视频分辨率**: `1280x720`（横屏）、`720x1280`（竖屏）、`720x720`（正方形）。订阅用户可上传 1080p 视频并获得 1080p 播放；未订阅用户可上传 720p 视频并获得 720p 播放。
- **最低视频比特率**: `5,000 kbps`
- **最低音频比特率**: `128 kbps`
- **音频编码**: `AAC LC`
- **纵横比**: `16:9`（横屏或竖屏），`1:1`（正方形）

<div id="advanced">
  ### 高级
</div>

- **帧率**：不得超过 `60 FPS`
- **尺寸**：必须介于 `32x32` 与 `1280x1024` 之间
- **文件大小**：不得超过 `512 MB`
- **时长**：必须介于 `0.5 秒` 与 `140 秒` 之间
- **纵横比**：必须介于 `1:3` 与 `3:1` 之间
- **[像素纵横比](https://en.wikipedia.org/wiki/Pixel_aspect_ratio)**：必须为 `1:1`
- **像素格式**：仅支持 [YUV](https://en.wikipedia.org/wiki/YUV) 4:2:0
- 音频必须为 [`AAC` 的低复杂度（Low Complexity）配置](https://en.wikipedia.org/wiki/Advanced_Audio_Coding#Modular_encoding)（不支持高效 `AAC`）
- 音频必须为 `单声道（mono）` 或 `立体声（stereo）`，不支持 5.1 或更高
- 不得使用 [`开放式 GOP（open GOP）`](https://en.wikipedia.org/wiki/Group_of_pictures)
- 必须使用 [`逐行扫描（progressive scan）`](https://en.wikipedia.org/wiki/Progressive_scan)

<div id="additional-information">
  ### 其他信息
</div>

下表中的每一行都提供了上传建议，但并非强制要求。所有上传内容都会针对多平台进行优化处理。

| 方向 | 宽度 | 高度 | 视频码率 | 音频码率 |
| :--- | :--- | :--- | :--- | :--- |
| 横向 | 1280 | 720 | 2048K | 128K |
| 横向 | 640 | 360 | 768K | 64K |
| 横向 | 320 | 180 | 256K | 64K |
| 纵向 | 720 | 1280 | 2048K | 128K |
| 纵向 | 360 | 640 | 768K | 64K |
| 纵向 | 180 | 320 | 256K | 64K |
| 方形 | 720 | 720 | 2048K | 128K |
| 方形 | 480 | 480 | 768K | 64K |
| 方形 | 240 | 240 | 256K | 32K |

有关媒体上传示例，请参阅[分块式媒体上传文档](/zh/x-api/media/quickstart/media-upload-chunked)。

<div id="troubleshooting">
  ### 疑难解答
</div>

如果遇到 Media API 相关问题，请前往开发者论坛的 [Media API 分类](https://devcommunity.x.com/c/x-api/media-apis) 查找答案。