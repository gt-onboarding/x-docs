---
title: 快速入门
sidebarTitle: 快速入门
---

import { Button } from '/snippets/zh/button.mdx';

<div id="getting-started-with-the-batch-compliance-endpoints">
  ## 批量合规端点入门
</div>

使用批量合规端点通常包括 5 个步骤：

1. 创建合规作业
2. 准备帖子 ID 或用户 ID 列表
3. 上传帖子 ID 或用户 ID 列表
4. 检查合规作业的状态
5. 下载结果

在本节中，我们将学习如何使用命令行完成上述每个步骤。若要查看不同编程语言的示例代码，请访问我们的 [X API v2 示例代码 GitHub 仓库](https://github.com/xdevplatform/Twitter-API-v2-sample-code)。

<div id="prerequisites">
  ### 先决条件
</div>

要完成本指南，您需要一组用于对请求进行身份验证的[keys and tokens](/zh/resources/fundamentals/authentication)。您可以按照以下步骤生成这些密钥和令牌：

- [注册开发者账户](https://developer.x.com/en/apply-for-access)并通过审批。
- 在开发者门户中创建一个[项目](/zh/resources/fundamentals/projects)以及关联的[开发者应用](/zh/resources/fundamentals/developer-apps)。
- 前往您的应用的“Keys and tokens”页面生成所需的凭证。请务必将所有凭证保存在安全位置。

<div id="step-one-create-a-compliance-job">
  #### 第一步：创建合规作业
</div>

首先，需要创建一个合规作业，并通过 type 参数指定将上传帖子 ID 还是用户 ID。你也可以选择使用 name 参数为作业命名。

要为此请求授权，需要使用[仅应用](/zh/resources/fundamentals/authentication#app-only-authentication-and-oauth-2-0-bearer-token)方式。请将下方的 $APP\_ACCESS\_TOKEN 替换为你在开发者门户的[X 应用](/zh/resources/fundamentals/developer-apps)中生成的[应用访问令牌](/zh/resources/fundamentals/authentication#using-and-generating-an-app-only-bearer-token)。

`curl --request POST 'https://api.x.com/2/compliance/jobs' \ --header 'Authorization: Bearer $APP_ACCESS_TOKEN' \ --header 'Content-Type: application/json' \ --data-raw '{"type": "tweets"}'`

如果 API 调用成功，你将收到类似如下的响应：

```
{
   "data": {
       "download_expires_at": "2021-08-18T19:42:55.000Z",
       "status": "created",
       "upload_url": "https://storage.googleapis.com/twttr-tweet-compliance/1425543269983784962/submission/1202726487847104512_1425543269983784962?X-Goog-Algorithm=GOOG4-RSA-SHA256&X-Goog-Credential=complianceapi-public-svc-acct%40twttr-compliance-public-prod.iam.gserviceaccount.com%2F20210811%2Fauto%2Fstorage%2Fgoog4_request&X-Goog-Date=20210811T194255Z&X-Goog-Expires=900&X-Goog-SignedHeaders=content-type%3Bhost&X-Goog-Signature=355e4c4739ae508304d3df15b4e13e64b6c7752d8d79d73676a4d8e60dc5241f83924ad2a1f8b7bddcc768062bb9c64d39b8e8f7cce7f66ffbea9f9ed33a4da975b3a2c127fb738c1c1ff3c3964bd4d9dc0706e6c8a70e67522160ea774e090d2793e06f890d1158ce86be3031c1c471b74f961b6f18743a28730611000336286ad0111b41fb5d14aa813ff00cf06b3572dc68d0b3c6fdc07f25c1b1196c1af4325a9ead68994944bbef0d2123585ea051deb9765aa7f5832446440bc9ba76af327b69df1fd7b1a99bd4419c128f1f697dbbacbc62bbc7c2c9aebc82a2128be0ed05d48a54d814162daad1232a0d13081e9543ab8557f567149af82281193f37",
       "created_at": "2021-08-11T19:42:55.000Z",
       "resumable": false,
       "id": "1425543269983784962",
       "type": "tweets",
       "download_url": "https://storage.googleapis.com/twttr-tweet-compliance/1425543269983784962/delivery/1202726487847104512_1425543269983784962?X-Goog-Algorithm=GOOG4-RSA-SHA256&X-Goog-Credential=complianceapi-public-svc-acct%40twttr-compliance-public-prod.iam.gserviceaccount.com%2F20210811%2Fauto%2Fstorage%2Fgoog4_request&X-Goog-Date=20210811T194255Z&X-Goog-Expires=604800&X-Goog-SignedHeaders=host&X-Goog-Signature=0a11dd5a3c5adb508f32ce904568abada863dc9499ba2adeafb3452ccee0dcb3dade17910dbc502dcbe54c130ac4d8638eb176c8b7344de068139b06c970794efa6312f0a5149f40da441eafcaf475f670c93ca73951999902a531d34dfab1e5490918929e5b06ae803b5604e0c0c26852255ccdbc79a2c1e2eefe924e5e6bf5b6603a7f287d1621333b9548ec6cc203716070528bebc2e67c12e92b1f4e54471db92c15a54799f2b855ae224250ca44c47993fd7d79a4940a0f68fe09f73fc8b291e88cfd10ade860b4b35c2b964d1777c1d93cd300c313138d9ca90aa8b3ecd3bf9dc73d3ebe32ba7634228fe07e1e4ecdda57cd94c802afc520162735d5a3",
       "upload_expires_at": "2021-08-11T19:57:55.000Z"
   }
}
```

请记录 upload\_url、download\_url 和 id 字段的值；在接下来的步骤中你将需要它们。

<div id="step-two-prepare-a-list-of-post-ids-or-user-ids">
  #### 步骤二：准备帖子 ID 或用户 ID 列表
</div>

创建一个包含帖子 ID 或用户 ID 的文本文件，每行只包含一个帖子 ID 或用户 ID。该文本文件的内容可能如下所示：

1417856744319971329

1415457498803232770

1415348607813832708

1413515358766452738

. . .

. . .

<Note>
  **注意**：上述文件只能包含帖子 ID 或用户 ID 之一，不能混合使用。

  你可以通过 **PUT** 请求将文件直接上传到此 URL。请注意，该 URL 已使用身份验证令牌完成签名，因此无需再次携带你的 App Access Token 进行认证。请务必添加 Content-Type 头以表明你正在上传文本文件，并将下方的 $FILE\_LOCATION 替换为你的文件路径。
</Note>

```
curl -X PUT  \
 -H "Content-Type: text/plain" \
 --data-binary @$FILE_LOCATION \
"https://storage.googleapis.com/twitter-compliance/customer_test_object_123456_d8ske9.json?X-Goog-Algorithm=\nGOOG4-RSA-SHA256&X-Goog-Credential=example%40example-project.iam.gserviceaccount\n.com%2F20181026%2Fus-central-1%2Fstorage%2Fgoog4_request&X-Goog-Date=20181026T18\n1309Z&X-Goog-Expires=900&X-Goog-SignedHeaders=host&X-Goog-Signature=247a2aa45f16\n9edf4d187d54e7cc46e4731b1e6273242c4f4c39a1d2507a0e58706e25e3a85a7dbb891d62afa849\n6def8e260c1db863d9ace85ff0a184b894b117fe46d1225c82f2aa19efd52cf21d3e2022b3b868dc\nc1aca2741951ed5bf3bb25a34f5e9316a2841e8ff4c530b22ceaa1c5ce09c7cbb5732631510c2058\n0e61723f5594de3aea497f195456a2ff2bdd0d13bad47289d8611b6f9cfeef0c46c91a455b94e90a\n66924f722292d21e24d31dcfb38ce0c0f353ffa5a9756fc2a9f2b40bc2113206a81e324fc4fd6823\na29163fa845c8ae7eca1fcf6e5bb48b3200983c56c5ca81fffb151cca7402beddfc4a76b13344703\n2ea7abedc098d2eb14a7"
```

状态码 200 表示上传成功。

<div id="step-three-optional-check-your-job-status">
  #### 步骤三（可选）：检查作业状态
</div>

大文件上传可能需要一些时间处理。您可以通过指定在第一步中获取的作业 ID，向内容合规作业端点请求状态更新。

同样，请务必将下方的 $APP\_ACCESS\_TOKEN 替换为您的 App Access Token，并将 $ID 替换为第一步中的作业 ID。

`curl --request GET 'https://api.x.com/2/compliance/jobs/$ID' \ --header 'Authorization: Bearer $APP_ACCESS_TOKEN'`

响应将包含有关该作业的信息。

```
{
   "data": {
       "upload_expires_at": "2021-08-05T01:50:11.000Z",
       "type": "tweets",
       "resumable": false,
       "download_url": "https://storage.googleapis.com/twttr-tweet-compliance/1423095206576984067/delivery/1202726487847104512_1423095206576984067?X-Goog-Algorithm=GOOG4-RSA-SHA256&X-Goog-Credential=complianceapi-public-svc-acct%40twttr-compliance-public-prod.iam.gserviceaccount.com%2F20210805%2Fauto%2Fstorage%2Fgoog4_request&X-Goog-Date=20210805T013511Z&X-Goog-Expires=604800&X-Goog-SignedHeaders=host&X-Goog-Signature=09de4feae68a6d4449eb7ce1f8f3551996552e7fba103005b3bd50ab318bb5215e4f5396ef29d17755deb6bf172b9d1dab61a04b249d39e87f6e2dbb31632b7e5f2d35f4f534e1f1522c9d7958b8745dd62471deb8d6992c80fd418628404f5f14eda3f557adf709403058910ea009e0c88ce81458ec9b915016a5c5901e2365b130db00b18fcb7da1b082e1a5c75f7bf7eeab8783675d1b6a56441ac6e9ffc972b1278a5853d2b94dda55e1a6e2068bc0ddd3cddc9213ec9cebb7cb5be931977bb28dda12c7c5e69d1f876b243f0f224076bf1b81149603319a2fc9cb82337bdbe05e7bbf184bcbdc17d43b3f5efbae72ea386d955ca10e702e00df31aabf32",
       "id": "1423095206576984067",
       "status": "expired",
       "created_at": "2021-08-05T01:35:11.000Z",
       "upload_url": "https://storage.googleapis.com/twttr-tweet-compliance/1423095206576984067/submission/1202726487847104512_1423095206576984067?X-Goog-Algorithm=GOOG4-RSA-SHA256&X-Goog-Credential=complianceapi-public-svc-acct%40twttr-compliance-public-prod.iam.gserviceaccount.com%2F20210805%2Fauto%2Fstorage%2Fgoog4_request&X-Goog-Date=20210805T013511Z&X-Goog-Expires=900&X-Goog-SignedHeaders=content-type%3Bhost&X-Goog-Signature=ba08f588bea3873aa0465cf22015e583c2851a5ff14891d22430b1127288728f1aa303673e6895694e7017739871ff5ae59bbcde7d4ac7a14aaaafba98ad22ca818e99fb3ec7eaaf74b3ecfecbfb33711869b2e85d7666609276666ef4a8b396ae9616743a0cbd773962e5850f2942cd76be7373d608a140e041ca8492017d43fac9220fa145d0b2ecaf9f752d71fc8c4b81b67c5c22aa59ac87666f7d83714fdace72894d2911a3e36dd42028d0222e71054d6b28c8ef63d0f0000f228c8680bab9c8011b87d1a6c9a60e8cc9e8b6a83abf7c47a57772746c83b19849f5b4c938ccd0922990da5f2a81ff806edcb4667bb402fb1f1f6f5162768e0661648b21",
       "download_expires_at": "2021-08-12T01:35:11.000Z"
   }
}
```

状态为 complete 表示结果已可下载。注意：其他可能的状态值包括 created、in\_progress、failed 和 expired。

<div id="step-four-download-the-results">
  #### 步骤四：下载结果
</div>

当收到作业完成状态后，你可以从 `download_url` 字段指示的 URL（也在第一步生成）下载合规结果。该 URL 已附带身份验证令牌签名，这意味着你无需再次通过传递 App Access Token 进行身份验证。

```
curl --request GET \
'https://storage.googleapis.com/twttr-tweet-compliance/1423047488781488129/delivery/1202726487847104512_1423047488781488129?X-Goog-Algorithm=GOOG4-RSA-SHA256&X-Goog-Credential=complianceapi-public-svc-acct%40twttr-compliance-public-prod.iam.gserviceaccount.com%2F20210804%2Fauto%2Fstorage%2Fgoog4_request&X-Goog-Date=20210804T222534Z&X-Goog-Expires=604800&X-Goog-SignedHeaders=host&X-Goog-Signature=8ed0fe9e9748f6be5e7e052f6635c8b5cbe62fb2d3a165278b922b28a48fb79b02d74f0bd31b4fdb32532bc6746c6082aaff2154cdab4b59c4c6561ff2c840e5f32dd13c09ff5b52376dfac1b7f97807c72209d2844a6c078b71fddf22a5493f88118802e98a60e16ce5715fce0242baddd17d4598d31be59393e1dacd22fc1eeb532572cc4e784402c5fbeb84a22dd308922e937a26fa99cb717bb26fb61b657403010121a996691814b7aeb00bc05ed25f15d394fd46899dd9390be6d5da44960e81d8018318c325c70b39d0a4fc9d65fea2b8b3355d4c7dd7c386eac1d9c09233462bde40fa3f4023d1cd6470b0346f9f36d74665dde3f716940312019703'
```

结果包含一组 JSON 对象（每行一个对象）。每个对象包含帖子或用户 ID、帖子或用户的创建时间（便于按日期定位帖子）、所需执行的操作、合规操作的原因，以及该操作的时间：

```
{"id":"1265324480517361664","action":"delete","created_at":"2019-10-29T17:02:47.000Z","redacted_at":"2020-07-29T17:02:47.000Z","reason":"deleted"}
{"id":"1263926741774581761","action":"delete","created_at":"2019-10-29T17:02:47.000Z","redacted_at":"2020-07-29T17:02:47.000Z","reason":"protected"}
{"id":"1265324480517361669","action":"delete","created_at":"2019-10-29T17:02:47.000Z","redacted_at":"2020-07-29T17:02:47.000Z","reason":"suspended"}
```

你的代码可以逐行解析 JSON，定位帖子或用户 ID，并从数据集中删除这些 ID 对应的帖子和用户，以保持合规。对于你上传的某个 ID，如没有对应的 JSON 对象，则可视为该 ID 处于合规状态。

**注意**：并非所有合规事件都会包含 `redacted_at` 字段。