<div id="v2-account-activity-api">
  # V2 账户活动 API
</div>

<Note>
  账户活动 API v2 现已在 [**Pro**](https://developer.x.com/en/portal/products) 可用！
</Note>

<div id="overview">
  ## 概述
</div>

Account Activity API（AAA）通过 webhook 提供接收与 X 用户帐号相关实时事件的方式。将特定用户帐号订阅到预先配置的 webhook 后，您的应用即可通过单一连接，从一个或多个您拥有或已订阅的帐号接收帖子、私信、点赞、关注、屏蔽等各类活动通知。\
此 API 常用于构建需要对用户操作即时响应，或基于用户活动保持最新状态的应用。对于您在 webhook 注册中订阅的每个用户，您将收到以下所有相关活动：

<div id="activity-types">
  ## 活动类型
</div>

- **帖子**（由该用户发布）
- **帖子删除**（由该用户执行）
- **@提及**（提及该用户）
- **回复**（发给该用户或来自该用户）
- **转帖**（由该用户或涉及该用户）
- **引用帖子**（由该用户或涉及该用户）
- **对引用帖的转帖**（由该用户或涉及该用户）
- **点赞**（由该用户或涉及该用户）
- **关注**（由该用户或涉及该用户）
- **取消关注**（由该用户或涉及该用户）
- **拉黑**（由该用户或涉及该用户）
- **取消拉黑**（由该用户或涉及该用户）
- **静音**（由该用户或涉及该用户）
- **取消静音**（由该用户或涉及该用户）
- **发送的私信**（由该用户发送）
- **接收的私信**（由该用户接收）
- **正在输入指示器**（发给该用户）
- **已读回执**（发给该用户）
- **订阅撤销**（由该用户执行）

**注意**：我们不通过 Account Activity API 提供首页时间线数据。请使用“按用户 ID 的用户帖子时间线”端点来获取这些数据。

通过 Account Activity API 返回的帖子将计入每月的[推文上限（帖子上限）](https://docs.x.com/zh/x-api/fundamentals/post-cap)。

<div id="feature-summary">
  ## 功能摘要
</div>

| 等级 | 价格 | 唯一订阅数量 | Webhook 数量 |
| :----- | :----- | :----- | :----- |
| Pro | $5000/月 | 3 | 1 |
| Enterprise | [联系销售](/zh/enterprise/forms/enterprise-api-interest) | 5000+ | 5+ |

本文档重点介绍如何使用 v2 Account Activity API 端点来管理与您的 Webhook 关联的用户订阅。

<div id="manage-subscriptions">
  ## 管理订阅
</div>

Account Activity API 会在与你的服务已订阅的 X 账号相关的事件发生时，通过 webhook 发送 JSON 格式的消息。X 会将这些活动推送到你注册的 webhook。按照以下步骤，你将了解如何为用户账号设置并管理订阅。

<div id="1-create-an-x-app">
  ### 1. 创建 X 应用
</div>

使用已获批准的开发者账号在[开发者门户](https://developer.x.com/en/portal/products/enterprise)创建 X 应用。若代表公司创建，请使用公司的 X 账号。

- 在应用页面的“权限”选项卡中启用“读取、写入和访问私信”。
- 在“Keys and Access Tokens”选项卡中，记录应用的 **Consumer Key (API Key)**、**Consumer Token (API Secret)** 和 **Bearer Token**。
- 生成应用的 **Access Token** 和 **Access Token Secret**。这些将在订阅用户账户时使用。
- 如果不熟悉 X 登录和用户上下文，请查看[获取访问令牌](https://developer.x.com/en/docs/authentication)。
- 在开发者门户的 “Apps” 页面记录应用的数字 ID。申请 Account Activity API 访问权限时需要该信息。

<div id="2-get-account-activity-api-access">
  ### 2. 获取 Account Activity API 访问权限
</div>

Account Activity API 仅在 Enterprise 级别提供。请通过 [developer portal](https://developer.x.com/en/portal/products/enterprise) 提交 Enterprise 访问申请。

<div id="3-register-a-webhook">
  ### 3. 注册 Webhook
</div>

要接收账户活动事件，您必须使用可公开访问的 HTTPS URL 注册一个 webhook。有关开发 webhook 消费端应用、注册 webhook、加固其安全，以及处理质询-响应校验（CRC）的详细信息，请参阅 V2 Webhooks API 文档。

- 确保您的 webhook 已配置为处理携带 JSON 编码事件负载的 POST 请求。
- 从 webhook 注册的响应中获取 **webhook\_id**，该值是管理订阅所必需的。

<div id="4-validate-setup">
  ### 4. 验证设置
</div>

要验证你的应用和 webhook 是否配置正确：

- 将一个用户账号订阅到你的 webhook（参见下方“Adding a Subscription”）。
- 给你的应用已订阅的某个 X 账号发布的帖子点一次赞。
- 你应该会通过对你的 webhook URL 发起的 POST 请求收到一个 favorite\_events 负载。
- **注意**：添加订阅后，事件开始投递可能需要长达 10 秒。

<div id="important-notes">
  ### 重要说明
</div>

- **身份验证**：在订阅用户时，请使用该用户账户的 consumer key、consumer secret、access token 和 access token secret。
- **私信**：所有收发的私信（通过 POST /2/dm\_conversations/with/:participant\_id/messages 发送）都会通过 webhook 投递，使你的应用能够了解所有私信活动。
- **事件重复**：
  - 如果两个已订阅用户在同一私信会话中，你的 webhook 将会收到重复事件（每个用户一次）。请使用 for\_user\_id 字段加以区分。
  - 如果多个应用共享相同的 webhook URL 和用户，事件会被多次发送（每个应用一次）。
  - 你的应用应使用事件 ID 进行去重，以处理偶发的重复事件。
- **示例代码**：请参阅 [Account Activity API Setup](https://github.com/xdevplatform/account-activity-dashboard-enterprise/tree/master)，查看一个用于展示 webhook 事件的 Web 应用。

<div id="managing-subscribed-users-v2-api">
  ## 管理已订阅用户（v2 API）
</div>

在已注册并拥有有效 webhook\_id 的 webhook 就绪后，你可以管理用户订阅以接收其账户活动。使用以下端点添加、查看或移除订阅。

<div id="adding-a-subscription">
  ### [添加订阅](https://docs.x.com/zh/x-api/account-activity/subscribes-the-provided-application-to-all-events-for-the-provided-user-context-for-all-message-types)
</div>

**端点**: POST /2/account\_activity/webhooks/:webhook\_id/subscriptions/all\
**描述**: 通过指定的 webhook 为当前认证用户订阅以接收事件。\
**认证**: OAuthUser（需要三方 OAuth 授权流程，代表被订阅的用户）。

- **Consumer Key**: 例如 xvz1evFS...
- **Access Token**: 例如 370773112-GmHxMAgYyLbN...

**路径参数**:

| 参数 | 描述 |
| :----- | :----- |
| webhook\_id | 要将订阅关联到的 webhook 的 ID。 |

**请求**:\
bash

```
curl --request POST --url 'https://api.twitter.com/2/account_activity/webhooks/:WEBHOOK_ID/subscriptions/all' \
--header 'authorization: OAuth oauth_consumer_key="<CONSUMER_KEY>", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="<ACCESS_TOKEN>", oauth_version="1.0"'
```

**响应**:

- **成功（200 OK）**:
- json

```
{
  "data": {
    "subscribed": true
  }
}
```

- **失败（400 Bad Request）**:

| 原因 | 描述 |
| :---- | :---- |
| WebhookIdInvalid | 提供的 webhook\_id 未找到，或未与该应用关联。 |
| DuplicateSubscriptionFailed | 指定的 webhook\_id 下已存在该用户的订阅。 |
| SubscriptionLimitExceeded | 该应用在所有 webhook 上的订阅数量已达上限。 |

###

<div id="checking-a-subscription">
  ### [检查订阅](https://docs.x.com/zh/x-api/account-activity/check-if-a-subscription-exists-for-a-given-webhook-and-user)
</div>

**端点**: GET /2/account\_activity/webhooks/:webhook\_id/subscriptions/all\
**说明**: 检查当前认证用户是否订阅了指定的 webhook。\
**认证**: OAuthUser（需要三方 OAuth 授权流程）。\
**路径参数**:

| 参数 | 说明 |
| :----- | :----- |
| webhook\_id | 要检查的 webhook 的 ID。 |

**请求**:\
bash

```
curl --request GET --url 'https://api.twitter.com/2/account_activity/webhooks/:WEBHOOK_ID/subscriptions/all' \
--header 'authorization: OAuth oauth_consumer_key="<CONSUMER_KEY>", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="<ACCESS_TOKEN>", oauth_version="1.0"'
```

**响应**:

- **成功（200 OK）**:
- json

```
{
  "data": {
    "subscribed": true // 或 false
  }
}
```

- **失败（400 Bad Request）**:

| 原因 | 说明 |
| :---- | :---- |
| WebhookIdInvalid | 提供的 webhook\_id 未找到，或未与该应用关联。 |

###

<div id="removing-subscriptions">
  ### [移除订阅](https://docs.x.com/zh/x-api/account-activity/deactivates-a-subscription-for-the-specified-webhook-and-user-id)
</div>

**Endpoint**: DELETE /2/account\_activity/webhooks/:webhook\_id/subscriptions/:user\_id/all\
**Description**: 为指定用户 ID 停用订阅，停止向该 webhook 投递事件。\
**Authentication**: OAuth 2.0 应用仅限（App Only）Bearer Token。

- **Bearer Token**: 例如：AAAAAAAAAAAA0%2EUifi76ZC9Ub0wn...

**Path Parameters**:

| Parameter | Description |
| :----- | :----- |
| webhook\_id | 托管该订阅的 webhook 的 ID。 |
| user\_id | 需要取消订阅的用户的数值型 ID。 |

**Request**:\
bash

```
curl --request DELETE --url 'https://api.twitter.com/2/account_activity/webhooks/:WEBHOOK_ID/subscriptions/:USER_ID/all' \
--header 'authorization: Bearer <BEARER_TOKEN>'
```

**Responses**:

- **Success (200 OK)**:
- json

```
{
  "data": {
    "subscribed": false
  }
}
```

- **Failure (400 Bad Request)**:

| Reason | Description |
| :---- | :---- |
| SubscriptionNotFound | 在给定的 webhook\_id 上不存在指定 user\_id 的订阅。 |
| WebhookIdInvalid | 提供的 webhook\_id 未找到，或未与该应用关联。 |

<div id="viewing-all-subscriptions">
  ### [查看所有订阅](https://docs.x.com/zh/x-api/account-activity/get-a-list-of-the-current-all-activity-type-subscriptions-for-the-specified-webhook)
</div>

**端点**: GET /2/account\_activity/webhooks/:webhook\_id/subscriptions/all/list\
**说明**: 返回当前订阅指定 webhook 的所有用户 ID 列表。\
**认证**: OAuth2 应用仅限（Bearer 令牌）。\
**路径参数**:

| 参数 | 说明 |
| :----- | :----- |
| webhook\_id | 要列出其订阅的 webhook 的 ID。 |

**请求**:\
bash

```
curl --request GET --url 'https://api.twitter.com/2/account_activity/webhooks/:WEBHOOK_ID/subscriptions/all/list' \
--header 'authorization: Bearer <BEARER_TOKEN>'
```

**响应**:

- **成功（200 OK）**:
- json

```
{
  "data": {
    "application_id": "<your app id>",
    "webhook_id": "<webhook id>",
    "webhook_url": "<the webhook's callback url>",
    "subscriptions": [
      { "user_id": "<user_id_1>" },
      { "user_id": "<user_id_2>" }
    ]
  }
}
```

- **失败（400 Bad Request）**:

| 原因 | 说明 |
| :---- | :---- |
| WebhookIdInvalid | 提供的 webhook\_id 未找到，或与该应用不匹配。 |

###

<div id="subscriptions-count">
  ### [订阅计数](https://docs.x.com/zh/x-api/account-activity/get-a-count-of-subscriptions-that-are-currently-active-on-your-account)
</div>

**端点**: GET /2/account\_activity/subscriptions/count\
**描述**: 返回当前活跃订阅的总数，以及用于进行身份验证的应用所获配的上限。\
**认证**: OAuth2 应用专用 Bearer 令牌。\
**请求**:\
bash

```
curl --request GET --url 'https://api.twitter.com/2/account_activity/subscriptions/count' \
--header 'authorization: Bearer <BEARER_TOKEN>'
```

**响应**:

- **成功（200 OK）**:
- json

```
{
  "data": {
    "account_name": "<your application name>",
    "provisioned_count": "<subscription limit allocated>",
    "subscriptions_count_all": "<current active subscription count>",
    "subscriptions_count_direct_messages": "0" // 仅限私信（DM）的订阅已不再支持
  }
}
```

<div id="replay">
  ## [重放](https://docs.x.com/zh/x-api/account-activity/request-activity-replay)
</div>

AAAv2 提供重放功能，允许你在指定时间范围内检索过去的事件，并将其重新投递到你的 webhook。这对于恢复因停机而错过的事件非常有用。

**Endpoint**: POST /2/account\_activity/replay/webhooks/:webhook\_id/subscriptions/all

**Description**: 启动重放作业

**Authentication**: OAuth2 应用专用 Bearer 令牌

**Path Parameters**:

| Parameter | Description |
| :----- | :----- |
| webhook\_id | 要开始重放的 webhook 的 ID |

**Query Parameters**:

| Parameter | Description |
| :----- | :----- |
| from\_date | 提供事件的最早（起始）UTC 时间戳，必须为 ‘yyyymmddhhmm’ 格式。时间戳粒度为分钟，且为包含式（例如 12:00 包含第 00 分钟）。有效时间必须在过去 24 小时内（UTC），且不得比当前时间点近于 31 分钟。建议 from\_date 与 to\_date 的间隔约为 2 小时内。 |
| to\_date | 提供事件的最晚（结束）UTC 时间戳，必须为 ‘yyyymmddhhmm’ 格式。时间戳粒度为分钟，且为不包含式（例如 12:30 不包含该小时的第 30 分钟）。有效时间必须在过去 24 小时内（UTC），且不得比当前时间点近于 10 分钟。 |

**Responses**:

成功：

```
200

{
  "for_user_id": "<USER_ID>"
  "replay_event": {
    "job_id": "<REPLAY_JOB_ID>",
    "created_at": "yyyy-mm-ddThh:mm:ss.000Z"
  }
}
```

失败：

| Reason | Description |
| :---- | :---- |
| QueryParamInvalid | from\_date 早于当前时间 24 小时之前。 |
| QueryParamInvalid | from\_date 晚于 to\_date。 |
| QueryParamInvalid | from\_date 是未来时间。 |
| QueryParamInvalid | to\_date 是未来时间。 |
| QueryParamInvalid | from\_date 或 to\_date 的格式不正确。 |
| CrcValidationFailed | 在 CRC 验证期间从 webhook URL 收到不正确的响应。 |
| ReplayConflictError | 指定的 webhook 已有重放作业在进行中。 |
| WebhookIdInvalid | 提供的 webhook\_id 无效或未与该应用关联。  |

<div id="job-completed-messages">
  ### 作业完成消息
</div>

当你的回放作业成功完成后，X 将发送以下作业完成事件。收到此事件后，表示该作业已运行结束，你可以提交新的作业。

```
{
  "replay_job_status": {
    "webhook_id": "<WEBHOOK_ID>",
    "job_state": "Complete",
    "job_state_description": "Job completed successfully",
    "job_id": "<JOB_ID>"
  }
}
```

如果你的作业未能成功完成，我们将返回以下消息，提示你重试回放作业。收到此事件后，表示该作业已运行结束，你可以提交新的作业。

```
{
  "replay_job_status": {
    "webhook_id": "<WEBHOOK_ID>",
    "job_state": "Incomplete",
    "job_state_description": "Job failed to deliver all events, please retry your replay job",
    "job_id": "<JOB_ID>"
  }
}
```

<div id="account-activity-data-object-structure">
  ## 账户活动数据对象结构
</div>

| 对象 | 详情 |
| :----- | :----- |
| for\_user\_id | 标识与该事件关联的用户订阅。 |
| is\_blocked\_by | （条件）仅在帖子提及事件中显示：当提及该帖的用户被订阅用户屏蔽时。 |
| source | 执行动作的用户（例如，进行关注、屏蔽或静音的用户）。 |
| target | 动作的对象用户（例如，被关注、被屏蔽或被静音的用户）。 |

<div id="available-activities">
  ### 可用活动
</div>

| 消息类型 | 详情 |
| :----- | :----- |
| tweet\_create\_events | 帖子、转推、回复、@ 提及、引用推文或对引用推文的转推的发布状态。 |
| favorite\_events | 点赞事件（包含用户与目标）。 |
| follow\_events | 关注事件（包含用户与目标）。 |
| unfollow\_events | 取消关注事件（包含用户与目标）。 |
| block\_events | 屏蔽事件（包含用户与目标）。 |
| unblock\_events | 取消屏蔽事件（包含用户与目标）。 |
| mute\_events | 静音事件（包含用户与目标）。 |
| unmute\_events | 取消静音事件（包含用户与目标）。 |
| user\_event | 当用户移除应用授权时的撤销事件（订阅将自动删除）。 |
| direct\_message\_events | 已发送或已接收消息的私信状态。 |
| direct\_message\_indicate\_typing\_events | 私信“正在输入”事件（包含用户与目标）。 |
| direct\_message\_mark\_read\_events | 私信“已读”事件（包含用户与目标）。 |
| tweet\_delete\_events | 用于合规的帖子删除通知。 |
| spaces\_events | 目前不支持，敬请期待。 |

<div id="payload-examples">
  ## 负载示例
</div>

以下是各类 Account Activity 事件的负载示例。

### tweet\_create\_events（帖子、转发、回复、引用帖子）

```json
{
  "for_user_id": "2244994945",
  "tweet_create_events": [
    {
      <Tweet Object>
    }
  ]
}
```

###

### tweet\_create\_events（@ 提及）

```json
{
  "for_user_id": "2244994945",
  "user_has_blocked": "false",
  "tweet_create_events": [
    {
      <Tweet Object>
    }
  ]
}
```

### favorite\_events

```json
{
  "for_user_id": "2244994945",
  "favorite_events": [{
    "id": "a7ba59eab0bfcba386f7acedac279542",
    "created_at": "Mon Mar 26 16:33:26 +0000 2018",
    "timestamp_ms": 1522082006140,
    "favorited_status": {
      <Tweet Object>
    },
    "user": {
      <User Object>
    }
  }]
}
```

### follow\_events

```json
{
  "for_user_id": "2244994945",
  "follow_events": [{
    "type": "follow",
    "created_timestamp": "1517588749178",
    "target": {
      <User Object>
    },
    "source": {
      <User Object>
    }
  }]
}
```

### 取消关注事件（unfollow\_events）

```json
{
  "for_user_id": "2244994945",
  "follow_events": [{
    "type": "unfollow",
    "created_timestamp": "1517588749178",
    "target": {
      <User Object>
    },
    "source": {
      <User Object>
    }
  }]
}
```

### block\_events

```json
{
  "for_user_id": "2244994945",
  "block_events": [{
    "type": "block",
    "created_timestamp": "1518127020304",
    "source": {
      <User Object>
    },
    "target": {
      <User Object>
    }
  }]
}
```

### unblock\_events

```json
{
  "for_user_id": "2244994945",
  "block_events": [{
    "type": "unblock",
    "created_timestamp": "1518127020304",
    "source": {
      <用户对象>
    },
    "target": {
      <用户对象>
    }
  }]
}
```

### mute\_events

```json
{
  "for_user_id": "2244994945",
  "mute_events": [
    {
      "type": "mute",
      "created_timestamp": "1518127020304",
      "source": {
        <用户对象>
      },
      "target": {
        <用户对象>
      }
    }
  ]
}
```

### 取消静音事件（unmute\_events）

```json
{
  "for_user_id": "2244994945",
  "mute_events": [
    {
      "type": "unmute",
      "created_timestamp": "1518127020304",
      "source": {
        <User Object>
      },
      "target": {
        <User Object>
      }
    }
  ]
}
```

### user\_event

```json
{
  "user_event": {
    "revoke": {
      "date_time": "2018-05-24T09:48:12+00:00",
      "target": {
        "app_id": "13090192"
      },
      "source": {
        "user_id": "63046977"
      }
    }
  }
}
```

### direct\_message\_events

```json
{
  "for_user_id": "4337869213",
  "direct_message_events": [{
    "type": "message_create",
    "id": "954491830116155396",
    "created_timestamp": "1516403560557",
    "message_create": {
      "target": {
        "recipient_id": "4337869213"
      },
      "sender_id": "3001969357",
      "source_app_id": "13090192",
      "message_data": {
        "text": "Hello World!",
        "entities": {
          "hashtags": [],
          "symbols": [],
          "user_mentions": [],
          "urls": []
        }
      }
    }
  }],
  "apps": {
    "13090192": {
      "id": "13090192",
      "name": "FuriousCamperTestApp1",
      "url": "https://x.com/furiouscamper"
    }
  },
  "users": {
    "3001969357": {
      "id": "3001969357",
      "created_timestamp": "1422556069340",
      "name": "Jordan Brinks",
      "screen_name": "@furiouscamper",
      "location": "Boulder, CO",
      "description": "另一个身份 - X PE 观点仅代表个人立场",
      "url": "https://t.co/SnxaA15ZuY",
      "protected": false,
      "verified": false,
      "followers_count": 22,
      "friends_count": 45,
      "statuses_count": 494,
      "profile_image_url_https": "https://pbs.twimg.com/profile_images/851526626785480705/cW4WTi7C_normal.jpg"
    },
    "4337869213": {
      "id": "4337869213",
      "created_timestamp": "1448312972328",
      "name": "Harrison Test",
      "screen_name": "@Harris_0ff",
      "location": "Burlington, MA",
      "protected": false,
      "verified": false,
      "followers_count": 8,
      "friends_count": 8,
      "statuses_count": 240,
      "profile_image_url_https": "https://abs.twimg.com/sticky/default_profile_images/default_profile_normal.png"
    }
  }
}
```

### direct\_message\_indicate\_typing\_events

```json
{
  "for_user_id": "4337869213",
  "direct_message_indicate_typing_events": [{
    "created_timestamp": "1518127183443",
    "sender_id": "3284025577",
    "target": {
      "recipient_id": "3001969357"
    }
  }],
  "users": {
    "3001969357": {
      "id": "3001969357",
      "created_timestamp": "1422556069340",
      "name": "Jordan Brinks",
      "screen_name": "furiouscamper",
      "location": "Boulder, CO",
      "description": "Alter Ego - X PE opinions-are-my-own",
      "url": "https://t.co/SnxaA15ZuY",
      "protected": false,
      "verified": false,
      "followers_count": 23,
      "friends_count": 47,
      "statuses_count": 509,
      "profile_image_url_https": "https://pbs.twimg.com/profile_images/851526626785480705/cW4WTi7C_normal.jpg"
    },
    "3284025577": {
      "id": "3284025577",
      "created_timestamp": "1437281176085",
      "name": "Bogus Bogart",
      "screen_name": "bogusbogart",
      "protected": true,
      "verified": false,
      "followers_count": 1,
      "friends_count": 4,
      "statuses_count": 35,
      "profile_image_url_https": "https://pbs.twimg.com/profile_images/763383202857779200/ndvZ96mE_normal.jpg"
    }
  }
}
```

### direct\_message\_mark\_read\_events

```json
{
  "for_user_id": "4337869213",
  "direct_message_mark_read_events": [{
    "created_timestamp": "1518452444662",
    "sender_id": "199566737",
    "target": {
      "recipient_id": "3001969357"
    },
    "last_read_event_id": "963085315333238788"
  }],
  "users": {
    "199566737": {
      "id": "199566737",
      "created_timestamp": "1286429788000",
      "name": "Le Braat",
      "screen_name": "LeBraat",
      "location": "Denver, CO",
      "description": "data by day @X, design by dusk",
      "protected": false,
      "verified": false,
      "followers_count": 299,
      "friends_count": 336,
      "statuses_count": 752,
      "profile_image_url_https": "https://pbs.twimg.com/profile_images/936652894371119105/YHEozVAg_normal.jpg"
    },
    "3001969357": {
      "id": "3001969357",
      "created_timestamp": "1422556069340",
      "name": "Jordan Brinks",
      "screen_name": "furiouscamper",
      "location": "Boulder, CO",
      "description": "Alter Ego - X PE opinions-are-my-own",
      "url": "https://t.co/SnxaA15ZuY",
      "protected": false,
      "verified": false,
      "followers_count": 23,
      "friends_count": 48,
      "statuses_count": 510,
      "profile_image_url_https": "https://pbs.twimg.com/profile_images/851526626785480705/cW4WTi7C_normal.jpg"
    }
  }
}
```

### tweet\_delete\_events

```json
{
  "for_user_id": "930524282358325248",
  "tweet_delete_events": [
    {
      "status": {
        "id": "1045405559317569537",
        "user_id": "930524282358325248"
      },
      "timestamp_ms": "1432228155593"
    }
  ]
}
```

<div id="support-for-longform-posts">
  ## 对长文帖子的支持
</div>

V2 Account Activity API 现已支持**长文**帖子，即超过 280 个字符的帖子。当 tweet\_create\_events 负载中包含长文帖子时，text 字段仅包含前 140 个字符（或更少），并将 truncated 字段设为 true。完整的帖子内容在 extended\_tweet 对象中提供，其中包括：

- full\_text：帖子的完整文本，包括超过 280 字符限制的所有字符。
- entities：出现在完整文本中的任何实体（例如话题标签、URL、用户提及、符号），包括第 280 个字符之后的实体。
- display\_text\_range：用于展示的字符范围，涵盖完整文本。

这确保应用能够处理长文帖子的全部内容，包括在文本后部出现的提及或其他实体。下面是一个关于长文帖子的 tweet\_create\_events 负载示例：

```json
{
  "for_user_id": "1603419180975409153",
  "tweet_create_events": [
    {
      "created_at": "Mon May 19 14:01:46 +0000 2025",
      "id": 1924465506158879000,
      "id_str": "1924465506158878979",
      "text": "The Antikythera Mechanism: A Window into Ancient Ingenuity Discovered in 1901 among the wreckage of a Roman ship of… https://t.co/bzbEKj8cd8",
      "display_text_range": [
        0,
        140
      ],
      ...
      "user": {
        ...
      },
      ...
      "extended_tweet": {
        "full_text": "安提凯希拉机械：窥见古代匠心之窗。1901 年在希腊安提凯希拉岛附近一艘罗马船只残骸中出土的安提凯希拉机械，常被誉为世界上第一台模拟计算机。这个精巧的青铜装置可追溯至公元前约 100 年，其复杂的设计与神秘用途令历史学家、考古学家和科学家为之着迷。该机械由复杂的齿轮系统构成，精密打造以执行在当时已相当超前的计算。它的发现动摇了人们对古代技术能力的长期认知。安提凯希拉机械的主要功能似乎是天文计算。它能够预测太阳、月亮及可能的行星位置，追踪月食与日食，甚至计算奥林匹克运动会的日期。装置上的表盘与指针，并配以古希腊文铭刻，显示其兼具科学研究与文化活动之用。其精度可与 19 世纪的制表工艺相媲美，凸显了其创造者（可能来自希腊化世界）的非凡才智。尽管研究已历数十年，仍有诸多疑问未解：谁制造了它？为谁而作？它是孤品杰作，还是本属一套已湮没于历史的机械传统？X 射线成像与现代计算技术揭示了其内部运作的诸多细节，但其全部能力范围仍存争议。有人认为它用于占星预测，亦有人视其为天文学教学工具。安提凯希拉机械是人类好奇心与创新精神的见证，架起古今之间的桥梁。它提醒我们，即便在古代，人们也试图以复杂度不逊于当今技术的工具来理解宇宙。其经久不衰的谜团继续激发敬畏与探索，使其成为最为非凡的出土文物之一。\n@xai\n@HistoryInPics",
        "display_text_range": [
          0,
          2051
        ],
        "entities": {
          "hashtags": [],
          "urls": [],
          "user_mentions": [
            {
              "screen_name": "xai",
              "name": "xAI",
              "id": 1661523610111193000,
              "id_str": "1661523610111193088",
              "indices": [
                2032,
                2036
              ]
            },
            {
              "screen_name": "HistoryInPics",
              "name": "History Photographed",
              "id": 1582853809,
              "id_str": "1582853809",
              "indices": [
                2037,
                2051
              ]
            }
          ],
          "symbols": []
        }
      },
      ...
      "entities": {
        "hashtags": [],
        "urls": [
          {
            "url": "https://t.co/bzbEKj8cd8",
            "expanded_url": "https://twitter.com/i/web/status/1924465506158878979",
            "display_url": "twitter.com/i/web/status/1…",
            "indices": [
              117,
              140
            ]
          }
        ],
        "user_mentions": [],
        "symbols": []
      },
      ...
    }
  ]
}
```

<div id="account-activity-api-migrating-from-legacy-enterprise-to-v2">
  ## 将 Account Activity API 从旧版企业版迁移到 v2
</div>

请参阅我们的[迁移指南](https://docs.x.com/zh/x-api/account-activity/migrate/overview)。

<div id="frequently-asked-questions">
  ## 常见问题
</div>

**使用 Account Activity API 有哪些优势？**

Account Activity API 使用 webhooks，在无需保持长连接（不同于流式 API）或频繁轮询（不同于 REST API）的情况下实时传递数据。优势包括：

- **速度**：以 X 的速度传递数据。
- **简洁**：通过单一 webhook 连接提供所有账户事件，包括帖子、@提及、回复、转帖、引用帖、点赞、私信、关注、拉黑和静音。
- **规模**：在企业级（Enterprise）对受管账户的所有活动提供支持，无速率限制或事件上限。

**我需要为 Account Activity API 设置开发、预发布和生产环境，这可以吗？**

可以！你可以注册多个 webhook URL，并通过 [V2 Webhooks API](https://docs.x.com/zh/x-api/webhooks/introduction) 分别管理订阅。

**是否有按步骤的指南帮助我开始使用 Account Activity API？**

有！请参阅 [Webhooks 入门指南](https://docs.x.com/zh/x-api/webhooks/introduction)以及 [Account Activity API 示例应用](https://github.com/m-rosinsky/XWebhookTest/blob/main/app.py)。

**使用 Account Activity API 需要采用哪种身份验证方式？**

身份验证要求按端点而定。详情请查看[身份验证部分](https://developer.x.com/en/docs/authentication)。

**如果我订阅了彼此互动的用户，会收到重复的活动吗？**

会。如果你的应用为用户 A 和用户 B 都创建了订阅，而用户 A 在一条帖子中提及了用户 B，你的 webhook 会收到两个事件（每个用户一个）。请使用 for\_user\_id 字段来识别订阅。

**当我向我的 webhook 发起订阅时，是否可以将端点中的** /all/ **部分替换为其他账户活动数据对象，以限制传递的活动？**

不可以。/all/ 是唯一选项，会传递所有支持的事件类型。

**如果我有三个 webhooks 的访问权限，我能否为我注册用于企业用途的每个应用分别使用三个 webhooks？**

webhook 限制设置在账户级，而不是应用级。举例来说，如果你有三个 webhooks 和两个应用，你可以为一个应用使用两个 webhook、另一个应用使用一个，但不能为每个应用分别使用三个。

<div id="account-activity-api-reference-index">
  ## 账户活动 API 参考索引
</div>

| 目的 | V2 端点 |
| :----- | :----- |
| 将应用订阅到某个账户的事件 | POST /2/account\_activity/webhooks/:webhook\_id/subscriptions/all |
| 返回当前活动订阅的计数 | GET /2/account\_activity/subscriptions/count |
| 检查某个 webhook 是否已订阅某个账户 | GET /2/account\_activity/webhooks/:webhook\_id/subscriptions/all |
| 返回当前活动订阅列表 | GET /2/account\_activity/webhooks/:webhook\_id/subscriptions/all/list |
| 使用仅应用 OAuth 停用订阅 | DELETE /2/account\_activity/webhooks/:webhook\_id/subscriptions/:user\_id/all |
| 创建重放作业 | POST /2/account\_activity/replay/webhooks/:webhook\_id/subscriptions/all |

有关 webhook 管理端点（注册、查看、验证、删除），请参见 [V2 Webhooks API 文档](https://docs.x.com/zh/x-api/webhooks/introduction)