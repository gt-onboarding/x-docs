---
title: 快速开始
sidebarTitle: 快速开始
---

import { Button } from '/snippets/zh/button.mdx';

<div id="getting-started-with-the-manage-direct-message-endpoints">
  ## 开始使用管理私信端点
</div>

本快速入门指南将帮助你使用 Postman（一款用于管理和发起 HTTP 请求的工具）向私信端点发送第一个请求。想了解更多我们的 Postman 集合，请参阅[使用 Postman](/zh/tutorials/postman-getting-started)指南。

如果你想查看基于 Python 的示例，请访问我们的 [X API v2 示例代码](https://github.com/xdevplatform/Twitter-API-v2-sample-code) GitHub 代码库。此外，官方的 [X Developer Platform 软件开发工具包（SDK）](/zh/x-api/tools-and-libraries/sdks) 将更新以支持这些私信端点。 

<Note>
  **先决条件**

  完成本指南前，你需要一组用于为请求进行身份验证的[密钥和令牌](/zh/resources/fundamentals/authentication)。你可以按照以下步骤生成这些密钥和令牌：

  - [注册开发者账户](https://developer.x.com/en/apply-for-access)并获得批准。
  - 在开发者门户中创建[项目](/zh/resources/fundamentals/projects)及其关联的[开发者应用](/zh/resources/fundamentals/developer-apps)。
  - 前往应用的“Keys and tokens”页面生成所需凭据。请确保将所有凭据妥善保管。
</Note>

<div id="steps-to-building-manage-direct-message-requests">
  ### 构建并管理私信请求的步骤
</div>

在本示例中，我们会在一次请求中创建一个新的群组会话并添加第一条消息。随后，再向该会话添加第二条消息。

<div id="step-one-start-with-a-tool-or-library">
  #### 步骤一：从工具或库开始
</div>

要开始使用管理私信端点，我们将使用 Postman 工具来简化流程。我们将使用由 XDev 编写的 X API v2 示例请求集合，来探索用于创建新私信和列出私信会话事件的六个端点。

虽然集合的大部分内容已预填，但你需要根据用于承载这些 API 请求的 X 应用提供一些详细信息。首先，让我们加载/更新该集合。

要将 X API v2 的 Postman 集合加载到你的环境中，请点击以下按钮：

<Button href="https://app.getpostman.com/run-collection/9956214-784efcda-ed4c-4491-a4c0-a26470a67400">
  将 X API v2 添加到 Postman
</Button>

在你将 X API v2 集合加载到 Postman 后，导航到“Manage Direct Messages”文件夹。该文件夹的 Authorization 选项卡在可能的情况下已预填，你可以更新一些设置以共享你的 X 应用的身份验证信息。此文件夹还包含三个用于创建新私信的端点。注意，还有一个“Direct Message lookup”文件夹，包含三个用于检索私信会话事件的端点，包括发送与接收消息，以及会话参与者加入与离开时的事件。 

由于创建群组会话是 X API v2 的一项令人期待的新功能，本示例将重点介绍这一点。我们将使用“New group DM and conversation”示例，通过该请求创建一个私信群组会话。

下一步是对该端点进行身份验证。

**步骤二：为你的请求进行身份验证**

要正确地向 X API 发起请求，你需要验证你拥有相应权限。为了成功调用该端点，我们将使用 [OAuth 2.0 Authorization Code Flow with PKCE](zh/resources/fundamentals/authentication#oauth-2-0-authorization-code-flow-with-pkce-2)。你可以在 Postman 中生成访问令牌。 

在 Postman 中，你可以在文件夹级别或请求级别设置身份验证方法。这里我们将在文件夹级别配置身份验证信息。

导航到“Manage Direct Messages”文件夹，选择“Authorization”选项卡，确认 Type 设置为 “OAuth 2.0”，且“Add auth data to”设置为“Request Headers”。在“Current Token”部分，确保“header Prefix”设置为 Bearer。  

配置并生成新令牌：

1. 创建一个 Token Name，例如“Manage DMs”。

2. 确认 **Grant Type** 设置为 Authorization Code（with PKCE）。

3. 设置你的 **Callback URL**。你需要将 Callback URL 更新为与你在 [v2 Dev Portal](https://developer.x.com/en/portal/dashboard) 中与应用关联的 Callback URL 完全一致。对于本示例使用的 X 应用，Callback URL 设置为 - [_https://www.example.com_.](https://www.example.com/)（注意由于必须完全匹配，[_https://example.com_](https://example.com) 将无法使用。） 

4. 确认 **Auth URL** 设置为 [https://x.com/i/oauth2/authorize](https://x.com/i/oauth2/authorize)。

5. 确认 **Access Token URL** 设置为 [https://api.x.com/2/oauth2/token.](https://api.x.com/2/oauth2/token)**Client ID** - 从 Developer Portal 复制并粘贴 OAuth 2.0 client ID\
   **Client Secret** - 仅当你使用的应用类型为保密客户端时才需要此项。若是，请从 Developer Portal 复制并粘贴 OAuth 2.0 Client Secret。 

6. 确认 **Scope** 设置为 dm.read、dm.write、tweet.read 和 users.read。

7. 确认 **State** 设置为“state”。

8. 确认 **Client Authentication** 设置为 Send as Basic Auth header。

9. 点击 **Get New Access Token**，在“Sign-in with X”流程中点击“Authorize app”。

10. 点击“Proceed”按钮，然后点击“Use Token”以生成令牌。 

11. 点击“Save”按钮保存这些配置信息。

你可能会收到一条提示你尚未登录 X 的消息。如果出现此错误，你需要在 Postman 内登录你打算代表其发帖的 X 账户。

现在已在文件夹级别设置这些 OAuth 2.0 详细信息，请前往每个示例的 “Authorization” 选项卡，确认其 Type 已设置为 “Inherit auth from parent”。

请注意，此令牌即将过期，您需要点击 “Get New Access Token” 按钮重新生成。点击后将触发 “Sign in with X” 流程，并生成一个新的令牌用于发起请求。

<div id="step-three-specify-the-direct-message-conversation-participants-and-message-contents">
  #### 第三步：指定私信会话的参与者和消息内容
</div>

转到“Body”选项卡，并更新示例 JSON 对象。将 participant\_ids 属性设置为你希望发送私信的账号。

`{
   "message": {"text": "Hello to just you two, this is a new group conversation."},
   "participant_ids": ["944480690","906948460078698496"],
   "conversation_type": "Group"
}`

<div id="step-four-make-your-request-and-review-the-response">
  #### 第四步：发起请求并查看响应
</div>

完成所有设置后，点击“Send”按钮，您将收到与下方示例响应类似的结果。提醒一下，如果自上方创建令牌后令牌已过期，您可以返回该文件夹的 Authorization 选项卡并点击“Get New Access Token”以创建新的令牌。

```
{
   "data": {
       "dm_conversation_id": "1582103724607971328",
       "dm_event_id": "1582103724607971332"
   }
}
```

如果返回的响应 data 对象包含 dm\_conversation\_id 和 dm\_event\_id，则表示您已成功创建新的私信会话。要开始查询与此会话相关的事件，请前往“私信查询”快速入门指南。

<div id="step-five-add-another-message-to-that-group-conversation">
  #### 第五步：向该群组会话再添加一条消息
</div>

现在选择“Add DM to conversation”示例，并切换到“Params”选项卡。在“Path Variables”下，将 dm\_conversation\_id 更新为你在上面创建的会话 ID。

|     |     |
| :--- | :--- |
| **Key** | **Value** |
| dm\_conversation\_id | 1582103724607971328 |

使用该会话 ID，请求路径将解析为：https://api.x.com/2/dm\_conversations/1582103724607971328/messages

同时，在“Body”选项卡中更新请求 JSON，包含你要发送的消息文本：

```
{
   "text": "Adding a new message to our group conversation..."
}
```

完成所有设置后，点击“Send”按钮，你将收到与下方示例相似的响应：

```
{
   "data": {
       "dm_conversation_id": "1582103724607971328",
       "dm_event_id": "1582106224379559940"
   }
}
```