---
title: 快速开始
sidebarTitle: 快速开始
---

import { Button } from '/snippets/zh/button.mdx';

<div id="getting-started-with-the-manage-direct-message-endpoints">
  ## 开始使用私信管理端点
</div>

本快速入门指南将帮助你使用 Postman（一款用于管理并发起 HTTP 请求的工具）向私信管理端点发出你的第一个请求。要了解更多关于我们的 Postman 集合，请参阅[使用 Postman](/zh/tutorials/postman-getting-started)指南。

如果你想查看基于 Python 的示例，请访问我们的 [X API v2 示例代码](https://github.com/xdevplatform/Twitter-API-v2-sample-code) GitHub 仓库。此外，官方的 [X Developer Platform 软件开发工具包（SDK）](/zh/x-api/tools-and-libraries/sdks) 将更新以支持这些私信端点。

<Note>
  **先决条件**

  要完成本指南，你需要一组用于对请求进行身份验证的[密钥和令牌](/zh/resources/fundamentals/authentication)。你可以按照以下步骤生成这些密钥和令牌：

  - [注册开发者账户](https://developer.x.com/en/apply-for-access)并通过审核。
  - 在开发者门户中创建一个[项目](/zh/resources/fundamentals/projects)以及关联的[开发者应用](/zh/resources/fundamentals/developer-apps)。
  - 前往你的应用的“Keys and tokens”页面生成所需凭证。请务必将所有凭证保存在安全位置。
</Note>

<div id="steps-to-building-direct-message-lookup-requests">
  ### 构建私信查询请求的步骤
</div>

在本示例中，我们将在一次请求中创建一个新的群聊会话并发送第一条消息，随后再向该会话发送第二条消息。

<div id="step-one-start-with-a-tool-or-library">
  #### 第一步：从工具或库入手
</div>

要开始使用管理私信的端点，我们将借助 Postman 工具来简化流程。我们会使用由 XDevelopers 编写的 X API v2 示例请求集合，来探索六个用于创建新私信以及列出私信会话事件的端点。

虽然该集合的大部分已预先填充，但仍有一些细节需要你根据用于承载这些 API 请求的 X 应用来提供。首先，让我们加载/更新该集合。

要将 X API v2 的 Postman 集合加载到你的环境中，请点击以下按钮：

<Button href="https://app.getpostman.com/run-collection/9956214-784efcda-ed4c-4491-a4c0-a26470a67400">
  将 X API v2 添加到 Postman
</Button>

在你将 X API v2 集合加载到 Postman 后，导航到“Manage Direct Messages”文件夹。该文件夹的 Authorization 选项卡在可行的情况下已预先填充。你需要更新部分设置以填写你的 X 应用的身份验证信息。

该文件夹还包含三个用于创建新私信的端点。请注意，还有一个“Direct Message lookup”文件夹，其中提供三个端点用于检索私信会话事件，包括消息的发送与接收，以及会话参与者加入和离开的事件。

由于创建群组会话是 X API v2 的新功能，本示例将重点演示该功能。我们将使用“New group DM and conversation”示例，通过此请求创建一个私信群组会话。

下一步是对该端点进行身份验证。

<div id="step-two-authenticate-your-request">
  #### 步骤二：为请求进行身份验证
</div>

要正确向 X API 发起请求，您需要验证自己是否拥有相应权限。为成功调用此端点，我们将使用 [OAuth 2.0 Authorization Code Flow with PKCE](zh/resources/fundamentals/authentication#oauth-2-0-authorization-code-flow-with-pkce-2)。您可以在 Postman 中生成访问令牌。

使用 Postman，您可以在文件夹级或请求级设置身份验证方法。此处我们将在文件夹级配置身份验证信息。进入 “Manage Direct Messages” 文件夹，选择 “Authorization” 选项卡，确认 Type 设置为 “OAuth 2.0”，且 “Add auth data to” 设置为 “Request Headers”。在 “Current Token” 部分，确保 “Header Prefix” 设置为 Bearer。

配置并生成新令牌：

1. 创建一个令牌名称，例如 “DM lookup”。

2. 确认 **Grant Type** 设置为 Authorization Code (with PKCE)。

3. 设置 **Callback URL**。您需要将 Callback URL 更新为与您在 [v2 Dev Portal](https://developer.x.com/en/portal/dashboard) 中应用所配置的 Callback URL 完全一致。在本示例所用的 X 应用中，Callback URL 设置为 [https://www.example.com/](https://www.example.com/)（注意必须完全匹配，[https://example.com](https://example.com) 将无法使用）。

4. 确认 **Auth URL** 设置为 [https://x.com/i/oauth2/authorize](https://x.com/i/oauth2/authorize)

5. 确认 **Access Token URL** 设置为 [https://api.x.com/2/oauth2/token](https://api.x.com/2/oauth2/token)。
   **Client ID** - 从 Developer Portal 复制并粘贴 OAuth 2.0 Client ID\
   **Client Secret** - 仅当您使用的是机密客户端类型的应用时才需要。如果是，请从 Developer Portal 复制并粘贴 OAuth 2.0 Client Secret。

6. 确认 **Scope** 设置为 dm.read dm.write tweet.read users.read。

7. 确认 **State** 设置为 “state”。

8. 确认 **Client Authentication** 设置为 Send as Basic Auth header。

9. 点击 “Get New Access Token”，在 “Sign-in with X” 流程中点击 “Authorize app”。

10. 点击 “Proceed”，然后点击 “Use Token” 以生成令牌。

11. 点击 “Save” 保存这些配置信息。

您可能会收到未登录 X 的提示。如果出现此错误，请在 Postman 内登录您要代为发帖的 X 账户。

现在这些 OAuth 2.0 配置已在文件夹级生效，前往各示例的 “Authorization” 选项卡，确认其 Type 设置为 “Inherit auth from parent”。

请注意，此令牌会很快过期；您需要通过点击 “Get New Access Token” 按钮重新生成。点击后将触发 “Sign-in with X” 流程并生成新的令牌用于发起请求。

<div id="step-three-retrieve-direct-messages-conversation-events">
  #### 第三步：检索私信会话事件
</div>

使用此端点检索私信会话事件时，需要指定会话 ID。会话 ID 是端点路径的一部分：https://api.x.com/2/dm\_conversations/:dm\_conversation\_id/dm\_events

在 Postman 中，转到“Params”选项卡，在“Path Variables”部分输入要检索事件的会话 ID。

设置如下：

|     |     |
| :--- | :--- |
| **Key** | **Value** |
| `dm_conversation_id` | `1228393702244134912` |

指定该会话后，生成的路径为 https://api.x.com/2/dm\_conversations/1582103724607971328/dm\_events

点击“Send”按钮后，你将在响应中收到默认的私信对象字段：id、text 和 event\_type。还会返回一个“meta”对象，包含结果数量，以及在可用情况下用于检索更多事件的分页令牌。

```
{
   "data": [
       {
           "event_type": "MessageCreate",
           "id": "1580705921830768647",
           "text": "hello to you two, this is a new group conversation."
       }
   ],
   "meta": {
       "result_count": 1,
       "next_token": "18LAA5FFPEKJA52G0G00ZZZZ",
       "previous_token": "1BLC45FFPEKJA52G0S00ZZZZ"
   }
}
```

如果你希望接收更多字段，需要在请求中通过 [field](/zh/x-api/fundamentals/fields) 和/或 [expansion](/zh/x-api/fundamentals/expansions) 参数显式指定。

在本练习中，我们将请求 dm\_event 对象的额外字段集：

1. 默认的私信对象字段：id、text 和 event\_type。

2. 额外的私信对象字段：dm\_conversation\_id、created\_at、sender\_id、attachments、participant\_ids、referenced\_tweets

在 Postman 中，转到“Params”选项卡，并在“Query Params”表中添加以下键值对：

|     |     |
| :--- | :--- |
| Key | Value |
| dm\_event.fields | dm\_conversation\_id,created\_at,sender\_id,attachments,participant\_ids,referenced\_tweets |

现在你应当能在“Send”按钮旁看到以下 URL：

https://api.x.com/2/dm\_conversations/:dm\_conversation\_id/dm\_events?dm\_event.fields=id,text,event\_type,dm\_conversation\_id,created\_at,sender\_id,attachments,participant\_ids,referenced\_tweets

<div id="step-four-make-your-request-and-review-your-response">
  #### 第四步：发起请求并查看响应
</div>

完成所有设置后，再次点击“Send”按钮，您将收到与下方类似的响应。请注意，该响应包含所有可用的 dm\_event 字段。

```
{
   "data": [
       {
           "text": "hello to you two, this is a new group conversation.",
           "id": "1580705921830768647",
           "dm_conversation_id": "1580705921830768643",
           "event_type": "MessageCreate",
           "sender_id": "17200003",
           "created_at": "2022-10-13T23:43:54.000Z"
       }
   ],
   "meta": {
       "result_count": 1,
       "next_token": "18LAA5FFPEKJA52G0G00ZZZZ",
       "previous_token": "1BLC45FFPEKJA52G0S00ZZZZ"
   }
}
```