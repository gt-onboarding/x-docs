---
title: 使用 v2 全档案搜索端点获取历史帖子
mode: wide
---

<div id="introduction">
  ## 介绍
</div>

[v2 中的搜索帖子端点](/zh/x-api/posts/search/introduction)
使你能够根据你构建的搜索查询，获取与你感兴趣主题相关的帖子。v2 搜索帖子提供两个不同的端点：近期搜索，面向所有已获批准账户的开发者，支持检索过去最多 7 天的帖子；以及全档案搜索，仅向已获批准加入
[Academic Research product track](https://developer.x.com/en/products/x-api/early-access/guide#na_2)
的研究人员开放，支持检索可追溯至 2006 年 3 月的全部帖子存档。

你可以在我们的
[搜索概览页面](/zh/x-api/posts/search/introduction)
查看完整的搜索能力。

这些搜索帖子端点覆盖了学术研究者最常见的用例之一，例如用于纵向研究，或分析既往主题或事件。

本教程为希望使用全档案搜索端点检索 X 公开数据完整历史的研究人员提供分步指南。还将演示构建数据集的不同方法，如检索带地理标签的帖子，并介绍如何对查询返回的可用帖子进行分页。

<div id="prerequisites">
  ### 先决条件
</div>

目前，此端点仅作为
[Academic Research 产品轨道](https://developer.x.com/en/solutions/academic-research/products-for-researchers) 的一部分提供。
要使用此端点，您必须
[申请访问权限](https://developer.x.com/en/portal/petition/academic/is-it-right-for-you)。
详细了解该轨道的
[申请流程和要求](https://developer.x.com/en/solutions/academic-research/application-info)。

<div id="connect-an-app-to-the-academic-project">
  ### 将应用程序连接到学术项目
</div>

获准使用 Academic Research 产品通道后，你将在
[开发者门户](https://developer.x.com/en/portal/dashboard)中看到你的学术[项目](/zh/resources/fundamentals/projects)。
在“Projects and Apps”部分，点击“Add App”，将你的
[X 应用](/zh/resources/fundamentals/developer-apps)连接到该项目。

[](https://res.cloudinary.com/practicaldev/image/fetch/s--gHFOyuDc--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/gb7aevhqyfvfjznd0pnd.png)

![此图展示了开发者门户中的一个 Academic Project，目前尚未添加 App](https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/docs/tutorials/getting-historical-tweets-using-the-full-archive-search-endpoint/dev-portal-1.png.twimg.1920.png)

接下来，你可以选择一个现有的 App 并将其连接到你的项目（如下所示）。

![此图展示了尝试向 Academic Project 添加 App 时弹出的页面](https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/docs/tutorials/getting-historical-tweets-using-the-full-archive-search-endpoint/dev-portal-2.png.twimg.1920.png)

或者创建一个新的 App，命名后点击完成，将该新 App 连接到你的 Academic Project。

![此图展示了为新 App 输入名称或选择现有 App 的页面](https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/docs/tutorials/getting-historical-tweets-using-the-full-archive-search-endpoint/dev-portal-3.png.twimg.1920.png)

完成后，你将获得 API 密钥和
[Bearer Token](/zh/resources/fundamentals/authentication#using-and-generating-an-app-only-bearer-token)，随后即可使用它们连接到全档案搜索端点。

![此图展示了创建新 App 后显示你的密钥与令牌的页面](https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/docs/tutorials/getting-historical-tweets-using-the-full-archive-search-endpoint/dev-portal-4.png.twimg.1920.png)

**请注意**

上方截图中的密钥已隐藏，但在你的开发者门户中，
你将能看到 API Key、API Secret Key 和
Bearer Token 的实际值。请保存这些密钥和 Bearer Token，因为调用全档案搜索端点时需要用到它们。

<div id="connecting-to-the-full-archive-search-endpoint">
  ### 连接到全档案搜索端点
</div>

下面的 cURL 命令展示了如何从 @XDevelopers 账户获取历史帖子。将 $BEARER\_TOKEN 替换为你的 Bearer Token，将完整请求粘贴到终端中，然后按下回车键。

```bash
curl --request GET 'https://api.x.com/2/tweets/search/all?query=from:xdevelopers' --header 'Authorization: Bearer $BEARER_TOKEN'
```

你将会看到返回的 JSON。

默认情况下，只会返回最近的 10 条帖子。若希望每次请求返回超过 10 条帖子，可使用 max\_results 参数，并将其设置为每次请求最多 500 条帖子，如下所示：

```bash
curl --request GET 'https://api.x.com/2/tweets/search/all?query=from:xdevelopers&max_results=500' --header 'Authorization: Bearer $BEARER_TOKEN'
```

###

构建查询

如上面的示例调用所示，使用 query 参数即可指定要搜索的数据。比如，如果你想获取所有包含单词 _covid_ 或 _coronavirus_ 的帖子，可以在括号内使用 OR 运算符，查询为
`(covid OR coronavirus)`，相应的 API 调用如下：

```bash
curl --request GET 'https://api.x.com/2/tweets/search/all?query=(covid%20OR%20coronavirus)&max_results=500' --header 'Authorization: Bearer $BEARER_TOKEN'
```

同样，如果你想获取所有包含 _covid19_ 且不是转帖的帖子，可以使用 is:retweet 运算符配合逻辑非（用 - 表示），查询为 covid19 -is:retweet，对应的 API 调用为：

```bash
curl --request GET 'https://api.x.com/2/tweets/search/all?query=covid19%20-is:retweet&max_results=500' --header 'Authorization: Bearer $BEARER_TOKEN'
```

查看
[此指南以获取完整的运算符列表](/zh/x-api/posts/search/integrate/build-a-query)，
这些运算符适用于全档案搜索端点。

### 使用 start\_time 和 end\_time 参数获取历史帖子

在使用全档案搜索端点时，默认返回过去 30 天内的帖子。如果你想获取早于 30 天的帖子，可以在 API 调用中使用 start\_time 和 end\_time 参数。这些参数必须符合有效的 RFC3339 日期时间格式，例如 2020-12-21T13:00:00.00Z。因此，如果你想获取 XDevelopers 账号在 2020 年 12 月的所有帖子，你的 API 调用如下：

```bash
curl --request GET 'https://api.x.com/2/tweets/search/all?query=from:XDevelopers&start_time=2020-12-01T00:00:00.00Z&end_time=2021-01-01T00:00:00.00Z' --header 'Authorization: Bearer $BEARER_TOKEN'
```

###

获取带地理标签的历史帖子

带地理标签的帖子是指附带地理信息（如城市、州/省、国家等）的帖子。

<div id="using-hasgeo-operator">
  #### 使用 has:geo 运算符
</div>

如果你要获取包含地理数据的帖子，可以使用 has:geo 运算符。
例如，下面的 cURL 请求将仅返回来自
@XDevelopers 账号且包含地理数据的帖子：

```
curl --request GET
'https://api.x.com/2/tweets/search/all?query=from:xdevelopers%20has:geo' --header
'Authorization: Bearer $BEARER_TOKEN'
```

#### 使用 place\_country 运算符

同样，你可以使用 place\_country 运算符，将带有地理数据的帖子限定在特定国家。下面的 cURL 命令将获取来自 @XDevelopers 账号、位于美国的所有帖子：

```
curl --request GET
'https://api.x.com/2/tweets/search/all?query=from:xdevelopers%20place_country:US'
--hbasheader 'Authorization: Bearer XXXXX'
```

上述示例中的国家使用 ISO alpha-2 两位字母代码指定。有效的 ISO 代码见[此处](http://en.wikipedia.org/wiki/ISO_3166-1_alpha-2)。

### 使用 next\_token 获取超过 500 条历史帖子

如上所述，默认情况下，对全档案搜索端点的每个请求最多只能获取 500 条帖子。如果你的查询可用的帖子超过 500 条，你的 JSON 响应将包含一个 next\_token。你可以将该值附加到 API 调用中，以获取此查询的下一批帖子。该 next\_token 位于 JSON 响应的 meta 对象中，类似如下所示：

```
{ "newest_id": "12345678...", "oldest_id": "12345678...", "result_count": 500,
"next_token": "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" }
```

因此，要获取下一批帖子，请从该 meta 对象中取出 next\_token 的值，并在对全档案搜索端点的 API 调用中，将其作为 next\_token 参数传递，如下所示（你将使用自己的 Bearer Token，以及上一次 API 调用返回的 next\_token 值）。

```
curl --request GET
'https://api.x.com/2/tweets/search/all?max_results=500&query=covid&next_token=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'
--header 'Authorization: Bearer $BEARER_TOKEN'
```

通过这种方式，你可以持续检查是否返回了 next\_token；如果尚未达到计划收集的帖子数量，你可以在每个请求中使用新的 next\_token 继续调用全档案端点。请记住，全档案搜索端点会计入你的总体
[推文上限（帖子上限）](/zh/x-api/fundamentals/post-cap)，也就是每个
[项目与应用](/zh/resources/fundamentals/projects) 每月可通过 X API 获取的帖子数量。因此，在分页获取结果时，请谨慎设计代码逻辑，避免无意间耗尽你的推文上限（帖子上限）。

以下是一些在使用全档案搜索端点时可能对你有帮助的资源。我们非常期待你的反馈。若对该端点有任何问题，请通过
[@XDevelopers](https://x.com/XDevelopers) 或我们的
[社区论坛](https://devcommunity.x.com/) 与我们联系。

<div id="additional-resources">
  ### 其他资源
</div>

- [全档案搜索端点 API 参考](/zh/x-api/posts/full-archive-search)
- [搜索查询入门：学习基础构建方法](/zh/x-api/posts/search/integrate/build-a-query)