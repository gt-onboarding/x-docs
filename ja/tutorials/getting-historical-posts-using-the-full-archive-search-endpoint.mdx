---
title: v2 全アーカイブ検索エンドポイントを使って過去の投稿を取得する
mode: wide
---

<div id="introduction">
  ## はじめに
</div>

[v2 の Search Posts エンドポイント](/ja/x-api/posts/search/introduction)は、作成した検索クエリに基づいて関心のあるトピックに関連する投稿を取得できるようにします。v2 の Search Posts には 2 種類のエンドポイントがあり、承認済みアカウントを持つすべての開発者が利用でき最大 7 日前までの投稿を検索できる recent search と、承認された研究者のみが利用できる
[Academic Research product track](https://developer.x.com/en/products/x-api/early-access/guide#na_2)
向けの full-archive search があります。後者は 2006 年 3 月までさかのぼる投稿の全アーカイブを検索できます。

検索機能の全体像は
[search overview ページ](/ja/x-api/posts/search/introduction)
をご覧ください。

これらの Search Posts エンドポイントは、縦断研究や過去のトピック・イベントの分析など、学術研究者における最も一般的なユースケースの一つに対応します。

このチュートリアルでは、研究者が full-archive search エンドポイントを使用して X の公開データの完全な履歴を検索するためのステップバイステップのガイドを提供します。さらに、ジオタグ付きの投稿を取得するなどデータセットを構築するさまざまな方法や、クエリに対して利用可能な投稿をページングする方法も示します。

<div id="prerequisites">
  ### 前提条件
</div>

現在、このエンドポイントは
[Academic Research product track](https://developer.x.com/en/solutions/academic-research/products-for-researchers)
の一部としてのみご利用いただけます。
このエンドポイントを使用するには、
[アクセス申請](https://developer.x.com/en/portal/petition/academic/is-it-right-for-you)
が必要です。
本トラックの
[申請手続きと要件](https://developer.x.com/en/solutions/academic-research/application-info)
の詳細をご確認ください。

<div id="connect-an-app-to-the-academic-project">
  ### 学術プロジェクトにアプリを接続する
</div>

Academic Research プロダクトトラックの利用が承認されると、
[developer portal](https://developer.x.com/en/portal/dashboard) の Academic
[Project](/ja/resources/fundamentals/projects) が表示されます。「Projects and Apps」
セクションから「Add App」をクリックして、プロジェクトに
[X アプリ](/ja/resources/fundamentals/developer-apps) を接続します。

[](https://res.cloudinary.com/practicaldev/image/fetch/s--gHFOyuDc--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/gb7aevhqyfvfjznd0pnd.png)

![この画像は、developer portal 上でまだアプリが追加されていない Academic Project を表示しています](https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/docs/tutorials/getting-historical-tweets-using-the-full-archive-search-endpoint/dev-portal-1.png.twimg.1920.png)

その後、既存のアプリを選択してプロジェクトに接続することもできます（下図参照）。

![この画像は、Academic Project にアプリを追加しようとしたときに表示されるページを示しています](https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/docs/tutorials/getting-historical-tweets-using-the-full-archive-search-endpoint/dev-portal-2.png.twimg.1920.png)

または新しいアプリを作成し、名前を付けて「完了」をクリックして、Academic Project に新しい
アプリを接続することもできます。

![この画像は、新しいアプリの名前を入力する、または既存のアプリを選択できるページを示しています](https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/docs/tutorials/getting-historical-tweets-using-the-full-archive-search-endpoint/dev-portal-3.png.twimg.1920.png)

これにより API キーと
[Bearer Token](/ja/resources/fundamentals/authentication#using-and-generating-an-app-only-bearer-token) が発行され、
全アーカイブ検索エンドポイントへの接続に使用できるようになります。

![この画像は、新しいアプリを作成した後に表示され、キーとトークンが表示されるページを示しています](https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/docs/tutorials/getting-historical-tweets-using-the-full-archive-search-endpoint/dev-portal-4.png.twimg.1920.png)

**ご注意**

上記のスクリーンショットのキーは非表示になっていますが、ご自身の developer portal では
API Key、API Secret Key、Bearer Token の実際の値を確認できます。これらのキーと
Bearer Token は保存してください。全アーカイブ検索エンドポイントの呼び出しに必要になります。

<div id="connecting-to-the-full-archive-search-endpoint">
  ### 全アーカイブ検索エンドポイントへの接続
</div>

以下の cURL コマンドは、@XDevelopers の投稿の過去分を取得する方法を示しています。$BEARER\_TOKEN を自身の Bearer Token に置き換え、リクエスト全体をターミナルに貼り付けて Enter キーを押してください。

```bash
curl --request GET 'https://api.x.com/2/tweets/search/all?query=from:xdevelopers' --header 'Authorization: Bearer $BEARER_TOKEN'
```

レスポンスの JSON が表示されます。

デフォルトでは、最新の投稿が10件だけ返されます。1回のリクエストで10件より多く取得したい場合は、以下の例のように max\_results パラメータを使用し、最大で1リクエストあたり500件の投稿を指定できます。

```bash
curl --request GET 'https://api.x.com/2/tweets/search/all?query=from:xdevelopers&max_results=500' --header 'Authorization: Bearer $BEARER_TOKEN'
```

###

クエリの作成

上の呼び出し例のとおり、`query` パラメータで検索対象のデータを指定できます。たとえば、単語 _covid_ または _coronavirus_ を含むすべての投稿を取得したい場合、丸括弧内で OR 演算子を使用し、クエリは
`(covid OR coronavirus)`、API 呼び出しは次のようになります:

```bash
curl --request GET 'https://api.x.com/2/tweets/search/all?query=(covid%20OR%20coronavirus)&max_results=500' --header 'Authorization: Bearer $BEARER_TOKEN'
```

同様に、リポストではない _covid19_ を含むすべての投稿を取得したい場合、論理否定（- で表される）とともに is:retweet 演算子を使用し、クエリは covid19 -is:retweet、API 呼び出しは次のとおりです:

```bash
curl --request GET 'https://api.x.com/2/tweets/search/all?query=covid19%20-is:retweet&max_results=500' --header 'Authorization: Bearer $BEARER_TOKEN'
```

全アーカイブ検索エンドポイントでサポートされている
[演算子の一覧はこちらのガイド](/ja/x-api/posts/search/integrate/build-a-query)
をご覧ください。

### start\_time と end\_time パラメータを使用して過去の投稿を取得する

全アーカイブ検索エンドポイントを使用する場合、デフォルトでは直近30日間の
投稿が返されます。30日より前の投稿を取得したい場合は、
API 呼び出しで start\_time と end\_time パラメータを使用します。これらの
パラメータは有効な RFC3339 の日時形式で指定する必要があります（例：
2020-12-21T13:00:00.00Z）。たとえば、2020年12月の XDevelopers
アカウントのすべての投稿を取得するには、API 呼び出しは次のとおりです。

```bash
curl --request GET 'https://api.x.com/2/tweets/search/all?query=from:XDevelopers&start_time=2020-12-01T00:00:00.00Z&end_time=2021-01-01T00:00:00.00Z' --header 'Authorization: Bearer $BEARER_TOKEN'
```

###

位置情報付きの過去の投稿を取得する

位置情報付きの投稿とは、都市、州、国などの地理情報が紐づけられている投稿を指します。

<div id="using-hasgeo-operator">
  #### has:geo 演算子の使用
</div>

位置情報（ジオデータ）を含む投稿を取得するには、has:geo 演算子を使用します。
たとえば、次の cURL リクエストは、@XDevelopers の投稿のうち
位置情報を含むものだけを取得します。

```
curl --request GET
'https://api.x.com/2/tweets/search/all?query=from:xdevelopers%20has:geo' --header
'Authorization: Bearer $BEARER_TOKEN'
```

#### place\_country 演算子の使用

同様に、`place_country` 演算子を使用すると、位置情報を持つ投稿を特定の国に絞り込めます。以下の cURL コマンドは、@XDevelopers ハンドルからの米国のすべての投稿を取得します。

```
curl --request GET
'https://api.x.com/2/tweets/search/all?query=from:xdevelopers%20place_country:US'
--hbasheader 'Authorization: Bearer XXXXX'
```

国は上記のとおり ISO Alpha-2 文字コードで指定します。有効な ISO コードは[こちら](http://en.wikipedia.org/wiki/ISO_3166-1_alpha-2)で確認できます。

### next\_token を使用して 500 件を超える過去の投稿を取得する

前述のとおり、デフォルトでは全アーカイブ検索エンドポイントへのクエリで、1 回のリクエストにつき最大 500 件の投稿しか取得できません。クエリで利用可能な投稿が 500 件を超える場合、JSON レスポンスには next\_token が含まれ、これを API 呼び出しに付加することで、そのクエリで次に取得可能な投稿を取得できます。next\_token は JSON レスポンスの meta オブジェクト内にあり、次のような形式です。

```
{ "newest_id": "12345678...", "oldest_id": "12345678...", "result_count": 500,
"next_token": "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" }
```

したがって、次に取得可能な投稿を取得するには、この meta オブジェクトの next\_token の値を使用し、API 呼び出しの next\_token に指定して全アーカイブ検索エンドポイントへリクエストしてください（以下参照。ご自身の Bearer Token と、直前の API 呼び出しで得た next\_token の値を使用します）。

```
curl --request GET
'https://api.x.com/2/tweets/search/all?max_results=500&query=covid&next_token=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'
--header 'Authorization: Bearer $BEARER_TOKEN'
```

この方法で、next\_token の有無を確認し続け、収集したい投稿数に達していない場合は、各リクエストで新しい next\_token を指定して全アーカイブ検索エンドポイントを呼び出し続けることができます。全アーカイブ検索エンドポイントは合計の
[投稿上限](/ja/x-api/fundamentals/post-cap)、つまり X API から 1 か月に取得できる
[プロジェクト](/ja/resources/fundamentals/projects) あたりの投稿数にカウントされる点に留意し、結果をページングする際はコードロジックに注意して、意図せず投稿上限を使い切ってしまわないようにしてください。

以下は、全アーカイブ検索エンドポイントを使用する際に役立つリソースです。フィードバックをお待ちしています。このエンドポイントに関するご質問は
[@XDevelopers](https://x.com/XDevelopers) または
[コミュニティフォーラム](https://devcommunity.x.com/) までお寄せください。

<div id="additional-resources">
  ### 追加リソース
</div>

- [全アーカイブ検索エンドポイントのAPIリファレンス](/ja/x-api/posts/full-archive-search)
- [検索クエリの作成基礎](/ja/x-api/posts/search/integrate/build-a-query)