---
title: リクエストの認可設定
sidebarTitle: リクエストの認可設定
---

import { Button } from "/snippets/ja/button.mdx";

<div id="authorizing-a-request">
  ### リクエストの認可
</div>

このドキュメントの目的は、X API に認可済みリクエストを送信するために、HTTP リクエストをどのように変更するかを示すことです。

X のすべての API は HTTP プロトコルに基づいています。つまり、X の API を利用するソフトウェアは、X のサーバーに対して一連の構造化メッセージを送信します。例えば、テキスト「**Hello Ladies + Gentlemen, a signed OAuth request!**」をポストとして投稿するリクエストは、次のようになります。

```
POST /1.1/statuses/update.json?include_entities=true HTTP/1.1
Accept: */*
Connection: close
User-Agent: OAuth gem v0.4.4
Content-Type: application/x-www-form-urlencoded
Content-Length: 76
Host: api.x.com

status=Hello%20Ladies%20%2b%20Gentlemen%2c%20a%20signed%20OAuth%20request%21
```

上記のリクエストは、一般的な HTTP ライブラリであれば最小限の手間で生成・送信できます。しかし、次の点が不明なため、上記のリクエストは無効と見なされます。

1. どのアプリケーションがリクエストを行っているか
2. リクエストがどのユーザーに代わって投稿しているか
3. ユーザーがそのアプリケーションに代理投稿の権限を付与しているか
4. リクエストが転送中に第三者によって改ざんされていないか

アプリケーションがこの情報を提供できるよう、X の API は [OAuth 1.0a プロトコル](http://tools.ietf.org/html/rfc5849)に依拠しています。ごく単純化すると、X の実装では、認可が必要なリクエストに、上記の質問に答えるのに十分な情報を含む追加の HTTP Authorization ヘッダーを付与する必要があります。上記の HTTP リクエストにこのヘッダーを追加した例は次のとおりです（通常、Authorization ヘッダーは 1 行ですが、ここでは可読性のために折り返しています）。

```
POST /1.1/statuses/update.json?include_entities=true HTTP/1.1
Accept: */*
Connection: close
User-Agent: OAuth gem v0.4.4
Content-Type: application/x-www-form-urlencoded
Authorization:
OAuth oauth\_consumer\_key="xvz1evFS4wEEPTGEFPHBog",
oauth_nonce="kYjzVBB8Y0ZFabxSWbWovY3uYSQ2pTgmZeNu2VS4cg",
oauth_signature="tnnArxj06cWHq44gCs1OSKk%2FjLY%3D",
oauth\_signature\_method="HMAC-SHA1",
oauth_timestamp="1318622958",
oauth_token="370773112-GmHxMAgYyLbNEtIKZeRNFsMKPR9EyMZeS9weJAEb",
oauth_version="1.0"
Content-Length: 76
Host: api.x.com

status=Hello%20Ladies%20%2b%20Gentlemen%2c%20a%20signed%20OAuth%20request%21
```

このリクエストが作成された当時であれば、X API によって有効として受け入れられます。

この署名プロセスが実装の範囲を超えると感じる場合は、OAuth を使用せずに X API と連携できる [Web Intents](https://dev.x.com/web/intents) の利用を検討してください。
 

**パラメータの収集**

ヘッダーには 7 つのキーと値のペアが含まれており、キーはすべて「oauth\_」で始まります。任意の X API リクエストにおいて、これら 7 つの値を収集して同様のヘッダーを作成すれば、そのリクエストの認可を指定できます。各値の生成方法は以下のとおりです。

**Consumer key**

oauth\_consumer\_key は、どのアプリケーションがリクエストを行っているかを識別します。この値は、[developer portal](/ja/resources/fundamentals/developer-portal) の [X app](/ja/resources/fundamentals/developer-apps) の設定ページから取得してください。

|     |     |
| :--- | :--- |
| oauth\_consumer\_key | xvz1evFS4wEEPTGEFPHBog |

**Nonce**

oauth\_nonce パラメータは、各リクエストごとにアプリケーションが生成すべき一意のトークンです。X はこの値を使用して、同一リクエストが複数回送信されていないかを判定します。この例の値は、ランダムな 32 バイトのデータを base64 エンコードし、英数字以外の文字をすべて取り除くことで生成していますが、十分にランダムな英数字文字列を生成できる方法であれば問題ありません。

|     |     |
| :--- | :--- |
| oauth\_nonce | kYjzVBB8Y0ZFabxSWbWovY3uYSQ2pTgmZeNu2VS4cg |

**Signature**

oauth\_signature パラメータには、他のすべてのリクエストパラメータと2つのシークレット値を署名アルゴリズムにかけて生成された値が含まれます。署名の目的は、X が転送中にリクエストが改ざんされていないことを検証し、リクエスト送信元のアプリケーションを確認し、さらにそのアプリケーションがユーザーのアカウントとやり取りする権限を持つことを確認できるようにすることです。

このリクエストの oauth\_signature を計算する手順は、[Creating a signature](/ja/resources/fundamentals/authentication/oauth-1-0a/creating-a-signature) に記載されています。

|     |     |
| :--- | :--- |
| oauth\_signature | tnnArxj06cWHq44gCs1OSKk/jLY= |

**Signature method**

X が使用する oauth\_signature\_method は HMAC-SHA1 です。この値は、X の API へ送信するすべての認可済みリクエストで使用してください。

|     |     |
| :--- | :--- |
| oauth\_signature\_method | HMAC-SHA1 |

**Timestamp**

oauth\_timestamp パラメータは、リクエストの作成時刻を示します。この値は、リクエスト生成時点の Unix エポックからの経過秒数である必要があり、ほとんどのプログラミング言語で容易に生成できます。X は過去に作成されすぎたリクエストを拒否するため、リクエストを生成するコンピューターの時計は NTP と同期させておくことが重要です。

|     |     |
| :--- | :--- |
| oauth\_timestamp | 1318622958 |

**Token**

oauth\_token パラメータは通常、ユーザーが自分のアカウントへのアクセスをあなたのアプリケーションに共有することを許可したことを表します。この値が渡されない、または別形式のトークンとなる認証リクエストも一部ありますが、その詳細は [Obtaining access tokens](/ja/resources/fundamentals/authentication/oauth-1-0a/obtaining-user-access-tokens) で説明しています。一般的な用途のリクエストの大半では、「アクセス トークン」を使用します。

[developer portal](/ja/resources/fundamentals/developer-portal) の [X app](/ja/resources/fundamentals/developer-apps) の設定ページで、自分のアカウント用の有効な [access token](/ja/resources/fundamentals/authentication/oauth-1-0a/obtaining-user-access-tokens) を生成できます。

|     |     |
| :--- | :--- |
| oauth\_token | 370773112-GmHxMAgYyLbNEtIKZeRNFsMKPR9EyMZeS9weJAEb |

**Version**

oauth\_version パラメータは、X API に送信するすべてのリクエストで常に 1.0 としてください。

|     |     |
| :--- | :--- |
| oauth\_version | 1.0 |

<div id="building-the-header-string">
  #### ヘッダー文字列の構築
</div>

ヘッダー文字列を構築するには、DST という名前の文字列に書き込むことを想定します。

1. 文字列 “OAuth ”（末尾のスペースを含む）を DST に追加します。
2. 上記の 7 つのパラメータの各キー／値ペアについて:
   1. キーを[パーセントエンコード](/ja/resources/fundamentals/authentication/oauth-1-0a/obtaining-user-access-tokens)し、DST に追加します。
   2. 等号 ‘=’ を DST に追加します。
   3. 二重引用符 ‘”’ を DST に追加します。
   4. 値を[パーセントエンコード](/ja/resources/fundamentals/authentication/oauth-1-0a/obtaining-user-access-tokens)し、DST に追加します。
   5. 二重引用符 ‘”’ を DST に追加します。
   6. まだキー／値ペアが残っている場合は、カンマ ‘,’ とスペース ‘ ‘ を DST に追加します。

この文字列を構築する際は、値のパーセントエンコードに特に注意してください。たとえば、oauth\_signature の値 tnnArxj06cWHq44gCs1OSKk/jLY= は tnnArxj06cWHq44gCs1OSKk%2FjLY%3D のようにエンコードする必要があります。

上記で収集したパラメータに対してこれらの手順を実行すると、次の文字列になります。

```
OAuth oauth\_consumer\_key="xvz1evFS4wEEPTGEFPHBog", oauth\_nonce="kYjzVBB8Y0ZFabxSWbWovY3uYSQ2pTgmZeNu2VS4cg", oauth\_signature="tnnArxj06cWHq44gCs1OSKk%2FjLY%3D", oauth\_signature\_method="HMAC-SHA1", oauth\_timestamp="1318622958", oauth\_token="370773112-GmHxMAgYyLbNEtIKZeRNFsMKPR9EyMZeS9weJAEb", oauth_version="1.0"
```

この値は、リクエストの Authorization ヘッダーとして設定してください。