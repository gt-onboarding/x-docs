---
title: クイックスタート
sidebarTitle: クイックスタート
---

import { Button } from '/snippets/ja/button.mdx';

<div id="getting-started-with-the-manage-direct-message-endpoints">
  ## ダイレクトメッセージ管理エンドポイントのはじめ方
</div>

このクイックスタートガイドでは、HTTP リクエストの管理と送信ツールである Postman を使って、ダイレクトメッセージエンドポイントに初めてリクエストする手順を説明します。Postman コレクションの詳細は、[Using Postman](/ja/tutorials/postman-getting-started) ガイドをご覧ください。

Python のサンプルを確認する場合は、[X API v2 sample code](https://github.com/xdevplatform/Twitter-API-v2-sample-code) の GitHub リポジトリをご参照ください。加えて、公式の [X Developer Platform software development kits (SDKs)](/ja/x-api/tools-and-libraries/sdks) も、これらのダイレクトメッセージエンドポイントをサポートするよう順次更新されます。  

<Note>
  **前提条件**

  このガイドを完了するには、リクエストの認証に使用する [keys and tokens](/ja/resources/fundamentals/authentication) 一式が必要です。これらのキーとトークンは、次の手順で生成できます。

  - [開発者アカウントに申請](https://developer.x.com/en/apply-for-access) し、承認を受ける。
  - 開発者ポータルで [Project](/ja/resources/fundamentals/projects) とそれに関連付ける [developer App](/ja/resources/fundamentals/developer-apps) を作成する。
  - App の “Keys and tokens” ページに移動し、必要な認証情報を生成する。生成した認証情報はすべて安全な場所に保管してください。
</Note>

<div id="steps-to-building-direct-message-lookup-requests">
  ### ダイレクトメッセージのルックアップリクエストを作成する手順
</div>

この例では、1 回のリクエストで新しいグループ会話を作成し、最初のメッセージを追加します。続いて、作成した会話に 2 件目のメッセージを追加します。

<div id="step-one-start-with-a-tool-or-library">
  #### ステップ1: ツールまたはライブラリから始める
</div>

Direct Message 管理エンドポイントの利用を始めるにあたり、手順を簡素化するために Postman を使用します。X Developers が用意した X API v2 リクエストのサンプルコレクションを使って、新規の Direct Message を作成し、Direct Message の会話イベントを一覧表示するための6つのエンドポイントを確認します。

コレクションの大半はあらかじめ設定されていますが、これらの API リクエストを実行するために作成した X アプリに基づき、いくつか入力が必要な項目があります。まずはコレクションを読み込み／更新しましょう。

X API v2 の Postman コレクションを環境に読み込むには、次のボタンをクリックしてください:

<Button href="https://app.getpostman.com/run-collection/9956214-784efcda-ed4c-4491-a4c0-a26470a67400">
  X API v2 を Postman に追加
</Button>

Postman に X API v2 コレクションを読み込んだら、「Manage Direct Messages」フォルダに移動します。このフォルダの Authorization タブは可能な限り事前設定済みです。X アプリの認証情報を共有するために、いくつかの設定を更新する必要があります。

このフォルダには、新しい Direct Message を作成するための3つのエンドポイントも含まれています。あわせて、送受信メッセージや会話参加者の参加・退出など、Direct Message の会話イベントを取得するための3つのエンドポイントを備えた「Direct Message lookup」フォルダもあります。

グループ会話の作成は X API v2 の新機能であるため、この例ではそこに焦点を当てます。「New group DM and conversation」という例を使用します。このリクエストで Direct Message のグループ会話を作成します。

次のステップは、エンドポイントでの認証です。

<div id="step-two-authenticate-your-request">
  #### ステップ2：リクエストを認証する
</div>

X API に正しくリクエストするには、その権限があることを確認する必要があります。このエンドポイントへのリクエストを成功させるために、[OAuth 2.0 Authorization Code Flow with PKCE](ja/resources/fundamentals/authentication#oauth-2-0-authorization-code-flow-with-pkce-2) を使用します。Postman でアクセストークンを生成できます。 

Postman では、フォルダー単位またはリクエスト単位で認証方式を設定できます。ここではフォルダー単位で認証情報を設定します。"Manage Direct Messages" フォルダーに移動し、"Authorization" タブを選択して、Type が "OAuth 2.0" に設定されていること、"Add auth data to" が "Request Headers" に設定されていることを確認します。"Current Token" セクションで、"Header Prefix" が "Bearer" に設定されていることを確認してください。  

新しいトークンを設定・生成するには:

1. "DM lookup" などのトークン名を作成します。

2. **Grant Type** が Authorization Code (with PKCE) に設定されていることを確認します。

3. **Callback URL** を設定します。Callback URL は、[v2 Dev Portal](https://developer.x.com/en/portal/dashboard) のアプリに登録されている Callback URL と完全に一致するように更新する必要があります。本例で使用する X App では、Callback URL は [https://www.example.com/](https://www.example.com/) に設定されています（厳密に一致する必要があるため、[https://example.com](https://example.com) は使用できません）。 

4. **Auth URL** が [https://x.com/i/oauth2/authorize](https://x.com/i/oauth2/authorize) に設定されていることを確認します。

5. **Access Token URL** が [https://api.x.com/2/oauth2/token](https://api.x.com/2/oauth2/token) に設定されていることを確認します。\
   **Client ID** - Developer Portal から OAuth 2.0 クライアント ID をコピー＆ペースト\
   **Client Secret** - 機密クライアントの App タイプを使用している場合のみ必要です。その場合は、Developer Portal から OAuth 2.0 クライアントシークレットをコピー＆ペーストします。 

6. **Scope** が dm.read dm.write tweet.read users.read に設定されていることを確認します。

7. **State** が "state" に設定されていることを確認します。

8. **Client Authentication** が Send as Basic Auth header に設定されていることを確認します。

9. "Get New Access Token" をクリックし、"Sign-in with X" のフローの中で "Authorize app" をクリックします。

10. "Proceed" ボタンをクリックし、続けて "Use Token" をクリックしてトークンを適用します。 

11. "Save" ボタンをクリックして、これらの設定内容を保存します。

X にログインしていないというメッセージが表示される場合があります。このエラーが表示された場合は、Postman 内で代理投稿しようとしている対象の X アカウントにログインする必要があります。

これで OAuth 2.0 の詳細がフォルダー単位で設定されたので、各サンプルの "Authorization" タブに移動し、Type が "Inherit auth from parent." に設定されていることを確認します。 

このトークンはまもなく有効期限が切れるため、"Get New Access Token" ボタンをクリックして再生成する必要があります。クリックすると "Sign-in with X" のフローが開始され、リクエストに使用できる新しいトークンが生成されます。

<div id="step-three-retrieve-direct-messages-conversation-events">
  #### ステップ3：ダイレクトメッセージの会話イベントを取得する
</div>

このエンドポイントでダイレクトメッセージの会話イベントを取得する際は、会話 ID を指定する必要があります。会話 ID はエンドポイントパスの一部です: https://api.x.com/2/dm\_conversations/:dm\_conversation\_id/dm\_events

Postman で「Params」タブに移動し、「Path Variables」セクションに取得したい会話の ID を入力します。

設定は次のとおりです:

|     |     |
| :--- | :--- |
| **Key** | **Value** |
| `dm_conversation_id` | `1228393702244134912` |

この会話を指定すると、結果のパスは https://api.x.com/2/dm\_conversations/1582103724607971328/dm\_events になります。

「Send」ボタンをクリックすると、レスポンスにはデフォルトのダイレクトメッセージオブジェクトのフィールドである id、text、event\_type が含まれます。さらに、結果数を含む「meta」オブジェクトと、利用可能な場合により多くのイベントを取得するためのページネーショントークンも含まれます。

```
{
   "data": [
       {
           "event_type": "MessageCreate",
           "id": "1580705921830768647",
           "text": "hello to you two, this is a new group conversation."
       }
   ],
   "meta": {
       "result_count": 1,
       "next_token": "18LAA5FFPEKJA52G0G00ZZZZ",
       "previous_token": "1BLC45FFPEKJA52G0S00ZZZZ"
   }
}
```

追加のフィールドを受け取りたい場合は、[field](/ja/x-api/fundamentals/fields) および/または [expansion](/ja/x-api/fundamentals/expansions) パラメータでそれらのフィールドをリクエストに指定する必要があります。

この演習では、dm\_event オブジェクトの追加フィールドセットをリクエストします:

1. デフォルトのダイレクトメッセージオブジェクトのフィールド: id、text、event\_type
2. 追加のダイレクトメッセージオブジェクトのフィールド: dm\_conversation\_id、created\_at、sender\_id、attachments、participant\_ids、referenced\_tweets

Postman で「Params」タブに移動し、「Query Params」テーブルに次の key:value ペアを追加します:

|     |     |
| :--- | :--- |
| Key | Value |
| dm\_event.fields | dm\_conversation\_id,created\_at,sender\_id,attachments,participant\_ids,referenced\_tweets |

これで「Send」ボタンの横に次の URL が表示されるはずです:

https://api.x.com/2/dm\_conversations/:dm\_conversation\_id/dm\_events?dm\_event.fields=id,text,event\_type,dm\_conversation\_id,created\_at,sender\_id,attachments,participant\_ids,referenced\_tweets

<div id="step-four-make-your-request-and-review-your-response">
  #### ステップ4：リクエストを送信し、レスポンスを確認する
</div>

すべての準備が整ったら、再度「Send」ボタンをクリックすると、以下の例に類似したレスポンスが返ってきます。なお、このレスポンスには利用可能なすべての dm\_event フィールドが含まれます。

```
{
   "data": [
       {
           "text": "hello to you two, this is a new group conversation.",
           "id": "1580705921830768647",
           "dm_conversation_id": "1580705921830768643",
           "event_type": "MessageCreate",
           "sender_id": "17200003",
           "created_at": "2022-10-13T23:43:54.000Z"
       }
   ],
   "meta": {
       "result_count": 1,
       "next_token": "18LAA5FFPEKJA52G0G00ZZZZ",
       "previous_token": "1BLC45FFPEKJA52G0S00ZZZZ"
   }
}
```