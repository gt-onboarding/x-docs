---
title: クイックスタート
sidebarTitle: クイックスタート
---

import { Button } from '/snippets/ja/button.mdx';

<div id="getting-started-with-the-manage-direct-message-endpoints">
  ## ダイレクトメッセージ管理エンドポイントの始め方
</div>

このクイックスタートガイドでは、HTTP リクエストの管理と送信に使用するツールである Postman を使って、ダイレクトメッセージエンドポイントへの最初のリクエストを送る方法を説明します。Postman コレクションの詳細は、[Using Postman](/ja/tutorials/postman-getting-started) ガイドをご覧ください。

Python のサンプルを確認したい場合は、[X API v2 sample code](https://github.com/xdevplatform/Twitter-API-v2-sample-code) の GitHub リポジトリをご参照ください。加えて、公式の [X Developer Platform software development kits (SDKs)](/ja/x-api/tools-and-libraries/sdks) は、これらのダイレクトメッセージエンドポイントのサポートに合わせて更新される予定です。  

<Note>
  **前提条件**

  このガイドを完了するには、リクエストを認証するための[キーとトークン](/ja/resources/fundamentals/authentication)一式が必要です。以下の手順に従って生成できます。

  - [開発者アカウントに申し込み](https://developer.x.com/en/apply-for-access)し、承認を受ける。
  - 開発者ポータルで[プロジェクト](/ja/resources/fundamentals/projects)と、それに関連付けられた[開発者アプリ](/ja/resources/fundamentals/developer-apps)を作成する。
  - アプリの「Keys and tokens」ページに移動して、必要な認証情報を生成する。すべての認証情報は安全な場所に保存すること。
</Note>

<div id="steps-to-building-manage-direct-message-requests">
  ### ダイレクトメッセージの管理リクエストを作成する手順
</div>

この例では、1 回のリクエストで新しいグループ会話を作成して最初のメッセージを送信します。続いて、作成した会話に 2 通目のメッセージを追加します。

<div id="step-one-start-with-a-tool-or-library">
  #### ステップ1：ツールまたはライブラリから始める
</div>

Direct Message 管理エンドポイントの利用を開始するにあたり、手順を簡素化するために Postman を使用します。X Dev によって作成された X API v2 リクエストのサンプルコレクションを使い、新規ダイレクトメッセージの作成と、ダイレクトメッセージの会話イベントの一覧取得に用いる6つのエンドポイントを確認します。

コレクションの大部分は事前に設定済みですが、これらの API リクエストを実行するために作成した X App に基づいて入力が必要な項目がいくつかあります。まずはコレクションを読み込み／更新しましょう。

X API v2 の Postman コレクションを環境に読み込むには、次のボタンをクリックしてください:

<Button href="https://app.getpostman.com/run-collection/9956214-784efcda-ed4c-4491-a4c0-a26470a67400">
  X API v2 を Postman に追加
</Button>

Postman に X API v2 コレクションを読み込んだら、“Manage Direct Messages” フォルダーに移動します。このフォルダーの Authorization タブは可能な限り事前設定されており、X App の認証情報を共有するためにいくつかの設定を更新できます。このフォルダーには、新しいダイレクトメッセージを作成するための3つのエンドポイントも含まれています。なお、送受信メッセージや会話参加者の参加・離脱など、ダイレクトメッセージの会話イベントを取得するための3つのエンドポイントがある "Direct Message lookup" フォルダーもあります。 

グループ会話の作成は X API v2 の新しい注目機能の一つであるため、この例ではそこに焦点を当てます。"New group DM and conversation" の例を使用します。このリクエストでダイレクトメッセージのグループ会話を作成します。

次のステップは、エンドポイントで認証することです。

**ステップ2：リクエストを認証する**

X API に正しくリクエストするには、必要な権限を持っていることを確認する必要があります。このエンドポイントへのリクエストを成功させるために、[OAuth 2.0 Authorization Code Flow with PKCE](ja/resources/fundamentals/authentication#oauth-2-0-authorization-code-flow-with-pkce-2) を使用します。Postman 内でアクセストークンを生成できます。 

Postman では、認証方法をフォルダーレベルまたはリクエストレベルで設定できます。ここではフォルダーレベルで認証情報を設定します。

"Manage Direct Messages" フォルダーに移動し、"Authorization" タブを選択して、Type が “OAuth 2.0”、"Add auth data to" が "Request Headers" に設定されていることを確認します。"Current Token" セクションでは、"Header Prefix" が Bearer に設定されていることを確認してください。  

新しいトークンを設定・生成する手順:

1. "Manage DMs" などのトークン名を作成します。

2. **Grant Type** が Authorization Code (with PKCE) に設定されていることを確認します。

3. **Callback URL** を設定します。Callback URL は、[v2 Dev Portal](https://developer.x.com/en/portal/dashboard) のアプリケーションに登録された Callback URL と完全に一致する必要があります。この例で使用する X App では、Callback URL は [_https://www.example.com_](https://www.example.com/) に設定されています。（完全一致が必要なため、[_https://example.com_](https://example.com) は使用できません。） 

4. **Auth URL** が [https://x.com/i/oauth2/authorize](https://x.com/i/oauth2/authorize) に設定されていることを確認します。

5. **Access Token URL** が [https://api.x.com/2/oauth2/token](https://api.x.com/2/oauth2/token) に設定されていることを確認します。\
   **Client ID** - Developer Portal から OAuth 2.0 クライアント ID をコピー＆ペーストします\
   **Client Secret** - 機密クライアントの App タイプを使用している場合にのみ必要です。その場合、Developer Portal から OAuth 2.0 クライアントシークレットをコピー＆ペーストします。 

6. **Scope** が dm.read、dm.write、tweet.read、users.read に設定されていることを確認します。

7. **State** が “state” に設定されていることを確認します。

8. **Client Authentication** が Send as Basic Auth header に設定されていることを確認します。

9. **Get New Access Token** をクリックし、"Sign in with X" のフローで "Authorize app" をクリックします。

10. "Proceed" をクリックし、続いて "Use Token" をクリックしてトークンを適用します。 

11. "Save" をクリックして、これらの設定を保存します。

X にログインしていないというメッセージが表示される場合があります。このエラーが発生した場合は、Postman 内で、代理で投稿しようとしている X アカウントにログインする必要があります。

これらの OAuth 2.0 の詳細をフォルダー単位で設定したら、各サンプルの「Authorization」タブを開き、Type が「Inherit auth from parent」に設定されていることを確認してください。

なお、このトークンはまもなく有効期限が切れるため、「Get New Access Token」ボタンをクリックして再発行する必要があります。クリックすると「Sign-in with X」のフローが開始され、リクエストに使用できる新しいトークンが生成されます。

<div id="step-three-specify-the-direct-message-conversation-participants-and-message-contents">
  #### ステップ3：ダイレクトメッセージの会話参加者とメッセージ内容を指定する
</div>

「Body」タブに移動し、サンプルの JSON オブジェクトを更新します。`participant_ids` 属性に、ダイレクトメッセージを送信したいアカウントを設定します。

`{
   "message": {"text": "お二人だけにこんにちは。これは新しいグループ会話です。"},
   "participant_ids": ["944480690","906948460078698496"],
   "conversation_type": "Group"
}`

<div id="step-four-make-your-request-and-review-the-response">
  #### ステップ4：リクエストを送信し、レスポンスを確認する
</div>

すべての準備が整ったら「Send」ボタンを押すと、以下の例と同様のレスポンスが返ってきます。なお、上で作成したトークンの有効期限が切れている場合は、フォルダの「Authorization」タブに戻り、「Get New Access Token」をクリックして新しいトークンを発行できます。

```
{
   "data": {
       "dm_conversation_id": "1582103724607971328",
       "dm_event_id": "1582103724607971332"
   }
}
```

返ってきたレスポンスの「data」オブジェクトに dm\_conversation\_id と dm\_event\_id が含まれていれば、新しいダイレクトメッセージの会話が正常に作成されています。この会話に関連するイベントの取得を始めるには、Direct Message lookup のクイックスタートガイドをご覧ください。

<div id="step-five-add-another-message-to-that-group-conversation">
  #### ステップ5：そのグループ会話に別のメッセージを追加する
</div>

次に「Add DM to conversation」の例を選択し、「Params」タブを選びます。「Path Variables」の下で、先ほど作成した会話の ID に合わせて dm\_conversation\_id を更新します。

|     |     |
| :--- | :--- |
| **Key** | **Value** |
| dm\_conversation\_id | 1582103724607971328 |

この会話 ID を使用すると、リクエストパスは次のとおりになります: https://api.x.com/2/dm\_conversations/1582103724607971328/messages

また、送信したいメッセージのテキストを含むリクエスト JSON を用意して「Body」タブも更新します: 

```
{
   "text": "私たちのグループ会話に新しいメッセージを追加します..."
}
```

すべての設定が完了したら「Send」ボタンを押します。次の例と同様のレスポンスが返ってきます:

```
{
   "data": {
       "dm_conversation_id": "1582103724607971328",
       "dm_event_id": "1582106224379559940"
   }
}
```