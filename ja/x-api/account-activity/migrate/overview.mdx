<div id="v2-account-activity-api-migration-guide">
  # v2 Account Activity API 移行ガイド
</div>

このガイドは、従来の Enterprise Account Activity API から v2 Account Activity API への移行を支援します。中核機能は変わりませんが、エンドポイント構成と認証方式は X API v2 と整合するように更新されています。

<div id="summary-of-changes">
  ### 変更点の概要
</div>

- **API フォーマット**: エンドポイントは /1.1/account\_activity/ ではなく /2/account\_activity/ のベースパスを使用します。
- **Webhook 管理**: Webhook の作成、一覧、検証（CRC）、削除は [V2 Webhooks API](https://github.com/m-rosinsky/XWebhookTest/blob/main/app.py) で行います。
- **認証**: V2 エンドポイントには次のいずれかが必要です:
  - ユーザー単位の操作（例: ユーザーの購読追加）には **OAuthUser**（3-legged OAuth）。
  - アプリレベルの操作（例: 購読の一覧/削除）には **OAuth2 App Only**（Bearer Token）。
  - V1.1 では要件がまちまちで、多くの場合 OAuth 1.0a が使われていました。
- **エンドポイント対応表**:

| V1.1 Endpoint | V2 Equivalent / Action | Notes |
| ----- | ----- | ----- |
| POST /1.1/account\_activity/webhooks.json?url=\<URL> | POST /2/webhooks | [Docs](https://docs.x.com/ja/x-api/webhooks/introduction). Requires OAuth2AppOnly. |
| GET /1.1/account\_activity/webhooks.json | GET /2/webhooks | [Docs](https://docs.x.com/ja/x-api/webhooks/introduction). Requires OAuth2AppOnly. |
| PUT /1.1/account\_activity/webhooks/:webhook\_id.json | PUT /2/webhooks/:webhook\_id | Triggers CRC. [Docs](https://docs.x.com/ja/x-api/webhooks/introduction). Requires OAuth2AppOnly. |
| DELETE /1.1/account\_activity/webhooks/:webhook\_id.json | DELETE /2/webhooks/:webhook\_id | [Docs](https://docs.x.com/ja/x-api/webhooks/introduction). Requires OAuth2AppOnly. |
| POST /1.1/account\_activity/webhooks/:webhook\_id/subscriptions/all.json | POST /2/account\_activity/webhooks/:webhook\_id/subscriptions/all | Requires OAuthUser. |
| GET /1.1/account\_activity/subscriptions/count.json | GET /2/account\_activity/subscriptions/count | Requires OAuth2AppOnly. |
| GET /1.1/account\_activity/webhooks/:webhook\_id/subscriptions/all.json | GET /2/account\_activity/webhooks/:webhook\_id/subscriptions/all | Requires OAuthUser. |
| GET /1.1/account\_activity/webhooks/:webhook\_id/subscriptions/all/list.json | GET /2/account\_activity/webhooks/:webhook\_id/subscriptions/all/list | Requires OAuth2AppOnly. |
| DELETE /1.1/account\_activity/webhooks/:webhook\_id/subscriptions/:user\_id/all | DELETE /2/account\_activity/webhooks/:webhook\_id/subscriptions/:user\_id/all | Requires OAuth2AppOnly. |
| DELETE /1.1/account\_activity/webhooks/:webhook\_id/subscriptions/all | Deprecated / No Direct Equivalent | Use individual deletes or remove the webhook via DELETE /2/webhooks/:webhook\_id. |

- **レスポンス形式**: 成功・エラー時のレスポンス構造は AAAPI ドキュメントを参照してください。

移行時は、新しいベースパスへの切り替え、認証フローの見直し、そして [V2 Webhooks API](https://docs.x.com/ja/x-api/webhooks/introduction) による webhook 管理に合わせてコードを更新してください。

<div id="how-to-migrate">
  ### 移行方法
</div>

- **パッケージを決める**:
  - Account Activity API にアクセスするには Enterprise か Pro のいずれかのパッケージを選択し、次を考慮してください:
    - 必要な webhook の数
    - 現在／将来のサブスクリプション数または認可ユーザー数
    - X クライアントアプリケーションの数
    - 望ましいサポートレベル（フォーラム対応か、エンタープライズ向けの専任 1:1 サポートか）
    - 価格の詳細（Enterprise は営業へお問い合わせください）
- **認証を OAuth 2.0 に更新する**:
  - X アプリに「読み取り、書き込み、ダイレクトメッセージへのアクセス」権限が付与されていることを確認してください。
  - V2 エンドポイント向けに OAuth 2.0 へ更新します。スコープが変更された場合はユーザーを再認可してください。
  - Developer Portal で以下を管理します:
    - OAuth 2.0 アクセストークン
    - クライアント ID とクライアントシークレット
- **Webhook を確認または再設定する**:
  - 既存の webhook URL を使用するか、新しいものを設定します（例: https://your\_domain.com/webhook/twitter）。
  - [V2 Webhooks API のドキュメント](https://docs.x.com/ja/x-api/webhooks/introduction)に従って webhook を登録・管理します。
- **サンプルアプリ:**
  - [Simple webhook server](https://github.com/m-rosinsky/XWebhookTest/blob/main/app.py)
    - CRC チェックへの応答と POST イベントの受け入れ方法を示す、単一の Python スクリプトです。
  - [Account Activity API sample dashboard](https://github.com/xdevplatform/account-activity-dashboard-enterprise/tree/master)
    - [bun.sh](http://bun.sh) 製の Web アプリで、webhook やサブスクリプションの管理、アプリ内でのライブイベント受信が可能です。