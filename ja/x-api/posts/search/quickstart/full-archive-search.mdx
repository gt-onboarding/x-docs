---
title: 全アーカイブ検索
sidebarTitle: 全アーカイブ検索
---

import { Button } from '/snippets/ja/button.mdx';

<div id="getting-started-with-the-full-archive-search-endpoint">
  ## 全アーカイブ検索エンドポイントのはじめ方
</div>

このクイックスタートガイドでは、Postman を使用して、指定したフィールドセットとともに全アーカイブ検索エンドポイントへ最初のリクエストを送る手順を説明します。

さまざまな言語のサンプルコードをご覧になりたい場合は、GitHub の [X API v2 sample code](https://github.com/xdevplatform/Twitter-API-v2-sample-code) リポジトリをご参照ください。

<Note>
  ### 前提条件

  全アーカイブ検索エンドポイントは現在、Pro および Enterprise アクセスでのみ利用可能です。このエンドポイントを使用するには、Pro アクセスへアップグレードするか、[Enterprise アクセスレベルを申請](https://docs.google.com/forms/d/e/1FAIpQLScO3bczKWO2jFHyVZJUSEGfdyfFaqt2MvmOfl_aJp0KxMqtDA/viewform)する必要があります。

  アクセス承認に加えて、リクエストを認証するための[キーとトークン](/ja/resources/fundamentals/authentication)が必要です。以下の手順に従ってキーとトークンを生成できます。

  - 開発者ポータルで Pro または Enterprise アクセスを持つ[プロジェクト](/ja/resources/fundamentals/projects)に移動し、そのプロジェクト内に関連付けられた[開発者アプリ](/ja/resources/fundamentals/developer-apps)があることを確認します。

  - アプリの「Keys and tokens」ページに移動して、必要な認証情報を生成します。すべての認証情報は安全な場所に保存してください。
</Note>

<div id="steps-to-build-a-full-archive-search-request">
  ### 全アーカイブ検索リクエストを作成する手順
</div>

**ステップ1：ツールまたはライブラリから始める**

このエンドポイントにリクエストを送るためのツール、コード例、ライブラリはいくつかありますが、ここでは手順を簡略化するために Postman を使用します。

ご利用の環境に X API v2 の Postman コレクションを読み込むには、次のボタンをクリックしてください。

<Button href="https://app.getpostman.com/run-collection/9956214-784efcda-ed4c-4491-a4c0-a26470a67400">
  X API v2 を Postman に追加
</Button>

Postman に X API v2 コレクションを読み込んだら、Search Posts > Full-archive search request に移動します。

**ステップ2：リクエストを認証する**

X API に正しくリクエストするには、権限を確認する必要があります。このエンドポイントでは、[OAuth 2.0 App-Only](/ja/resources/fundamentals/authentication#app-only-authentication-and-oauth-2-0-bearer-token) の認証方式でリクエストを認証する必要があります。

キーとトークン、特に [App Access Token](/ja/resources/fundamentals/authentication#using-and-generating-an-app-only-bearer-token)（App-only Bearer Token とも呼ばれます）を Postman に追加してください。Postman 右上の “X API v2” という環境を選択し、"initial value" および "current value" の各フィールドにキーとトークンを入力します（環境ドロップダウン横の目のアイコンをクリック）。

正しく設定されていれば、この変数はリクエストの authorization タブに自動で反映されます。
 

**ステップ3：検索クエリを作成する**

全アーカイブ検索では、検索クエリが1つ必要です。この例では、@XDevelopers アカウントによる投稿に一致するクエリを使用します。このクエリでは from 演算子を使用し、XDevelopers（大文字・小文字は不問）を指定します。

`from:XDevelopers`

Postman で "Params" タブに移動し、この ID、またはカンマ区切りの投稿 ID の文字列を、`ids` パラメータの "Value" 列に入力します。
 

| Key | Value | Description |
| :--- | :--- | :--- |
| `query` | `from:XDevelopers` | 全アーカイブ検索エンドポイントに送信する検索クエリ |

ステップ4：取得したいフィールドを特定して指定する

ステップ3の後に "Send" ボタンをクリックすると、レスポンスにはデフォルトの [Post object](/ja/x-api/fundamentals/data-dictionary#tweet) フィールドである `id`、`text`、`edit_history_tweet_ids` が返されます。編集機能がサポートされる前の投稿が返る場合、`edit_history_tweet_ids` フィールドは提供されません。このフィールドについての履歴のバックフィルは行われていません。 

これらのデフォルトフィールド以外を受け取りたい場合は、[field](/ja/x-api/fundamentals/fields) および／または [expansion](/ja/x-api/fundamentals/expansions) パラメータで、それらのフィールドをリクエストに指定してください。

この演習では、異なるオブジェクトから4種類のフィールドセットをリクエストします。

1. デフォルトの Post オブジェクトのフィールド
2. 投稿オブジェクトの追加フィールド tweet.created\_at
3. 返された投稿に紐づく投稿者の [user object](/ja/x-api/fundamentals/data-dictionary#user) のデフォルトフィールド
4. 関連するユーザーオブジェクトの追加フィールド user.description
    

Postman で "Params" タブに移動し、"Query Params" テーブルに次の key:value ペアを追加します。

| Key | Value | Returned fields |
| :--- | :--- | :--- |
| `tweet.fields` | `created_at` | `tweets.created_at` |
| `expansions` | `author_id` | includes.users.id, includes.users.name, includes.users.username |
| user.fields | description | includes.users.description |

"Send" ボタンの横に次の URL が表示されるはずです。

`https://api.x.com/2/tweets/search/all?query=from:XDevelopers&tweet.fields=created_at&expansions=author_id&user.fields=created_at`

<Note>
  **ご注意ください**

  デフォルトでは、最新の投稿のうち 10 件のみが返されます。1 回のリクエストで 10 件より多く取得したい場合は、max\_results パラメータを使用し、1 リクエストあたり最大 500 件の投稿まで設定できます。同様に、デフォルトでは直近 30 日間の投稿が返されます。30 日より前の投稿を取得したい場合は、API コールで start\_time と end\_time パラメータを使用してください。
</Note>

**ステップ5：リクエストを送信し、レスポンスを確認する**

セットアップが完了したら、「Send」ボタンを押すと、次のようなレスポンスが返ってきます。

```
{
   "data": [
       {
           "author_id": "2244994945",
           "created_at": "2020-06-11T16:05:06.000Z",
           "id": "1271111223220809728",
           "text": "Tune in tonight and watch as @jessicagarson takes us through running your favorite Python package in R. 🍿\n\nLearn how to use two powerful programming languages for data science together, and see a live example that uses the recent search endpoint from Twitter’s Developer Labs. https://t.co/v178oUZNuj"
       },
       {
           "author_id": "2244994945",
           "created_at": "2020-06-10T19:25:24.000Z",
           "id": "1270799243071062016",
           "text": "As we work towards building the new Twitter API, we’ve extended the deprecation timeline for several Labs v1 endpoints. Learn more 📖 https://t.co/rRWaJYJgKk"
       },
       {
           "author_id": "2244994945",
           "created_at": "2020-06-09T18:08:47.000Z",
           "id": "1270417572001976322",
           "text": "Annotations help you learn more about a Tweet — they can even help you find topics of interest. 🔬\n\nIn this tutorial, @suhemparack shows us how find Tweets related to COVID-19 using annotations + the filtered stream endpoint.\n\nLearn how you can, too. ⤵️\nhttps://t.co/qwVOgw0zSV"
       }
   ],
   "includes": {
       "users": [
           {
               "description": "The voice of Twitter's #DevRel team, and your official source for updates, news, & events about Twitter's API. \n\n#BlackLivesMatter",
               "id": "2244994945",
               "name": "Twitter Dev",
               "username": "TwitterDev"
           }
       ]
   },
   "meta": {
       "newest_id": "1271111223220809728",
       "oldest_id": "1270417572001976322",
       "result_count": 3
   }
}
```

この例では、ごくシンプルなクエリを使用しています。より詳しいガイドは、以下のリソースをご参照ください。

**次のステップ**

[API Reference を使用してリクエストをカスタマイズする](/ja/x-api/posts/full-archive-search)

[クエリオペレーターの全一覧を見る](/ja/x-api/posts/search/integrate/build-a-query "クエリオペレーターの全一覧を見る")

[これらのエンドポイントのサンプルコードを利用する](https://github.com/xdevplatform/Twitter-API-v2-sample-code "これらのエンドポイントのサンプルコードを利用する")