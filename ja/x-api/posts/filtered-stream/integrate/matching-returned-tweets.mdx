---
title: 投稿とルールの照合
sidebarTitle: 投稿とルールの照合
---

<div id="matching-returned-posts-to-their-associated-rule">
  ### 返される投稿を対応するルールにひも付ける
</div>

フィルタードストリームのエンドポイントでは、単一の接続で複数のルールを運用できます。ストリームで投稿を受信し始める前に、対象とする投稿の種類を指定するルールを作成する必要があります。

ユーザー属性、位置情報、言語など、さまざまな属性に基づいて投稿を照合するルールを定義する際には、そのルールを上位レベルで判別できるようタグを付与できます。多数のルールがある場合、とりわけタグはルールの文脈化に有効です。フィルタリングルールは、どの投稿アクティビティが接続経由で送信されるかを決定します。

別種の投稿を取得するために新しいフィルタリングルールを追加したい場合や、既存のルールを削除したい場合は、アプリから [POST tweets/search/stream/rules](/ja/x-api/posts/filtered-stream#post-2-tweets-search-stream-rules) エンドポイントにリクエストを送信して実行できます。リクエスト送信後、フィルタリングルールは自動的に更新され、再接続の必要なくデータストリームに変更が反映されます。多くのルール追加はおおむね20秒以内に反映されます。まれに、外的要因（例：ネットワーク接続）により、照合対象の投稿を受信し始めるまでに時間がかかる場合があります。ルール一覧のエンドポイントで目的のルールが見つからない場合は、ルール作成リクエストが成功しているかを確認してください。ログにエラーメッセージが出ていないかを確認することで検証できます。

<div id="matching-rules">
  #### 照合ルール
</div>

アクティビティがフィルタードストリーム接続で配信される際、matching\_rules 配列には、配信された投稿に対して一致したフィルターの一覧が含まれます。

Post のペイロードには、特定の投稿が配信された理由となったルールの id と tag を含む追加の文字列メタデータが含まれます。複数のルールが1つの投稿に一致した場合、アクティビティは1回だけ配信され、そのメタデータに一致した各ルールが含まれます。照合ルールは、特定の投稿を特定のルールに関連付ける簡便な方法であり、異なるルールを多数運用している場合に特に有用です。データはこの方式で単一のストリームから配信されるため、id と tag を一意にすることが照合には不可欠です。

「matching\_rules」配列が Post のペイロード内でどのように表れるかの例を次に示します:
 

```"matching_rules": [
    {
      "id": "1166916266197536768",
      "tag": "test-rule-tag-00000"
    },
    {
      "id": "1166916266197536769",
      "tag": "test-rule-tag-12345"
    }
  ]
```

<div id="rule-tags">
  #### ルールタグ
</div>

作成時に、各フィルタリングルールにはタグを付与できます。ルールタグ自体に特別な意味はなく、ルールに付随して持ち運ばれる不透明な文字列として扱われます。これらは返されるアクティビティの matching\_rules メタデータに含まれ、上位レベルでルールを区別しやすくすることを目的としています。 

タグは、フィルタリングルールを論理的にグループ化する簡便な手段を提供します。たとえば、特定のルールに一意の ID をタグとして付与し、アプリが処理するアクティビティ内でその ID を参照することで、結果を特定の顧客、キャンペーン、カテゴリ、その他の関連グループに関連付けることができます。

なお、タグは既存のルールに対して更新できず、ルール作成時にのみ付与できます。タグを「更新」または「名前変更」する必要がある場合は、まずそのルールを削除し、希望するタグを付けて再作成してください。最善の方法は、タグとして一意の識別子を使用し、それを自社アプリ内で他のさまざまなデータポイントと関連付けることです。これにより、ルールセットを変更することなく運用できます。

<div id="filtered-stream-recovery-and-redundancy-features">
  ### フィルタードストリーム - 復旧と冗長化機能
</div>

<Note>
  注: これらの復旧および冗長化機能を利用できるのは、Enterprise アクセスをお持ちの方のみです。
</Note>