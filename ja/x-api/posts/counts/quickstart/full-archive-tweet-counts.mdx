---
title: 投稿検索（全アーカイブ）
sidebarTitle: 投稿検索（全アーカイブ）
---

import { Button } from '/snippets/ja/button.mdx';

<div id="getting-started-with-the-full-archive-post-counts-endpoint">
  ### 全アーカイブ投稿数エンドポイントのはじめ方
</div>

このクイックスタートガイドでは、HTTPリクエストを送信できるグラフィカルツールである Postman を使って、全アーカイブ投稿数エンドポイントへの最初のリクエストを行う方法を説明します。

さまざまなプログラミング言語でのサンプルコードは、[X API v2 sample code](https://github.com/xdevplatform/Twitter-API-v2-sample-code) の GitHub リポジトリをご覧ください。

<Note>
  ### 前提条件

  全アーカイブ投稿数エンドポイントは、現在 Pro または Enterprise のアクセス権をお持ちの方のみご利用いただけます。このエンドポイントを使用するには、Pro または [Enterprise アクセス](https://docs.google.com/forms/d/e/1FAIpQLScO3bczKWO2jFHyVZJUSEGfdyfFaqt2MvmOfl_aJp0KxMqtDA/viewform) を申請する必要があります。

  アクセスが承認されたうえで、リクエストを認証するための [keys and tokens](/ja/resources/fundamentals/authentication) が必要です。次の手順に従ってこれらのキーとトークンを生成できます。

  - 開発者ポータルで Enterprise アクセス権のある [プロジェクト](/ja/resources/fundamentals/projects) に移動し、そのプロジェクト内に関連付けられた [開発者アプリ](/ja/resources/fundamentals/developer-apps) があることを確認します。

  - アプリの「Keys and tokens」ページに移動して、必要な認証情報を生成します。すべての認証情報は安全な場所に保存してください。
</Note>

<div id="steps-to-build-a-full-archive-post-counts-request">
  #### 全アーカイブの投稿件数リクエストを作成する手順
</div>

**ステップ1：ツールまたはライブラリを用意する**

このエンドポイントにリクエストを送るために使用できるツール、コード例、ライブラリはいくつかありますが、ここでは手順を簡素化するために Postman を使用します。

X API v2 の Postman コレクションを環境に読み込むには、次のボタンをクリックしてください。

<Button href="https://app.getpostman.com/run-collection/9956214-784efcda-ed4c-4491-a4c0-a26470a67400">
  Postman に X API v2 を追加
</Button>

Postman に X API v2 コレクションを読み込んだら、Post counts > Full-archive Post counts リクエストに移動します。

**ステップ2：リクエストを認証する**

X API に正しくリクエストするには、権限があることを確認する必要があります。このエンドポイントでは、[OAuth 2.0 App-Only](/ja/resources/fundamentals/authentication#app-only-authentication-and-oauth-2-0-bearer-token) 認証方式でリクエストを認証する必要があります。

キーとトークン、特に [App Access Token](/ja/resources/fundamentals/authentication#using-and-generating-an-app-only-bearer-token)（App-only Bearer Token とも呼ばれます）を Postman に追加してください。Postman の右上にある「X API v2」という環境を選択し、「initial value」と「current value」のフィールドにキーとトークンを追加します（環境のドロップダウン横の目のアイコンをクリック）。

これを正しく行うと、この変数はリクエストの Authorization タブに自動的に取り込まれます。
 

**ステップ3：クエリを作成する**

各全アーカイブの投稿件数リクエストには 1 つの[クエリ](/ja/x-api/posts/counts/integrate/build-a-query)が必要です。この例では、@XDevelopers アカウントが投稿したポストに一致するクエリを使用します。このクエリでは from 演算子を使用し、XDevelopers（大文字小文字は不問）に設定します。

`from:XDevelopers`

Postman で「Params」タブに移動し、この ID、またはカンマ区切りのポスト ID の文字列を、`ids` パラメータの「Value」列に入力します。
 

| Key | Value | Description |
| :--- | :--- | :--- |
| `query` | `from:XDevelopers` | 全アーカイブの投稿件数エンドポイントに送信するクエリ |

ステップ4（オプション）：粒度と期間を指定する

ステップ3の後に「Send」ボタンをクリックすると、デフォルトの全アーカイブの投稿件数（直近30日間の時間別）が返されます。日別の全アーカイブの投稿件数を取得したい場合は、granularity パラメータに day を設定してください。30日より前の投稿件数が必要な場合は、start\_time と end\_time パラメータに希望の値を指定する必要があります。 

Postman で「Params」タブに移動し、「Query Params」テーブルに次のキーと値のペアを追加します。

|     |     |     |
| :--- | :--- | :--- |
| **Key** | **Value** | **Description** |
| granularity | day | 投稿件数結果の粒度。指定可能な値は day、hour、minute |
| start\_time | 2021-05-01T00:00:00Z | ポストが提供される最も古い UTC タイムスタンプ |
| end\_time | 2021-06-01T00:00:00Z | ポストが提供される最も古い UTC タイムスタンプ。 |

「Send」ボタンの横に次の URL が表示されるはずです。

`https://api.x.com/2/tweets/counts/all?query=from%3AXDevelopers&start_time=2021-05-01T00:00:00Z&end_time=2021-06-01T00:00:00Z&granularity=day`

**ステップ5：リクエストを送信し、レスポンスを確認する**

準備が整ったら「Send」ボタンを押すと、次のようなレスポンスが返ってきます。

```
{
   "data": [
       {
           "end": "2021-05-02T00:00:00.000Z",
           "start": "2021-05-01T00:00:00.000Z",
           "tweet_count": 0
       },
       {
           "end": "2021-05-03T00:00:00.000Z",
           "start": "2021-05-02T00:00:00.000Z",
           "tweet_count": 0
       },
       {
           "end": "2021-05-04T00:00:00.000Z",
           "start": "2021-05-03T00:00:00.000Z",
           "tweet_count": 0
       },
       {
           "end": "2021-05-05T00:00:00.000Z",
           "start": "2021-05-04T00:00:00.000Z",
           "tweet_count": 0
       },
       {
           "end": "2021-05-06T00:00:00.000Z",
           "start": "2021-05-05T00:00:00.000Z",
           "tweet_count": 0
       },
       {
           "end": "2021-05-07T00:00:00.000Z",
           "start": "2021-05-06T00:00:00.000Z",
           "tweet_count": 0
       },
       {
           "end": "2021-05-08T00:00:00.000Z",
           "start": "2021-05-07T00:00:00.000Z",
           "tweet_count": 0
       },
       {
           "end": "2021-05-09T00:00:00.000Z",
           "start": "2021-05-08T00:00:00.000Z",
           "tweet_count": 0
       },
       {
           "end": "2021-05-10T00:00:00.000Z",
           "start": "2021-05-09T00:00:00.000Z",
           "tweet_count": 0
       },
       {
           "end": "2021-05-11T00:00:00.000Z",
           "start": "2021-05-10T00:00:00.000Z",
           "tweet_count": 0
       },
       {
           "end": "2021-05-12T00:00:00.000Z",
           "start": "2021-05-11T00:00:00.000Z",
           "tweet_count": 0
       },
       {
           "end": "2021-05-13T00:00:00.000Z",
           "start": "2021-05-12T00:00:00.000Z",
           "tweet_count": 6
       },
       {
           "end": "2021-05-14T00:00:00.000Z",
           "start": "2021-05-13T00:00:00.000Z",
           "tweet_count": 1
       },
       {
           "end": "2021-05-15T00:00:00.000Z",
           "start": "2021-05-14T00:00:00.000Z",
           "tweet_count": 0
       },
       {
           "end": "2021-05-16T00:00:00.000Z",
           "start": "2021-05-15T00:00:00.000Z",
           "tweet_count": 0
       },
       {
           "end": "2021-05-17T00:00:00.000Z",
           "start": "2021-05-16T00:00:00.000Z",
           "tweet_count": 0
       },
       {
           "end": "2021-05-18T00:00:00.000Z",
           "start": "2021-05-17T00:00:00.000Z",
           "tweet_count": 0
       },
       {
           "end": "2021-05-19T00:00:00.000Z",
           "start": "2021-05-18T00:00:00.000Z",
           "tweet_count": 1
       },
       {
           "end": "2021-05-20T00:00:00.000Z",
           "start": "2021-05-19T00:00:00.000Z",
           "tweet_count": 0
       },
       {
           "end": "2021-05-21T00:00:00.000Z",
           "start": "2021-05-20T00:00:00.000Z",
           "tweet_count": 8
       },
       {
           "end": "2021-05-22T00:00:00.000Z",
           "start": "2021-05-21T00:00:00.000Z",
           "tweet_count": 1
       },
       {
           "end": "2021-05-23T00:00:00.000Z",
           "start": "2021-05-22T00:00:00.000Z",
           "tweet_count": 0
       },
       {
           "end": "2021-05-24T00:00:00.000Z",
           "start": "2021-05-23T00:00:00.000Z",
           "tweet_count": 0
       },
       {
           "end": "2021-05-25T00:00:00.000Z",
           "start": "2021-05-24T00:00:00.000Z",
           "tweet_count": 0
       },
       {
           "end": "2021-05-26T00:00:00.000Z",
           "start": "2021-05-25T00:00:00.000Z",
           "tweet_count": 1
       },
       {
           "end": "2021-05-27T00:00:00.000Z",
           "start": "2021-05-26T00:00:00.000Z",
           "tweet_count": 1
       },
       {
           "end": "2021-05-28T00:00:00.000Z",
           "start": "2021-05-27T00:00:00.000Z",
           "tweet_count": 1
       },
       {
           "end": "2021-05-29T00:00:00.000Z",
           "start": "2021-05-28T00:00:00.000Z",
           "tweet_count": 2
       },
       {
           "end": "2021-05-30T00:00:00.000Z",
           "start": "2021-05-29T00:00:00.000Z",
           "tweet_count": 0
       },
       {
           "end": "2021-05-31T00:00:00.000Z",
           "start": "2021-05-30T00:00:00.000Z",
           "tweet_count": 0
       },
       {
           "end": "2021-06-01T00:00:00.000Z",
           "start": "2021-05-31T00:00:00.000Z",
           "tweet_count": 0
       }
   ],
   "meta": {
       "total_tweet_count": 22
   }
}
```

**ステップ6：結果をページングで取得する**

レスポンスの meta オブジェクトに next\_token が含まれている場合は、その値を next\_token クエリパラメータに渡します。

| Key | Value | Description |
| :--- | :--- | :--- |
| next\_token | 直前のリクエストの meta オブジェクトから取得した next\_token をここに指定します。 | 直近のリクエストで結果が最後まで返ってこなかった場合、meta オブジェクトに next\_token が含まれます。そのフィールドの値を取得し、次のリクエストで next\_token パラメータの値として設定します。他のリクエストパラメータはすべて同じままにします。 |

next\_token の値を正しく設定したら、「Send」ボタンを押して次のページの結果を受け取ります。