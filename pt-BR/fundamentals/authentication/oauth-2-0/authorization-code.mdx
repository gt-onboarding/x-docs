---
title: Fluxo de autorização OAuth 2.0 com código e PKCE
sidebarTitle: Fluxo de autorização OAuth 2.0 com código e PKCE
---

<div id="oauth-20-authorization-code-flow-with-pkce">
  ### Fluxo de autorização OAuth 2.0 com PKCE (Authorization Code)
</div>

<div id="introduction">
  #### Introdução
</div>

OAuth 2.0 é um protocolo de autorização padrão do setor que oferece maior controle sobre o escopo de uma aplicação e sobre fluxos de autorização em vários dispositivos. O OAuth 2.0 permite escolher escopos detalhados que concedem permissões específicas em nome de um usuário.

Para habilitar o OAuth 2.0 no seu App, ative-o nas configurações de autenticação do App, na seção Configurações do App no portal do desenvolvedor.

#### Por quanto tempo minhas credenciais permanecerão válidas?  

Por padrão, o token de acesso que você cria por meio do fluxo de código de autorização com PKCE permanecerá válido por apenas duas horas, a menos que você tenha usado o escopo `offline.access`.

<div id="refresh-tokens">
  #### Tokens de atualização
</div>

Tokens de atualização permitem que um aplicativo obtenha um novo token de acesso sem solicitar a intervenção do usuário, por meio do fluxo de atualização.

Se o escopo `offline.access` for aplicado, um token de atualização do OAuth 2.0 será emitido. Com esse token de atualização, você obtém um token de acesso. Se esse escopo não for enviado, não geraremos um token de atualização.

Um exemplo da solicitação para usar um token de atualização e obter um novo token de acesso é o seguinte:

```bash
POST 'https://api.x.com/2/oauth2/token' \
--header 'Content-Type: application/x-www-form-urlencoded' \
--data-urlencode 'refresh_token=bWRWa3gzdnk3WHRGU1o0bmRRcTJ5VUxWX1lZTDdJSUtmaWcxbTVxdEFXcW5tOjE2MjIxNDc3NDM5MTQ6MToxOnJ0OjE' \
--data-urlencode 'grant_type=refresh_token' \
--data-urlencode 'client_id=rG9n6402A3dbUJKzXTNX4oWHJ
```

<div id="app-settings">
  #### Configurações do App
</div>

Você pode definir as configurações de autenticação do seu App como OAuth 1.0a ou OAuth 2.0. Você também pode habilitar um App para usar tanto OAuth 1.0a quanto OAuth 2.0.

OAuth 2.0 pode ser usado apenas com a API do X v2. Se você selecionar OAuth 2.0, verá um Client ID na seção Keys and Tokens do seu App. 

<div id="confidential-clients">
  #### Clientes confidenciais
</div>

[Clientes confidenciais](https://datatracker.ietf.org/doc/html/rfc6749#section-2.1) podem manter credenciais de forma segura, sem expô-las a partes não autorizadas, e se autenticar com segurança no servidor de autorização, mantendo o segredo do cliente protegido. Clientes públicos, por geralmente serem executados em um navegador ou em um dispositivo móvel, não conseguem usar segredos de cliente. Se você selecionar um tipo de App que seja um cliente confidencial, receberá um segredo de cliente.

Se você selecionou, no portal do desenvolvedor, um tipo de cliente que é confidencial, também poderá ver um segredo de cliente. Suas opções são Native App, Single Page App, Web App, Automated App ou bot. Native App e Single Page App são clientes públicos, e Web App e Automated App ou bots são clientes confidenciais.

Você não precisa de client\_id para clientes confidenciais quando usar um Authorization Header válido. Ainda é necessário incluir client\_id no corpo das solicitações feitas com um cliente público. 

<div id="scopes">
  #### Escopos
</div>

Os escopos permitem definir acesso granular para seu App, garantindo que ele tenha apenas as permissões necessárias. Para saber mais sobre quais escopos correspondem a quais endpoints, consulte nosso [guia de mapeamento de autenticação](/pt-BR/resources/fundamentals/authentication/guides/v2-authentication-mapping).

|     |     |
| :--- | :--- |
| **Scope** | **Descrição** |
| tweet.read | Todos os Tweets que você pode visualizar, incluindo Tweets de contas protegidas. |
| tweet.write | Tuitar e retuitar por você. |
| tweet.moderate.write | Ocultar e desocultar respostas aos seus Tweets. |
| users.email | E-mail de um usuário autenticado. |
| users.read | Qualquer conta que você pode visualizar, incluindo contas protegidas. |
| follows.read | Pessoas que seguem você e pessoas que você segue. |
| follows.write | Seguir e deixar de seguir pessoas por você. |
| offline.access | Permanecer conectado à sua conta até que você revogue o acesso. |
| space.read | Todos os Spaces que você pode visualizar. |
| mute.read | Contas que você silenciou. |
| mute.write | Silenciar e reativar o som de contas por você. |
| like.read | Tweets que você curtiu e curtidas que você pode visualizar. |
| like.write | Curtir e retirar curtidas de Tweets por você. |
| list.read | Listas, membros de listas e seguidores de listas que você criou ou das quais é membro, incluindo listas privadas. |
| list.write | Criar e gerenciar listas por você. |
| block.read | Contas que você bloqueou. |
| block.write | Bloquear e desbloquear contas por você. |
| bookmark.read | Obter Tweets salvos (favoritos) de um usuário autenticado. |
| bookmark.write | Salvar e remover Tweets dos favoritos. |
| media.write | Enviar mídia. |

<div id="rate-limits">
  #### Limites de taxa
</div>

Em geral, os limites de taxa são os mesmos que ao autenticar com OAuth 1.0a, com exceção de consulta de Tweets e consulta de Usuários. Estamos aumentando o limite por App de 300 para 900 solicitações a cada 15 minutos ao usar OAuth 2.0 para consulta de Tweets e consulta de Usuários. Para saber mais, consulte nossa [documentação sobre limites de taxa](/pt-BR/resources/fundamentals/rate-limits).

<div id="grant-types">
  #### Tipos de concessão
</div>

Neste lançamento inicial, oferecemos apenas [authorization code](https://oauth.net/2/grant-types/authorization-code/) com [PKCE](https://oauth.net/2/pkce/) e [refresh token](https://oauth.net/2/grant-types/refresh-token/) como [tipos de concessão](https://oauth.net/2/grant-types/) compatíveis. Podemos oferecer mais tipos de concessão no futuro.

<div id="oauth-20-flow">
  #### Fluxo OAuth 2.0
</div>

O OAuth 2.0 utiliza um fluxo semelhante ao que estamos usando atualmente para o OAuth 1.0a. Você pode consultar um diagrama e uma explicação detalhada em nossa [documentação sobre o assunto](/pt-BR/resources/fundamentals/authentication/oauth-1-0a/obtaining-user-access-tokens). 

<div id="glossary">
  #### Glossário
</div>

|     |     |
| :--- | :--- |
| **Termo** | **Descrição** |
| Tipos de concessão | O framework OAuth especifica vários tipos de concessão para diferentes casos de uso e um mecanismo para criar novos tipos. Exemplos incluem código de autorização, credenciais do cliente, código de dispositivo e token de renovação. |
| Cliente confidencial | Clientes são aplicativos que podem se autenticar com segurança no servidor de autorização, por exemplo, mantendo em sigilo seu segredo de cliente registrado. |
| Cliente público | Clientes que não podem usar segredos de cliente registrados, como aplicativos executados em um navegador ou em um dispositivo móvel. |
| Fluxo de código de autorização | Usado por clientes confidenciais e públicos para trocar um código de autorização por um token de acesso. |
| PKCE | Uma extensão do fluxo de código de autorização para evitar diversos ataques e permitir realizar a troca OAuth com segurança a partir de clientes públicos. |
| Client ID | Pode ser encontrado na seção de chaves e tokens do portal do desenvolvedor, sob o cabeçalho "Client ID". Se você não o visualizar, entre em contato diretamente com nossa equipe. O Client ID será necessário para gerar a URL de autorização. |
| Redirect URI | Sua URL de callback. Você precisará ter [validação de correspondência exata](https://datatracker.ietf.org/doc/html/rfc6749#section-10.6). |
| Código de autorização | Permite que um aplicativo acesse APIs em nome dos usuários. Também conhecido como auth\_code. O auth\_code tem um limite de 30 segundos a partir do momento em que o proprietário do App recebe um auth\_code aprovado do usuário. Você deverá trocá-lo por um token de acesso dentro de 30 segundos, caso contrário o auth\_code expirará. |
| Token de acesso | Tokens de acesso são o token que os aplicativos usam para fazer solicitações à API em nome de um usuário. |
| Token de renovação | Permite que um aplicativo obtenha um novo token de acesso sem solicitar ação do usuário, por meio do fluxo de token de renovação. |
| Client Secret | Se você selecionou um tipo de App que seja um cliente confidencial, você receberá um “Client Secret” em “Client ID” na seção de chaves e tokens do seu App. |

<div id="parameters">
  #### Parâmetros
</div>

Para construir uma URL de autorização OAuth 2.0, verifique se os seguintes parâmetros estão presentes na URL de autorização.

|     |     |
| :--- | :--- |
| **Parâmetro** | **Descrição** |
| response\_type | Especifique que o tipo é um código usando a palavra “code”. |
| client\_id | Pode ser encontrado no portal do desenvolvedor sob o rótulo “Client ID”. |
| redirect\_uri | Sua URL de retorno (callback). Esse valor deve corresponder a uma das Callback URLs definidas nas configurações do seu App. Para OAuth 2.0, é necessário ter [validação de correspondência exata](https://datatracker.ietf.org/doc/html/rfc6749#section-10.6) para sua URL de callback. |
| state | Uma string aleatória fornecida por você para se proteger contra [ataques CSRF](https://auth0.com/docs/protocols/state-parameters). O comprimento dessa string pode ter até 500 caracteres. |
| code\_challenge | Um parâmetro [PKCE](https://www.oauth.com/oauth2-servers/pkce/authorization-request/), um segredo aleatório para cada solicitação. |
| code\_challenge\_method | Especifica o método usado na solicitação (S256 ou plain). |

#### URL de autorização 

Com OAuth 2.0, você cria uma URL de autorização que pode ser usada para permitir que um usuário se autentique por meio de um fluxo de autenticação, semelhante ao “Entrar com o X”. 

Um exemplo da URL que você está criando é o seguinte: 

```
https://x.com/i/oauth2/authorize?response_type=code&client_id=M1M5R3BMVy13QmpScXkzTUt5OE46MTpjaQ&redirect_uri=https://www.example.com&scope=tweet.read%20users.read%20account.follows.read%20account.follows.write&state=state&code_challenge=challenge&code_challenge_method=plain
```

Você precisará usar a codificação adequada para que essa URL funcione. Consulte nossa documentação sobre [percent-encoding](/pt-BR/resources/fundamentals/authentication/oauth-1-0a/percent-encoding-parameters).