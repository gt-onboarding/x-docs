---
title: "Account Activity API: Enterprise"
---

<Note>
  Este endpoint foi atualizado para incluir metadados de edição de Post. Saiba mais sobre esses metadados na página de fundamentos ["Editar posts"](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/edit-tweets). 

  Este endpoint é frequentemente usado com os endpoints de Mensagens Diretas. Lançamos novos [endpoints v2 de Mensagens Diretas](/pt-BR/x-api/direct-messages/manage/introduction). Observe que as APIs Enterprise e Premium do Account Activity oferecem suporte a mensagens um a um na v2, mas ainda não oferecem suporte a conversas em grupo.   
</Note>

Visão geral

`Enterprise`

A Account Activity API permite assinar atividades em tempo real relacionadas a uma conta de usuário via webhooks. Isso significa que você pode receber posts, Mensagens Diretas e outros eventos de conta em tempo real de uma ou mais das suas contas próprias ou assinadas por meio de uma única conexão.

Você receberá todas as atividades abaixo para cada assinatura de usuário no seu registro de webhook:

| Tipos de atividade |     |
| :--- | :--- |
| \* Posts (pelo usuário)  <br />    <br />\* Exclusões de post (pelo usuário)<br />\* @menções (do usuário)<br />\* Respostas (para ou do usuário)<br />\* Retweets (pelo usuário ou do usuário)<br />\* Posts com citação (pelo usuário ou do usuário)<br />\* Retweets de posts com citação (pelo usuário ou do usuário)<br />\* Curtidas (pelo usuário ou do usuário)<br />\* Seguir (pelo usuário ou do usuário)  <br />    <br />\* Deixar de seguir (pelo usuário) | \* Bloqueios (pelo usuário)<br />\* Desbloqueios (pelo usuário)<br />\* Silenciamentos (pelo usuário)<br />\* Remoções de silêncio (pelo usuário)<br />\* Mensagens Diretas enviadas (pelo usuário)<br />\* Mensagens Diretas recebidas (pelo usuário)<br />\* Indicadores de digitação (para o usuário)<br />\* Confirmações de leitura (para o usuário)<br />\* Revogações de assinatura (pelo usuário) |

**Atenção** - Não entregamos dados da timeline inicial por meio da Account Activity API. Use o [GET statuses/home\_timeline](https://developer.x.com/en/docs/x-api/v1/tweets/timelines/overview) para obter esses dados.
 

<div id="video-series">
  #### Série de vídeos
</div>

Confira nossa [série de quatro vídeos](https://www.youtube.com/watch?v=otPxejFhyy8\&index=0\&list=PLFKjcMIU2WshGG6Yj940XM7Z6BFs1zfBg) sobre a Account Activity API para se atualizar!

<iframe src="https://platform.x.com/embed/Tweet.html?dnt=false&embedId=twitter-widget-0&features=eyJ0ZndfdGltZWxpbmVfbGlzdCI6eyJidWNrZXQiOltdLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X2ZvbGxvd2VyX2NvdW50X3N1bnNldCI6eyJidWNrZXQiOnRydWUsInZlcnNpb24iOm51bGx9LCJ0ZndfdHdlZXRfZWRpdF9iYWNrZW5kIjp7ImJ1Y2tldCI6Im9uIiwidmVyc2lvbiI6bnVsbH0sInRmd19yZWZzcmNfc2Vzc2lvbiI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfZm9zbnJfc29mdF9pbnRlcnZlbnRpb25zX2VuYWJsZWQiOnsiYnVja2V0Ijoib24iLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X21peGVkX21lZGlhXzE1ODk3Ijp7ImJ1Y2tldCI6InRydWF0bWVudCIsInZlcnNpb24iOm51bGx9LCJ0ZndfZXhwZXJpbWVudHNfY29va2llX2V4cGlyYXRpb24iOnsiYnVja2V0IjoxMjA5NjAwLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X3Nob3dfYmlyZHdhdGNoX3Bpdm90c19lbmFibGVkIjp7ImJ1Y2tldCI6Im9uIiwidmVyc2lvbiI6bnVsbH0sInRmd19kdXBsaWNhdGVfc2NyaWJlc190b19zZXR0aW5ncyI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfdXNlX3Byb2ZpbGVfaW1hZ2Vfc2hhcGVfZW5hYmxlZCI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfdmlkZW9faGxzX2R5bmFtaWNfbWFuaWZlc3RzXzE1MDgyIjp7ImJ1Y2tldCI6InRydWVfYml0cmF0ZSIsInZlcnNpb24iOm51bGx9LCJ0ZndfbGVnYWN5X3RpbWVsaW5lX3N1bnNldCI6eyJidWNrZXQiOnRydWUsInZlcnNpb24iOm51bGx9LCJ0ZndfdHdlZXRfZWRpdF9mcm9udGVuZCI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9fQ%3D%3D&frame=false&hideCard=false&hideThread=false&id=996790447048613888&lang=en&origin=https%3A%2F%2Fdeveloper.x.com%2Fen%2Fdocs%2Fx-api%2Fenterprise%2Faccount-activity-api%2Foverview&sessionId=81f4a0339cbd7bd77b669faa00bd3a7224bc4418&theme=light&widgetsVersion=2615f7e52b7e0%3A1702314776716&width=550px" height="400px" />

<div id="feature-summary">
  ### Resumo de recursos
</div>

| Nível | Preço | Número de assinaturas únicas | Número de webhooks | Confiabilidade e recuperação de atividade |
| :--- | :--- | :--- | :--- | :--- |
| Enterprise | [Fale com vendas](/pt-BR/x-api/enterprise-gnip-2.0/enterprise-gnip) | Até 500+ | 3+  | [Novas tentativas](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#retries) e [replay](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-replay-api) |

- Tem dúvidas? Está encontrando erros?
  - Leia nossas [Perguntas frequentes](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#frequently-asked-questions) ou o [guia de solução de erros](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#frequently-asked-questions).

- Explore nosso código de exemplo:
  - [Dashboard da Enterprise Account Activity API](https://github.com/xdevplatform/account-activity-dashboard-enterprise), um app web em Node que exibe eventos de webhook usando o nível Enterprise da Account Activity API e inclui funcionalidade de [replay](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-replay-api).
  - O [chatbot SnowBot](https://github.com/xdevplatform/SnowBotDev), um app web em Ruby criado com as APIs Enterprise de Account Activity e Direct Message.

#### Gerenciando um webhook:

Usar um webhook permite que você assine atividades em tempo real relacionadas a uma conta de usuário por meio de uma única conexão.

<Tabs>
  <Tab title="Adding a webhook">
    Vamos começar registrando uma nova URL de webhook para o contexto do aplicativo informado.

    A URL será validada por meio de uma solicitação CRC antes de ser salva. Depois de registrar um webhook, certifique-se de anotar o ID do webhook, pois você precisará dele mais tarde.

    Copie a seguinte solicitação cURL no seu terminal após fazer as seguintes substituições:

    - **URL** `<URL>` ex.: `https://yourdomain.com/webhooks/twitter/`

    - **Consumer key** `<CONSUMER_KEY>` ex.: `xvz1evFS4wEEPTGEFPHBog`

    - **Access token** `<ACCESS_TOKEN>` ex.: `370773112-GmHxMAgYyLbNEtIKZeRNFsMKPR9EyMZeS9weJAEb`

      ```
      curl --request POST --url 'https://api.x.com/1.1/account_activity/webhooks.json?url=<URL>' --header 'authorization: OAuth oauth_consumer_key="<CONSUMER_KEY>", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="<ACCESS_TOKEN>", oauth_version="1.0"'
      ```
  </Tab>

  <Tab title="Viewing a webhook">
    Executaremos o seguinte comando para retornar todas as URLs de webhook registradas e seus status para o aplicativo informado.

    Copie a seguinte solicitação cURL no seu terminal após fazer as seguintes substituições:

    - **Bearer token** `<BEARER_TOKEN>` ex.: `AAAAAAAAAAAA0%2EUifi76ZC9Ub0wn...`

      ```curl --request GET --url https://api.x.com/1.1/account_activity/webhooks.json --header 'authorization: Bearer <BEARER_TOKEN>'
      ```
  </Tab>

  <Tab title="Removing a webhook">
    Para remover um webhook da configuração do aplicativo informado, copie a seguinte solicitação cURL no seu terminal após fazer as seguintes substituições:

    - **Webhook ID** `<:WEBHOOK_ID>` ex.: `1234567890`

    - **Consumer key** `<CONSUMER_KEY>` ex.: `xvz1evFS4wEEPTGEFPHBog`

    - **Access token** `<ACCESS_TOKEN>` ex.: `370773112-GmHxMAgYyLbNEtIKZeRNFsMKPR9EyMZeS9weJAEb`

      ```curl --request DELETE --url https://api.x.com/1.1/account_activity/webhooks/<:WEBHOOK_ID>.json --header 'authorization: OAuth oauth_consumer_key="<CONSUMER_KEY>", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="<ACCESS_TOKEN>", oauth_version="1.0"'
      ```
  </Tab>
</Tabs>

<div id="managing-a-webhook">
  #### Gerenciando usuários inscritos:
</div>

Depois de registrar um webhook, você pode adicionar um usuário inscrito à Account Activity API para começar a receber as atividades da conta dele.

<Tabs>
  <Tab title="Adicionando uma assinatura">
    Vamos começar inscrevendo um usuário para que você receba todos os tipos de eventos.

    Copie a seguinte solicitação cURL no seu terminal após fazer as seguintes alterações:

    - **Webhook ID** `<:WEBHOOK_ID>`, por exemplo, `1234567890`

    - **Nome da consumer key** `<CONSUMER_KEY>`, por exemplo, `xvz1evFS4wEEPTGEFPHBog`

    - **Token de acesso do usuário inscrito** `<SUBSCRIBING_USER'S_ACCESS_TOKEN>`, por exemplo, `370773112-GmHxMAgYyLbNEtIKZeRNFsMKPR9EyMZeS9weJAEb`

      ```
      curl --request POST --url https://api.x.com/1.1/account_activity/webhooks/<:WEBHOOK_ID>/subscriptions/all.json --header 'authorization: OAuth oauth_consumer_key="<CONSUMER_KEY>", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="<SUBSCRIBING_USER'S_ACCESS_TOKEN>", oauth_version="1.0"'
      ```
  </Tab>

  <Tab title="Visualizando assinaturas">
    Para visualizar uma lista de todas as assinaturas por tipo de atividade para um webhook específico, copie a seguinte solicitação cURL no seu terminal após fazer as seguintes alterações:

    - **Webhook ID** `<:WEBHOOK_ID>`, por exemplo, `1234567890`

    - **Bearer token** `<BEARER_TOKEN>`, por exemplo, `AAAAAAAAAAAA0%2EUifi76ZC9Ub0wn...`

      ```
      curl --request GET --url https://api.x.com/1.1/account_activity/webhooks/<:WEBHOOK_ID>/subscriptions/all/list.json --header 'authorization: Bearer <BEARER_TOKEN>'
      ```
  </Tab>

  <Tab title="Removendo uma assinatura">
    Após a desativação, todos os eventos do usuário solicitante deixarão de ser enviados para a URL do webhook.

    Para desativar uma assinatura no contexto do usuário e do aplicativo fornecidos, copie a seguinte solicitação cURL no seu terminal após fazer as seguintes alterações:

    - **Webhook ID** `<:WEBHOOK_ID>`, por exemplo, `1234567890`

    - **Consumer key** `<CONSUMER_KEY>`, por exemplo, `xvz1evFS4wEEPTGEFPHBog`

    - **Token de acesso do usuário inscrito** `<SUBSCRIBING_USER'S_ACCESS_TOKEN>`, por exemplo, `370773112-GmHxMAgYyLbNEtIKZeRNFsMKPR9EyMZeS9weJAEb`

      ```
      curl --request DELETE --url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID/subscriptions/all.json --header 'authorization: OAuth oauth_consumer_key="CONSUMER_KEY", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="SUBSCRIBED_USER'S_ACCESS_TOKEN", oauth_version="1.0"'
      ```
  </Tab>
</Tabs>

Ótimo trabalho! Agora você deve conseguir gerenciar seus webhooks e usuários inscritos.

<div id="managing-subscribed-users">
  #### Artigos de referência
</div>

- [Visão geral do Challenge-Response Check (CRC)](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#securing-webhooks)
- [Gerenciamento de webhooks e assinaturas](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#managing-webhooks-and-subscriptions)

## Um passo a passo em vídeo da Account Activity API

Neste passo a passo em vídeo, você conhecerá os recursos dos níveis Premium e Enterprise da Account Activity API.

Ao final deste vídeo, você terá aprendido sobre os seguintes recursos:

- Registrar um webhook
- Adicionar uma assinatura de usuário
- Remover uma assinatura de usuário
- Receber atividades da conta
- Reproduzir atividades da conta

<iframe src="https://platform.x.com/embed/Tweet.html?dnt=false&embedId=twitter-widget-0&features=eyJ0ZndfdGltZWxpbmVfbGlzdCI6eyJidWNrZXQiOltdLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X2ZvbGxvd2VyX2NvdW50X3N1bnNldCI6eyJidWNrZXQiOnRydWUsInZlcnNpb24iOm51bGx9LCJ0ZndfdHdlZXRfZWRpdF9iYWNrZW5kIjp7ImJ1Y2tldCI6Im9uIiwidmVyc2lvbiI6bnVsbH0sInRmd19yZWZzcmNfc2Vzc2lvbiI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfZm9zbnJfc29mdF9pbnRlcnZlbnRpb25zX2VuYWJsZWQiOnsiYnVja2V0Ijoib24iLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X21peGVkX21lZGlhXzE1ODk3Ijp7ImJ1Y2tldCI6InRyZWF0bWVudCIsInZlcnNpb24iOm51bGx9LCJ0ZndfZXhwZXJpbWVudHNfY29va2llX2V4cGlyYXRpb24iOnsiYnVja2V0IjoxMjA5NjAwLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X3Nob3dfYmlyZHdhdGNoX3Bpdm90c19lbmFibGVkIjp7ImJ1Y2tldCI6Im9uIiwidmVyc2lvbiI6bnVsbH0sInRmd19kdXBsaWNhdGVfc2NyaWJlc190b19zZXR0aW5ncyI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfdXNlX3Byb2ZpbGVfaW1hZ2Vfc2hhcGVfZW5hYmxlZCI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfdmlkZW9faGxzX2R5bmFtaWNfbWFuaWZlc3RzXzE1MDgyIjp7ImJ1Y2tldCI6InRydWVfYml0cmF0ZSIsInZlcnNpb24iOm51bGx9LCJ0ZndfbGVnYWN5X3RpbWVpbmVfc3Vuc2V0Ijp7ImJ1Y2tldCI6dHJ1ZSwidmVyc2lvbiI6bnVsbH0sInRmd190d2VldF9lZGl0X2Zyb250ZW5kIjp7ImJ1Y2tldCI6Im9uIiwidmVyc2lvbiI6bnVsbH19&frame=false&hideCard=false&hideThread=false&id=1204084171334832128&lang=en&origin=https%3A%2F%2Fdeveloper.x.com%2Fen%2Fdocs%2Fx-api%2Fenterprise%2Faccount-activity-api%2Fquick-start%2Fa-visual-walkthrough-of-the-account-activity-api&sessionId=b5b8e259a4c6287be2413de9059093170036fb30&theme=light&widgetsVersion=2615f7e52b7e0%3A1702314776716&width=550px" />

- Tem dúvidas? Está enfrentando erros?
  - Leia nossas [perguntas frequentes](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#frequently-asked-questions) ou o [guia de solução de erros](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#frequently-asked-questions).

- Explore nosso código de exemplo:
  - [Painel da Enterprise Account Activity API](https://github.com/xdevplatform/account-activity-dashboard-enterprise), um app web em Node que exibe eventos de webhook usando o nível enterprise da Account Activity API e inclui a funcionalidade de [Replay](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-replay-api).
  - O [chatbot SnowBot](https://github.com/xdevplatform/SnowBotDev), um app web em Ruby criado com as APIs enterprise Account Activity e Direct Message.

**Enterprise**

<div id="a-video-walkthrough-of-the-account-activity-api">
  ## Introdução aos webhooks
</div>

A Account Activity API é uma API baseada em webhooks que envia eventos de conta para um aplicativo web que você desenvolve, implanta e hospeda.

Há vários detalhes de “infraestrutura” que exigem atenção antes de você começar a receber eventos de webhook no seu aplicativo consumidor de eventos. Conforme descrito abaixo, você precisará criar um app do X, obter acesso à Account Activity API e desenvolver um aplicativo web que consuma eventos de webhook. 

### 1. Crie um app do X.

- Crie um [app do X](/pt-BR/resources/fundamentals/developer-apps) com uma conta de desenvolvedor aprovada no [portal do desenvolvedor](/pt-BR/resources/fundamentals/developer-portal). Se você estiver criando o app em nome da sua empresa, recomenda-se criá-lo com uma conta corporativa do X. Para solicitar uma conta de desenvolvedor, [clique aqui](/pt-BR/resources/fundamentals/developer-apps).
- Ative “Ler, escrever e acessar mensagens diretas” na guia de [permissões](/pt-BR/resources/fundamentals/developer-apps#oauth-1-0a-app-permissions) da página do seu app.
- Na guia "Keys and Access Tokens", anote a Consumer Key (API Key) e o Consumer Secret (API Secret) do seu app.
- Na mesma guia, gere o [Access Token e o Access Token Secret](/pt-BR/resources/fundamentals/authentication#obtaining-access-tokens-using-3-legged-oauth-flow) do seu app. Você precisará desses tokens de acesso para registrar sua URL de webhook, que é para onde o X enviará os eventos de conta.
- Se você não estiver familiarizado com o [X Sign-in](/pt-BR/resources/fundamentals/authentication#log-in-with-x) e com o funcionamento dos contextos de usuário na API do X, consulte [Obtaining Access Tokens](https://dev.x.com/webhooks/access-tokens). À medida que você adicionar contas para receber eventos, você as inscreverá usando os tokens de acesso dessa conta.
- Anote o ID numérico do seu app, conforme exibido na página ["Apps"](/pt-BR/resources/fundamentals/developer-apps) do [portal do desenvolvedor](/pt-BR/resources/fundamentals/developer-portal). Ao solicitar acesso à Account Activity API, você precisará desse ID do app.
   

<div id="1-create-a-x-app">
  ### 2. Obter acesso à Account Activity API
</div>

Depois de criar um app do X, o próximo passo é solicitar acesso à Account Activity API.

A Account Activity API está disponível apenas no Enterprise, portanto, você precisará enviar uma solicitação usando o link abaixo.

<Button href="https://developer.x.com/en/enterprise-application.html">
  Solicitar acesso ao Enterprise
</Button>

<div id="2-get-account-activity-api-access">
  ### 3. Desenvolver app consumidora de webhook
</div>

Depois que você receber acesso à Account Activity API, será necessário desenvolver, implantar e hospedar um app web que receberá eventos de webhook do X. 

- Crie um app web com uma URL para usar como webhook para receber eventos. Este é o endpoint implantado no seu servidor para ouvir os eventos de webhook do X recebidos. 
  - O _path_ da URI fica totalmente a seu critério. Este exemplo seria válido: https://mydomain.com\_/service/listen\_

  - Se você estiver ouvindo webhooks de diversas fontes, um padrão comum é: https://mydomain.com/webhook/twitter

  - Observe que a URL especificada não pode incluir uma especificação de porta (https://mydomain.com:5000/NoWorkie).

- Conforme descrito em nosso guia [Securing Webhooks](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#securing-webhooks), o primeiro passo é escrever código que receba uma solicitação GET de X Challenge Response Check (CRC) e responda com um JSON devidamente formatado. 

- Registre sua URL de webhook. Você fará uma solicitação POST para o endpoint /webhooks.json?url=. Ao fazer essa solicitação, o X enviará uma solicitação CRC para seu app web. Quando um webhook é registrado com sucesso, a resposta incluirá um id de webhook. Esse id de webhook será necessário posteriormente ao fazer algumas solicitações para a Account Activity API. 

- O X enviará eventos de webhook da conta para a URL que você registrou. Certifique-se de que seu app web aceite solicitações POST para eventos recebidos. Esses eventos serão codificados em JSON. Veja [AQUI](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-data-object-structure) exemplos de payloads JSON de webhook.

- Quando seu app web estiver pronto, o próximo passo é adicionar contas para as quais deseja receber atividades. Ao adicionar (ou excluir) contas, você fará solicitações POST referenciando o id da conta. Consulte nosso [guia sobre como adicionar assinaturas](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#managing-webhooks-and-subscriptions) para mais informações.

<div id="3-develop-webhook-consumer-app">
  ### 4. Validar configuração
</div>

- Para validar que seu app e webhook estão configurados corretamente, curta um Post publicado por uma das contas do X às quais seu app está inscrito. Você deve receber um `favorite_events` via uma requisição POST para a URL do seu webhook para cada curtida que seus assinantes receberem.
- Observe que pode levar até 10 segundos para que os eventos comecem a ser entregues após a adição de uma assinatura.

**Notas importantes**

- Ao registrar a URL do seu webhook, seu app web deve autenticar com seu consumer token e secret _e o token e secret de acesso do usuário proprietário do app_.

- Todas as Mensagens Diretas recebidas serão entregues via webhooks. Todas as Mensagens Diretas enviadas via [POST direct\_messages/events/new (message\_create)](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/new-event) também serão entregues via webhooks. Isso permite que seu app web tenha visibilidade de Mensagens Diretas enviadas por um cliente diferente.

- Observe que todo evento de webhook inclui um user ID for\_user\_id, que indica para qual assinatura o evento foi entregue.

- Se você tiver dois usuários usando seu app web para Mensagens Diretas na mesma conversa, seu webhook receberá dois eventos duplicados (um para cada usuário). Seu app web deve considerar isso.

- Se você tiver mais de um app web compartilhando a mesma URL de webhook e o mesmo usuário mapeado para cada app, o mesmo evento será enviado ao seu webhook várias vezes (uma vez por app web).

- Em alguns casos, seu webhook pode receber eventos duplicados. Seu app de webhook deve ser tolerante a isso e fazer deduplicação pelo ID do evento.

- Não espere que a resposta de Resposta Rápida siga imediatamente uma solicitação. Um usuário pode ignorar uma solicitação de Resposta Rápida e responder via Mensagem Direta tradicional. O usuário também pode fornecer uma resposta de Resposta Rápida a uma solicitação à qual não respondeu anteriormente no histórico da conversa.

- Veja código de exemplo:
  - [Enterprise Account Activity API dashboard](https://github.com/xdevplatform/account-activity-dashboard-enterprise), um app web em Node que exibe eventos de webhook usando o nível enterprise da Account Activity API e inclui a funcionalidade de [Replay](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-replay-api).

  - O [chatbot SnowBot](https://github.com/xdevplatform/SnowBotDev), um app web em Ruby criado com as APIs Account Activity e Direct Message. Este codebase inclui um [script](https://github.com/xdevplatform/SnowBotDev/wiki/Account-Activity-API-setup-script) para ajudar a configurar webhooks da Account Activity API.

## Protegendo webhooks

As APIs do X baseadas em webhooks oferecem dois métodos para confirmar a segurança do seu servidor de webhook:

1. As verificações de desafio–resposta permitem que o X confirme a propriedade do app web que recebe eventos de webhook.
2. O cabeçalho de assinatura em cada requisição POST permite que você confirme que o X é a origem dos webhooks recebidos.
    

### Verificações de Challenge-Response

Para verificar que você é o proprietário do app e da URL do webhook, o X realizará uma verificação de Challenge-Response (CRC), que não deve ser confundida com uma verificação de redundância cíclica. Quando um CRC for enviado, o X fará uma requisição GET ao seu app web com um parâmetro _`crc_token`_. Quando essa requisição for recebida, seu app web precisa gerar um `response_token` criptografado com base no parâmetro _`crc_token`_ e no Consumer Secret do seu app (detalhes abaixo). O response\_token deve ser codificado em JSON (veja o exemplo abaixo) e retornado em até três segundos. Quando bem-sucedido, um `id` de webhook será retornado.

Um CRC será enviado quando você registrar sua URL de webhook; portanto, implementar o código de resposta do CRC é um primeiro passo fundamental. Depois que seu webhook estiver estabelecido, o X acionará um CRC aproximadamente a cada 24 horas a partir da última vez em que recebemos uma resposta bem-sucedida. Seu app também pode acionar um CRC quando necessário, fazendo uma requisição PUT com o `id` do seu webhook. Acionar um CRC é útil durante o desenvolvimento do seu aplicativo de webhook, após implantar novo código e reiniciar seu serviço.

O _`crc_token`_ deve mudar a cada requisição de CRC recebida e deve ser usado como a mensagem no cálculo, em que seu Consumer Secret é a chave.

Caso a resposta não seja enviada em até 3 segundos ou se torne inválida, os eventos deixarão de ser enviados para o webhook registrado.

#### A solicitação de CRC ocorrerá:

- Quando uma URL de webhook for registrada.
- Aproximadamente a cada _hora_ para validar sua URL de webhook.
- Você pode acionar manualmente um CRC fazendo uma solicitação PUT. À medida que desenvolve seu cliente de webhook, planeje acionar manualmente o CRC enquanto desenvolve sua resposta ao CRC. 
   

<div id="the-crc-request-will-occur">
  #### Requisitos da resposta:
</div>

- Um hash HMAC SHA-256 codificado em base64, criado a partir do `crc_token` e do Consumer Secret do seu app
- `response_token` válido e em formato JSON.
- Latência inferior a 3 segundos.
- Código de resposta HTTP 200.
   

<div id="response-requirements">
  #### Bibliotecas HMAC específicas de linguagem:
</div>

- [Java/Scala](https://docs.oracle.com/javase/8/docs/api/index.html?javax/crypto/Mac.html)
- [Ruby](http://ruby-doc.org/stdlib-2.1.0/libdoc/openssl/rdoc/OpenSSL/HMAC.html)
- [Node.js](https://nodejs.org/api/crypto.html#crypto_class_hmac)
- [Python](https://docs.python.org/2/library/hmac.html)

<div id="language-specific-hmac-libraries">
  #### Exemplo de geração de token de resposta em Python:
</div>

O trecho a seguir define uma rota em um aplicativo web Flask para Python 2.7 que responderá corretamente à verificação de desafio.

```
import base64
import hashlib
import hmac
import json


\# Define uma rota para a requisição GET
@app.route('/webhooks/twitter', methods=\['GET'\])
def webhook_challenge():

  # cria um hash HMAC SHA-256 a partir do token recebido e do seu segredo do consumidor
  sha256\_hash\_digest = hmac.new(TWITTER\_CONSUMER\_SECRET, msg=request.args.get('crc_token'), digestmod=hashlib.sha256).digest()

  # constrói os dados de resposta com o hash codificado em base64
  response = {
    'response\_token': 'sha256=' + base64.b64encode(sha256\_hash_digest)
  }

  # retorna a resposta JSON devidamente formatada
  return json.dumps(response)
```

<div id="example-response-token-generation-in-python">
  #### Exemplo de resposta JSON:
</div>

Com a rota definida como acima, seu aplicativo web deve retornar uma resposta semelhante à abaixo ao acessar https://your-app-domain/webhooks/twitter?crc\_token=foo no navegador.

```
{
  "response_token": "sha256=x0mYd8hz2goCTfcNAaMqENy2BFgJJfJOb4PdvTffpwg="
}
```

<div id="example-json-response">
  #### Outros exemplos:
</div>

- [AQUI](https://github.com/xdevplatform/account-activity-dashboard/blob/master/helpers/security.js) há um exemplo de método de resposta CRC escrito em Node.js.
- [AQUI](https://github.com/xdevplatform/SnowBotDev/blob/master/app/controllers/snow_bot_dev_app.rb) há um exemplo de método de resposta CRC escrito em Ruby (veja _generate\_crc\_response_ e a rota GET que recebe eventos de CRC).

### Validação opcional do cabeçalho de assinatura

Ao receber uma requisição POST do X, ao enviar uma requisição GET para criar um webhook ou ao enviar uma requisição GET para executar um CRC manual, um hash de assinatura será passado nos cabeçalhos como x-twitter-webhooks-signature. Essa assinatura pode ser usada para validar que a origem dos dados é o X. A assinatura de hash do POST começa com sha256=, indicando o uso de HMAC SHA-256 para assinar seu X App Consumer Secret e o payload. O hash do GET é calculado a partir da string de parâmetros de consulta crc\_token=$token\&nonce=$nonce.

**Etapas para validar uma requisição**

1. Crie um hash usando seu consumer secret e o corpo do payload recebido.
2. Compare o hash gerado com o valor x-twitter-webhooks-signature codificado em base64. Use um método como [compare\_digest](https://docs.python.org/2/library/hmac.html) para reduzir a vulnerabilidade a ataques por tempo (timing attacks).

<div id="optional-signature-header-validation">
  ### Diretrizes de segurança adicionais
</div>

A seguir, apresentamos diretrizes de segurança adicionais a considerar para seu aplicativo web. Não implementar essas diretrizes não impedirá o funcionamento do seu webhook, mas elas são altamente recomendadas pela equipe de Segurança da Informação do X. Se você não estiver familiarizado com as recomendações abaixo, consulte o administrador do seu servidor.

#### Blocos agregados de rede do X

Para maior segurança, você pode adicionar os seguintes blocos agregados de rede a uma lista de permissões (allowlist):

- 199.59.148.0/22

- 199.16.156.0/22

- 192.133.77.0/26

- 64.63.15.0/24

- 64.63.31.0/24

- 64.63.47.0/24

- 202.160.128.0/24

- 202.160.129.0/24

- 202.160.130.0/24

<div id="x-aggregate-network-blocks">
  #### Configurações recomendadas do servidor
</div>

- Classificação “A” no teste do [ssllabs.com](http://ssllabs.com/)
- **Habilite TLS 1.2**
- Habilite Forward Secrecy
- Desative SSLv2
- Desative SSLv3 (devido ao POODLE)
- Desative TLS 1.0
- Desative TLS 1.1
- Desative a compactação TLS
- Desative Session Tickets, a menos que você faça rotação das chaves de session ticket.
- Defina a opção “ssl\_prefer\_server\_ciphers” ou “SSLHonorCipherOrder” na configuração de SSL como “on”.
- Garanta que a lista de cifras seja moderna, por exemplo:
  `ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES128-SHA256:AES128-SHA:AES256-GCM-SHA384:AES256-SHA256:AES256-SHA:ECDHE-RSA-DES-CBC3-SHA:DES-CBC3-SHA`

## Gerenciar webhooks e assinaturas

### Criando e alterando webhooks

Para alterar URLs de webhook, você precisa excluir o webhook existente e, em seguida, criar um novo. Observe que, ao fazer isso, será necessário reassociar as assinaturas de usuários ao novo webhook.

#### Endpoints de gerenciamento de configuração de webhooks:

|     |     |
| :--- | :--- |
| **Método** | Enterprise |
| Registra uma URL de webhook / Gera um webhook\_id | [POST webhooks](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api) |
| Retorna todas as URLs de webhook e seus status | [GET webhooks](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks) |
| Exclui a configuração de webhook atual do app | [DELETE webhooks/:webhook\_id](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id) |
| Aciona manualmente uma solicitação de CRC | [PUT webhooks/:webhook\_id](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id) |

<div id="webhook-configuration-management-endpoints">
  #### Por que não posso simplesmente atualizar a URL do webhook?
</div>

Por que as configurações de webhook são imutáveis? O X leva a segurança muito a sério. Se a URL do seu webhook for alterada, existe a possibilidade de que a consumer key e o consumer secret do seu aplicativo tenham sido comprometidos. Ao exigir a criação de uma nova configuração de webhook, também é necessário assinar novamente os eventos do seu usuário. Isso requer o uso de tokens de acesso que uma parte mal-intencionada tem menos probabilidade de possuir. Como resultado, reduz-se a chance de que outra parte receba informações privadas do seu usuário.
 

### Adicionar e remover assinaturas de usuário

O suporte a milhares de assinaturas está disponível no nível Enterprise. Se você já tem um gerente de contas, entre em contato com ele para tirar dúvidas. Para solicitar acesso às APIs Enterprise, [clique aqui](https://developer.x.com/en/products/x-api/enterprise). 

#### Endpoints de gerenciamento de assinaturas

 

|     |     |
| :--- | :--- |
| Método | Enterprise |
| Adicionar nova assinatura de usuário | [POST webhooks/:webhook\_id/subscriptions/all](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all) |
| Recuperar uma assinatura de usuário | [GET webhooks/:webhook\_id/subscriptions/all](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all) |
| Retorna uma lista de todas as assinaturas ativas | [GET webhooks/:webhook\_id/subscriptions/all/list](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-subscriptions-count) |
| Desativa uma assinatura de usuário usando OAuth somente de aplicativo | [DELETE webhooks/:webhook\_id/subscriptions/:user\_id/all.json](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-user-id-all-json) |

Account Activity API: Enterprise

<Note>
  **Atenção**: 

  O X precisa habilitar o acesso à Account Activity API para o seu App de desenvolvedor antes que você possa começar a usá-la. Para isso, compartilhe o ID do App que pretende usar para autenticação com seu gerente de conta ou equipe de suporte técnico.
</Note>

A [Account Activity API](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity) consiste em um conjunto de endpoints que permitem criar e gerenciar assinaturas de usuários para receber, por meio de uma única conexão, atividades de conta em tempo real de todas as contas às quais você está inscrito. 

Há dois métodos de autenticação disponíveis com a Account Activity API ([OAuth 1.0a](/pt-BR/resources/fundamentals/authentication#oauth-1-0a-2) e [OAuth 2.0 Bearer Token](/pt-BR/resources/fundamentals/authentication#bearer-token-also-known-as-app-only)). O método de autenticação que você deve usar dependerá do endpoint que estiver utilizando.

|     |     |     |     |
| :--- | :--- | :--- | :--- |
| **Descrição** | **Endpoint** | OAuth 1.0a  <br />(contexto do usuário) | Token Bearer OAuth 2.0 (somente aplicativo) |
| Registrar uma nova URL de webhook para o contexto do aplicativo fornecido | [POST account\_activity/webhooks](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks) | ✓   |     |
| Retorna todas as URLs e seus status para o aplicativo fornecido | [GET account\_activity/webhooks](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks) |     | ✓   |
| Aciona uma verificação de resposta a desafio (CRC) para a URL de um webhook específico | [PUT account\_activity/webhooks/:webhook\_id](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id) | ✓   |     |
| Inscreve o aplicativo nos eventos da conta de um usuário | [POST account\_activity/webhooks/:webhook\_id/subscriptions/all](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all) | ✓ \* |     |
| Retorna a contagem de assinaturas ativas no momento | [GET account\_activity/subscriptions/count](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-subscriptions-count) |     | ✓   |
| Verifica se uma configuração de webhook está inscrita nos eventos de um usuário | [GET account\_activity/webhooks/:webhook\_id/subscriptions/all](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all) | ✓ \* |     |
| Retorna uma lista de assinaturas ativas no momento | [GET account\_activity/webhooks/:webhook\_id/subscriptions/all/list](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all-list) |     | ✓   |
| Exclui um webhook | [DELETE account\_activity/webhooks/:webhook\_id](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id) | ✓   |     |
| \[DESCONTINUADO] Desativa uma assinatura para o contexto de usuário e aplicativo fornecidos | [DELETE account\_activity/webhooks/:webhook\_id/subscriptions/all](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated) | ✓ \* |     |
| Desativa uma assinatura usando OAuth somente aplicativo | [DELETE /account\_activity/webhooks/:webhook\_id/subscriptions/:user\_id/all.json](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-user-id-all-json) |     | ✓   |
| Reentrega atividades a um webhook | [POST /1.1/account\_activity/replay/webhooks/:webhook\_id/subscriptions/all.json](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#replay-api) |     | ✓   |

\*\_ A autenticação requer os tokens de acesso do usuário que está se inscrevendo. \_

Para os endpoints que exigem autenticação no contexto do usuário com OAuth 1.0a, você precisará fornecer as seguintes credenciais para autenticar a solicitação:

- Chaves do consumidor (API Key e Secret)
- Tokens de acesso (Access Token e Secret)

Nos três endpoints a seguir, você executa ações de escrita no contexto do seu aplicativo (nenhum usuário do X está envolvido). Portanto, os tokens de acesso que você precisa fornecer são os do seu App de desenvolvedor. Eles podem ser gerados diretamente no [portal do desenvolvedor](https://developer.x.com/en/portal/projects-and-apps), na aba “Keys and tokens” do seu App.  

- [POST account\_activity/webhooks](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks): Registrar uma nova URL de webhook para o contexto de aplicativo fornecido
- [PUT account\_activity/webhooks/:webhook\_id](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id): Acionar uma verificação de resposta ao desafio (CRC) para a URL de um webhook específico
- [DELETE account\_activity/webhooks/:webhook\_id](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id): Excluir um webhook

Por outro lado, nos três endpoints a seguir, você faz uma solicitação que permite ao seu aplicativo acessar dados protegidos em nome de um usuário do X (por exemplo, Mensagens Diretas). Portanto, você deve fornecer os tokens de acesso pertencentes ao usuário assinante em questão. Os tokens de acesso necessários podem ser obtidos usando o fluxo OAuth de 3 etapas (consulte [OAuth 1.0a: how to obtain a user’s Access Tokens](/pt-BR/resources/fundamentals/authentication#obtaining-access-tokens-using-3-legged-oauth-flow)). Esses endpoints foram marcados com um asterisco na tabela acima (\*).

- [POST account\_activity/webhooks/:webhook\_id/subscriptions/all](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all): Inscrever o aplicativo nos eventos da conta de um usuário
- [GET account\_activity/webhooks/:webhook\_id/subscriptions/all](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all): Verificar se uma configuração de webhook está inscrita nos eventos de um usuário
- [DELETE account\_activity/webhooks/:webhook\_id/subscriptions/all](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated): Desativar uma assinatura para o contexto de usuário e aplicativo fornecidos \[DESCONTINUADO]

<Note>
  **Atenção**: 

  Certifique-se de que seu App de desenvolvedor esteja habilitado para “Read, Write, and Direct Messages”. Você pode alterar essa configuração na [seção Projects & Apps](https://developer.x.com/en/portal/projects-and-apps) da sua conta de desenvolvedor, em “App permissions” do App selecionado. Será necessário regerar as credenciais do seu App após alterar as permissões.
</Note>

Uma lista de todos os endpoints disponíveis na Account Activity API, incluindo a descrição e exemplos de solicitações cURL com exemplos de implementação de autenticação, pode ser encontrada na [documentação de referência da API](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-api-reference-index).

Para mais informações, confira o [aplicativo web de exemplo e scripts auxiliares](https://github.com/xdevplatform/account-activity-dashboard-enterprise) do XDev para começar a usar a Enterprise Account Activity API.

<Note>
  **Atenção**: 

  O X precisa habilitar o acesso à Account Activity API para o seu App de desenvolvedor antes que você possa começar a usar a API. Para isso, compartilhe o App ID que você pretende usar para autenticação com seu gerente de conta ou equipe de suporte técnico.
</Note>

A [Account Activity API](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity) consiste em um conjunto de endpoints que permitem criar e gerenciar assinaturas de usuários para receber, em tempo real, atividades de conta de todas as suas contas inscritas por meio de uma única conexão. 

Há dois métodos de autenticação disponíveis na Account Activity API ([OAuth 1.0a](/pt-BR/resources/fundamentals/authentication#oauth-1-0a-2) e [OAuth 2.0 Bearer Token](/pt-BR/resources/fundamentals/authentication#oauth-2-0)). O método de autenticação a ser usado depende do endpoint que você estiver utilizando.

|     |     |     |     |
| :--- | :--- | :--- | :--- |
| **Descrição** | **Endpoint** | OAuth 1.0a  <br />(contexto do usuário) | Token Bearer OAuth 2.0 (somente aplicativo) |
| Registrar uma nova URL de webhook para o contexto do aplicativo fornecido | [POST account\_activity/webhooks](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks) | ✓   |     |
| Retorna todas as URLs e seus status para o aplicativo fornecido | [GET account\_activity/webhooks](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks) |     | ✓   |
| Aciona uma verificação de resposta a desafio (CRC) para a URL de um webhook específico | [PUT account\_activity/webhooks/:webhook\_id](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id) | ✓   |     |
| Inscreve o aplicativo nos eventos da conta de um usuário | [POST account\_activity/webhooks/:webhook\_id/subscriptions/all](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all) | ✓ \* |     |
| Retorna a contagem de assinaturas ativas no momento | [GET account\_activity/subscriptions/count](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-subscriptions-count) |     | ✓   |
| Verifica se uma configuração de webhook está inscrita nos eventos de um usuário | [GET account\_activity/webhooks/:webhook\_id/subscriptions/all](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all) | ✓ \* |     |
| Retorna uma lista de assinaturas ativas no momento | [GET account\_activity/webhooks/:webhook\_id/subscriptions/all/list](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all-list) |     | ✓   |
| Exclui um webhook | [DELETE account\_activity/webhooks/:webhook\_id](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id) | ✓   |     |
| \[DESCONTINUADO] Desativa uma assinatura para o contexto de usuário e aplicativo fornecidos | [DELETE account\_activity/webhooks/:webhook\_id/subscriptions/all](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated) | ✓ \* |     |
| Desativa uma assinatura usando OAuth somente aplicativo | [DELETE /account\_activity/webhooks/:webhook\_id/subscriptions/:user\_id/all.json](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-user-id-all-json) |     | ✓   |
| Reentrega atividades a um webhook | [POST /1.1/account\_activity/replay/webhooks/:webhook\_id/subscriptions/all.json](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#replay-api) |     | ✓   |

\*\_ A autenticação requer os tokens de acesso do usuário que está se inscrevendo. \_

Para os endpoints que exigem autenticação no contexto do usuário com OAuth 1.0a, você precisará fornecer as seguintes credenciais para autenticar a solicitação:

- Chaves do consumidor (API Key e Secret)
- Tokens de acesso (Access Token e Secret)

Nos três endpoints a seguir, você executa ações de escrita no contexto do seu aplicativo (nenhum usuário do X está envolvido). Portanto, os tokens de acesso que você precisa fornecer são os do seu App de desenvolvedor. Eles podem ser gerados diretamente no [portal do desenvolvedor](https://developer.x.com/en/portal/projects-and-apps), na aba “Keys and tokens” do seu App.  

- [POST account\_activity/webhooks](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks): Registrar uma nova URL de webhook para o contexto de aplicativo informado
- [PUT account\_activity/webhooks/:webhook\_id](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id): Acionar uma verificação de resposta ao desafio (CRC) para a URL de um webhook específico
- [DELETE account\_activity/webhooks/:webhook\_id](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id): Excluir um webhook

Por outro lado, nos três endpoints a seguir, você faz uma solicitação que permite que seu aplicativo acesse dados protegidos em nome de um usuário do X (por exemplo, Mensagens Diretas). Portanto, você deve fornecer os tokens de acesso pertencentes ao usuário assinante em questão. Os tokens de acesso necessários podem ser obtidos usando o fluxo OAuth de 3 etapas (consulte [OAuth 1.0a: how to obtain a user’s Access Tokens](/pt-BR/resources/fundamentals/authentication#obtaining-access-tokens-using-3-legged-oauth-flow)). Esses endpoints foram marcados com um asterisco na tabela acima (\*).

- [POST account\_activity/webhooks/:webhook\_id/subscriptions/all](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all): Inscrever o aplicativo nos eventos da conta de um usuário
- [GET account\_activity/webhooks/:webhook\_id/subscriptions/all](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all): Verificar se uma configuração de webhook está inscrita nos eventos de um usuário
- [DELETE account\_activity/webhooks/:webhook\_id/subscriptions/all](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated): Desativar uma assinatura para o contexto de usuário e aplicativo fornecidos \[DESCONTINUADO]

<Note>
  **Observe**: 

  Verifique se seu App de desenvolvedor está habilitado para “Leitura, Escrita e Mensagens Diretas”. Você pode alterar essa configuração na [seção Projects & Apps](https://developer.x.com/en/portal/projects-and-apps) da sua conta de desenvolvedor, em “App permissions” do App de desenvolvedor selecionado. Você precisará regerar as credenciais do seu App após alterar as configurações de permissões.
</Note>

Uma lista de todos os endpoints disponíveis na Account Activity API, incluindo a descrição correspondente e exemplos de solicitações cURL com implementações de autenticação, pode ser encontrada na [documentação de referência da API](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-api-reference-index).

Para mais informações, confira o [aplicativo web de exemplo e scripts auxiliares](https://github.com/xdevplatform/account-activity-dashboard-enterprise) do XDev para começar a usar a Enterprise Account Activity API.

## Tentativas de nova execução

`Enterprise`

Um dos benefícios do nível Enterprise da Account Activity API é um mecanismo de tentativas para eventos de webhook. Se um código de resposta HTTP 200 de “sucesso” não for recebido, o servidor do X iniciará um novo envio, reenviando o evento de webhook até três vezes em um período de cinco minutos. Esse serviço de repetição de eventos de webhook ajuda a garantir confiabilidade e recuperação de eventos quando ocorrem problemas de rede e durante interrupções e implantações do serviço no lado do cliente.
 

### O que são novas tentativas?

A Account Activity API oferece um recurso de novas tentativas quando o app web do cliente não retorna uma resposta 200 “success” para um evento de webhook de atividade de conta. Quando o cliente não confirma o recebimento bem-sucedido de um evento, o X presume que o evento não foi recebido. Se for recebida uma resposta diferente de 200, se nenhuma resposta for recebida em três segundos ou se não recebermos resposta alguma, tentaremos novamente a solicitação e a manteremos aberta por três segundos. Isso significa que você tem aproximadamente cinco segundos, em duas tentativas, para responder e receber a atividade que estamos tentando enviar para a sua URL de webhook. Caso seu servidor não responda ou retorne um erro transitório, repetiremos por cinco minutos. Haverá um total de três novas tentativas para confirmar a validação. Isso proporciona redundância e garante que você receba todos os eventos de webhook. Observe que assinaturas com novas tentativas receberão eventos repetidos para quaisquer/todas as atividades de todos os usuários assinados em seu webhook.

Se você não confirmar a validação dentro dessas oito tentativas, a atividade não ficará mais disponível por meio da Account Activity API. 

<div id="what-are-retries">
  ### Cronograma de novas tentativas
</div>

A Account Activity API fará até três novas tentativas ao longo de um período de cinco minutos, até receber uma resposta 200. Consulte a tabela abaixo para mais detalhes. Após cerca de cinco minutos, a atividade não poderá ser reenviada pela Account Activity API. Você precisará usar outros endpoints do X para coletar os dados perdidos. Por exemplo, as [APIs de busca](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/search-api) podem ser usadas para recuperar Posts, Retweets, Quote Tweets, menções e respostas relevantes. Mensagens Diretas perdidas podem ser recuperadas com [este endpoint](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events).

#### Cronograma de novas tentativas

|     |
| :--- |
| Atividade criada; a Account Activity API faz um POST para a URL do webhook e ocorre timeout em três segundos. |
| Aguarde três segundos após o término do timeout anterior e, em seguida, faça um POST para a URL do webhook pela Account Activity API; ocorre timeout em três segundos. |
| Aguarde 27 segundos após o término do timeout anterior e, em seguida, faça um POST para a URL do webhook pela Account Activity API; ocorre timeout em três segundos. |
| Aguarde 242 segundos após o término do timeout anterior e, em seguida, faça um POST para a URL do webhook pela Account Activity API; ocorre timeout em três segundos. |
| A Account Activity API deixará de tentar fazer POST após isso. O cliente deve usar outros endpoints do X para recuperar os dados. |

## Estrutura do objeto de dados de Atividade de Conta

| Objeto | Detalhes |
| :--- | :--- |
| for\_user\_id | Identifica a assinatura de usuário à qual o evento está relacionado. |
| is\_blocked\_by | (condicional) Mostrado apenas quando outro usuário menciona o usuário inscrito. Incluído se verdadeiro somente para eventos de menção a post. |
| source | O usuário que está realizando a atividade. Por exemplo, o usuário que está seguindo, bloqueando ou silenciando é o usuário de origem. |
| target | O usuário ao qual a atividade se aplica. Por exemplo, o usuário que está sendo seguido, bloqueado ou silenciado é o usuário de destino. |

**Atividades disponíveis**

| Tipo de mensagem | Detalhes |
| :--- | :--- |
| [tweet\_create\_events](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#tweet-create-events-posts-retweets-replies-quotetweets) | Payload de status de post quando qualquer uma das seguintes ações é realizada pelo ou para o usuário da assinatura: posts, retweets, respostas, menções (@mentions), citações (Quote Tweets) e retweets de citações. |
| [favorite\_events](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#favorite-events) | Evento de favorito (curtida) com o usuário e o destino. |
| [follow\_events](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#follow-events) | Evento de seguir com o usuário e o destino. |
| [unfollow\_events](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#unfollow-events) | Evento de deixar de seguir com o usuário e o destino. |
| [block\_events](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#block-events) | Evento de bloqueio com o usuário e o destino. |
| [unblock\_events](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#unblock-events) | Evento de desbloqueio com o usuário e o destino. |
| [mute\_events](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#mute-events) | Evento de silenciar com o usuário e o destino. |
| [unmute\_events](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#unmute-events) | Evento de remover silêncio com o usuário e o destino. |
| [user\_event](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#user-event) | Eventos de revogação enviados quando um usuário remove a autorização do aplicativo e a assinatura é automaticamente excluída. |
| [direct\_message\_events](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-events) | Status de mensagem direta com o usuário e o destino quando uma mensagem direta é enviada ou recebida. |
| [direct\_message\_indicate\_typing\_events](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-indicate-typing-events) | Evento de indicação de digitação em mensagem direta com o usuário e o destino. |
| [direct\_message\_mark\_read\_events](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-mark-read-events) | Evento de marcação como lida em mensagem direta com o usuário e o destino. |
| [tweet\_delete\_events](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#tweet-delete-events) | Aviso de posts excluídos para facilitar a manutenção da conformidade. |

**Exemplos de payload**

Veja abaixo exemplos de payload para cada evento de Atividade de Conta descrito na tabela acima.

#### tweet\_create\_events (Posts, Retweets, Respostas, Tweets com citação) 

```
{
	"for_user_id": "2244994945",
	"tweet_create_events": [
	  {
		<Tweet Object>
	  }
	]
}
```

#### tweet\_create\_events (@menções) 

```
{
	"for_user_id": "2244994945",
	"user_has_blocked": "false",
	"tweet_create_events": [
	  {
		<Tweet Object>
	  }
	]
}
```

#### favorite\_events

```
{
	"for_user_id": "2244994945",
	"favorite_events": [{
		"id": "a7ba59eab0bfcba386f7acedac279542",
		"created_at": "Mon Mar 26 16:33:26 +0000 2018",
		"timestamp_ms": 1522082006140,
		"favorited_status": {
			<Tweet Object>
		},
		"user": {
			<User Object>
		}
	}]
}
```

#### follow\_events

```
{
	"for_user_id": "2244994945",
	"follow_events": [{
			"type": "follow",
			"created_timestamp": "1517588749178",
			"target": {
				<Objeto de Usuário>
			},
			"source": {
				<Objeto de Usuário>
			}
		]
	}
}
```

#### unfollow\_events

```
{
	"for_user_id": "2244994945",
	"follow_events": [{
			"type": "unfollow",
			"created_timestamp": "1517588749178",
			"target": {
				<Objeto User>
			},
			"source": {
				<Objeto User>
			}
		]
	}
}
```

#### block\_events

```
{
	"for_user_id": "2244994945",
	"block_events": [{
		"type": "block",
		"created_timestamp": "1518127020304",
		"source": {
			<User Object>
		},
		"target": {
			<User Object>
		}
	}]
}
```

#### unblock\_events

```
{
	"for_user_id": "2244994945",
	"block_events": [{
		"type": "unblock",
		"created_timestamp": "1518127020304",
		"source": {
			<Objeto de Usuário>
		},
		"target": {
			<Objeto de Usuário>
		}
	}]
}
```

#### mute\_events

```
{
	"for_user_id": "2244994945",
	"mute_events": [
		{
			"type": "mute",
		  	"created_timestamp": "1518127020304",
			"source": {
				<User Object>
			},
			"target": {
				<User Object>
			}
		}
	]
}
```

#### unmute\_events

```
{
	"for_user_id": "2244994945",
	"mute_events": [
		{
			"type": "unmute",
		  	"created_timestamp": "1518127020304",
			"source": {
				<User Object>
			},
			"target": {
				<User Object>
			}
		}
	]
}
```

#### evento\_do\_usuario

```
{
	"user_event": {
		"revoke": {
			"date_time": "2018-05-24T09:48:12+00:00",
			"target": {
				"app_id": "13090192"
			},
			"source": {
				"user_id": "63046977"
			}
		}
	}
}
```

#### direct\_message\_events

```
{
  	"for_user_id": "4337869213",
	"direct_message_events": [{
		"type": "message_create",
		"id": "954491830116155396",
		"created_timestamp": "1516403560557",
		"message_create": {
			"target": {
				"recipient_id": "4337869213"
			},
			"sender_id": "3001969357",
			"source_app_id": "13090192",
			"message_data": {
				"text": "Hello World!",
				"entities": {
					"hashtags": [],
					"symbols": [],
					"user_mentions": [],
					"urls": []
				}
			}
		}
	}],
	"apps": {
		"13090192": {
			"id": "13090192",
			"name": "FuriousCamperTestApp1",
			"url": "https://x.com/furiouscamper"
		},
		"users": {},
		"3001969357": {
			"id": "3001969357",
			"created_timestamp": "1422556069340",
			"name": "Jordan Brinks",
			"screen_name": "furiouscamper",
			"location": "Boulder, CO",
			"description": "Alter Ego - X PE opinions-are-my-own",
			"url": "https://t.co/SnxaA15ZuY",
			"protected": false,
			"verified": false,
			"followers_count": 22,
			"friends_count": 45,
			"statuses_count": 494,
			"profile_image_url": "null",
			"profile_image_url_https": "https://pbs.twimg.com/profile_images/851526626785480705/cW4WTi7C_normal.jpg"
		},
		"4337869213": {
			"id": "4337869213",
			"created_timestamp": "1448312972328",
			"name": "Harrison Test",
			"screen_name": "Harris_0ff",
			"location": "Burlington, MA",
			"protected": false,
			"verified": false,
			"followers_count": 8,
			"friends_count": 8,
			"profile_image_url": "null",
			"statuses_count": 240,
			"profile_image_url_https": "https://abs.twimg.com/sticky/default_profile_images/default_profile_normal.png"
		}
	}
}
```

#### direct\_message\_indicate\_typing\_events

```
{
	"for_user_id": "4337869213",
	"direct_message_indicate_typing_events": [{
		"created_timestamp": "1518127183443",
		"sender_id": "3284025577",
		"target": {
			"recipient_id": "3001969357"
		}
	}],
	"users": {
		"3001969357": {
			"id": "3001969357",
			"created_timestamp": "1422556069340",
			"name": "Jordan Brinks",
			"screen_name": "furiouscamper",
			"location": "Boulder, CO",
			"description": "Alter ego — opiniões pessoais",
			"url": "https://t.co/SnxaA15ZuY",
			"protected": false,
			"verified": false,
			"followers_count": 23,
			"friends_count": 47,
			"statuses_count": 509,
			"profile_image_url": "null",
			"profile_image_url_https": "https://pbs.twimg.com/profile_images/851526626785480705/cW4WTi7C_normal.jpg"
		},
		"3284025577": {
			"id": "3284025577",
			"created_timestamp": "1437281176085",
			"name": "Bogus Bogart",
			"screen_name": "bogusbogart",
			"protected": true,
			"verified": false,
			"followers_count": 1,
			"friends_count": 4,
			"statuses_count": 35,
			"profile_image_url": "null",
			"profile_image_url_https": "https://pbs.twimg.com/profile_images/763383202857779200/ndvZ96mE_normal.jpg"
		}
	}
}
```

#### direct\_message\_mark\_read\_events

```
{
	"for_user_id": "4337869213",
	"direct_message_mark_read_events": [{
		"created_timestamp": "1518452444662",
		"sender_id": "199566737",
		"target": {
			"recipient_id": "3001969357"
		},
		"last_read_event_id": "963085315333238788"
	}],
	"users": {
		"199566737": {
			"id": "199566737",
			"created_timestamp": "1286429788000",
			"name": "Le Braat",
			"screen_name": "LeBraat",
			"location": "Denver, CO",
			"description": "dados de dia no @X, design ao entardecer",
			"protected": false,
			"verified": false,
			"followers_count": 299,
			"friends_count": 336,
			"statuses_count": 752,
			"profile_image_url": "null",
			"profile_image_url_https": "https://pbs.twimg.com/profile_images/936652894371119105/YHEozVAg_normal.jpg"
		},
		"3001969357": {
			"id": "3001969357",
			"created_timestamp": "1422556069340",
			"name": "Jordan Brinks",
			"screen_name": "furiouscamper",
			"location": "Boulder, CO",
			"description": "Alter ego — opiniões pessoais sobre X PE",
			"url": "https://t.co/SnxaA15ZuY",
			"protected": false,
			"verified": false,
			"followers_count": 23,
			"friends_count": 48,
			"statuses_count": 510,
			"profile_image_url": "null",
			"profile_image_url_https": "https://pbs.twimg.com/profile_images/851526626785480705/cW4WTi7C_normal.jpg"
		}
	}
}
```

#### tweet\_delete\_events

```
{
    "for_user_id": "930524282358325248",
    "tweet_delete_events": [
{
        "status": {
            "id": "1045405559317569537",
            "user_id": "930524282358325248"
        },
        "timestamp_ms": "1432228155593"
    }
   ]
}
```

## API de Reprodução de Atividade de Conta

`Enterprise`

A API de Reprodução de Atividade de Conta é uma ferramenta de recuperação de dados que permite recuperar eventos de até cinco dias atrás. Ela deve ser usada para recuperar dados em cenários em que seu servidor de [webhook](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api) perdeu eventos — seja devido a desconexões que duraram mais do que a [janela de novas tentativas](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#retries), seja em cenários de recuperação de desastres em que você precisa de alguns dias para restaurar seu sistema ao normal.

A API de Reprodução de Atividade de Conta foi desenvolvida para qualquer cenário em que você deixe de ingerir [atividades](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity) por um período. Ela entrega as atividades ao mesmo webhook usado para a entrega original em tempo real. Este produto é uma ferramenta de recuperação, não de backfill, o que significa que os eventos só serão reproduzidos se uma entrega anterior deles tiver sido tentada. A API de Reprodução de Atividade de Conta não pode entregar eventos referentes a um período anterior ao momento de criação de uma assinatura.

### Usando a Account Activity Replay API

Se sua conta estiver configurada com a funcionalidade Replay, você pode fazer solicitações de maneira semelhante às feitas para a Account Activity API. É importante observar que sua solicitação deve especificar o parâmetro webhook id para indicar quais atividades do webhook você deseja reproduzir. Em outras palavras, uma solicitação de Replay pede à Account Activity Replay API que recupere eventos de uma data e hora de início até uma data e hora de término com base no webhook id e no application id.

Observe que o horário deve estar em UTC. Essas atividades são entregues por meio do webhook registrado associado ao id, a uma taxa de até 2.500 eventos por segundo. Também tenha em mente que apenas uma tarefa de Replay por webhook pode estar em execução por vez, embora todas as assinaturas que estavam ativas durante a data/hora especificada nesse webhook sejam reproduzidas.

Os eventos são entregues começando pelo primeiro (mais antigo) minuto do período especificado, continuando em ordem cronológica (na medida do possível) até que o último minuto seja entregue. Nesse ponto, o Replay enviará um [evento de conclusão da tarefa](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#job-completed-successfully-message) ao webhook. Como trabalhamos cronologicamente na entrega de atividades, se houver poucos ou nenhum resultado correspondente próximo ao horário de início, provavelmente haverá um intervalo antes que os primeiros resultados sejam entregues.

<div id="using-account-activity-replay-api">
  ### Limitações
</div>

O Replay é uma ferramenta para recuperar facilmente atividades dos últimos cinco dias, mas não entregará eventos anteriores ao momento de criação da assinatura. Por exemplo, se você adicionou uma nova assinatura há três dias e executou um job de Replay com uma janela de cinco dias anteriores a hoje, você receberá apenas os dados referentes aos três dias em que essa nova assinatura esteve ativa.

<div id="limitations">
  ### Disponibilidade e tipos de dados
</div>

As atividades da Account Activity Replay API ficam disponíveis por cinco dias a partir do início da solicitação, e novos dados ficam disponíveis cerca de 10 minutos após a criação de uma determinada atividade. Você poderá fazer solicitações especificando um intervalo de tempo dentro dessa janela de cinco dias usando os parâmetros from\_date e to\_date na solicitação. Eventos que foram originalmente entregues antes de você ter acesso ao Replay não podem ser reproduzidos. Por exemplo, se sua conta foi habilitada para acesso à Account Activity Replay API em 1º de junho de 2019 às 15h30 UTC, você não poderá usar o Replay para recuperar quaisquer eventos anteriores a essa data e hora.

Continue para a [referência da Account Activity Replay API](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated)

## Introdução à migração

**Descontinuamos os produtos Site Streams, User Streams e a versão beta padrão da Account Activity API - DM Only em 2018. Se você utilizava esses produtos, certifique-se de migrar para a versão premium ou enterprise da Account Activity API.**

**Também descontinuamos os endpoints legados de Mensagens Diretas. Se você utilizava esses endpoints, certifique-se de migrar para os novos endpoints de DM ou para a versão premium ou enterprise da Account Activity API.**

**Consulte [este anúncio](https://devcommunity.x.com/t/details-and-what-to-expect-from-the-api-deprecations-this-week-on-august-16-2018/110746) para saber mais.**

Aqui estão os endpoints que serão afetados por essas mudanças:

- User Streams
- Site Streams
- GET direct\_messages
- GET direct\_messages/sent
- GET direct\_messages/show
- POST direct\_messages/new
- POST direct\_messages/destroy
   

Temos novos endpoints e serviços disponíveis que fornecem acesso semelhante e, para Mensagens Diretas, funcionalidades adicionais:

- Account Activity API [enterprise](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api) e [premium](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-api-reference-index)
- [GET direct\_messages/events/list](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events)
- [GET direct\_messages/events/show](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/get-event)
- [POST direct\_messages/events/new](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/new-event)
- [POST direct\_messages/events/destroy](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/delete-message-event)

Para ajudar você a fazer uma migração tranquila para esses novos endpoints e serviços, temos dois guias de migração:

- [Guia de migração da Account Activity API](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#migration-guide-moving-from-user-streams-site-streams-to-account-activity-api) para quem está migrando de User Streams e Site Streams para nosso novo serviço baseado em webhooks
- [Guia de migração de Mensagens Diretas](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/guides/direct-message-migration) para quem está migrando entre endpoints REST de Mensagens Diretas
   

Além disso, temos uma [série de vídeos](https://www.youtube.com/playlist?list=PLFKjcMIU2WshGG6Yj940XM7Z6BFs1zfBg) sobre a Account Activity API e como começar.

E, por fim, temos exemplos de código para aprofundar seu entendimento e ajudar você a começar rapidamente:

- O [Account Activity Dashboard](https://github.com/xdevplatform/Account-Activity-dashboard) é um app web de exemplo em Node.js com scripts auxiliares para começar a usar a Account Activity API.
- O [SnowBot](https://github.com/xdevplatform/SnowBotDev) é um chatbot de exemplo que usa a Account Activity API e endpoints REST de Mensagens Diretas. Ele foi escrito em Ruby, usa o framework web Sinatra e é implantado no Heroku.

<div id="migration-introduction">
  ## Guia de migração: migração de User Streams/Site Streams para a Account Activity API
</div>

**Em 23 de agosto de 2018, desativamos o Site Streams e o User Streams. Certifique-se de migrar para a Account Activity API.**

**Consulte [este anúncio](https://devcommunity.x.com/t/details-and-what-to-expect-from-the-api-deprecations-this-week-on-august-16-2018/110746) para saber mais.**

Este guia foi elaborado para ajudar você a migrar das APIs legadas User Streams e Site Streams para sua substituta, a Account Activity API. Abaixo você encontrará um resumo das mudanças, uma lista de novos recursos e as principais diferenças e considerações para apoiar a transição. Para orientação na migração a partir de endpoints básicos de DM, consulte o [guia de migração de Mensagens Diretas](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/guides/direct-message-migration).

### Resumo das alterações

A Account Activity API entregará eventos de contas autenticadas e assinadas por meio de webhooks, em vez de uma conexão de streaming como em User Streams e Site Streams.

#### APIs descontinuadas

GET user

GET site (incluindo fluxos de controle: GET site/c/:stream\_id, GET site/c/:stream\_id/info.json, GET site/c/:stream\_id/friends/ids.json, POST site/c/:stream\_id/add\_user.json, POST /site/c/:stream\_id/remove\_user.json)

<div id="deprecated-apis">
  #### APIs de substituição
</div>

[Enterprise Account Activity API – Todas as atividades](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api)

<div id="new-features">
  ### Diferenças e considerações de migração
</div>

**Formato da API:** A nova Account Activity API funciona de forma diferente de User Streams e Site Streams. Você precisará ajustar seu app web para receber dados via webhooks. Você pode encontrar mais informações sobre webhooks [aqui](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#getting-started-with-webhooks).

**Dados disponíveis:** Outra diferença importante diz respeito aos dados entregues. O X não enviará mais eventos de pessoas que você segue no X (ou seja, sua linha do tempo inicial). Essa foi uma mudança intencional e não pretendemos alterá-la daqui para frente.

**Confiabilidade:** Diferente de streaming, webhooks permitem confirmar a entrega e oferecem opções de nova tentativa para atividades enviadas por POST que não chegam à URL do webhook. Isso aumenta a garantia de que o app está recebendo todas as atividades aplicáveis, mesmo em caso de breves desconexões ou períodos de indisponibilidade.

<div id="differences-migration-considerations">
  ### Novos recursos
</div>

A Account Activity API oferece muitos novos recursos, em especial a entrega de dados por meio de webhooks em vez de streaming. Webhooks oferecem muitas vantagens em comparação com streaming, sendo as principais a velocidade e a confiabilidade. A API enviará os dados a você na forma de eventos JSON assim que estiverem disponíveis, e você não precisará mais manter uma conexão ativa nem consultar o endpoint. Isso reduz a necessidade de redundância e aumenta a eficiência geral. Mais informações sobre webhooks podem ser encontradas na [documentação técnica](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#getting-started-with-webhooks).

<div id="new-features">
  ### Gerenciando assinaturas de usuários
</div>

A Account Activity API permite múltiplas assinaturas para um único webhook registrado. Isso possibilita que atividades de várias assinaturas de usuários sejam entregues no mesmo endpoint, de forma semelhante à arquitetura do Site Streams, com webhooks. Isso significa que você pode acompanhar as assinaturas — no que diz respeito aos seus limites de assinatura — de forma independente da conexão do webhook. Isso também permite escalar de apenas uma ou algumas assinaturas para milhares de assinaturas em um único webhook.

<div id="managing-user-subscriptions">
  ### **Como migrar**
</div>

<div id="how-to-migrate">
  ### **Siga as etapas abaixo para migrar facilmente da Site Streams API para a Account Activity API**
</div>

**Etapa 1: Decida por um pacote**

Dependendo de como você está operando atualmente com User Streams ou Site Streams, considere migrar para a versão enterprise ou premium da Account Activity API. Considere o número de aplicativos ou usuários autorizados que você atende atualmente e dimensione adequadamente para o volume e a confiabilidade necessários. Ao decidir pelo pacote que melhor atende às suas necessidades, alguns pontos a considerar são:

- Número de webhooks necessários
- Assinaturas/usuários autorizados atuais/projetados gerenciados no seu aplicativo
- Número atual de aplicativos cliente do X
- O nível de suporte que você prefere do X (suporte via fórum ou suporte enterprise gerenciado 1:1)
- Preço de cada pacote

**Etapa 2:** **Verifique a configuração do seu app do X no portal do desenvolvedor**

O [app do X](/pt-BR/resources/fundamentals/developer-apps) atualmente usado para User Streams ou Site Streams estará listado para o usuário proprietário no [portal do desenvolvedor](/pt-BR/resources/fundamentals/developer-portal). Esse app do X também pode ser usado com a Account Activity API para manter os usuários já autorizados nesse aplicativo. Um novo app também pode ser criado, e os usuários podem ser reautorizados para esse novo app, se desejado. Se você estiver criando um novo app em nome de uma empresa, recomenda-se criar o app com uma conta corporativa X @handle.

- Ative “Leitura, escrita e acesso a mensagens diretas” na aba [permissões](/pt-BR/resources/fundamentals/developer-apps#app-permissions) da página do seu app do X.
  \*Observe que alterar essas configurações não é retroativo; quaisquer usuários autorizados manterão as configurações de autorização do momento em que foram autorizados. Se um usuário ainda não tiver concedido a você acesso de leitura, escrita e mensagens diretas, será necessário que esse usuário reautorize seu aplicativo.
- Se você não estiver familiarizado com o [X Sign-in](/pt-BR/resources/fundamentals/authentication#log-in-with-x) e como os contextos de usuário funcionam com a X API, revise [Obtendo tokens de acesso](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#getting-started-with-webhooks).
- Gere tokens de acesso para o proprietário do app do X na parte inferior da aba “Keys and Tokens”. Nessa mesma aba, anote seu Consumer Key, Consumer Secret, Access Token e Access Token Secret. Você precisará deles para usar a API.
- Gere um bearer token usando seu Consumer Key e Consumer Secret para métodos de API [somente aplicativo](/pt-BR/resources/fundamentals/authentication#bearer-token-also-known-as-app-only).

**Etapa 3: Configure seus webhooks**

- Crie um aplicativo web com um endpoint para usar como webhook e receber eventos (por exemplo, https://your\_domain.com/webhook/twitter ou https://webhooks.your\_domain.com).

- Use seu Consumer Key, Consumer Secret, Access Token e Access Token Secret ao criar seu webhook. Observe que seu endpoint deve retornar uma resposta JSON com um response\_token, que é um hash HMAC SHA-256 codificado em base64 criado a partir do crc\_token e do Consumer Secret do seu app.

- Revise a documentação de [Protegendo webhooks](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#securing-webhooks), dando atenção especial aos requisitos do Challenge Response Check (CRC).

- Certifique-se de que seu webhook ofereça suporte a requisições POST para eventos recebidos e a requisições GET para o CRC.

- Certifique-se de que seu webhook tenha baixa latência (menos de 3 segundos para responder a requisições POST)

**Etapa 4: Valide a configuração do seu webhook**

- As APIs de webhook protegerão seus webhooks de duas maneiras:

               - Exigir verificações de resposta ao desafio para validar que o proprietário do webhook é o proprietário do app web.

               - Incluir um cabeçalho de assinatura em cada requisição POST para que seu app web valide a origem.

- Para verificar que você é tanto o proprietário do app web quanto da URL do webhook, o X realizará um Challenge Response Check (CRC), que não deve ser confundido com uma verificação de redundância cíclica.
- Uma requisição GET com um parâmetro chamado crc\_token será enviada para a URL do seu webhook. Seu endpoint deve retornar uma resposta JSON com um response\_token, que é um hash HMAC SHA-256 codificado em base64 criado a partir do crc\_token e do Consumer Secret do seu app.
- Espera-se que o crc\_token mude a cada requisição de CRC recebida. O crc\_token deve ser usado como a mensagem no cálculo, em que seu Consumer Secret é a chave.
- Caso a resposta seja inválida, os eventos deixarão de ser enviados para o webhook registrado.

**Etapa 5: Crie assinaturas para cada usuário autorizado de User Streams ou Site Streams**

Convertendo para a Account Activity API a partir de User Streams:

- Gere uma lista das suas assinaturas de usuário atuais em User Streams
- Configure suas novas assinaturas da Account Activity API usando a solicitação:  _POST account\_activity/all/:env\_name/subscriptions_
- Confirme suas assinaturas da Account Activity API usando a solicitação:  \_GET account\_activity/all/:env\_name/subscriptions/list
  \_

Migração para a Account Activity API a partir de Site Streams: (usando control streams):

- Gere uma lista das suas assinaturas atuais em Site Streams usando a solicitação:  _GET /1.1/site/c/:stream\_id/info.json_
- Configure suas novas assinaturas da Account Activity API usando a solicitação:  _POST account\_activity/all/:env\_name/subscriptions_
- Confirme suas assinaturas da Account Activity API usando a solicitação:  \_GET account\_activity/all/:env\_name/subscriptions/list
  \_

Registrar um webhook e criar assinaturas (sem migrar de Site Streams ou User Streams)

- Registre a URL do webhook no seu app usando [POST webhooks](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api) e receba um webhook\_id.
- Use o webhook\_id retornado para adicionar assinaturas de usuário com [POST webhooks/:webhook\_id/subscriptions/all](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all).

<div id="follow-the-steps-below-to-easily-migrate-from-the-site-streams-api-to-the-account-activity-api">
  ### O painel do Account Activity (aplicativo de exemplo da Account Activity API)
</div>

Criamos um aplicativo de exemplo para agilizar os testes com a Account Activity API:   

- Baixe o aplicativo de exemplo Account Activity Dashboard [aqui](https://github.com/xdevplatform/Account-Activity-dashboard) (usa Node.js)
- Siga as instruções no README para instalar e iniciar o app
- Depois que o aplicativo for iniciado, você pode usar a interface para configurar facilmente seu webhook e criar uma nova assinatura

<div id="the-account-activity-dashboard-sample-account-activity-api-application">
  ### Atividades disponíveis
</div>

| Tipo de mensagem | Detalhes |
| :--- | :--- |
| [tweet\_create\_events](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#tweet-create-events-posts-retweets-replies-quotetweets) | Payload de status de post quando qualquer uma das seguintes ações é realizada pelo usuário da assinatura ou direcionada a ele: posts, retweets, respostas, @menções, QuoteTweets |
| [favorite\_events](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#favorite-events) | Evento de curtida com o usuário e o destino. |
| [follow\_events](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#follow-events) | Evento de seguir com o usuário e o destino. |
| [block\_events](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#block-events) | Evento de bloqueio com o usuário e o destino. |
| [mute\_events](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#mute-events) | Evento de silenciar com o usuário e o destino. |
| [direct\_message\_events](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-events) | Status de mensagem direta com o usuário e o destino. |
| [direct\_message\_indicate\_typing\_events](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-indicate-typing-events) | Evento de digitação de mensagem direta com o usuário e o destino. |
| [direct\_message\_mark\_read\_events](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-mark-read-events) | Evento de leitura de mensagem direta com o usuário e o destino. |

### Tipos de mensagens de streaming descontinuados 

|     |     |
| :--- | :--- |
| Linhas em branco | Linhas em branco não serão mais entregues na Account Activity API, pois eram usadas como mensagens de keep-alive em User Streams e Site Streams. |
| Avisos de limite | Avisos de limite não serão mais enviados para um webhook específico. Em vez disso, os usuários podem chamar a API para obter o uso atual dos identificadores disponíveis. Isso será incluído no portal do desenvolvedor em algum momento no futuro. |
| Mensagens de desconexão | Avisos de desconexão não serão mais necessários, pois os webhooks não dependem de uma conexão ativa. |
| Avisos de estagnação | Avisos de estagnação não serão mais necessários, pois os webhooks não dependem de uma conexão ativa capaz de lidar com um grande volume de mensagens recebidas. |
| Lista de amigos | Listas de amigos não serão mais enviadas de forma proativa. Agora haverá um endpoint REST para obter essas informações. |

<div id="deprecated-streaming-message-types">
  ### Tipos de eventos descontinuados
</div>

|     |     |     |     |     |
| :--- | :--- | :--- | :--- | :--- |
| **Descrição** | **Nome do evento** | **Origem** | **Destino** | **Objeto de destino** |
| Usuário exclui um post | delete | Usuário atual | Usuário atual | Post |
| Usuário seguido exclui um post | delete | Usuário seguido | Usuário seguido | Post |
| Usuário remove a curtida de um post | unfavorite | Usuário atual | Autor do post | Post |
| O post do usuário tem a curtida removida | unfavorite | Usuário que removeu a curtida | Usuário atual | Post |
| Usuário deixa de seguir alguém | unfollow | Usuário atual | Usuário seguido | Nulo |
| Usuário cria uma lista | list\_created | Usuário atual | Usuário atual | Lista |
| Usuário exclui uma lista | list\_destroyed | Usuário atual | Usuário atual | Lista |
| Usuário edita uma lista | list\_updated | Usuário atual | Usuário atual | Lista |
| Usuário adiciona alguém a uma lista | list\_member\_added | Usuário atual | Usuário adicionado | Lista |
| Usuário é adicionado a uma lista | list\_member\_added | Usuário que adicionou | Usuário atual | Lista |
| Usuário remove alguém de uma lista | list\_member\_removed | Usuário atual | Usuário removido | Lista |
| Usuário é removido de uma lista | list\_member\_removed | Usuário que removeu | Usuário atual | Lista |
| Usuário segue uma lista | list\_user\_subscribed | Usuário atual | Dono da lista | Lista |
| A lista do usuário é seguida | list\_user\_subscribed | Usuário seguidor | Usuário atual | Lista |
| Usuário deixa de seguir uma lista | list\_user\_unsubscribed | Usuário atual | Dono da lista | Lista |
| A lista do usuário deixa de ser seguida | list\_user\_unsubscribed | Usuário que deixou de seguir | Usuário atual | Lista |
| Usuário atualiza o perfil | user\_update | Usuário atual | Usuário atual | Nulo |
| Usuário atualiza o status de protegido | user\_update | Usuário atual | Usuário atual | Nulo |

## Guia de migração de Mensagens Diretas

**Em 17 de setembro de 2018, desativamos os endpoints legados de Mensagens Diretas.
Se você utilizava esses endpoints, certifique-se de migrar para os novos endpoints de Mensagens Diretas ou para a Account Activity API.**

**Consulte [este comunicado](https://devcommunity.x.com//t/details-and-what-to-expect-from-the-api-deprecations-this-week-on-august-16-2018/110746) para saber mais.**

Este guia foi elaborado para ajudar você a migrar das APIs REST legadas de Mensagens Diretas para suas substitutas aprimoradas, que saíram do beta. A seguir, você encontrará um resumo das mudanças, uma lista de novos recursos e as principais diferenças e considerações para facilitar a transição. Os novos endpoints de Mensagens Diretas já estão disponíveis para todos os desenvolvedores. Para orientação sobre a migração a partir de User Streams ou Site Streams, consulte o [guia de migração para a Account Activity API](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#migration-guide-moving-from-user-streams-site-streams-to-account-activity-api).

- [Resumo das mudanças](#summary)
- [Novos recursos](#features)
- [Envio de Mensagens Diretas](#sending)
- [Recebimento de Mensagens Diretas](#receiving)
- [Exclusão de Mensagens Diretas](#deleting)

### Resumo das alterações

Se você ainda estiver usando os seguintes endpoints de MD, será necessário migrar para os endpoints mais recentes.

| Endpoint descontinuado | Nova alternativa de migração |
| :--- | :--- |
| [POST direct\_messages/new](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/new-event) | [POST direct\_messages/events/new](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/new-event) |
| [GET direct\_messages/show](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/get-event) | [GET direct\_messages/events/show](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/get-event) |
| [GET direct\_messages](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events) | [GET direct\_messages/events/list](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events) |
| [GET direct\_messages/sent](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/get-event) | [GET direct\_messages/events/list](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events) |
| [POST direct\_messages/destroy](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/delete-message-event) | [DELETE direct\_messages/events/destroy](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/delete-message-event "GET direct_messages/events/list") |

<div id="differences-migration-considerations">
  ### Novos recursos
</div>

Os novos endpoints da API de Mensagens Diretas oferecem várias funcionalidades inéditas e proporcionam acesso aprimorado a Mensagens Diretas anteriores. Os novos recursos incluem:

- Suporte a anexos de mídia (imagem, GIF e vídeo).
- Possibilidade de solicitar respostas estruturadas dos usuários com uma lista de opções predefinidas.
- Até 30 dias de acesso às Mensagens Diretas anteriores.

Para a lista completa de novos recursos de Mensagens Diretas e endpoints adicionais da API, consulte a [documentação técnica](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/overview).
 

<div id="new-features">
  ### Diferenças e considerações de migração
</div>

Os novos endpoints da API se comportam de forma bastante diferente em relação aos anteriores. Apenas atualizar as URLs dos endpoints causará erros no seu aplicativo. Considere o seguinte ao preparar seu aplicativo para a migração.

#### Novo objeto de Mensagem Direta

A primeira coisa que você provavelmente notará é a nova estrutura de objeto das Mensagens Diretas. Essa nova estrutura do objeto Message Create foi introduzida para dar suporte a novos recursos como [Respostas rápidas](https://developer.x.com/en/docs/x-api/v1/direct-messages/quick-replies/overview) e [Anexos](https://developer.x.com/en/docs/x-api/v1/direct-messages/message-attachments/overview). O novo objeto também contém um objeto de usuário mais compacto. Seu aplicativo precisará ser atualizado para considerar essa nova estrutura de objeto ao fazer o parsing e, possivelmente, nos modelos de dados ou no armazenamento. Para descrições de cada propriedade, consulte a [documentação completa sobre o objeto Message Create](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/guides/message-create-object).

**Exemplo de objeto message\_create**

```json
{
      "type": "message_create",
      "id": "1234858592",
      "created_timestamp": "1392078023603",
      "initiated_via": {
        "tweet_id": "123456",
        "welcome_message_id": "456789"
      },
      "message_create": {
        "target": {
          "recipient_id": "1234858592"
        },
        "sender_id": "3805104374",
        "source_app_id": "268278",
        "message_data": {
          "text": "Blue Bird",
          "entities": {
            "hashtags": [],
            "symbols": [],
            "urls": [],
            "user_mentions": [],
          },
          "quick_reply_response": {
            "type": "options",
            "metadata": "external_id_2"
          },
          "attachment": {
            "type": "media",
            "media": {
             ...
            }
          }
        }
      }
```

<div id="new-direct-message-object">
  #### Resumo
</div>

- Nova estrutura do objeto de Mensagem Direta.
- Objeto de usuário simplificado.
- Novas informações disponíveis (respostas de respostas rápidas, anexos, etc.).

### Enviando Mensagens Diretas

[POST direct\_messages/events/new](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/new-event) é um substituto direto para o envio de Mensagens Diretas. A diferença mais significativa neste endpoint é que todas as informações agora são enviadas como JSON no corpo da requisição POST, em vez de parâmetros POST individuais.

**Exemplo de requisição com Twurl**

```bash
twurl -A 'Content-type: application/json' -X POST /1.1/direct\_messages/events/new.json -d '{"event": {"type": "message\_create", "message\_create": {"target": {"recipient\_id": "4534871"}, "message_data": {"text": "Hello World!"}}}}'
```

Observe, na requisição acima, que o content-type está definido como application/json, e não como application/x-www-form-urlencoded. Além disso, se você estiver construindo a assinatura OAuth 1.0a, note que o corpo JSON não é incluído na geração da assinatura. A maioria das bibliotecas OAuth já trata isso. Se você estiver usando o [twurl](https://github.com/twitter/twurl), certifique-se de estar usando pelo menos a versão 0.9.3.

<div id="new-direct-message-object">
  #### Resumo
</div>

- A mensagem é definida no corpo de uma requisição POST em JSON
- O cabeçalho Content-Type deve ser definido como application/json
- O corpo JSON não é incluído na geração da assinatura do OAuth.
   

### Recuperando Mensagens Diretas

A recuperação de Mensagens Diretas anteriores agora é feita por um único endpoint da API: [GET direct\_messages/events/list](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events). A principal diferença deste novo endpoint é que ele retorna tanto as mensagens enviadas quanto as recebidas em ordem cronológica inversa, o que pode facilitar a reconstrução de uma conversa. No entanto, se você estiver interessado apenas em mensagens enviadas ou recebidas, será necessário pós-processar a resposta consultando a propriedade sender\_id.

A paginação agora é baseada em um valor de cursor, e não no ID de uma Mensagem Direta. Uma propriedade cursor é retornada em cada resposta. O endpoint [GET direct\_messages/events/list](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events) retornará até 30 dias de mensagens anteriores, independentemente de quantas mensagens existam nesse período. Quando um cursor não é retornado, não há mais mensagens a serem retornadas. O método para acessar Mensagens Diretas individualmente com [GET direct\_messages/events/show](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/get-event) permanece o mesmo, embora o objeto de Mensagem Direta retornado tenha uma estrutura diferente, conforme descrito anteriormente.

Por fim, o acesso em tempo real às Mensagens Diretas agora é feito via webhook com a [Account Activity API](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity). Para obter orientação na migração a partir de User Streams ou Site Streams, consulte o guia de migração para a Account Activity API.

<div id="new-direct-message-object">
  #### Resumo
</div>

- Mensagens enviadas e recebidas agora são retornadas no mesmo endpoint.
- Retorno de mensagens dos últimos 30 dias.
- Paginação baseada em cursor.
- Acesso em tempo real a mensagens diretas via webhook.

### Excluindo Mensagens Diretas

Agora é possível excluir Mensagens Diretas com DELETE direct\_messages/events/destroy. A interface permanece praticamente a mesma, exigindo o ID da mensagem a ser excluída. A principal diferença é que o endpoint agora requer uma requisição DELETE em vez de uma requisição POST.

A forma como Mensagens Diretas excluídas aparecem nos clientes oficiais do X permanece a mesma. As Mensagens Diretas são removidas apenas da interface do usuário do contexto fornecido. Outros participantes da conversa ainda podem acessar a Mensagem Direta.

<div id="new-direct-message-object">
  #### Resumo
</div>

- Excluir uma mensagem direta requer o ID.
- O novo endpoint exige uma solicitação DELETE.
- A forma como mensagens diretas excluídas são exibidas nos clientes oficiais do X permanece inalterada.

\*\*Tem perguntas sobre a migração para os novos endpoints de mensagens diretas?
\*\*Publique sua pergunta no fórum da comunidade de desenvolvedores em [devcommunity.com](https://devcommunity.x.com/).

## Perguntas frequentes

### Geral

**Quais são as vantagens de usar a Account Activity API?**

A Account Activity API usa webhooks, o que significa que, ao contrário das APIs de streaming, não exigimos que você mantenha uma conexão aberta para enviarmos informações. Webhooks também são diferentes de APIs REST porque você não precisa nos consultar centenas de vezes a cada 15 minutos para obter os dados de que precisa. Isso aumenta a eficiência entre o usuário e seu app, pois entrega os dados no momento em que acontecem.

A Account Activity API oferece diversos benefícios:

1. **Velocidade**: entregamos dados na velocidade do X.
2. **Simplicidade**: entregamos todos os eventos de uma conta por meio de uma única conexão de webhook. As atividades entregues na API incluem posts, @menções, respostas, Retweets, Tweets com citação, Retweets de Tweets com citação, favoritos, Mensagens Diretas enviadas, Mensagens Diretas recebidas, follows, blocks e mutes. 
3. **Escala**: você recebe todas as atividades de uma conta que gerencia sem ser limitado por limites de taxa ou tetos de eventos.

A Account Activity API está disponível como sandbox premium, premium pago e oferta enterprise, para que você possa escalar conforme precisar de mais contas para recursos de auditoria ou funcionalidades adicionais.

Para começar, baixe trechos de código de exemplo no [GitHub](https://github.com/xdevplatform/account-activity-dashboard).
 

**Como identificar qual nível de produto é o melhor para mim?**

Leia nossa página [Visão geral da Account Activity API](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity) para saber mais sobre as diferenças entre as opções Premium e a opção Enterprise. 
 

**Qual é a diferença entre um ambiente Premium e um webhook Enterprise?**

Não há diferença. Cada ambiente Premium terá seu próprio webhook\_id.
 

**Eu preciso de ambientes de desenvolvimento, homologação e produção para a Account Activity API, isso é possível?**

Sim! Nos níveis pagos da Account Activity API (Premium Pago e Enterprise), é possível registrar várias URLs de webhook e gerenciar assinaturas separadamente para cada uma por meio dos métodos da API. Além disso, vários apps clientes podem ser adicionados a uma allowlist para manter a autorização dos usuários que já estão autorizados.
 

**Vocês têm algum guia passo a passo sobre como configurar a Account Activity API?**

Na verdade, temos!

- Se você está começando agora, recomendamos visitar nosso guia [Introdução a webhooks](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#getting-started-with-webhooks)

- Acompanhe com nossos scripts com suporte do X Dev: 
  - [Account Activity API dashboard](https://github.com/xdevplatform/account-activity-dashboard), um app web em Node que exibe eventos de webhook.
  - O [chatbot SnowBot](https://github.com/xdevplatform/SnowBotDev), um app web em Ruby desenvolvido com as APIs de Account Activity e de Mensagem Direta. Este código-fonte inclui um [script](https://github.com/xdevplatform/SnowBotDev/wiki/Account-Activity-API-setup-script) para ajudar a configurar os webhooks da Account Activity API.
     

**Existe alguma forma de recuperar dados se nosso sistema ficar fora do ar por um período de tempo?**

Nos níveis pagos da Account Activity API (Premium Pago e Enterprise), nosso sistema [tentará novamente](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#retries) enviar as atividades várias vezes durante um período de quatro horas. Se o seu sistema não responder dentro desse período, a atividade será perdida e você terá que usar outros endpoints REST para recuperar dados em até 7 dias.

Sugerimos usar seus diferentes webhooks, ou ambientes, como ferramenta de redundância, como a [Account Activity Replay API](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-replay-api), para garantir que você não perca nenhuma atividade se um dos seus sistemas ficar fora do ar.
 

**Qual autenticação devo usar com a Account Activity API?**

Os métodos de autorização exigidos para a Account Activity API são descritos por método nas [páginas de referência da API](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-api-reference-index). Se você está começando com a autenticação do X, recomendamos que leia [esta seção](/pt-BR/resources/fundamentals/authentication).

**O que é um challenge-response check (CRC)?**

A verificação de resposta ao desafio da Account Activity API é um recurso de segurança implementado para garantir que as atividades da Account Activity API estejam sendo enviadas ao desenvolvedor correto. Ela também pode ser usada por desenvolvedores para assegurar que os dados recebidos estão vindo do X. O X enviará automaticamente um CRC para a sua URL de webhook uma vez a cada 24 horas, a partir da última vez em que a URL do webhook foi validada. Seu sistema deve responder com uma resposta válida em até 3 segundos para permanecer validado. 

Visite nossa página [Protegendo webhooks](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#securing-webhooks) para mais detalhes.
 

**Existe algo que invalidaria imediatamente minha URL de webhook?**

Se ocorrer um dos seguintes casos, marcaremos imediatamente seu webhook como inválido:

- O servidor responde a um CRC com um token incorreto. Nesse caso, nosso sistema não [tentará novamente](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#retries) enviar a atividade.
- A URL do webhook tem um certificado configurado incorretamente. Nesse caso, nosso sistema não [tentará novamente](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#retries) enviar a atividade.
- Seu servidor retorna um código de resposta que não seja 2XX, 4XX ou 5XX.
- Você especifica o uso de gzip sem de fato enviá-lo.
- Você não especifica o uso de gzip, mas o envia na resposta.
   

**Receberei atividades duplicadas se estiver inscrito em usuários que interagem entre si?**

Sim. Se seu aplicativo web tiver assinaturas ativas para o Usuário A e o Usuário B, e o Usuário A mencionar o Usuário B em um Post, haverá duas atividades POST enviadas para o webhook registrado. Cada atividade terá um indicador "for\_user\_id" para mostrar a qual assinatura a atividade pertence.
 

**Quando faço uma assinatura para meu webhook, posso substituir a parte `/all/` do endpoint a seguir por outros objetos de dados de atividade da conta para limitar as atividades que a API entrega?** `POST https://api.x.com/1.1/account_activity/all/:env_name/subscriptions.json`

Não, isso não é possível. No momento, temos disponível apenas o produto `/all/`.
 

**Existe alguma forma de usar a Account Activity API sem solicitar permissões de Mensagens Diretas dos usuários?**

Neste momento, as permissões de Mensagens Diretas são necessárias porque não há como “filtrar” as atividades de Mensagens Diretas para esta API. 
 

**Existe uma versão gratuita da Account Activity API?**

Sim, oferecemos a versão sandbox como uma camada gratuita. Nossa opção de sandbox é limitada a um único webhook com um máximo de 15 assinaturas. Você pode ler mais sobre a opção de sandbox em [nossa documentação](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity). 

**É possível usar a Account Activity API para obter Retweets de Posts que mencionam usuários assinados?**

Infelizmente, isso não faz parte das atividades entregues com esta API. Para isso, sugerimos usar a Streaming API. 
 

**Quais são os possíveis tipos de atividade representados por um tweet\_create\_event?**

Um payload de tweet\_create\_event será enviado:

Se o usuário da assinatura fizer qualquer uma das seguintes ações:

- Cria um Post
- Dá Retweet
- Responde a um Post

Se outro usuário:

- @menciona\* o usuário da assinatura
- Cita um Tweet criado pelo usuário da assinatura 

\*Observação: A Account Activity API apenas entrega eventos quando o usuário da assinatura receberia uma notificação do X e poderia ver o evento publicamente. Isso significa que, se a conta mencionada (@userA) segue a conta protegida (@userB), então o UsuárioA receberá uma notificação de que o UsuárioB o mencionou. Se o UsuárioA não estiver seguindo o UsuárioB (e aprovado pelo UsuárioB), o UsuárioA não receberá uma notificação e, portanto, um tweet\_create\_event não seria enviado via AAA se @userA tivesse uma assinatura.

**Se um usuário bloqueado mencionar meu usuário assinado, como posso identificar isso?**

Você verá um campo booleano `user_has_blocked` no nível superior da resposta JSON, definido como “true” ou “false”. Esse campo só será exposto em menções a Posts. 

Enterprise

**Como posso adicionar meu app a uma allowlist ou verificar se meu app já está na allowlist?**

Para gerenciar os [apps do X](/pt-BR/resources/fundamentals/developer-apps) que você adicionou a uma allowlist para acesso via as APIs Enterprise, entre em contato com seu gerente de conta informando o ID do seu app. Você pode encontrar o ID do seu app acessando a página ["Apps"](/pt-BR/resources/fundamentals/developer-apps) no [portal do desenvolvedor](/pt-BR/resources/fundamentals/developer-portal).
 

**Se eu tiver acesso a três webhooks, posso usar três webhooks para cada um dos apps que registrei para uso empresarial?**

O limite de webhooks é definido no nível da conta, não no nível do app. Se você tiver acesso a três webhooks e dois apps registrados para uso empresarial, poderá usar dois webhooks em um app e o terceiro no outro, mas não três em cada app. 

**Posso especificar quais tipos de eventos serão reenviados usando a Account Activity Replay API?**

Os tipos de eventos a serem reproduzidos não podem ser especificados. Todos os eventos entregues durante a janela de data e hora especificada serão reproduzidos. 

**Haverá novas tentativas se meu aplicativo falhar ao ingerir um evento da Account Activity Replay API?**

Não, não haverá novas tentativas. Se um aplicativo falhar ao ingerir um evento enviado pela Account Activity Replay API, outra tarefa de Replay pode ser enviada para o mesmo período para tentar a reentrega de quaisquer eventos de Replay perdidos. 

**O que devo fazer quando receber um evento de conclusão com sucesso parcial?**

Sugerimos anotar os carimbos de data e hora dos eventos recebidos e solicitar outra tarefa de Replay para os eventos que foram perdidos. 

**Quantas tarefas da Account Activity Replay API posso ter em execução ao mesmo tempo?**

Apenas uma tarefa da Account Activity Replay API por webhook pode estar em execução por vez. 

**Como posso diferenciar eventos da Account Activity Replay API de eventos de produção em tempo real à medida que são entregues ao meu webhook?**

Como a Account Activity Replay API sempre entrega eventos do passado, eles podem ser diferenciados dos eventos de produção em tempo real com base no carimbo de data e hora do evento. 

**Com que rapidez posso começar a usar a Account Activity Replay API para reenviar uma atividade que meu aplicativo descartou ou perdeu?**

Uma atividade fica disponível para reentrega cerca de 10 minutos após sua criação. 

<div id="general">
  ### Guia de solução de erros
</div>

#### Código 32

Esse erro geralmente significa que algo está incorreto na solicitação, nos cabeçalhos, na autorização ou na URL que você está especificando. Isso não é um erro da Account Activity API; é um erro de autorização, e o X não está recebendo a configuração correta de OAuth ou a URL.

- **Enterprise** - Certifique-se de que as consumer keys e os access tokens que você está usando pertencem a um [app do X](/pt-BR/resources/fundamentals/developer-apps) registrado para uso de produtos Enterprise. Se você não tiver suas consumer keys e access tokens, ou precisar adicionar seu app do X à allowlist, entre em contato com seu gerente de conta. 

- Se estiver autenticando com contexto de usuário, certifique-se de ter [autorizado sua solicitação](/pt-BR/resources/fundamentals/authentication#authorizing-a-request) corretamente com `oauth_nonce`, `oauth_signature` e `oauth_timestamp`.

- Certifique-se de que seus access tokens tenham o nível de permissão adequado.
  - Na guia “Keys and tokens” no [painel do app](/pt-BR/resources/fundamentals/developer-apps), verifique se seus access tokens têm o nível de permissão “Read, write, and direct messages” [permission level](/pt-BR/resources/fundamentals/developer-apps#app-permissions). 
  - Se o nível de permissão dos tokens estiver definido para algo inferior a isso, acesse a guia “Permissions”, ajuste a permissão de acesso para “Read, write, and direct messages” e, em seguida, regenere seus access tokens e secret na guia “Keys and tokens”.

- Certifique-se de que sua URL esteja corretamente formada.
  - Lembre-se de que `:env_name` diferencia maiúsculas de minúsculas.
     

<div id="code-32">
  #### Código 200 - Proibido
</div>

- **Premium** - Verifique se você tem uma [conta de desenvolvedor](/pt-BR/resources/fundamentals/developer-portal) aprovada antes de tentar fazer uma solicitação à API. Você também deve usar o :env\_name correto na solicitação, que pode ser configurado na página de [ambientes de desenvolvimento](/pt-BR/resources/fundamentals/developer-portal).

- **Enterprise** - Certifique-se de que seu gerente de conta tenha concedido acesso à Account Activity API.

- Verifique se você configurou seu URI corretamente. Esse erro pode ocorrer se você tiver inserido um URI incorreto na solicitação.
   

<div id="code-200-forbidden">
  #### Código 214 - A URL do webhook não atende aos requisitos.
</div>

- Certifique-se de que está usando HTTPS.
- Sua URL de webhook pode estar malformada.
- Saiba mais sobre como configurar sua URL de webhook na seção [Develop webhook consumer app](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#3-develop-webhook-consumer-app) na página [Getting started with webhooks](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#getting-started-with-webhooks).
   

<div id="code-214-webhook-url-does-not-meet-the-requirements">
  #### Código 214 - Alta latência na solicitação CRC via GET. Seu webhook deve responder em menos de 3 segundos.
</div>

- Isso indica que seu servidor está lento. Garanta que o CRC seja respondido em até 3 segundos.
   

<div id="code-214-high-latency-on-crc-get-request-your-webhook-should-respond-in-less-than-3-seconds">
  #### Código 214 - Resposta diferente de 200 durante a requisição CRC GET (por exemplo, 404, 500 etc.).
</div>

- Seu servidor está fora do ar. Verifique se ele está em execução corretamente.
   

<div id="code-214-non-200-response-code-during-crc-get-request-ie-404-500-etc">
  #### Código 214 - Recursos demais já criados.
</div>

- **Enterprise** - Você já utilizou todos os seus webhooks. Use o endpoint [GET webhooks](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks) com cada um dos seus apps registrados para identificar onde seus webhooks estão em uso. 

<div id="code-214-too-many-resources-already-created">
  #### Código 261 - O aplicativo não pode executar ações de gravação.
</div>

- O app que você está usando com a API não tem o [nível de permissão](/pt-BR/resources/fundamentals/developer-apps#app-permissions) adequado definido para seu access token e access token secret. Acesse a guia "Keys and tokens" no painel de [X apps](/pt-BR/resources/fundamentals/developer-apps) e verifique os níveis de permissão atribuídos ao seu access token e access token secret. Se estiver definido como algo diferente de "Read, write and Direct Messages", será necessário ajustar as configurações na guia "Permission" e regenerar seu access token e access token secret para aplicar as novas configurações.
- Como alternativa, você pode estar tentando registrar um webhook usando autenticação apenas do app, o que não é compatível. Autentique-se com contexto de usuário, conforme indicado nas seções de referência da API para registrar um webhook na [Enterprise Account Activity API](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks).

## Índice de referência da API de Atividade de Conta

|     |     |
| :--- | :--- |
| **Finalidade** | Enterprise |
| Registra uma URL de webhook / Gera um webhook\_id | [POST  <br />webhooks](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api) |
| Retorna todas as URLs de webhook e seus status | [GET  <br />webhooks](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks) |
| Aciona manualmente uma verificação de resposta ao desafio | [PUT  <br />webhooks/:webhook\_id](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id) |
| Inscreve um aplicativo nos eventos de uma conta | [POST  <br />webhooks/:webhook\_id/subscriptions/all](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all) |
| Retorna a contagem de assinaturas ativas no momento | [GET  <br />subscriptions/count](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-subscriptions-count) |
| Verifica se um webhook está inscrito em uma conta | [GET  <br />webhooks/:webhook\_id/subscriptions/all](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all) |
| Retorna uma lista das assinaturas ativas no momento | [GET  <br />webhooks/:webhook\_id/subscriptions/all/list](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-subscriptions-count) |
| Exclui o webhook | [DELETE  <br />webhooks/:webhook\_id](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id) |
| Desativa uma assinatura usando OAuth com 3 etapas (DESCONTINUADO) | [DELETE  <br />webhooks/:webhook\_id/subscriptions/all](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated) |
| Desativa uma assinatura usando OAuth somente do aplicativo | [DELETE  <br />webhooks/:webhook\_id/subscriptions/:user\_id/all.json](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-user-id-all-json) |
| Reentrega atividades para um webhook | [POST  <br />replay/webhooks/:webhook\_id/subscriptions/all](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated) |

### API de Atividade de Conta Empresarial

#### POST account\_activity/webhooks[](#post-account-activity-webhooks "Link permanente para este título")

Registra uma nova URL de webhook para o contexto do aplicativo especificado. A URL será validada por meio de uma solicitação CRC antes de ser salva. Se a validação falhar, será retornada ao solicitante uma mensagem de erro detalhada.

A quantidade de webhooks permitidos é determinada pelo pacote de cobrança.

### URL do recurso[](#resource-url "Permalink to this headline")

`https://api.x.com/1.1/account_activity/webhooks.json`

<div id="resource-url">
  ### Informações do recurso[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Formato da resposta | JSON |
| Requer autenticação | Sim (contexto do usuário — todos os tokens de consumidor e de acesso) |
| Sujeito a limitação de taxa | Sim |
| Solicitações por janela de 15 min (autenticação do usuário) | 15 |
| Suporte a edições de Tweet | Todos os objetos de Tweet incluirão metadados de edição que descrevem o histórico de edições do Tweet. Consulte a página de fundamentos ["Edições de Tweet"](/pt-BR/x-api/enterprise-gnip-2.0/fundamentals/edit-tweets) para mais detalhes. |

<div id="resource-information">
  ### Parâmetros[](#parameters "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| url (obrigatório) | URL codificada do endpoint de callback. |

<div id="parameters">
  ### Exemplo de requisição[](#example-request "Permalink to this headline")
</div>

$ curl --request POST
\--url 'https://api.x.com/1.1/account\_activity/webhooks.json?url=https%3A%2F%2Fyour\_domain.com%2Fwebhooks%2Ftwitter%2F0'
\--header 'authorization: OAuth oauth\_consumer\_key="CONSUMER\_KEY", oauth\_nonce="GENERATED", oauth\_signature="GENERATED", oauth\_signature\_method="HMAC-SHA1", oauth\_timestamp="GENERATED", oauth\_token="ACCESS\_TOKEN", oauth\_version="1.0"'

<div id="example-request">
  ### Respostas HTTP[](#http-responses "Permalink to this headline")
</div>

| Código HTTP | Mensagem |
| :--- | :--- |
| 200 | A URL do webhook está registrada para o aplicativo fornecido |
| 403 | Há um erro na sua solicitação. Consulte a seção de mensagens de erro abaixo. |

<div id="http-responses">
  ### Exemplo de resposta — sucesso[](#example-response-success "Permalink to this headline")
</div>

```json
_HTTP 200_

    {
      "id": "1234567890",
      "url": "https://your_domain.com/webhook/twitter/0",
      "valid": true,
      "created_at": "2016-06-02T23:54:02Z"
    }
```

<div id="example-response-success">
  ### Mensagens de erro[](#error-messages "Permalink to this headline")
</div>

| Código | Mensagem |
| :--- | :--- |
| 214 | A URL do webhook não atende aos requisitos. |
| 214 | Muitos recursos já foram criados. |
| 214 | A URL do webhook não atende aos requisitos. Token CRC inválido ou formato de resposta JSON inválido. |
| 214 | Alta latência na solicitação GET do CRC. Seu webhook deve responder em menos de 3 segundos. |
| 214 | Código de resposta diferente de 200 durante a solicitação GET do CRC (por exemplo, 404, 500, etc.). |

_HTTP 403_

```json
    {
      "errors": [
        {
          "code": 214,
          "message": "Too many resources already created."
        }
      ]
    }
```

#### GET account\_activity/webhooks[](#get-account-activity-webhooks "Link permanente para este título")

Retorna todas as URLs e seus respectivos status do aplicativo especificado.

Marcamos uma URL como inválida se ela falhar na verificação diária. Para reativar a URL, chame o endpoint de atualização.

### URL do recurso[](#resource-url "Permalink to this headline")

`https://api.x.com/1.1/account_activity/webhooks.json`

<div id="resource-url">
  ### Informações do recurso[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Formato da resposta | JSON |
| Requer autenticação | Sim (apenas aplicativo — token de portador) |
| Sujeito a limite de taxa | Sim |
| Solicitações por janela de 15 min (autenticação de aplicativo) | 15  |

<div id="parameters">
  ### Exemplo de requisição[](#example-request "Permalink to this headline")
</div>

```bash
    $ curl --request GET
     --url https://api.x.com/1.1/account_activity/webhooks.json
     --header 'authorization: Bearer TOKEN'
```

<div id="example-request">
  ### Exemplo de resposta[](#example-response "Permalink to this headline")
</div>

_HTTP 200 OK_

```json
    [
      {
        "id": "1234567890",
        "url": "https://your_domain.com/webhook/twitter/0",
        "valid": true,
        "created_at": "2016-06-02T23:54:02Z"
      }
      {
        "id": "2468013579",
        "url": "https://your_domain2.com/webhook/twitter/0",
        "valid": true,
        "created_at": "2016-06-04T22:31:29Z"
      }
    ]
```

<div id="example-response-success">
  ### Mensagens de erro[](#error-messages "Permalink to this headline")
</div>

| Código | Mensagem |
| :--- | :--- |
| 99  | Você não tem acesso a este recurso. |

#### PUT account\_activity/webhooks/:webhook\_id[](#put-account-activity-webhooks-webhook-id "Permalink to this headline")

Aciona a verificação de resposta ao desafio (CRC) para a URL do webhook especificado. Se a verificação for bem-sucedida, retorna 204 e reativa o webhook definindo seu status como `valid`.

### URL do recurso[](#resource-url "Link permanente para este título")

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id.json`

<div id="resource-url">
  ### Informações do recurso[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Formato da resposta | JSON |
| Exige autenticação | Sim (contexto do usuário — todos os tokens de consumidor e de acesso) |
| Sujeito a limite de taxa | Sim |
| Solicitações por janela de 15 min (autenticação do usuário) | 15  |

### Parâmetros[](#parameters "Link permanente para este título")

|     |     |
| :--- | :--- |
| webhook\_id (obrigatório) | ID do webhook. Definido no caminho do recurso. |

<div id="parameters">
  ### Exemplo de requisição[](#example-request "Permalink to this headline")
</div>

```json
    $ curl --request PUT
     --url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID.json
     --header 'authorization: OAuth oauth_consumer_key="CONSUMER_KEY", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="ACCESS_TOKEN", oauth_version="1.0"'
```

<div id="example-request">
  ### Resposta[](#response "Permalink to this headline")
</div>

_HTTP 204 OK_

```
    { }
```

### Mensagens de erro[](#error-messages "Link permanente para este título")

| Código | Mensagem |
| :--- | :--- |
| 34  | O webhook não existe ou está associado a um aplicativo do X diferente. |
| 214 | A URL do webhook não atende aos requisitos. |
| 214 | A URL do webhook não atende aos requisitos. Token CRC inválido ou formato de resposta JSON inválido. |
| 214 | Alta latência na solicitação GET de CRC. Seu webhook deve responder em menos de 3 segundos. |
| 214 | Código de resposta diferente de 200 durante a solicitação GET de CRC (por exemplo, 404, 500, etc.). |

#### POST account\_activity/webhooks/:webhook\_id/subscriptions/all[](#post-account-activity-webhooks-webhook-id-subscriptions-all "Permalink to this headline")

Inscreve o aplicativo informado em todos os eventos, no contexto do usuário especificado, para todos os tipos de mensagem. Após a ativação, todos os eventos do usuário solicitante serão enviados ao webhook do aplicativo por meio de uma solicitação POST.

As assinaturas estão atualmente limitadas com base na configuração da sua conta. Se precisar adicionar mais assinaturas, entre em contato com o seu gerente de contas.

### URL do recurso[](#resource-url "Permalink to this headline")

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/all.json`

<div id="resource-url">
  ### Informações do recurso[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Formato da resposta | JSON |
| Requer autenticação | Sim (OAuth de 3 etapas — consumer key na lista de permissões e token de acesso do usuário assinante) |
| Sujeito a limite de taxa | Sim |
| Solicitações por janela de 15 min (autenticação do usuário) | 500 |

### Parâmetros[](#parameters "Link permanente para este título")

|     |     |
| :--- | :--- |
| webhook\_id (obrigatório) | ID do webhook. Definido no caminho do recurso. |

<div id="parameters">
  ### Exemplo de requisição[](#example-request "Permalink to this headline")
</div>

```bash
    $ curl --request POST
     --url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID/subscriptions/all.json
     --header 'authorization: OAuth oauth_consumer_key="WHITELISTED_CONSUMER_KEY", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="SUBSCRIBING_USER'S_ACCESS_TOKEN", oauth_version="1.0"'
```

<div id="example-request">
  ### Exemplo de resposta – sucesso[](#example-response-success "Link permanente para este título")
</div>

_HTTP 204 NO CONTENT_

```
    {}
```

<div id="example-response-success">
  ### Mensagens de erro[](#error-messages "Permalink to this headline")
</div>

| Código | Mensagem |
| :--- | :--- |
| 34  | O webhook não existe ou está associado a um app do X diferente. |
| 348 | O app cliente não tem permissão para acessar as assinaturas de webhook deste usuário. |

#### GET account\_activity/subscriptions/count[](#get-account-activity-subscriptions-count "Link permanente para este título")

Retorna o número de assinaturas atualmente ativas na sua conta. Observe que o endpoint /count requer OAuth somente de aplicativo; portanto, você deve fazer solicitações usando um token bearer em vez de contexto de usuário.

### URL do recurso[](#resource-url "Permalink to this headline")

`https://api.x.com/1.1/account_activity/subscriptions/count.json`

<div id="resource-url">
  ### Informações do recurso[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Formato da resposta | Código de resposta HTTP |
| Requer autenticação | Sim (somente aplicativo — token bearer) |
| Sujeito a limite de taxa | Sim |
| Requisições / janela de 15 min (autenticação de aplicativo) | 15  |

<div id="resource-information">
  ### Códigos de resposta HTTP[](#http-response-codes "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Código | Mensagem |
| 200 | Sucesso. Será retornada a contagem de assinaturas do webhook solicitado. |
| 401 | Seu aplicativo não tem permissão para visualizar as assinaturas do webhook especificado. |

### Exemplo de requisição[](#example-request "Link permanente para este título")

```bash
    $ curl --request GET
     --url https://api.x.com/1.1/account_activity/subscriptions/count.json
     --header 'authorization: Bearer TOKEN'
```

<div id="http-responses">
  ### Exemplo de resposta — sucesso[](#example-response-success "Permalink to this headline")
</div>

_HTTP 200_

```bash
    {
      "account_name":"my-account",
      "subscriptions_count_all":"1",
      "subscriptions_count_direct_messages":"0",
      "provisioned_count":"50"
    }
```

### Mensagens de erro[](#error-messages "Link permanente para este cabeçalho")

| Código | Mensagem |
| :--- | :--- |
| 32  | Não foi possível autenticar você. |

_HTTP 401_

```abash
    {
      "errors": [
        {
           "code": 32,
          "message": "Could not authenticate you."
        }
      ]
    }
```

#### GET account\_activity/webhooks/:webhook\_id/subscriptions/all[](#get-account-activity-webhooks-webhook-id-subscriptions-all "Permalink to this headline")

Fornece uma forma de verificar se uma configuração de webhook está inscrita nos eventos do usuário especificado. Se o contexto do usuário informado tiver uma assinatura ativa com o aplicativo fornecido, retorna 204 OK. Se o código de resposta não for 204, o usuário não tem uma assinatura ativa. Consulte o código de resposta HTTP e as mensagens de erro abaixo para mais detalhes.

### URL do recurso[](#resource-url "Permalink to this headline")

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/all.json`

<div id="resource-url">
  ### Informações do recurso[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Formato da resposta | JSON |
| Requer autenticação | Sim (OAuth de 3 etapas — consumer key na lista de permissões e token de acesso do usuário assinante) |
| Sujeito a limite de taxa | Sim |
| Solicitações por janela de 15 min (autenticação do usuário) | 500 |

### Parâmetros[](#parameters "Link permanente para este título")

|     |     |
| :--- | :--- |
| webhook\_id (obrigatório) | ID do webhook. Definido no caminho do recurso. |

<div id="parameters">
  ### Exemplo de solicitação[](#example-request "Permalink para este título")
</div>

$ curl --request GET
\--url https://api.x.com/1.1/account\_activity/webhooks/:WEBHOOK\_ID/subscriptions/all.json
\--header 'authorization: OAuth oauth\_consumer\_key="WHITELISTED\_CONSUMER\_KEY", oauth\_nonce="GENERATED", oauth\_signature="GENERATED", oauth\_signature\_method="HMAC-SHA1", oauth\_timestamp="GENERATED", oauth\_token="SUBSCRIBING\_USER'''S\_ACCESS\_TOKEN", oauth\_version="1.0"'

<div id="example-request">
  ### Exemplo de resposta – Sucesso[](#example-response-success "Permalink to this headline")
</div>

_HTTP 204 SEM CONTEÚDO_

```
    { }
```

#### GET account\_activity/webhooks/:webhook\_id/subscriptions/all/list[](#get-account-activity-webhooks-webhook-id-subscriptions-all-list "Link permanente para este título")

Retorna a lista das assinaturas do tipo All Activity atualmente ativas para o webhook especificado. Observe que o endpoint /list requer OAuth somente de aplicativo; portanto, as solicitações devem ser feitas usando um token bearer em vez de contexto de usuário.

### URL do recurso[](#resource-url "Link permanente para este título")

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/all/list.json`

<div id="resource-url">
  ### Informações do recurso[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Formato da resposta | Código de resposta HTTP |
| Requer autenticação | Sim (somente aplicativo — token bearer) |
| Sujeito a limite de taxa | Sim |
| Solicitações/Janela de 15 min (autenticação do aplicativo) | 50  |

### Parâmetros[](#parameters "Link permanente para este título")

|     |     |
| :--- | :--- |
| webhook\_id (obrigatório) | ID do webhook. Definido no caminho do recurso. |

<div id="resource-information">
  ### Códigos de resposta HTTP[](#http-response-codes "Permalink to this headline")
</div>

| Código | Mensagem |
| :--- | :--- |
| 200 | Sucesso. Uma lista de inscrições para o webhook solicitado será retornada. |
| 401 | Seu aplicativo não tem permissão para visualizar inscrições do webhook especificado. |

<div id="parameters">
  ### Exemplo de requisição[](#example-request "Permalink to this headline")
</div>

$ curl --request GET
\--url https://api.x.com/1.1/account\_activity/webhooks/:WEBHOOK\_ID/subscriptions/all/list.json
\--header 'authorization: Bearer TOKEN'

<div id="http-responses">
  ### Exemplo de resposta — sucesso[](#example-response-success "Permalink to this headline")
</div>

_HTTP 200_

```bash
    {
      "webhook_id": "1234567890",
      "webhook_url": "https://your_domain.com/webhook/twitter/0",
      "application_id": "11231812",
      "subscriptions": [{
        "user_id": "20212306"
      }]
    }
```

<div id="example-response-success">
  ### Mensagens de erro[](#error-messages "Permalink to this headline")
</div>

| Código | Mensagem |
| :--- | :--- |
| 32  | Não foi possível autenticar você. |

_HTTP 401_

```bash
    {
      "errors": [
        {
           "code": 32,
          "message": "Could not authenticate you."
        }
      ]
    }
```

#### DELETE account\_activity/webhooks/:webhook\_id[](#delete-account-activity-webhooks-webhook-id "Link permanente para este título")

Remove o webhook da configuração do aplicativo especificado. O ID do webhook pode ser obtido fazendo uma chamada a GET /1.1/account\_activity/webhooks.

### URL do recurso[](#resource-url "Link permanente para este título")

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id.json`

<div id="resource-url">
  ### Informações do recurso[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Formato da resposta | JSON |
| Exige autenticação | Sim (contexto do usuário — todos os tokens de consumidor e de acesso) |
| Sujeito a limite de taxa | Sim |
| Solicitações por janela de 15 min (autenticação do usuário) | 15  |

### Parâmetros[](#parameters "Link permanente para este título")

|     |     |
| :--- | :--- |
| webhook\_id (obrigatório) | ID do webhook. Definido no caminho do recurso. |

### Exemplo de solicitação[](#example-request "Link permanente para este título")

```bash
    $ curl --request DELETE
     --url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID.json
     --header 'authorization: OAuth oauth_consumer_key="CONSUMER_KEY", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="ACCESS_TOKEN", oauth_version="1.0"'
```

<div id="example-request">
  ### Resposta[](#response "Permalink to this headline")
</div>

_HTTP 204 OK_

```
    { }
```

#### DELETE account\_activity/webhooks/:webhook\_id/subscriptions/all (DESCONTINUADO)[](#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated- "Permalink to this headline")

Desativa as assinaturas para o contexto de usuário e o aplicativo fornecidos. Após a desativação, nenhum evento do usuário solicitante continuará a ser enviado para a URL do webhook.

### URL do recurso[](#resource-url "Permalink to this headline")

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/all.json`

<div id="resource-url">
  ### Informações do recurso[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Formato da resposta | JSON |
| Requer autenticação | Sim (OAuth de 3 etapas — chave de consumidor autorizada e token de acesso do usuário inscrito) |
| Sujeito a limite de taxa | Sim |
| Solicitações por janela de 15 min (autenticação do usuário) | 500 |

### Parâmetros[](#parameters "Link permanente para este título")

|     |     |
| :--- | :--- |
| webhook\_id (obrigatório) | ID do webhook. Definido no caminho do recurso. |

### Exemplo de solicitação[](#example-request "Permalink to this headline")

```bash
    $ curl --request DELETE
     --url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID/subscriptions/all.json
     --header 'authorization: OAuth oauth_consumer_key="WHITELISTED_CONSUMER_KEY", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="SUBSCRIBED_USER'S_ACCESS_TOKEN", oauth_version="1.0"'
```

Exemplo de solicitação

```
    { }
```

#### DELETE /account\_activity/webhooks/:webhook\_id/subscriptions/:user\_id/all.json[](#delete-account-activity-webhooks-webhook-id-subscriptions-user-id-all-json "Link permanente para este título")

Desativa a assinatura para o webhook e o ID de usuário especificados. Após a desativação, nenhum evento do usuário solicitante será mais enviado para a URL do webhook. Observe que este endpoint requer OAuth somente de aplicativo; portanto, as solicitações devem ser feitas usando um token bearer em vez do contexto de usuário.

### URL do recurso[](#resource-url "Link permanente para este título")

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/:user_id/all.json`

<div id="resource-url">
  ### Informações do recurso[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Formato da resposta | JSON |
| Requer autenticação | Sim (somente aplicativo — token bearer) |
| Sujeito a limite de taxa | Sim |
| Requisições / janela de 15 min | 500 |

<div id="parameters">
  ### Exemplo de requisição[](#example-request "Permalink to this headline")
</div>

```bash
    $ curl --request DELETE
     --url https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/:user_id/all.json
     --header 'authorization: Bearer TOKEN'
```

### Resposta[](#response "Link permanente para este título")

_HTTP 204 SEM CONTEÚDO_

<div id="example-response-success">
  ### Mensagens de erro[](#error-messages "Permalink to this headline")
</div>

| Código | Mensagem |
| :--- | :--- |
| 404 | Desculpe, esta página não existe. - Isso geralmente ocorre quando o ID de usuário especificado não está de fato inscrito. |

<div id="error-messages">
  ### API de Reprodução
</div>

**POST /1.1/account\_activity/replay/webhooks/:webhook\_id/subscriptions/all.json [¶](#post-1-1-account-activity-replay-webhooks-webhook-id-subscriptions-all-json- "Link permanente para este título")**

Envia uma solicitação para recuperar atividades de até os últimos cinco dias de todas as assinaturas presentes durante as janelas de data e hora especificadas na solicitação. Se o seu webhook tiver assinaturas de usuário ativas, você também receberá esses eventos em paralelo. Observação: realizamos um CRC antes de entregar eventos de reprodução.

|     |     |
| :--- | :--- |
| **Método da solicitação** | HTTP POST |
| **URL** | /1.1/account\_activity/replay/webhooks/:webhook\_id/subscriptions/all.json?from\_date=yyyymmddhhmm\&to\_date=yyyymmddhhmm |
| **Formato da resposta** | JSON |
| **Requer autenticação** | Sim (somente aplicativo — token bearer) |
| **Limite de taxa** | 5 solicitações a cada 15 minutos. Atualmente não há máximo para o número de tarefas de reprodução que podem ser solicitadas. |
| **from\_date** | O carimbo de data/hora UTC mais antigo (inicial) a partir do qual os eventos serão fornecidos; deve estar no formato 'yyyymmddhhmm'. O carimbo de data/hora tem granularidade de minuto e é inclusivo (ou seja, 12:00 inclui o minuto 00). Os horários válidos devem estar dentro dos últimos 5 dias, em UTC, e não mais recentes do que 31 minutos antes do momento atual. Recomenda-se que from\_date e to\_date estejam dentro de ~2 horas. |
| **to\_date** | O carimbo de data/hora UTC mais recente (final) até o qual os eventos serão fornecidos; deve estar no formato 'yyyymmddhhmm'. O carimbo de data/hora tem granularidade de minuto e é exclusivo (ou seja, 12:30 não inclui o 30º minuto da hora). Os horários válidos devem estar dentro dos últimos 5 dias, em UTC, e não mais recentes do que 10 minutos antes do momento atual. |

#### Respostas

As seguintes respostas podem ser retornadas pela API. A maioria dos códigos de erro é retornada com uma string que inclui detalhes adicionais no corpo. Para respostas diferentes de 200, você deve corrigir o erro e tentar novamente.

| Status | Texto | Código de erro | Descrição | Mensagem |
| :--- | :--- | :--- | :--- | :--- |
| 202 | Accepted | N/A | A solicitação foi bem-sucedida e as atividades serão enviadas. | N/A |
| 400 | Bad Request | 214 | O webhook foi marcado como inválido. | O webhook está marcado como inválido e requer uma verificação CRC. |
| 400 | Bad Request | 357 | Parâmetro de consulta ausente. | : queryParam é obrigatório. |
| 400 | Bad Request | 358 | Rota ou parâmetro de consulta malformado. | Não foi possível analisar o parâmetro. |
| 400 | Bad Request | 360 | O parâmetro de rota é negativo. | webhook\_id: \[] não é maior ou igual a 0. |
| 400 | Bad Request | 368 | from\_date ou to\_date não está no passado. | : \[\<field\_value>] não está no passado. |
| 400 | Bad Request | 356 | from\_date deve ser anterior a to\_date. | from\_date deve ser anterior a to\_date. |
| 400 | Bad Request | 356 | from\_date deve estar dentro dos últimos 5 dias. | from\_date deve estar dentro dos últimos 5 dias. |
| 401 | Unauthorized | 32  | A autenticação HTTP falhou devido à autenticação em 3 etapas fornecida. | Método de autenticação inválido. Use a autenticação somente para aplicativo. |
| 401 | Unauthorized | 61  | O cliente não tem permissão para solicitar este método. | O cliente não tem permissão para solicitar este método. |
| 403 | Forbidden | 200 | O cliente não possui uma conta enterprise com Replay ativado. | É necessária uma conta enterprise da Account Activity API com Replay. Confirme se você tem uma conta enterprise e se o Replay está ativado. |
| 404 | Not Found | 34  | webhook\_id inexistente; incompatibilidade entre webhook\_id e application\_id. | O webhook não existe ou está associado a um aplicativo do X diferente. |
| 409 | Conflict | 355 | Há uma solicitação em andamento e será necessário concluí-la antes de fazer outra. | Já há uma tarefa de replay em andamento para este webhook. |
| 429 | Too Many Requests | 88  | Limitado por taxa (atingiu o limite de solicitações por período). | Solicitações em excesso. Reduza a taxa de solicitações à API. |
| 500 | Internal Server Error | 0   | Erro interno do servidor. | Erro interno do servidor. |
| 503 | Service Unavailable | 67  | Um ou mais serviços dependentes no X estão indisponíveis. | Erro do servidor do X. Tente novamente usando um padrão de recuo exponencial. |

<div id="responses">
  #### Mensagem "Job completed successfully”
</div>

Quando sua tarefa for concluída com sucesso, a Account Activity Replay API entregará o seguinte evento de conclusão de tarefa. Assim que você receber esse evento, a tarefa terá sido finalizada e outra poderá ser enviada.

```json
{
  "replay\_job\_status": {
    "webhook_id": "1234577122340233217",
    "job_state": "Complete",
    "job\_state\_description": "Job completed successfully"
    "job_id": "1095098195724558337"
  }
}
```

<div id="job-completed-successfully-message">
  #### Mensagem "Job failed to complete"
</div>

Se a sua tarefa não for concluída com sucesso, retornaremos a seguinte mensagem recomendando que você tente executar novamente o seu job de Replay. Assim que você receber este evento, a tarefa terá concluído a execução e outra poderá ser enviada.

```json
{
  "replay\_job\_status": {
    "webhook_id": "123451374207332352",
    "job_state": "Incomplete",
    "job\_state\_description": "Job failed to deliver all events, please retry your replay job",
    "job_id": "1093226942650736640"
  }
}
```

<div id="job-failed-to-complete-message">
  #### Exemplo de requisição curl
</div>

```bash
    curl --request POST  --url 'https://api.x.com/1.1/account_activity/replay/webhooks/:webhook_id/subscriptions/all.json?from_date=yyyymmddhhmm&to_date=yyyymmddhhmm'
    --header 'authorization: Bearer TOKEN'
```

<div id="example-curl-request">
  #### Exemplo de resposta
</div>

HTTP 202

```bash
{
  "job_id": "1234567890",
  "created_at": "2016-06-02T23:54:02Z"
}
```