---
title: OAuth 에코
sidebarTitle: OAuth 에코
---

import { Button } from "/snippets/ko/button.mdx";


<div id="oauth-echo">
  ### OAuth Echo
</div>

OAuth Echo는 API와 상호작용하면서 제3자에게 OAuth 인증을 안전하게 위임하는 방법입니다.

이 상호작용에는 네 주체가 관여합니다:

* **사용자**: 특정한, 인증된 X 애플리케이션을 통해 X를 사용하는 사람
* **소비자(Consumer)**: 제3자 미디어 제공자(예: 사진 공유 사이트)와 상호작용하려는 X 애플리케이션
* **위임자(Delegator)**: 제3자 미디어 제공자
* **서비스 제공자(Service Provider)**: 즉, X 자체
     

요지는 애플리케이션과 사용자를 대신해 위임자가 X API에 보낼 요청을 준비하도록 하는 것입니다. 원래는 서명된 OAuth 요청이 될 내용을 HTTP 헤더에 넣고, 위임자에게 중간 작업을 마친 뒤 그 요청을 X로 전송해 달라고 요청합니다.

예를 들어, 사용자가 사진을 업로드하려 한다고 합시다. 소비자는 POST로 위임자의 업로드 엔드포인트를 호출합니다. 이 POST에는 이미지가 포함되어야 하며, 추가로 다음 두 가지 항목을 HTTP 헤더에 포함해야 합니다:

* `x-auth-service-provider` — 신원 위임을 전송해야 하는 대상 영역(realm)입니다. X의 경우 https://api.x.com/1.1/account/verify_credentials.json 로 설정합니다. iOS5 기반 X 통합은 이 URL에 추가 application_id 매개변수를 덧붙이며, 이는 x-verify-credentials-authorization에서 사용되는 oauth_signature 계산에도 사용됩니다.
* `x-verify-credentials-authorization` — 소비자는 OAuth를 사용해 HTTP 헤더에서 https://api.x.com/1.1/account/verify_credentials.json 를 호출할 수 있도록 필요한 모든 OAuth 매개변수를 생성해야 합니다(예: OAuth oauth_consumer_key=”...”, oauth_token=”...”, oauth_signature_method=”...”, oauth_signature=”...”, oauth_timestamp=”...”, oauth_nonce=”...”, oauth_version=”...” 형식).
     

전체 트랜잭션은 `oauth_timestamp`가 여전히 유효한 시간 내에 완료되어야 합니다.

대안으로, 이 두 매개변수를 헤더 대신 POST 본문에 x_auth_service_provider 및 x_verify_credentials_authorization 로 보낼 수도 있습니다. 이 경우 OAuth 서명 베이스 문자열에 해당 매개변수를 이스케이프하여 포함해야 함을 기억하십시오. 이는 일반적인 요청에서 매개변수를 인코딩하는 것과 유사합니다. 가능한 한 작업을 분리하기 위해 HTTP 헤더를 사용하는 것이 가장 좋습니다.

이 시점에서 위임자의 목표는 미디어를 저장하기 전에 사용자가 본인임을 확인하는 것입니다. 위임자가 업로드 메서드를 통해 위의 모든 데이터를 수신하면 이미지를 임시로 저장한 다음, x-auth-service-provider 헤더에 지정된 엔드포인트(이 경우 https://api.x.com/1.1/account/verify_credentials.json)를 소비자가 x-verify-credentials-authorization 헤더에서 제공한 동일한 OAuth 인증 헤더와 함께 호출하도록 요청을 구성해야 합니다.
 

<div id="oauth-echo-best-practices">
  #### OAuth Echo 모범 사례
</div>

조회 시에는 하드코딩된 값이 아니라 `x-auth-service-provider`에서 제공한 URL을 사용하십시오. 예를 들어 Apple iOS는 모든 OAuth 요청에 추가적인 application_id 매개변수를 추가하며, 이 매개변수는 OAuth Echo의 모든 단계에서 유지되어야 합니다.

OAuth 인가 단계에서는 x-verify-credentials-authorization의 헤더 값을 가져와 서비스 제공자 호출을 위한 별도의 Authorization 헤더에 넣으십시오. 추가로, `x-auth-service-provider`의 값이 올바른지 확인하십시오.

* 서비스 제공자가 HTTP 200을 반환하면 정상입니다. 위임자는 이미지를 영구적으로 저장하고 URL을 생성한 다음 반환해야 합니다.
* 서비스 제공자가 HTTP 200을 반환하지 않으면 이미지를 폐기하고 Consumer에게 오류를 반환하십시오.