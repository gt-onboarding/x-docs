---
title: 연결 끊김 처리
sidebarTitle: 연결 끊김 처리
---

<div id="what-is-a-disconnection">
  ### 연결 해제란 무엇인가요?
</div>

스트리밍 API에 연결한다는 것은 수명이 매우 긴 HTTPS 요청을 보내고 응답을 점진적으로 파싱하는 것을 의미합니다. 필터드 스트림 엔드포인트에 연결할 때는 HTTPS 요청을 보내고, 가능한 한 오래 결과 스트림을 소비해야 합니다. 서버 측 오류, 과도한 클라이언트 지연, 네트워크 문제, 정기적인 서버 유지 보수, 중복 로그인 등의 경우를 제외하면 서버는 연결을 무기한 유지합니다. 스트리밍 엔드포인트에 대한 연결에서는 연결 해제가 발생할 가능성이 높으므로 이를 예상하고 재연결 로직을 구현해야 합니다.
 

<div id="why-a-streaming-connection-might-be-disconnected">
  #### 스트리밍 연결이 끊길 수 있는 이유
</div>

스트림은 여러 가지 이유로 끊길 수 있습니다. 실패 원인을 파악하려면 스트림에서 반환된 오류 메시지를 확인하세요. 연결이 끊길 수 있는 가능한 이유는 다음과 같습니다:

- 인증 오류(잘못된 토큰 사용 또는 부적절한 인증 방식 사용 등).
- X 측에서 스트리밍 서버가 재시작됨. 보통 코드 배포와 관련이 있으며, 일반적으로 예상하고 대비해야 합니다.
- 클라이언트가 스트림이 전달하는 게시물 양을 따라가지 못하거나 데이터를 너무 느리게 읽는 경우. 모든 스트리밍 연결은 클라이언트로 전송할 메시지 큐를 기반으로 합니다. 이 큐가 시간이 지나며 과도하게 커지면 연결이 종료됩니다.
- 계정이 일간/월간 게시물 할당량을 초과함.
- 중복된 활성 연결이 너무 많음.
- 클라이언트가 갑자기 데이터 읽기를 중단함. 스트림에서 읽는 게시물의 속도가 급격히 떨어지면 연결이 종료됩니다.
- 서버와 클라이언트 간 네트워크 문제 가능성
- 일시적인 서버 측 이슈, 예정된 유지 보수 또는 업데이트. ([상태 페이지](https://api.twitterstat.us/) 확인)
   

#### 일반적인 연결 해제 오류 예시는 다음과 같습니다: 

```{
	"errors": [{
		"title": "operational-disconnect",
		"disconnect_type": "UpstreamOperationalDisconnect",
		"detail": "운영상의 이유로 상위에서 이 스트림이 연결 해제되었습니다.",
		"type": "https://api.x.com/2/problems/operational-disconnect"
	}]
}
```

```
{
	"title": "ConnectionException",
	"detail": "현재 이 스트림은 허용된 최대 연결 수에 도달했습니다.",
	"connection_issue": "TooManyConnections",
	"type": "https://api.x.com/2/problems/streaming-connection"
}
```

<div id="anticipating-disconnects-and-reconnecting">
  #### 연결 끊김을 대비하고 재연결하기
</div>

게시물을 스트리밍할 때는 연결이 끊길 수 있음을 염두에 두고, 가능한 한 오래 연결을 유지하는 것이 목표입니다. 이 엔드포인트는 20초 간격의 keep-alive 하트비트를 제공합니다(개행 문자처럼 보입니다). 이 신호를 사용해 연결이 끊겼는지 감지하세요.

1. 새 콘텐츠와 하트비트가 더 이상 도착하지 않는 상황을 코드에서 감지해야 합니다.
2. 그런 경우 재연결 로직을 실행해야 합니다. 일부 클라이언트와 언어는 읽기 타임아웃을 지정할 수 있으며, 이를 20초로 설정할 수 있습니다.
3. 서비스는 이러한 연결 끊김을 감지하고 가능한 한 빨리 재연결해야 합니다.

수립된 연결이 끊어지면 즉시 재연결을 시도하세요. 재연결이 실패하면 발생한 오류 유형에 따라 재연결 시도를 점진적으로 늦추세요:

- TCP/IP 수준의 네트워크 오류에는 선형 백오프를 적용합니다. 이러한 문제는 일반적으로 일시적이며 빠르게 해소되는 경향이 있습니다. 각 시도마다 재연결 지연을 250ms씩 늘려 최대 16초까지 늘리세요.
- 재연결이 적절한 HTTP 오류에는 지수 백오프를 적용합니다. 5초 대기로 시작해 시도할 때마다 두 배로 늘려 최대 320초까지 늘리세요.
- HTTP 429 오류(요율 제한 초과)에는 지수 백오프를 적용합니다. 1분 대기로 시작해 시도할 때마다 두 배로 늘리세요. HTTP 429를 받을 때마다 계정에 대한 요율 제한이 해제될 때까지 기다려야 하는 시간이 증가한다는 점에 유의하세요.
   

<div id="recovering-lost-data">
  #### 손실된 데이터 복구
</div>

연결이 끊기는 경우, 놓쳤을 수 있는 모든 데이터를 다시 받기 위해 사용할 수 있는 여러 가지 전략이 있습니다. 누락된 데이터를 복구하는 데 도움이 되는 핵심 단계는 [데이터 복구](/ko/x-api/posts/filtered-stream/integrate/recovery-and-redundancy-features) 통합 가이드에 자세히 정리되어 있습니다. 
 

<div id="rate-limits-and-usage">
  #### 속도 제한 및 사용량
</div>

연결 제한을 확인하려면 응답에 세 개의 헤더가 포함됩니다. 이는 규칙 엔드포인트를 얼마나 자주 호출할 수 있는지와 스트리밍 엔드포인트에서 허용되는 재연결 시도 횟수를 파악하는 데 유용합니다.

- x-rate-limit-limit은 15분 윈도우 동안 클라이언트가 수행할 수 있도록 할당된 요청 수를 나타냅니다.

- x-rate-limit-remaining은 해당 15분 윈도우에서 지금까지 수행된 요청 수를 나타냅니다.

- x-rate-limit-reset은 15분 윈도우가 언제 재시작되어 x-rate-limit-remaining이 0으로 초기화되는지를 나타내는 UNIX 타임스탬프입니다.

Filtered Stream 엔드포인트는 현재 사용량 데이터를 보고하지 않습니다. 전달된 게시물(Post) 수를 확인하려면, 코드에 계량(metering) 로직을 구현하여 소비량을 측정하고 필요 시 일시 중지할 수 있도록 하세요.

스트림의 클라이언트 측을 호스팅하는 코드는 수신된 게시물을 선입선출(FIFO) 큐 또는 유사한 메모리 구조에 삽입하면 됩니다. 별도의 프로세스/스레드가 해당 큐에서 게시물을 소비하여 파싱하고 저장을 위한 콘텐츠를 준비해야 합니다. 이러한 설계를 통해 수신 게시물량이 급격히 변하는 경우에도 효율적으로 확장 가능한 서비스를 구현할 수 있습니다. 개념적으로는 HTTP를 통해 무한히 긴 파일을 다운로드하는 것으로 이해할 수 있습니다.

<div id="reconnection-best-practices">
  #### 재연결 모범 사례
</div>

**백오프 전략 테스트**

백오프 구현을 테스트하는 좋은 방법은 잘못된 인증 자격 증명을 사용해 재연결 시도를 관찰하는 것입니다. 올바른 구현이라면 429 응답이 발생하지 않습니다.

**여러 차례 재연결에 대한 경보 설정**

클라이언트가 재연결 간의 최대 임계 시간에 도달하면, 연결에 영향을 주는 문제를 신속히 분류할 수 있도록 알림을 전송해야 합니다.

**DNS 변경 처리**

클라이언트 프로세스가 DNS TTL(Time To Live)을 준수하는지 테스트하십시오. 일부 스택은 프로세스 실행 동안 해석된 주소를 캐시하여, 지정된 TTL 내의 DNS 변경을 반영하지 않을 수 있습니다. 이러한 과도한 캐싱은 X가 IP 주소 간에 부하를 분산할 때 클라이언트 측 서비스 중단을 유발할 수 있습니다.

**User Agent**

user-agent HTTP 헤더에 클라이언트 버전을 포함하십시오. 이는 X 측 문제 진단에 매우 중요합니다. 환경상 user-agent 필드를 설정할 수 없다면 x-user-agent 헤더를 설정하십시오.