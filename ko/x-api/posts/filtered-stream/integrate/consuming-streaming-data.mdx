---
title: 스트리밍 데이터 사용
sidebarTitle: 스트리밍 데이터 사용
---

<div id="building-a-client-to-consume-streaming-data">
  ### 스트리밍 데이터를 수신하는 클라이언트 구축
</div>

스트리밍 엔드포인트를 사용할 때는 사용을 최적화하기 위해 고려해야 할 일반적인 모범 사례가 있습니다.  
 

<div id="client-design">
  #### 클라이언트 설계
</div>

필터드 스트림 엔드포인트로 솔루션을 구축할 때는 다음을 수행할 수 있는 클라이언트가 필요합니다:

1. 필터드 스트림 엔드포인트에 HTTPS 스트리밍 연결을 설정합니다.
2. 스트림의 규칙을 추가·삭제하기 위해 필터드 스트림 규칙 엔드포인트로 POST 요청을 비동기적으로 전송합니다.
3. 저량 데이터 처리 – 스트리밍 연결을 유지하고 Post 객체와 keep-alive 신호를 감지합니다.
4. 대량 데이터 처리 – 비동기 처리로 스트림 수집을 후속 처리와 분리하고, 클라이언트 측 버퍼를 정기적으로 플러시합니다.
5. 클라이언트 측에서 데이터 사용량(볼륨) 추적을 관리합니다.
6. 스트림 연결 해제를 감지하고 평가하여 자동으로 재연결합니다.
    

<div id="connecting-to-a-streaming-endpoint">
  #### 스트리밍 엔드포인트에 연결하기
</div>

X API v2 스트리밍 엔드포인트에 연결한다는 것은 수명이 매우 긴 HTTP 요청을 열고 응답을 순차적으로 파싱하는 것을 의미합니다. 개념적으로는 HTTP를 통해 끝없이 긴 파일을 다운로드하는 것과 같습니다. 연결이 수립되면 연결이 유지되는 동안 X 서버는 해당 연결을 통해 게시 이벤트를 전달합니다.
 

<div id="consuming-data">
  #### 데이터 소비
</div>

JSON 객체의 개별 필드는 순서가 보장되지 않으며, 모든 상황에서 모든 필드가 존재하는 것은 아닙니다. 마찬가지로, 개별 활동은 정렬된 순서로 전달되지 않고, 중복 메시지가 발생할 수 있습니다. 시간이 지나면서 새로운 메시지 유형이 추가되어 스트림을 통해 전송될 수 있다는 점을 유의하세요.

따라서 클라이언트는 다음을 허용해야 합니다:

- 임의의 순서로 나타나는 필드
- 예기치 않거나 누락된 필드
- 정렬되지 않은 게시물
- 중복 메시지
- 언제든지 스트림으로 전달될 수 있는 임의의 새로운 메시지 유형

관련 게시물 데이터와 요청한 필드 매개변수 외에도, 스트림 연결에서는 다음과 같은 유형의 메시지가 전달될 수 있습니다. 이 목록이 포괄적이지 않을 수 있으며, 추가 객체가 스트림에 도입될 수 있음을 유의하세요. 파서가 예기치 않은 메시지 형식을 허용하도록 구현하세요.
 

#### 버퍼링 

스트리밍 엔드포인트는 데이터가 사용 가능해지는 즉시 전송하므로 많은 경우 데이터량이 매우 커질 수 있습니다. X 서버가 스트림에 새 데이터를 곧바로 기록할 수 없을 때(예: 클라이언트가 충분히 빠르게 읽지 못하는 경우. 자세한 내용은 [연결 해제 처리](/ko/x-api/posts/filtered-stream#what-is-a-disconnection) 참조) 서버 측에서 콘텐츠를 버퍼링하여 클라이언트가 따라잡을 수 있도록 합니다. 다만 이 버퍼가 가득 차면 연결을 끊는 강제 연결 해제가 발생하며, 버퍼에 쌓여 있던 Posts는 폐기되고 재전송되지 않습니다. 자세한 내용은 아래를 참조하세요.

앱이 처리 속도에서 뒤처지는 시점을 파악하는 한 가지 방법은 수신 중인 Posts의 타임스탬프를 현재 시간과 비교하고 이를 시간에 따라 추적하는 것입니다.

공용 인터넷의 잠재적인 지연과 일시적 장애로 인해 스트림의 정체를 완전히 없앨 수는 없지만, 앱을 적절히 구성하면 상당 부분 줄일 수 있습니다. 정체 발생을 최소화하려면:

- 클라이언트가 스트림을 충분히 빠르게 읽고 있는지 확인하세요. 일반적으로 스트림을 읽는 동안 실질적인 처리 작업은 하지 않는 것이 좋습니다. 스트림은 읽기만 하고, 처리 작업은 다른 스레드/프로세스/데이터 저장소로 넘겨 비동기적으로 수행하세요.
- 데이터 센터에 대규모의 지속 트래픽과 그보다 훨씬 큰 스파이크(예: 평시의 5~10배)를 감당할 충분한 인바운드 대역폭이 있는지 확인하세요. 필터드 스트림의 경우, 귀하 측에서 필요한 데이터량과 대역폭은 규칙이 어떤 Posts와 일치하느냐에 전적으로 좌우됩니다.
   

<div id="usage-tracking-and-rule-management">
  #### 사용량 추적 및 규칙 관리
</div>

개발자마다 자신의 스트림에서 “정상적인” 데이터 볼륨에 대한 기대치가 다르므로, 특정 퍼센트 증감이나 기간에 대한 일반적인 권장치는 제공하지 않습니다.

예기치 않은 변동이 있는지 스트림의 데이터 볼륨을 모니터링하세요. 데이터 볼륨 감소는 스트림 연결 해제와는 다른 문제를 시사할 수 있습니다. 이런 경우 스트림은 여전히 keep-alive 신호와 일부 신규 활동 데이터를 수신할 수 있습니다. 그러나 게시물 수가 눈에 띄게 줄었다면, 애플리케이션이나 네트워크로 유입되는 데이터 볼륨을 감소시키는 원인이 있는지 조사하고, 관련 공지가 있는지 [상태 페이지](https://api.twitterstat.us/)를 확인해야 합니다.

이러한 모니터링을 구현하려면, 일정 시간 동안 기대하는 신규 게시물 수를 추적하세요. 스트림의 데이터 볼륨이 지정한 임계값보다 충분히 낮아지고 설정한 기간 내에 회복되지 않으면 경고와 알림을 발송해야 합니다. 특히 필터드 스트림에서 규칙을 수정하는 중이거나 게시물 활동이 급증하는 이벤트가 발생한 경우에는 데이터 볼륨의 큰 증가도 함께 모니터링하는 것이 좋습니다.

필터드 스트림을 통해 전달되는 게시물은 월간 총 게시물 볼륨에 포함되므로, 최적화를 위해 소비량을 추적하고 조정해야 합니다. 볼륨이 높다면, 각 규칙에 sample: 연산자를 추가하여 필요 시 100% 일치에서 sample:50 또는 sample:25로 낮추는 것을 고려하세요.

또한 미리 설정한 임계값을 초과할 경우 팀에 알림을 보내는 기능을 앱에 구현하고, 과도한 데이터를 유입시키는 규칙을 자동으로 삭제하거나, 극단적인 경우 스트림 연결을 완전히 종료하는 등의 추가 조치도 도입할 것을 권장합니다.
 

<div id="responding-to-system-messages">
  #### 시스템 메시지에 대한 응답
</div>

Keep-alive 신호
스트림은 최소 20초마다 열린 연결을 통해 \r\n 캐리지 리턴 형태의 keep-alive 신호(하트비트)를 보내 클라이언트의 타임아웃을 방지합니다. 클라이언트 애플리케이션은 스트림에 포함된 \r\n 문자를 허용하도록 구현되어야 합니다.

클라이언트가 HTTP 라이브러리에서 읽기 타임아웃을 올바르게 구현했다면, 해당 기간 동안 데이터가 읽히지 않을 경우 HTTP 프로토콜과 HTTP 라이브러리가 이벤트를 발생시키므로 \r\n 문자를 명시적으로 모니터링할 필요가 없습니다.

이 이벤트는 사용 중인 HTTP 라이브러리에 따라 일반적으로 예외가 발생하거나 다른 형태의 이벤트로 전달됩니다. 이러한 타임아웃을 감지하기 위해 HTTP 메서드에 오류/이벤트 핸들러를 래핑하는 것을 강력히 권장합니다. 타임아웃 발생 시 애플리케이션은 재연결을 시도해야 합니다.

오류 메시지
v2 스트리밍 엔드포인트는 스트림 내에서 오류 메시지를 전달할 수 있습니다. 아래에는 이러한 메시지의 기본 형식과 몇 가지 예시가 제공됩니다. 제공되는 메시지는 변경될 수 있으며, 새로운 메시지가 도입될 수 있습니다. 클라이언트 애플리케이션은 변경될 수 있는 시스템 메시지 페이로드에 유연하게 대응해야 합니다.

오류 메시지에는 문제 해결 방법을 설명하는 문서로 연결되는 링크가 포함됩니다.

메시지 형식:

```{
	"errors": [{
		"title": "operational-disconnect",
		"disconnect_type": "UpstreamOperationalDisconnect",
		"detail": "This stream has been disconnected upstream for operational reasons.",
		"type": "https://api.x.com/2/problems/operational-disconnect"
	}]
}
```

버퍼가 가득 차 강제 연결 해제가 발생하는 경우, 이를 알리는 오류 메시지가 강제 해제를 유발한 병목 때문에 클라이언트에 도달하지 못할 수 있습니다. 따라서 재연결을 시작하기 위해 이러한 메시지에 의존해서는 안 됩니다.