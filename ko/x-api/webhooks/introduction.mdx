<div id="v2-webhooks-api">
  # V2 웹훅 API
</div>

<div id="overview">
  ## 개요
</div>

V2 Webhooks API는 개발자가 웹훅 기반 JSON 메시지를 통해 X 계정의 실시간 이벤트 알림을 수신할 수 있도록 합니다. 이 API를 사용하면 웹훅을 등록 및 관리하고, 이벤트를 처리하는 컨슈머 애플리케이션을 개발하며, 챌린지-리스폰스 체크(CRC)와 서명 헤더를 통해 안전한 통신을 보장할 수 있습니다.

<div id="feature-summary">
  ## 기능 요약
</div>

| 등급 | 가격 | 웹훅 수 |
| :---: | :---: | :---: |
| 셀프-서브 Pro | 월 $5,000 | 1 |
| 엔터프라이즈 | [영업팀 문의](/ko/resources/enterprise/forms/enterprise-api-interest#enterprise-access-form) | 5개 이상 |

<div id="products-that-support-webhooks">
  ## 웹훅을 지원하는 제품
</div>

다음은 현재 웹훅으로 이벤트 전달을 지원하는 제품입니다:

- [Account Activity API (AAA)](/ko/x-api/account-activity/introduction)
- [Filtered Stream](/ko/x-api/webhooks/stream/introduction)

<div id="manage-webhooks">
  ## 웹훅 관리
</div>

Account Activity API는 귀하의 서비스에 구독된 X 계정에 관련된 이벤트가 발생할 때마다 웹훅 기반 JSON 메시지를 제공합니다. X는 해당 활동을 등록된 웹훅으로 전달합니다. 다음 단계에서는 웹훅과 구독 사용자 관리 방법을 알아봅니다.

웹훅과 구독 사용자를 등록, 조회, 제거하는 방법을 다룹니다. 다양한 API 엔드포인트에 요청하기 위해 간단한 cURL 명령을 사용할 것입니다. cURL은 URL 구문을 사용해 요청을 전송하거나 가져오는 명령줄 도구입니다.

이벤트 컨슈머 애플리케이션에서 웹훅 이벤트를 수신하기 전에 확인해야 할 사항이 몇 가지 있습니다. 아래 설명대로 X 앱을 생성하고 Account Activity API 액세스를 확보하며, 웹훅 이벤트를 처리하는 웹 애플리케이션을 개발해야 합니다. 

<div id="1-develop-a-webhook-consumer-app">
  ### 1. 웹훅 컨슈머 앱 개발
</div>

X 앱에 연결된 새 웹훅을 등록하려면 X 웹훅 이벤트를 수신하고 보안 요청에 응답하는 웹 앱을 개발, 배포, 호스팅해야 합니다.

_시작하기 전에 [샘플 앱](https://github.com/xdevplatform/account-activity-dashboard-enterprise/tree/master)을 확인하는 것을 권장합니다!_

- 이벤트를 수신하는 웹훅 엔드포인트로 동작할, 공개적으로 접근 가능한 HTTPS URL을 가진 웹 앱을 만드세요.
  - URI의 경로(path)는 전적으로 자유롭게 정할 수 있습니다. 다음 예시는 유효합니다: [https://mydomain.com/service/listen](https://mydomain.com/service/listen)
  - 여러 소스의 웹훅을 수신하는 경우 일반적인 패턴은 다음과 같습니다: [https://mydomain.com/webhook/twitter](https://mydomain.com/webhook/twitter)
  - 지정한 URL에는 포트 번호를 포함할 수 없습니다([https://mydomain.com:5000/NoWorkie](https://mydomain.com:5000/NoWorkie)).
- 첫 단계는 X Challenge Response Check(CRC) GET 요청을 수신하고 올바르게 형식화된 JSON으로 응답하는 코드를 작성하는 것입니다.
- 웹훅 URL을 등록하세요. JSON 본문에 URL을 포함해 /2/webhooks 엔드포인트로 POST 요청을 보냅니다. 이 요청을 보내면 X가 CRC 요청을 웹 앱으로 전송합니다.
- 웹훅이 성공적으로 등록되면 응답에 웹훅 ID가 포함됩니다. 이 웹훅 ID는 이후 웹훅을 지원하는 제품에 요청할 때 필요합니다.
- X는 등록한 URL로 이벤트가 포함된 POST 요청을 전송합니다. 이러한 이벤트는 JSON으로 인코딩됩니다. 예시 웹훅 JSON 페이로드는 [여기](/ko/x-api/account-activity/introduction#account-activity-data-object-structure)를 참조하세요.

<div id="optional-use-xurl-for-testing">
  #### 선택 사항: 테스트에 xurl 사용
</div>

테스트를 위해 이제 xurl 도구가 임시 웹후크를 지원합니다! GitHub에서 [`xurl` 프로젝트](https://github.com/xdevplatform/xurl)의 최신 버전을 설치하고 권한 설정을 구성한 뒤, 다음을 실행하세요:

```
xurl webhook start
```

이 명령은 임시 공개 웹후크 URL을 생성하고, CRC 검사를 자동으로 처리하며, 들어오는 구독 이벤트를 모두 로그로 남깁니다. 배포 전에 설정을 검증하기에 좋은 방법입니다. 예시 출력:

```
Starting webhook server with ngrok...
Enter your ngrok authtoken (leave empty to try NGROK_AUTHTOKEN env var):

Attempting to use NGROK_AUTHTOKEN environment variable for ngrok authentication.
Configuring ngrok to forward to local port: 8080
Ngrok tunnel established!
  Forwarding URL: https://<your-ngrok-subdomain>.ngrok-free.app -> localhost:8080

Use this URL for your X API webhook registration: https://<your-ngrok-subdomain>.ngrok-free.app/webhook

Starting local HTTP server to handle requests from ngrok tunnel (forwarded from https://<your-ngrok-subdomain>.ngrok-free.app)...
```

**중요한 참고 사항**

- 웹후크 URL을 등록할 때 웹 앱은 CRC 검사 암호화를 위해 앱의 consumer secret을 사용해야 합니다.

- 모든 수신 다이렉트 메시지는 웹후크로 전달됩니다. 또한 [POST /2/dm\_conversations/with/:participant\_id/messages](/ko/x-api/direct-messages/send-a-new-message-to-a-user)로 전송된 다이렉트 메시지도 웹후크로 전달됩니다. 이는 다른 클라이언트를 통해 전송된 다이렉트 메시지도 웹 앱이 인지할 수 있도록 하기 위함입니다.

- 동일한 웹후크 URL을 공유하고 각 앱에 동일한 사용자가 매핑된 웹 앱이 둘 이상인 경우, 동일한 이벤트가 웹후크로 여러 번 전송됩니다(웹 앱당 한 번).

- 경우에 따라 웹후크가 중복 이벤트를 수신할 수 있습니다. 웹후크 앱은 이에 내구성이 있어야 하며 이벤트 ID로 중복을 제거해야 합니다.

- 예제 코드:

  - [Account Activity API Setup](https://github.com/m-rosinsky/XWebhookTest): Account Activity API의 엔터프라이즈 티어를 사용해 웹후크 이벤트를 표시하는 Node 웹 앱.

<div id="2-securing-webhooks">
  ### 2. 웹훅 보안
</div>

X의 웹훅 기반 API는 웹훅 서버의 보안을 확인하는 두 가지 방법을 제공합니다:

1. 챌린지-응답 검사를 통해 X는 웹훅 이벤트를 수신하는 웹앱의 소유권을 확인할 수 있습니다.
2. 각 POST 요청의 서명 헤더를 통해 수신된 웹훅의 발신자가 X인지 확인할 수 있습니다.

구현 세부사항은 CRC 체크 섹션을 참고하세요.

<div id="3-the-webhooks-api">
  ### 3. Webhooks API
</div>

Webhooks는 Webhook Management API를 통해 관리됩니다. 모든 엔드포인트에는 OAuth 2.0 앱 전용 베어러 토큰 인증이 필요합니다.

<div id="adding-a-webhook">
  #### [웹훅 추가하기](/ko/x-api/webhooks/create-webhook-config)
</div>

**POST /2/webhooks**

**설명:**

웹훅 구성을 생성합니다. 공개적으로 접근 가능한 `https` 콜백 URL을 JSON 본문에 포함해 전달해야 합니다.\
주어진 애플리케이션 컨텍스트에 대해 새 웹훅 URL을 등록하는 것부터 시작합니다.

**인증:**

OAuth2 App Only Bearer Token

- **Bearer 토큰** `<BEARER_TOKEN>` 예: `AAAAAAAAAAAA0%2EUifi76ZC9Ub0wn...`

**매개변수 (JSON 본문):**

```
{
    "url": "<your publicly accessible https callback url>"
}
```

- **URL** `<URL>` 예: `https://yourdomain.com/webhooks/twitter/`

**요청:** 아래 cURL 요청에서 필요한 값을 변경한 후, 명령줄에 복사해 실행하세요:

````
  ```
  curl --request POST --url 'https://api.twitter.com/2/webhooks?url=<URL>' --header 'authorization: Bearer <BEARER_TOKEN>'
  --data '{
"url": "https://yourdomain.com/webhooks/twitter"
          }'
  ```
````

**응답:**

**성공 (200 OK)**

요청이 성공하면 웹훅이 생성되고 초기 CRC 검사에 통과했음을 나타냅니다.

```
{
  "data": {
    "id": "<webhook_id>",
    "url": "<your callback url>",
    "valid": true,
    "created_at": "YYYY-mm-DDTHH:MM:ss.000Z"
  }
}
```

**실패 (400 Bad Request)**

실패 시 표준 오류 객체가 반환됩니다.

```
{
    "errors": [
      {
        "message": "<Reason>: <Details>"
      }
    ],
    "title": "Invalid Request",
    "detail": "One or more parameters to your request was invalid.",
    "type": "https://api.twitter.com/2/problems/invalid-request"
}
```

실패의 일반적인 원인은 다음과 같습니다:

| Reason | Description |
| :---- | :---- |
| `CrcValidationFailed` | 콜백 URL이 CRC 검사에 올바르게 응답하지 않았습니다(예: 시간 초과, 잘못된 응답). |
| `UrlValidationFailed` | 제공된 콜백 URL이 요구 사항을 충족하지 않습니다(예: `https`가 아님, 형식이 올바르지 않음). |
| `DuplicateUrlFailed` | 제공된 콜백 URL에 대해 해당 애플리케이션에 이미 웹훅이 등록되어 있습니다. |
| `WebhookLimitExceeded` | 애플리케이션이 허용된 웹훅 구성의 최대 개수에 도달했습니다. |

<div id="viewing-a-webhook">
  #### [웹훅 보기](/ko/x-api/webhooks/get-a-list-of-webhook-configs-associated-with-a-client-app)
</div>

**GET /2/webhooks**

**설명:** 애플리케이션(개발자 계정)에 연결된 모든 웹훅 구성을 조회합니다.

**인증:**

OAuth2 App Only Bearer Token

- **Bearer token** `<BEARER_TOKEN>` 예: `AAAAAAAAAAAA0%2EUifi76ZC9Ub0wn...`

- **URL** `<URL>` 예: `https://yourdomain.com/webhooks/twitter/`

**요청:** 다음 명령을 실행하여 지정된 애플리케이션에 등록된 모든 웹훅 URL과 그 상태를 조회합니다.

아래 cURL 요청에서 필요한 값을 수정한 뒤 명령줄에 복사하여 실행하세요:

````
  ```
  curl --request GET --url 'https://api.twitter.com/2/webhooks' --header 'authorization: Bearer <BEARER_TOKEN>'
  ```
````

**성공 (200 OK)**

웹훅 구성 목록을 반환합니다. 웹훅이 구성되어 있지 않다면 목록은 비어 있습니다.

_예시(웹훅이 하나 구성된 경우):_

```
{
  "data": [
    {
      "created_at": "YYYY-mm-DDTHH:MM:ss.000Z",
      "id": "<webhook_id>",
      "url": "<callback url>",
      "valid": true
    }
  ],
  "meta": {
    "result_count": 1
  }
}
```

_예시(웹훅이 구성되지 않은 경우):_

```
{
  "data": [],
  "meta": {
    "result_count": 0
  }
}
```

<div id="removing-a-webhook">
  #### [웹훅 제거](/ko/x-api/webhooks/delete-webhook-config)
</div>

DELETE /2/webhooks/:webhook\_id

**설명:** 특정 `webhook_id`를 사용해 웹훅 구성을 삭제합니다. 이 ID는 `POST /2/webhooks` 생성 응답 또는 `GET /2/webhooks` 목록 응답에서 확인할 수 있습니다.

**인증:**

OAuth2 앱 전용 Bearer 토큰

- **Bearer 토큰** `<BEARER_TOKEN>` 예: `AAAAAAAAAAAA0%2EUifi76ZC9Ub0wn...`

**경로 매개변수:**

| 매개변수 | 설명 |
| :---- | :---- |
| `webhook_id` | 삭제할 웹훅의 ID입니다. |

**요청:** 제공된 애플리케이션의 구성에서 웹훅을 제거하려면 다음 명령을 실행하세요.

아래 cURL 요청에서 필요한 값을 수정한 뒤 커맨드 라인에 복사해 실행하세요:

````
  ```
  curl --request DELETE --url 'https://api.twitter.com/2/webhooks/:WEBHOOK_ID' --header 'authorization: Bearer <BEARER_TOKEN>'
  ```

  **응답:**
````

**성공 (200 OK)**

성공적으로 삭제된 경우 "deleted" 상태가 true인 JSON 응답을 반환합니다.

_예시(웹훅이 성공적으로 삭제된 경우):_

```
{
  "data": {
    "deleted": true
  }
}
```

**실패 (400 Bad Request)**

| 이유 | 설명 |
| :---- | :---- |
| `WebhookIdInvalid` | 제공된 `webhook_id`를 찾을 수 없거나 앱과 연관되어 있지 않습니다. |

<div id="validate-and-reenable-webhook">
  #### [웹훅 유효성 검증 및 재활성화](/ko/x-api/webhooks/webhook-crc-check)
</div>

**PUT /2/webhooks/:webhook\_id**

**설명:** 지정된 웹훅의 URL에 대해 CRC(Challenge Response Check)를 트리거합니다. 검사가 성공하면 200을 반환하고 상태를 `valid`로 설정하여 웹훅을 재활성화합니다.

**인증:**

OAuth2 App Only Bearer Token

- **Bearer token** `<BEARER_TOKEN>` 예: `AAAAAAAAAAAA0%2EUifi76ZC9Ub0wn...`

**경로 매개변수:**

| 매개변수 | 설명 |
| :---- | :---- |
| `webhook_id` | 유효성을 검증할 웹훅의 ID입니다. |

**요청:** 제공된 애플리케이션 구성에서 웹훅을 검증하려면 다음 명령을 실행하세요.

아래 cURL 요청의 필요 부분을 변경한 뒤 명령줄에 복사해 실행하세요:

````
  ```
  curl --request PUT --url 'https://api.twitter.com/2/webhooks/:WEBHOOK_ID' --header 'authorization: Bearer <BEARER_TOKEN>'
  ```

  **응답:**
````

**성공 (200 OK)**

200 OK 응답은 CRC 검사 요청이 _시작되었&#xC74C;_&#xC744; 나타냅니다. 이는 CRC 검사가 통과되었음을 보장하지 **않습니다**. 응답의 `valid` 필드는 검사 시도 _이&#xD6C4;_&#xC758; 상태를 반영합니다. CRC 검사가 성공하면 웹훅의 상태가 valid로 업데이트됩니다. 현재 상태는 `GET /2/webhooks`로 확인할 수 있습니다.

```
{
  "data": {
    "valid": true // CRC 검사 시도가 완료된 후의 상태를 나타냅니다
  }
}
```

**실패 (400 Bad Request)**

| 사유 | 설명 |
| :---- | :---- |
| `WebhookIdInvalid` | 제공된 `webhook_id`를 찾을 수 없거나 앱과 연결되어 있지 않습니다. |
| `CrcValidationFailed` | 콜백 URL이 CRC 검사 요청에 올바르게 응답하지 않았습니다. |

<div id="4-the-crc-check">
  ### 4. CRC 검사
</div>

Challenge Response Check(CRC)는 제공한 콜백 URL이 유효하며 해당 URL을 여러분이 제어하고 있음을 X가 검증하는 방식입니다.

**CRC가 실행되는 시점:**

- 최초 웹훅 등록 시(`POST /2/webhooks`)
- X에 의한 매시간 유효성 검사
- `PUT /2/webhooks/:id`를 통한 수동 실행

예시:

```
GET https://your-webhook-url.com/webhook?crc_token=challenge_string
```

예시 JSON 응답 본문:

```
{
  "response_token": "sha256=<base64_encoded_hmac_hash>"
}
```

**응답 생성 방법:**

- crc\_token을 메시지로 사용
- 앱의 **consumer secret**을 키로 사용
- HMAC SHA-256 해시 생성
- 결과를 Base64로 인코딩

<div id="sample-apps">
  ## 샘플 앱
</div>

- [Simple webhook server](https://github.com/m-rosinsky/XWebhookTest/blob/main/app.py)
  - CRC 체크에 응답하고 POST 이벤트를 수신하는 방법을 보여주는 단일 Python 스크립트입니다.
- [Account Activity API sample dashboard](https://github.com/xdevplatform/account-activity-dashboard-enterprise/tree/master)
  - 앱 내에서 웹후크와 구독을 관리하고 실시간 이벤트를 직접 수신할 수 있도록 [bun.sh](https://bun.sh)로 작성된 웹 앱입니다.